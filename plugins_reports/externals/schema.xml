<?xml version="1.0"?>
<ReportSchema xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <Reports>
    <Report Id="105" Name="Акт сдачи-приемки прикрепленного населения (отправляется в страховые компании)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Акт сдачи-приемки прикрепленного населения (отправляется в страховые компании).xls">
      <Queries>
        <Query>
          <Sql>itogo_people select count(*) from ( 
select distinct prik_zayav_tab.dan_id, max(date_prik) 
from prik_zayav_tab p 
 left join dan_tab d on prik_zayav_tab.dan_id=d.dan_id 
 where date_prik between date(':period_1_1_:') and date(':period_1_2_:') 
and :uchastok_1_: 
 and :period_2_1_: 
group by 1) f</Sql>
        </Query>
        <Query>
          <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
        </Query>
        <Query>
          <Sql>strcom_name select name from codifiers.strcom_tab where id=:period_2_1_:</Sql>
        </Query>
        <Query>
          <Sql>zapros1 select DISTINCT '$id', p.fam||' '||p.nam||' '||conv_to_null(p.mid) as param_1_1_, p.ser_pol as param_1_2_,  
p.num_pol as param_1_3_, max(date_prik) as param_1_4_, d.date_born, d.address, coalesce(serdoc,'')||' '||coalesce(numdoc,'') as pasport 
from prik_zayav_tab p 
left join dan_tab d on p.dan_id=d.dan_id 
 where date_prik between date(':period_1_1_:') and date(':period_1_2_:') 
and :uchastok_1_: 
 and :period_2_1_:  
group by 1,2,3,4,6,7,8 
 order by param_1_1_</Sql>
        </Query>
        <Query>
          <Sql>zapros4 select count(*) from 
(select DISTINCT '$id', p.fam||' '||p.nam||' '||p.mid as param_1_1_, p.ser_pol as param_1_2_,  p.num_pol as param_1_3_, 
max(date_prik) as param_1_4_ 
from prik_zayav_tab p 
 left join dan_tab d on p.dan_id=d.dan_id 
 where date_prik between date(':period_1_1_:') and date(':period_1_2_:') 
and :uchastok_1_: 
 and :period_2_1_: 
group by 1,2,3,4 
 order by param_1_1_ ) as f</Sql>
        </Query>
      </Queries>
      <Parameters>
        <Parameter Name="period_1" Caption="Дата" Type="date_period">
          <Sql />
        </Parameter>
        <Parameter Name="period_2" Caption="СМО" Type="select">
          <Sql>select 'true','Все',0 union select 'p.strcom_id='||id, name,1 from codifiers.strcom_tab where region_id='0300000000000' order by 3,2</Sql>
        </Parameter>
        <Parameter Name="uchastok" Caption="Участок" Type="select">
          <Sql>select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab order by 3,2</Sql>
        </Parameter>
      </Parameters>
    </Report>
    <Report Id="175" Name="Список врачей" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Список врачей.xls">
      <Queries>
        <Query>
          <Sql>zapros1 SELECT coalesce(f.fam,'')||' '||coalesce(f.nam,'')||' '||coalesce(f.mid,'') as fio, 
f.full_doctor_id,  f.kod_feld,f.dolg_doctor, o.nam_otdel, 
u.name as uch, f.date_born 
FROm  full_doctor_tab f 
LEFT JOIN otdel_tab o ON o.otdel::text = f.otdel 
left join doctor_tab doc on doc.id=f.full_doctor_id   
left join codifiers.uchactok_tab u on u.id=doc.uchastok_id 
ORDER BY 1,2,3</Sql>
        </Query>
      </Queries>
      <Parameters />
    </Report>
    <Report Id="188" Name="Количество посещений по районам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Количество посещений по районам.xls">
      <Queries>
        <Query>
          <Sql>zapros SELECT DISTINCT 
CASE WHEN s1.name IS NOT NULL THEN s1.name ELSE s2.name END AS p0 , count(visit_id) as p1 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN kladr_tab s1 ON d.raion_id = s1.code 
LEFT JOIN kladr_tab s2 ON d.town_id = s2.code 
WHERE v.data_vnes_inf BETWEEN ':period_1_:' AND  ':period_2_:' 
AND d.region_id='0300000000000' 
GROUP BY p0 ORDER BY p0</Sql>
        </Query>
      </Queries>
      <Parameters>
        <Parameter Name="period" Caption="Дата" Type="date_period">
          <Sql />
        </Parameter>
      </Parameters>
    </Report>
    <Report Id="210010" Name="Акт сдачи-приемки (DBF)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Акт сдачи-приемки (DBF).xls">
      <Queries>
        <Query>
          <Sql>zapros1 SELECT DISTINCT  (case when p.ser_pol is not null then p.ser_pol else d.ser_pol end) AS p5, 
(case when p.num_pol is not null then text_to_int(p.num_pol)::numeric else text_to_int(d.num_pol)::numeric end) AS p6, 
(case when p.fam is not null then p.fam else d.fam end) AS p1, 
(case when p.nam is not null then p.nam else d.nam end) AS p2, 
(case when p.mid is not null then p.mid else d.mid end) AS p3, 
d.date_born AS p4, 
(case when p.strcom_id is not null then p.strcom_id else d.strcom_id end)  AS p7, 
d.pens, d.serdoc||' '||d.numdoc as sn_pasp, d.date_output as d_pasp, 
d.kem_output  as n_pasp, 
substr(d.street_id,13,5) as street_id, d.dom, d.korp, d.kv, '' as str, d.telephon, 
case when position(' РЕГ' in a1.text_address)&lt;&gt;0 then substr(a1.text_address,1,position(' РЕГ' in a1.text_address)) else a1.text_address end as address, 
d.okvd, d.date_vnes_inf as sysdate, 
'' as s_kms,	0 as n_kms,	'' as q_pasp, s.code as q, '' as ql, (case when d.sex='м' then 1 else 2 end) as w, 
substr(kl.kod_oms,1,case when position(',' in kl.kod_oms)=0 then length(kl.kod_oms) else position(',' in kl.kod_oms)-1 end) as regs, 
d.dan_id as danid, '' as old_s_pol, '' as old_n_pol, '' as old_fam, '' as d2, d.date_smerti as ds, '' as del_pol, d.med_karta_kod as card, 
'' as tu, '' as kateg, '' as katpfr, '' as okrug, '' as dkat, '' as dskat, '' as fin, '' as sp, '' as ved, '' as work, '' as ndog, 
'' as workp, '' as gr, '' as ser1, '' as num1, '' as ser2, '' as num2, k.health_group as grzd, '' as dopdisp, '' as tp, 
max(date_delivery_disp) as ddisp, 0 as send, '' as dop1, '' as dop2, '' as smso, '' as err, '' as ans, '' as selo, '' as sysoper, 
 
case when ':includepol_1_:' = 'y'  AND  p.spolref is null then (SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) 
	when ':includepol_1_:' = 'y' AND p.spolref IS NOT NULL THEN p.spolref 
	ELSE null END as p8, 
case  when ':includewcon_1_:' = 'y'  AND  p.swconref is null then (SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) 
	when ':includewcon_1_:' = 'y' AND p.swconref IS NOT NULL THEN p.swconref 
	ELSE null END as p9, 
case when ':includest_1_:' = 'y'  AND  p.sstomref is null then (SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) 
	when ':includest_1_:' = 'y' AND p.sstomref IS NOT NULL THEN p.sstomref 
	ELSE null END as p10 , 
pred_lpu.pricpol AS p11 
FROM prik_zayav_tab p 
JOIN dan_tab d ON p.dan_id=d.dan_id 
LEFT JOIN kart_dd_tab k ON k.dan_id = p.dan_id 
LEFT JOIN codifiers.strcom_tab s ON s.id = d.strcom_id 
LEFT JOIN kladr_tab kl ON substr(kl.code,1,12) = substr(d.street_id,1,12)  --kl.code = substr(d.street_id,1,13) 
LEFT JOIN lpu_tab pred_lpu ON pred_lpu.lpu_id = p.lpu_prik_pred_id 
LEFT JOIN address_tab a1 ON a1.dan_id = p.dan_id and a1.sp_addr_type_id=1 
LEFT JOIN codifiers.sp_street_tab s1 ON s1.code = a1.sp_street_code 
WHERE date_prik BETWEEN date(':date_1_:') and date(':date_2_:') 
AND :strcom_1_: 
AND (:param6_1_:=-100 OR p.operator_id=:param6_1_:) 
and p.date_prik = (select max(pp.date_prik) from prik_zayav_tab pp where pp.dan_id = p.dan_id 
  and pp.date_prik BETWEEN date(':date_1_:') and date(':date_2_:') ) 
 
 
group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40, 
41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,/*56,*/57,58,59,60,61,62,63,64,65,66,67,68 
ORDER by 1,2,3</Sql>
        </Query>
        <Query>
          <Sql>zapros1_backup SELECT DISTINCT  (case when p.ser_pol is not null then p.ser_pol else d.ser_pol end) AS p5, 
/*(case when p.num_pol is not null then p.num_pol::integer else d.num_pol::integer end) AS p6, */ 
(case when p.num_pol is not null then text_to_int(p.num_pol)::numeric else text_to_int(d.num_pol)::numeric end) AS p6, 
(case when p.fam is not null then p.fam else d.fam end) AS p1, 
(case when p.nam is not null then p.nam else d.nam end) AS p2, 
(case when p.mid is not null then p.mid else d.mid end) AS p3, 
d.date_born AS p4, 
(case when p.strcom_id is not null then p.strcom_id else d.strcom_id end)  AS p7, 
d.pens, d.serdoc||' '||d.numdoc as sn_pasp, d.date_output as d_pasp, '' as n_pasp, substr(d.street_id,13,5) as street_id, d.dom, d.korp, d.kv, '' as str, 
 d.telephon, 
 
case when position(' РЕГ' in a1.text_address)&lt;&gt;0 then 
/*conv_to_null('('||s1.index||') ')||conv_to_null(s1.region_name)||conv_to_null(trim(' '||s1.socr))||conv_to_null(' '||s1.name)||conv_to_null(' д.'||a1.house_number::text)||conv_to_null('/'||a1.building)||conv_to_null(' кв.'||a1.flat_number) */ 
substr(a1.text_address,1,position(' РЕГ' in a1.text_address)) else a1.text_address end as address, 
 
d.okvd, d.date_vnes_inf /*now()*/ as sysdate, 
'' as s_kms,	0 as n_kms,	'' as q_pasp, s.code as q, '' as ql, (case when d.sex='м' then 1 else 2 end) as w, /*kl.kod_oms as regs, */ 
substr(kl.kod_oms,1,case when position(',' in kl.kod_oms)=0 then length(kl.kod_oms) else position(',' in kl.kod_oms)-1 end) as regs, 
/*(select lpu.code from codifiers.lpu_tab lpu where id::text = get_lpu_number())*/ 
/*lpu.code as mcod,*/  d.dan_id as danid, '' as old_s_pol, '' as old_n_pol, '' as old_fam, '' as d2, d.date_smerti as ds, '' as del_pol, d.med_karta_kod as card, 
'' as tu, '' as kateg, '' as katpfr, '' as okrug, '' as dkat, '' as dskat, '' as fin, '' as sp, '' as ved, '' as work, '' as ndog, 
'' as workp, '' as gr, '' as ser1, '' as num1, '' as ser2, '' as num2, k.health_group as grzd, '' as dopdisp, '' as tp, 
max(date_delivery_disp) as ddisp, 0 as send, '' as dop1, '' as dop2, '' as smso, '' as err, '' as ans, '' as selo, '' as sysoper, 
 
case when ':includepol_1_:' = 'y'  AND  p.spolref is null then (SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) 
	when ':includepol_1_:' = 'y' AND p.spolref IS NOT NULL THEN p.spolref 
	ELSE null END as p8, 
case  when ':includewcon_1_:' = 'y'  AND  p.swconref is null then (SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) 
	when ':includewcon_1_:' = 'y' AND p.swconref IS NOT NULL THEN p.swconref 
	ELSE null END as p9, 
case when ':includest_1_:' = 'y'  AND  p.sstomref is null then (SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) 
	when ':includest_1_:' = 'y' AND p.sstomref IS NOT NULL THEN p.sstomref 
	ELSE null END as p10 , 
 
 
/*CASE WHEN ':includepol_1_:' = 'y' THEN 
(SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) ELSE NULL END AS p8, 
CASE WHEN ':includest_1_:' = 'y' THEN 
(SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) ELSE NULL END AS p9, 
CASE WHEN ':includewcon_1_:' = 'y' THEN 
(SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) ELSE NULL END  AS p10, */ 
/*oms.pricpol*/ pred_lpu.pricpol AS p11 
FROM prik_zayav_tab p 
--LEFT 
JOIN dan_tab d ON p.dan_id=d.dan_id 
LEFT JOIN kart_dd_tab k ON k.dan_id = p.dan_id 
LEFT JOIN codifiers.strcom_tab s ON s.id = d.strcom_id 
LEFT JOIN kladr_tab kl ON substr(kl.code,1,12) = substr(d.street_id,1,12)  --kl.code = substr(d.street_id,1,13) 
--LEFT JOIN oms_tab oms ON d.pens = oms.pens 
LEFT JOIN lpu_tab pred_lpu ON pred_lpu.lpu_id = p.lpu_prik_pred_id 
LEFT JOIN address_tab a1 ON a1.dan_id = p.dan_id and a1.sp_addr_type_id=1 
LEFT JOIN codifiers.sp_street_tab s1 ON s1.code = a1.sp_street_code 
WHERE date_prik BETWEEN date(':date_1_:') and date(':date_2_:') 
AND :strcom_1_: 
AND (:param6_1_:=-100 OR p.operator_id=:param6_1_:) 
and p.date_prik = (select max(pp.date_prik) from prik_zayav_tab pp where pp.dan_id = p.dan_id 
  and pp.date_prik BETWEEN date(':date_1_:') and date(':date_2_:') ) 
 
 
group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40, 
41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,/*56,*/57,58,59,60,61,62,63,64,65,66,67,68--,69,70 
ORDER by 1,2,3</Sql>
        </Query>
        <Query>
          <Sql>zapros2 SELECT (l.value).spolref FROM logs.dan_tab l 
WHERE l.date_time_mod &lt;= ':date_1_:' AND (l.value).spolref::int8 != get_local_lpu_num()::int8 
and (l.value).dan_id = :danid: 
ORDER BY l.date_time_mod DESC 
LIMIT 1</Sql>
        </Query>
      </Queries>
      <Parameters>
        <Parameter Name="includewcon" Caption="Включить в отчет женскую консультацию" Type="select2">
          <Sql>n=Нет|y=Да</Sql>
        </Parameter>
        <Parameter Name="includepol" Caption="Включить в отчет поликлинику" Type="select2">
          <Sql>y=Да|n=Нет</Sql>
        </Parameter>
        <Parameter Name="includest" Caption="Включить в отчет стоматологию" Type="select2">
          <Sql>y=Да|n=Нет</Sql>
        </Parameter>
        <Parameter Name="date" Caption="Дата прикрепления:" Type="date_period">
          <Sql />
        </Parameter>
        <Parameter Name="param6" Caption="Оператор" Type="select">
          <Sql>select -100, 'Все',1 union select u.id, conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid), 2 from users_tab u join dan_tab d on d.dan_id = u.dan_id where u.id in (select distinct operator_id from prik_zayav_tab) order by 3,2</Sql>
        </Parameter>
        <Parameter Name="strcom" Caption="СМО" Type="select">
          <Sql>SELECT ' true ', 'Все' UNION SELECT  '(p.strcom_id = '||id::text||' OR p.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name from codifiers.strcom_tab where region_id='0300000000000' AND (parent_id IS NULL OR parent_id = id)</Sql>
        </Parameter>
      </Parameters>
    </Report>
    <Report Id="320010" Name="Объем работы операторов (29.05.2008)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем работы операторов (29.05.2008).xls">
      <Queries>
        <Query>
          <Sql>zapros1 select t.operator_id as oper1, d.fio as op1, count(*) as talcount  
from talon_tab t  
LEFT JOIN users_tab f On f.id = t.operator_id  
LEFT JOIN dan_tab d On d.dan_id = f.dan_id 
where t.operator_id&gt;0 and t.data_vnes_inf between date(':period1_1_:') and date (':period1_2_:')  
group by t.operator_id, d.fio 
ORDER BY 1</Sql>
        </Query>
        <Query>
          <Sql>zapros2 select count(*) from visit_tab 
left join talon_tab on talon_tab.talon_id=visit_tab.talon_id 
where talon_tab.data_vnes_inf between date(':period1_1_:') 
and date (':period1_2_:') and visit_tab.operat_id= :oper1:;</Sql>
        </Query>
        <Query>
          <Sql>zapros3 select count(*) from diagn_tab 
left join talon_tab on talon_tab.talon_id=diagn_tab.talon_id 
where talon_tab.data_vnes_inf between date(':period1_1_:') 
and date (':period1_2_:') and diagn_tab.operat_id=:oper1:;</Sql>
        </Query>
        <Query>
          <Sql>zapros4 select count(DISTINCT b.oid) from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
LEFT JOIN dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab ON d.dan_id = b.dan_id AND visit_tab.data_pos between b.data_begin AND b.data_end 
where b.data_begin between date(':period1_1_:') and date (':period1_2_:') 
and b.doctor_id=:oper1: 
AND b.fl_clos=1 and b1.prev_blist_num is null;</Sql>
        </Query>
        <Query>
          <Sql>zapros5 select count(*) from rezept_tab 
left join talon_tab on talon_tab.talon_id=rezept_tab.talon_id 
where not bad and talon_tab.data_vnes_inf between date(':period1_1_:') 
and date(':period1_2_:') and rezept_tab.operator_id=:oper1:;</Sql>
        </Query>
      </Queries>
      <Parameters>
        <Parameter Name="period1" Caption="Дата внесения" Type="date_period">
          <Sql />
        </Parameter>
      </Parameters>
    </Report>
    <Report Id="11600000" Name="Форма №1 - ВОП (квартальная, годовая)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Форма №1 - ВОП (квартальная, годовая).xls">
      <Queries>
        <Query>
          <Sql>prik(age1,age2,mw) select count(*) from  dan_tab d 
left join codifiers.uchactok_tab uch ON d.uchactok_id = uch.id 
left join full_doctor_tab doc ON doc.doctor_id =uch.doctor_id 
where d.prikreplen =1 and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN age1 AND age2) 
and (mw) 
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and doc.dolg_doctor_id = :ddolg_1_:</Sql>
        </Query>
        <Query>
          <Sql>prik2(age1,age2,mw,sex1) select count(*) from  dan_tab d 
left join codifiers.uchactok_tab uch ON d.uchactok_id = uch.id 
left join full_doctor_tab doc ON doc.doctor_id =uch.doctor_id 
where d.prikreplen =1 and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN age1 AND age2) 
and (mw) and sex='sex1' 
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and doc.dolg_doctor_id = :ddolg_1_:</Sql>
        </Query>
        <Query>
          <Sql>profilaktika 4,5</Sql>
        </Query>
        <Query>
          <Sql>z1(age1,age2,targetpos,mkb1,mkb2) select count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN full_doctor_tab f ON v.doctor_id = f.doctor_id and f.dolg_doctor_id = :ddolg_1_: 
WHERE v.data_pos between date(':period_1_:') and (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN age1 AND age2)  
AND v.target_pos_id in (targetpos) 
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:))  and f.dolg_doctor_id = :ddolg_1_: 
and t.diag_osn between 'mkb1' and 'mkb2'</Sql>
        </Query>
        <Query>
          <Sql>z2(targetpos,mkb1,mkb2) select sum(mr+fr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 1 else 0 end as mr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 1 else 0 end as fr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN full_doctor_tab f ON v.doctor_id = f.doctor_id and f.dolg_doctor_id = :ddolg_1_: 
WHERE v.data_pos between date(':period_1_:') and (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59)  
AND v.target_pos_id in (targetpos)  
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and f.dolg_doctor_id = :ddolg_1_: 
and t.diag_osn between 'mkb1' and 'mkb2' 
) q</Sql>
        </Query>
        <Query>
          <Sql>z3(targetpos,mkb1,mkb2) select sum(mr+fr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 1 else 0 end as mr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 1 else 0 end as fr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN full_doctor_tab f ON v.doctor_id = f.doctor_id and f.dolg_doctor_id = :ddolg_1_: 
WHERE v.data_pos between date(':period_1_:') and (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59)  
AND v.target_pos_id in (targetpos)  AND v.mesto_obs = 'Д' 
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and f.dolg_doctor_id = :ddolg_1_: 
and t.diag_osn between 'mkb1' and 'mkb2' 
) q</Sql>
        </Query>
        <Query>
          <Sql>z4(targetpos,mkb1,mkb2) select sum(mnr+fnr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 0 else 1 end as mnr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 0 else 1 end as fnr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN full_doctor_tab f ON v.doctor_id = f.doctor_id and f.dolg_doctor_id = :ddolg_1_: 
WHERE v.data_pos between date(':period_1_:') and (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 54 AND 200)  
AND v.target_pos_id in (targetpos)  
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and f.dolg_doctor_id = :ddolg_1_: 
and t.diag_osn between 'mkb1' and 'mkb2' 
) q</Sql>
        </Query>
        <Query>
          <Sql>z5(targetpos,mkb1,mkb2) select sum(mnr+fnr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 0 else 1 end as mnr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 0 else 1 end as fnr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN full_doctor_tab f ON v.doctor_id = f.doctor_id and f.dolg_doctor_id = :ddolg_1_: 
WHERE v.data_pos between date(':period_1_:') and (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 54 AND 200)  
AND v.target_pos_id in (targetpos)  AND v.mesto_obs = 'Д' 
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and f.dolg_doctor_id = :ddolg_1_: 
and t.diag_osn between 'mkb1' and 'mkb2' 
) q</Sql>
        </Query>
        <Query>
          <Sql>zabolevania 1</Sql>
        </Query>
      </Queries>
      <Parameters>
        <Parameter Name="ddolg" Caption="Должность врача:" Type="select">
          <Sql>select distinct dolg_doctor_id, dolg_doctor, CASE WHEN dolg_doctor ilike '%общей прак%' THEN 1 ELSE 0 END from full_doctor_tab ORDER BY 3 DESC,2 </Sql>
        </Parameter>
        <Parameter Name="period" Caption="Период:" Type="date_period">
          <Sql />
        </Parameter>
        <Parameter Name="district" Caption="Участок:" Type="select">
          <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
        </Parameter>
      </Parameters>
    </Report>
    <Report Id="14200000" Name="dbf" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\dbf.xls">
      <Queries>
        <Query>
          <Sql>zapros SELECT '' AS p1;</Sql>
        </Query>
      </Queries>
      <Parameters />
    </Report>
    <Report Id="2009903000" Name="Список всех пациентов (DBF)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Список всех пациентов (DBF).xls">
      <Queries>
        <Query>
          <Sql>zapros select fam, nam, mid, date_born, conv_to_null(serdoc)||' '||conv_to_null(numdoc) as sn_pasp, address, date_output 
from dan_tab 
where life = 0</Sql>
        </Query>
      </Queries>
      <Parameters />
    </Report>
    <Report Id="2010903001" Name="Реестр_посещений " Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестр_посещений .xls">
      <Queries>
        <Query>
          <Sql>zapros0 SELECT DISTINCT  '$id'::text, (conv_to_null(d.ser_pol)||' №'||conv_to_null(d.num_pol)) as ser_num,  (case WHEN d.prikreplen = 1 THEN 'Да'::text ELSE 'Нет'::text  
END) as pr, (conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid)) as fio  , (conv_to_null(d.serdoc)||' '||conv_to_null(d.numdoc)) as ser_num_doc, d.address, soz1.sozstatus,  
diag.diagn_osn, JOIN_STR(DISTINCT diag.diagn_osn) as diagn_osn1, v_target_pos.target_pos, diag.otmet, d.date_born, v.mesto_obs, result1.result, (strcom.name||'  '|| d.data_begin ||'  '||d.data_end) as name, d.mest_work 
FROM public.talon_tab t   
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
LEFT JOIN target_pos_tab v_target_pos ON v_target_pos.target_pos_id = v.target_pos_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id  
LEFT JOIN result_tab result1 ON result1.result_id = t.result_id 
left join codifiers.strcom_tab strcom on t.strcom_id= strcom.id 
LEFT JOIN sozstatus_tab soz1 On soz1.sozstatus_id = d.sozstatus_id  
WHERE (v.data_pos =' :v_data_pos_1_:' ) AND v.doctor_id =:v_doctor_id_1_:  
GROUP BY '$id'::text, (conv_to_null(d.ser_pol)||' №'||conv_to_null(d.num_pol)), case WHEN d.prikreplen = 1 THEN  
'Да'::text ELSE 'Нет'::text END, conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid),  
(conv_to_null(d.serdoc)||' '||conv_to_null(d.numdoc)), d.address, soz1.sozstatus, diag.diagn_osn, v_target_pos.target_pos, diag.otmet, d.date_born, v.mesto_obs, result1.result, (strcom.name||'  '||d.data_begin||'  '||d.data_end), d.mest_work    
ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</Sql>
        </Query>
      </Queries>
      <Parameters>
        <Parameter Name="v_data_pos" Caption="дата внесения" Type="date">
          <Sql />
        </Parameter>
        <Parameter Name="v_doctor_id" Caption="Доктор" Type="select">
          <Sql>SELECT  f.full_doctor_id, (f.full_doctor_id::text||' '||f.fio) as fio  FROM full_doctor_tab f ORDER BY 2</Sql>
        </Parameter>
      </Parameters>
    </Report>
    <Report Id="2011703001" Name="reestr" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\reestr.xls">
      <Queries>
        <Query>
          <Sql>zapros0 SELECT DISTINCT   '$id'::text, '2301001' as mcod,(conv_to_null(d.ser_pol)||' '||conv_to_null(d.num_pol)) as ser_num,  (case WHEN d.prikreplen = 1 THEN 'Да'::text ELSE 'Нет'::text  
END) as pr, d.fam as fam, d.nam as nam, d.mid as mid  , (conv_to_null(d.serdoc)||' '||conv_to_null(d.numdoc)) as ser_num_doc, d.address, soz1.sozstatus,  
diag.diagn_osn, JOIN_STR(DISTINCT diag.diagn_osn) as diagn_osn1, v_target_pos.target_pos, diag.otmet, d.date_born, v.mesto_obs, result1.result, strcom.name,  st.name as codes, d.mest_work, d.pens, d.dom, d.korp, d.kv FROM public.talon_tab t   
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
LEFT JOIN target_pos_tab v_target_pos ON v_target_pos.target_pos_id = v.target_pos_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id  LEFT JOIN result_tab result1 ON result1.result_id = t.result_id                                                                                        left join codifiers.sp_street_tab st ON d.street_id = st.code          
left join codifiers.strcom_tab strcom on t.strcom_id= strcom.id                                                                                                                                                                            left join codifiers.uchactok_tab ut on ut.id=d.uchactok_id   
LEFT JOIN sozstatus_tab soz1 On soz1.sozstatus_id = d.sozstatus_id  WHERE (v.data_pos &gt;=' :v_data_pos_1_:' and v.data_pos &lt;=' :v_data_pos_2_:' ) AND ut.otdel_id  =:id_1_:  GROUP BY '$id'::text, (conv_to_null(d.ser_pol)||' '||conv_to_null(d.num_pol)), case WHEN d.prikreplen = 1 THEN   
'Да'::text ELSE 'Нет'::text END, d.fam, d.nam, d.mid,  
(conv_to_null(d.serdoc)||' '||conv_to_null(d.numdoc)), d.address, soz1.sozstatus, diag.diagn_osn, v_target_pos.target_pos, diag.otmet, d.date_born, v.mesto_obs, result1.result, strcom.name, st.name, d.mest_work, d.pens, d.dom, d.korp, d.kv   ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</Sql>
        </Query>
      </Queries>
      <Parameters>
        <Parameter Name="v_data_pos" Caption="дата внесения" Type="date_period">
          <Sql />
        </Parameter>
        <Parameter Name="id" Caption="Отделение" Type="select">
          <Sql>SELECT  f.id, f.name  FROM codifiers.otdel_tab f  ORDER BY 2</Sql>
        </Parameter>
      </Parameters>
    </Report>
    <Report Id="2013903000" Name="Акт сдачи-приемки СОГАЗ (DBF)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Акт сдачи-приемки СОГАЗ (DBF).xls">
      <Queries>
        <Query>
          <Sql>zapros1 SELECT DISTINCT  '', 
(case when p.ser_pol is not null then p.ser_pol else d.ser_pol end) AS p5, 
(case when p.num_pol is not null then text_to_int(p.num_pol)::numeric else text_to_int(d.num_pol)::numeric end) AS p6, 
(case when p.fam is not null then p.fam else d.fam end) AS p1, 
(case when p.nam is not null then p.nam else d.nam end) AS p2, 
(case when p.mid is not null then p.mid else d.mid end) AS p3, 
d.date_born AS p4, 
d.serdoc||' '||d.numdoc as sn_pasp, 
d.telephon, 
case when position(' РЕГ' in a1.text_address)&lt;&gt;0 then substr(a1.text_address,1,position(' РЕГ' in a1.text_address)) else a1.text_address end as address, d.fakt_adr, 
d.sex as w, 
d.mest_work, 
p.date_prik, '' as p7, '' as ndog, 
case when ':includepol_1_:' = 'y'  AND  p.spolref is null then (SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) 
	when ':includepol_1_:' = 'y' AND p.spolref IS NOT NULL THEN p.spolref 
	ELSE null END as p8, 
case  when ':includewcon_1_:' = 'y'  AND  p.swconref is null then (SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) 
	when ':includewcon_1_:' = 'y' AND p.swconref IS NOT NULL THEN p.swconref 
	ELSE null END as p9, 
case when ':includest_1_:' = 'y'  AND  p.sstomref is null then (SELECT value FROM settings_tab WHERE name = 'LPU_NUMBER' LIMIt 1) 
	when ':includest_1_:' = 'y' AND p.sstomref IS NOT NULL THEN p.sstomref 
	ELSE null END as p10, '2301001'::text as cods 
 
FROM prik_zayav_tab p 
JOIN dan_tab d ON p.dan_id=d.dan_id 
LEFT JOIN kladr_tab kl ON substr(kl.code,1,12) = substr(d.street_id,1,12)  --kl.code = substr(d.street_id,1,13) 
LEFT JOIN address_tab a1 ON a1.dan_id = p.dan_id and a1.sp_addr_type_id=1 
--LEFT JOIN codifiers.sp_street_tab s1 ON s1.code = a1.sp_street_code 
WHERE date_prik BETWEEN date(':date_1_:') and date(':date_2_:') 
AND :strcom_1_: 
AND (:param6_1_:=-100 OR p.operator_id=:param6_1_:) 
and p.date_prik = (select max(pp.date_prik) from prik_zayav_tab pp where pp.dan_id = p.dan_id 
  and pp.date_prik BETWEEN date(':date_1_:') and date(':date_2_:') ) 
 
/*group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40, 
41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,/*56,*/57,58,59,60,61,62,63,64,65,66,67,68 */ 
ORDER by 1,2,3</Sql>
        </Query>
      </Queries>
      <Parameters>
        <Parameter Name="includewcon" Caption="Включить в отчет женскую консультацию" Type="select2">
          <Sql>n=Нет|y=Да</Sql>
        </Parameter>
        <Parameter Name="includepol" Caption="Включить в отчет поликлинику" Type="select2">
          <Sql>y=Да|n=Нет</Sql>
        </Parameter>
        <Parameter Name="includest" Caption="Включить в отчет стоматологию" Type="select2">
          <Sql>y=Да|n=Нет</Sql>
        </Parameter>
        <Parameter Name="date" Caption="Дата прикрепления:" Type="date_period">
          <Sql />
        </Parameter>
        <Parameter Name="param6" Caption="Оператор" Type="select">
          <Sql>select -100, 'Все',1 union select u.id, conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid), 2 from users_tab u join dan_tab d on d.dan_id = u.dan_id where u.id in (select distinct operator_id from prik_zayav_tab) order by 3,2</Sql>
        </Parameter>
        <Parameter Name="strcom" Caption="СМО" Type="select">
          <Sql>SELECT ' true ', 'Все' UNION SELECT  '(p.strcom_id = '||id::text||' OR p.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name from codifiers.strcom_tab where region_id='0300000000000' AND (parent_id IS NULL OR parent_id = id)</Sql>
        </Parameter>
      </Parameters>
    </Report>
    <Report Id="2020103000" Name="Список застрахованных пациентов" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Список застрахованных пациентов.xls">
      <Queries>
        <Query>
          <Sql>z1 select d.fam||' '||d.nam||' '||d.mid as a1, d.date_born as a2, d.address as a3 
from dan_tab d 
WHERE strcom_id=:str_com_1_: 
AND 
get_vozrast(d.date_born) between :vozrast_1_: AND :vozrast_2_: 
and d.sex=':pol_1_:' 
order by 1</Sql>
        </Query>
        <Query>
          <Sql>z2 select case  when  :str_com_1_:=-1 then 'Все страховые компании' 
	else 
(select strcom from strcom_tab where strcom_id=:str_com_1_:) 
	end as napr</Sql>
        </Query>
      </Queries>
      <Parameters>
        <Parameter Name="vozrast" Caption="Возраст" Type="int_period">
          <Sql />
        </Parameter>
        <Parameter Name="pol" Caption="Пол" Type="select">
          <Sql>SELECT 'м'::text, 'м'::text UNION SELECT 'ж'::text, 'ж'::text </Sql>
        </Parameter>
        <Parameter Name="str_com" Caption="Страховая компания" Type="select">
          <Sql>SELECT '-1'::text, 'Все страховые компании'::text,0 UNION select strcom_id::text, strcom,1 from strcom_tab  ORDER By 3,2  </Sql>
        </Parameter>
      </Parameters>
    </Report>
    <Report Id="2025103000" Name="Сведения о неработающих застрахованных лицах" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Сведения о неработающих застрахованных лицах.xls">
      <Queries>
        <Query>
          <Sql>zapros1 select '$id'::text, 
d.fam as p1, 
d.nam as p2, 
d.mid as p3, 
d.sex as p4, 
d.date_born as p5, 
d.mest_born as p6, 
c.name as p7, 
d.vid_doc_id as p21, 
d.serdoc as p8, 
d.numdoc as p9, 
d.date_output as p10, 
d.kem_output as p11, 
d.fakt_adr as p12, 
d.address as p13, 
d.date_registration as p14, 
d.pens as p15, 
d.ser_pol as p16, 
d.num_pol as p17, 
s.name as p18, 
'' as p19, 
st.sozstatus as p20 
from dan_tab d 
left join codifiers.citizenship_tab c on c.id=d.citizenship_id::int4 
left join codifiers.strcom_tab s on s.id=d.strcom_id 
left join sozstatus_tab st on st.sozstatus_id=d.sozstatus_id 
where d.strcom_id is not null 
and (d.mest_work is null or d.mesto_work_id is null) 
and get_vozrast(d.date_born) between :vozrast_1_: and :vozrast_2_: 
and :prik_1_: 
and :param3_1_: 
order by 2,3,4</Sql>
        </Query>
      </Queries>
      <Parameters>
        <Parameter Name="vozrast" Caption="Возраст" Type="int_period">
          <Sql />
        </Parameter>
        <Parameter Name="prik" Caption="Прикреплен" Type="select">
          <Sql>select 'true','Все',0 union select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',1 order by 3,2</Sql>
        </Parameter>
        <Parameter Name="param3" Caption="Учебное заведение" Type="select">
          <Sql>select 'true','Все',0 union select 'd.kod_vuz='||kod, name,1 from ucheb_zaved_tab   order by 3,2  </Sql>
        </Parameter>
      </Parameters>
    </Report>
    <Report Id="2030703000" Name="Реестр посещений_2" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестр посещений_2.xls">
      <Queries>
        <Query>
          <Sql>zapros0 SELECT DISTINCT  '$id'::text, 
(conv_to_null(d.ser_pol)||' №'||conv_to_null(d.num_pol)) as ser_num,  
(case WHEN d.prikreplen = 1 THEN 'Да'::text ELSE 'Нет'::text  END) as pr, 
(conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid)) as fio  , 
(conv_to_null(d.serdoc)||' '||conv_to_null(d.numdoc)) as ser_num_doc, 
d.address, 
soz1.sozstatus, 
JOIN_STR(DISTINCT diag.diagn_osn) as diagn_osn1, 
v_target_pos.target_pos, 
diag.otmet, 
d.date_born, 
v.mesto_obs, 
result1.result, 
(strcom.name||'  '|| d.data_begin ||'  '||d.data_end) as name, 
d.mest_work, 
join_str(distinct cu.code) as usl_code, 
u.name as uch_name, 
f.full_fio, 
join_str(distinct su.code||'('||ok.kol_vo::varchar||')') as dop_usl  
FROM public.talon_tab t   
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id and diag.sp_disease_vid_id=200001 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
LEFT JOIN target_pos_tab v_target_pos ON v_target_pos.target_pos_id = v.target_pos_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id  
LEFT JOIN result_tab result1 ON result1.result_id = t.result_id 
left join codifiers.strcom_tab strcom on t.strcom_id= strcom.id 
LEFT JOIN sozstatus_tab soz1 On soz1.sozstatus_id = d.sozstatus_id  
left jOIN doctor_tab doc ON doc.id = v.doctor_id 
left JOIN codifiers.bur_reestr_auto_usl_tab ca ON ca.doctor_spec_id = doc.sp_spec_doctor_id 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id 
left join okaz_uslug_tab ok on ok.dan_id=t.dan_id 
and ok.doctor_id=v.doctor_id and ok.auto_flag is null  
/*and t.diag_osn=ok.inference_diagnosis*/ and v.data_pos=ok.reestr_date 
left join codifiers.sp_uslug_tab su on su.id=ok.sp_uslug_id 
left join full_doctor_tab f on f.full_doctor_id=v.doctor_id 
left JOIN codifiers.sp_uslug_tab cu ON cu.id = 
				CASE WHEN (d.spolref::int4 IN (SELECT * FROM get_all_lpu_numbers()) AND d.strcom_region_id = GET_OUR_REGION_CODE()) 
				THEN ( 
					CASE WHEN (v.mesto_obs='Д' OR v.mesto_obs='А') 
					THEN ca.sp_usl_id_home 
					ELSE ca.sp_usl_id 
					END) 
				ELSE 
					ca.sp_usl_id_mtr 
				END 
 AND (ca.sex = d.sex OR ca.sex IS NULL) 
			AND date_part('year', age(v.data_pos, d.date_born)) between coalesce(ca.age_from, 0) and coalesce(ca.age_to, 150) 
WHERE (v.data_pos  between ':v_data_pos_1_:' and ':v_data_pos_2_:') AND :v_otdel_id_1_:  
GROUP BY 2,3,4,5,6,7,9,10,11,12,13,14,15,17,18    
ORDER BY 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</Sql>
        </Query>
      </Queries>
      <Parameters>
        <Parameter Name="v_data_pos" Caption="Дата внесения" Type="date_period">
          <Sql />
        </Parameter>
        <Parameter Name="v_otdel_id" Caption="Отделение" Type="select">
          <Sql>select 'true','Все',0 union SELECT  'doc.sp_otdel_id='||f.otdel, nam_otdel,1   FROM otdel_tab f  ORDER BY 3,2</Sql>
        </Parameter>
      </Parameters>
    </Report>
  </Reports>
  <Folders>
    <Folder Name="Объем поликлинической помощи">
      <Reports>
        <Report Id="176" Name="Количество посещений к специалистам по месту за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Количество посещений к специалистам по месту за период.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT f.fio, f.full_doctor_id as param1, count(distinct visit_id) as param2 FROM visit_tab v  
LEFT JOIN talon_tab t On t.talon_id = v.talon_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id 
WHERE :param4_1_: &gt;= date(':period1_1_:') and :param4_1_: &lt;=  date(':period1_2_:')  AND :period2_1_:  
AND f.full_doctor_id is not null 
AND t.vid_oplat_id  = ANY(get_kind_paid_subnodes(:param3_1_:))  and :param5_1_: 
GROUP BY f.fio, f.full_doctor_id  
ORDER BY 1,2</Sql>
            </Query>
            <Query>
              <Sql>zapros2(mest_obs1) SELECT  count(distinct visit_id)  FROM  visit_tab v  
LEFT JOIN talon_tab t On t.talon_id = v.talon_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id 
WHERE :param4_1_: &gt;= date(':period1_1_:') and :param4_1_: &lt;=  date(':period1_2_:')  AND :period2_1_:  
AND f.full_doctor_id = :param1: AND v.mesto_obs::text = ANY  (string_to_array('mest_obs1', ',')) 
AND t.vid_oplat_id  = ANY(get_kind_paid_subnodes(:param3_1_:)) 
and :param5_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT  count(distinct visit_id)  FROM  visit_tab v   
LEFT JOIN talon_tab t On t.talon_id = v.talon_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id  
WHERE :param4_1_: &gt;= date(':period1_1_:') and  :param4_1_: &lt;=   date(':period1_2_:')  AND :period2_1_:   
AND f.full_doctor_id is not null AND t.vid_oplat_id  = ANY(get_kind_paid_subnodes(:param3_1_:)) 
and :param5_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4(mest_obs1) SELECT  count(distinct visit_id)  FROM  visit_tab v  
LEFT JOIN talon_tab t On t.talon_id = v.talon_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id 
WHERE  :param4_1_: &gt;= date(':period1_1_:') and  :param4_1_: &lt;=  date(':period1_2_:')  AND :period2_1_:  
AND f.full_doctor_id is not null 
 AND v.mesto_obs::text = ANY  (string_to_array('mest_obs1', ',')) 
AND t.vid_oplat_id  = ANY(get_kind_paid_subnodes(:param3_1_:)) 
and :param5_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param3" Caption="Вид оплаты" Type="select2">
              <Sql>0=ОМС|2=Платные услуги|4=Другое|5=ДМС|1=Бюджет</Sql>
            </Parameter>
            <Parameter Name="period2" Caption="Отделы" Type="select">
              <Sql>SELECT ' true '::text, 'Все'::text, 0  UNION  SELECT ' f.otdel = '||otdel::text, nam_otdel, 1 FROM otdel_tab  ORDEr BY 3,2 </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param4" Caption="по" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Специальность врача" Type="select">
              <Sql>SELECT ' true '::text, 'Все'::text, 0  UNION  SELECT distinct 'f.dolg_doctor_id='||dolg_doctor_id::text, f.dolg_doctor, 1 FROm full_doctor_tab f ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="186" Name="Количество пролеченных больных за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Количество пролеченных больных за период.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT COUNT(DISTINCT t.dan_id), COUNT(v.visit_id) as param2 FROm talon_tab t 
LEFT jOIN visit_tab v ON v.talon_id = t.talon_id 
LEFT JOIN dan_tab d On d.dan_id = t.dan_id 
left join spec_doctor_tab s on  s.kod_doctor = v.doctor_id 
 
WHERE :param3_1_: &gt;= date(':param1_1_:') AND :param3_1_: &lt;= date(':param1_2_:')  
/*AND v.mesto_obs='П' */AND s.dolg_doctor_id not in (97,98,50) 
and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(0))</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT COUNT(DISTINCT t.dan_id), COUNT(v.visit_id) as param3 FROm talon_tab t 
LEFT jOIN visit_tab v ON v.talon_id = t.talon_id 
LEFT JOIN dan_tab d On d.dan_id = t.dan_id 
left join spec_doctor_tab s on  s.kod_doctor = v.doctor_id 
 
WHERE :param3_1_: &gt;= date(':param1_1_:') AND :param3_1_: &lt;= date(':param1_2_:')  
AND v.mesto_obs='П' AND t.vid_oplat_id   = ANY(get_kind_paid_subnodes(1))   AND 
s.dolg_doctor_id not in (97,98,50)</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT COUNT(DISTINCT t.dan_id), COUNT(v.visit_id) as param4 FROm talon_tab t 
LEFT jOIN visit_tab v ON v.talon_id = t.talon_id 
LEFT JOIN dan_tab d On d.dan_id = t.dan_id 
left join spec_doctor_tab s on  s.kod_doctor = v.doctor_id 
 
WHERE :param3_1_: &gt;= date(':param1_1_:') AND :param3_1_: &lt;= date(':param1_2_:')  
AND v.mesto_obs='П' AND t.vid_oplat_id   = ANY(get_kind_paid_subnodes(2))   AND 
s.dolg_doctor_id not in (97,98,50)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param3" Caption="по" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="20001" Name="Характеристика объема поликлинической помощи" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Характеристика объема поликлинической помощи.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT d.dolg_doctor, f.dolg_doctor_id, 
round(sum(f.stavka)::numeric,2) as stavka1, 
round(sum(f.stavka*d.nagruzka)::numeric*get_default(':param2_1_:','1')::text::int4,0) as plan1, 
get_default(':param2_1_:','1') as kolvo_dney 
 FROM spec_doctor_tab f 
LEFT JOIN dolg_doctor_tab d On d.dolg_doctor_id = f.dolg_doctor_id 
WHERe f.dolg_doctor_id IN 
( 
SELECT f.dolg_doctor_id FROm visit_tab v  
LEFT JOIN full_doctor_tab f On f.full_doctor_id = v.doctor_id 
WHERE :param3_1_: BETWEEN date(':period1_1_:') 
AND date(':period1_2_:') 
) 
GROUP BY d.dolg_doctor, f.dolg_doctor_id 
ORDER BY 1</Sql>
            </Query>
            <Query>
              <Sql>zapros2(vid_oplat1) select  round(count(*)*100.0/conv_to_null(:plan1:), 2) as proc1,count(*) from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id 
left join talon_tab t on t.talon_id=v.talon_id  
where f.dolg_doctor_id = :dolg_doctor_id: and    
:param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
--and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(vid_oplat1)) 
and (vid_oplat1=-1 or t.vid_oplat_id   = vid_oplat1)</Sql>
            </Query>
            <Query>
              <Sql>zapros3(vid_oplat1,mest_obs) select count(distinct t.dan_id) as cnt_pat, count(*)  from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
where f.dolg_doctor_id = :dolg_doctor_id: and     
:param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
--and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(vid_oplat1))  
and t.vid_oplat_id   = vid_oplat1 
AND  v.mesto_obs mest_obs 'П'</Sql>
            </Query>
            <Query>
              <Sql>zapros4(vid_oplat1,mest_obs,target1) select count(*) from visit_tab  v 
 left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
 left join talon_tab t on t.talon_id=v.talon_id   
 where f.dolg_doctor_id = :dolg_doctor_id: and     
 :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
-- and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(vid_oplat1))  
and t.vid_oplat_id   = vid_oplat1 
AND  v.mesto_obs mest_obs 'П' AND  
 v.target_pos_id IN (target1)</Sql>
            </Query>
            <Query>
              <Sql>zapros5 SELECT round(sum(f.stavka)::numeric,2) as stavka1, 
round(sum(f.stavka*d.nagruzka)::numeric*get_default(':param2_1_:','1')::text::int4,0) as plan1, 
get_default(':param2_1_:','1') as kolvo_dney 
 FROM spec_doctor_tab f 
LEFT JOIN dolg_doctor_tab d On d.dolg_doctor_id = f.dolg_doctor_id 
WHERe f.dolg_doctor_id IN 
( 
SELECT f.dolg_doctor_id FROm visit_tab v  
LEFT JOIN full_doctor_tab f On f.full_doctor_id = v.doctor_id 
WHERE :param3_1_: BETWEEN date(':period1_1_:') 
AND date(':period1_2_:') 
)</Sql>
            </Query>
            <Query>
              <Sql>zapros6(vid_oplat1) select count(*), round(count(*)*100.0/conv_to_null(:plan1:), 2) as proc1 from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
--and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(vid_oplat1)) 
and (vid_oplat1=-1 or t.vid_oplat_id   = vid_oplat1)</Sql>
            </Query>
            <Query>
              <Sql>zapros7(vid_oplat1,mest_obs) select count(*), count(distinct t.dan_id) as cnt_pat from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
--and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(vid_oplat1))  
and t.vid_oplat_id   = vid_oplat1 
AND  v.mesto_obs mest_obs 'П'</Sql>
            </Query>
            <Query>
              <Sql>zapros8(vid_oplat1,mest_obs,target1) select count(*) from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
--and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(vid_oplat1))  
and t.vid_oplat_id   = vid_oplat1 
AND   v.mesto_obs mest_obs 'П' AND   
v.target_pos_id IN (target1)</Sql>
            </Query>
            <Query>
              <Sql>zaprosdd SELECT   count(*) 
--f1.full_fio, 
--ddm.name 
FROM 
dop_disp_measures_tab dm 
left join full_doctor_tab f on f.full_doctor_id=dm.doctor_id 
 WHERE 
f.dolg_doctor_id = :dolg_doctor_id: and      dm.dop_disp_measure_id in (1800000, 1900000, 2200000, 2300000, 2400000, 2500000, 2600000, 2700000, 3400000, 3500000, 3800000, 3900000, 4000000, 4100000, 4800000, 5000000, 4900000, 5200000, 5500000, 5700000, 6400000, 7900000, 8300000, 9300000, 9700000) and 
dm.measure_date between date(':period1_1_:') and date (':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата внесения визита" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Кол-во рабочих дней" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="по" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="30001" Name="Характеристика объема поликлинической помощи по отделениям" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Характеристика объема поликлинической помощи по отделениям.xls">
          <Queries>
            <Query>
              <Sql>fake_zapros SELECT join_str(f.nam_otdel) FROM otdel_tab f  
WHERE :param3_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select 
full_doctor_id, fio, dolg_doctor, 
case when kolvo_pos=0 then stavka1 else round(stavka1/kolvo_pos,1) end as stavka1, 
case when kolvo_pos=0 then plan1 else round(plan1/kolvo_pos) end as plan1, kolvo_dney, kolvo_pos 
from ( 
select 
f.full_doctor_id, f.fio, f.dolg_doctor,  
round(sum(s.stavka)::numeric,2) as stavka1, 
round(sum(s.stavka*d.nagruzka)::numeric*get_kol_days(:param4_1_:,':param2_1_:',f.full_doctor_id),0) as plan1, 
get_kol_days(:param4_1_:,':param2_1_:',f.full_doctor_id) as kolvo_dney  , 
count(v.visit_id) as kolvo_pos 
from visit_tab v 
left join full_doctor_tab f on f.full_doctor_id=v.doctor_id 
left join talon_tab t on t.talon_id=v.talon_id   and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(0)) 
LEFT JOIN spec_doctor_tab s On s.kod_doctor = f.full_doctor_id 
LEFT JOIN dolg_doctor_tab d On d.dolg_doctor_id = f.dolg_doctor_id 
WHERe  :param3_1_: and :param5_1_: 
and :param1_1_: between date(':period1_1_:') and date (':period1_2_:')  
GROUP BY f.full_doctor_id, f.fio, f.dolg_doctor 
) q where :pose_1_1_: 
ORDER BY 1</Sql>
            </Query>
            <Query>
              <Sql>zapros2(vid_oplat1) select round(count(distinct v.visit_id)*100.0/conv_to_null(:plan1:), 2) as proc1, count(distinct v.visit_id) 
from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
where v.doctor_id= :full_doctor_id: and     
:param1_1_: between date(':period1_1_:') and date (':period1_2_:')   
and (vid_oplat1=-1 or t.vid_oplat_id   = vid_oplat1)</Sql>
            </Query>
            <Query>
              <Sql>zapros3(vid_oplat1,mest_obs) select  count(distinct t.dan_id) as cnt_pat, count(distinct v.visit_id) 
from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id 
left join dan_tab d on d.dan_id=t.dan_id  
where v.doctor_id = :full_doctor_id: and    
:param1_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id   = vid_oplat1 
AND v.mesto_obs mest_obs 'П'</Sql>
            </Query>
            <Query>
              <Sql>zapros4(vid_oplat1,mest_obs,target1) select count(distinct v.visit_id) 
from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id  
where v.doctor_id = :full_doctor_id: and     
:param1_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id   = vid_oplat1 
AND v.mesto_obs mest_obs 'П'  AND 
v.target_pos_id IN (target1)</Sql>
            </Query>
            <Query>
              <Sql>zapros5 SELECT round(sum(s.stavka)::numeric,2) as stavka1, 
round(sum(s.stavka*d.nagruzka)::numeric*avg(get_kol_days(:param4_1_:,':param2_1_:',f.full_doctor_id))::numeric,0)  as plan1, 
avg(get_kol_days(:param4_1_:,':param2_1_:',f.full_doctor_id)) as kolvo_dney,  join_str(f.full_doctor_id::text) as full_doctor_id 
 FROM full_doctor_tab f 
 LEFT JOIN spec_doctor_tab s On s.kod_doctor = f.full_doctor_id  
LEFT JOIN dolg_doctor_tab d On d.dolg_doctor_id = f.dolg_doctor_id 
WHERe :param3_1_: and :param5_1_: 
ORDER BY 1</Sql>
            </Query>
            <Query>
              <Sql>zapros6(vid_oplat1) select count(distinct v.visit_id), round(count(*)*100.0/conv_to_null(:plan1:), 2) as proc1 
from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
where v.doctor_id IN (:full_doctor_id:) and    
:param1_1_: between date(':period1_1_:') and date (':period1_2_:')  
and (vid_oplat1=-1 or t.vid_oplat_id   = vid_oplat1)</Sql>
            </Query>
            <Query>
              <Sql>zapros7(vid_oplat1,mest_obs) select count(distinct v.visit_id), 
count(distinct t.dan_id) as cnt_pat 
from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
left join dan_tab d on d.dan_id=t.dan_id 
where v.doctor_id IN (:full_doctor_id:) and    
:param1_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id   = vid_oplat1 
AND v.mesto_obs mest_obs 'П'</Sql>
            </Query>
            <Query>
              <Sql>zapros8(vid_oplat1,mest_obs,target1) select count(distinct v.visit_id) 
from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
where v.doctor_id IN (:full_doctor_id:) and     
:param1_1_: between date(':period1_1_:') and date (':period1_2_:')    
and t.vid_oplat_id   = vid_oplat1 
AND  v.mesto_obs mest_obs 'П'  AND  
v.target_pos_id IN (target1)</Sql>
            </Query>
            <Query>
              <Sql>zaprosdd SELECT   count(*) 
--f1.full_fio, 
--ddm.name 
FROM 
dop_disp_measures_tab dm 
left join full_doctor_tab f on f.full_doctor_id=dm.doctor_id 
 WHERE 
 dm.doctor_id= :full_doctor_id: and  dm.dop_disp_measure_id in (1800000, 1900000, 2200000, 2300000, 2400000, 2500000, 2600000, 2700000, 3400000, 3500000, 3800000, 3900000, 4000000, 4100000, 4800000, 5000000, 4900000, 5200000, 5500000, 5700000, 6400000, 7900000, 8300000, 9300000, 9700000) and 
dm.measure_date between date(':period1_1_:') and date (':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="pose_1" Caption="Врачей с нулевыми посещениями" Type="select">
              <Sql>select 'true'::text, 'учитывать'::text UNION ALL select 'kolvo_pos&gt;0', 'не учитывать'::text</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Кол-во рабочих дней" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Отдел" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0  UNION  SELECT 'f.otdel = '''||o.otdel||'''',o.nam_otdel, 1 FROm otdel_tab o  ORDER BY 3,2 </Sql>
            </Parameter>
            <Parameter Name="param1" Caption="По" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Расчет рабочих дней" Type="select2">
              <Sql>0=Не уточнять|1=Уточнить по врачам(справочник Число дней, которые врач в отчетном периоде работал)</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Специалист" Type="select">
              <Sql>SELECT ' true '::text, 'Все'::text, 0  UNION  SELECT distinct 'f.dolg_doctor_id='||dolg_doctor_id::text, f.dolg_doctor, 1 FROm full_doctor_tab f ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="40001" Name="Характеристика объема поликлинической помощи врача" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Характеристика объема поликлинической помощи врача.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT f.full_doctor_id, f.fio, f.dolg_doctor, 
round(sum(s.stavka)::numeric,2) as stavka1, 
round(sum(s.stavka*d.nagruzka)::numeric*get_default(':param2_1_:','1')::text::int4,0) as plan1, 
get_default(':param2_1_:','1') as kolvo_dney 
 FROM full_doctor_tab f 
 LEFT JOIN spec_doctor_tab s On s.kod_doctor = f.full_doctor_id 
LEFT JOIN dolg_doctor_tab d On d.dolg_doctor_id = f.dolg_doctor_id 
WHERE f.full_doctor_id = ':param3_1_:' 
GROUP BY f.full_doctor_id, f.fio, f.dolg_doctor 
ORDER BY 1</Sql>
            </Query>
            <Query>
              <Sql>zapros2(vid_oplat1) select  round(count(*)*100.0/conv_to_null(:plan1:), 2) as proc1, count(*) from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
where f.full_doctor_id= :full_doctor_id: and    
:param4_1_: between date(':period1_1_:') and date (':period1_2_:')  
--and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(vid_oplat1)) 
and (vid_oplat1=-1 or t.vid_oplat_id   = vid_oplat1)</Sql>
            </Query>
            <Query>
              <Sql>zapros3(vid_oplat1,mest_obs) select count(distinct t.dan_id) as cnt_pat, count(*) from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
where f.full_doctor_id = :full_doctor_id: and     
:param4_1_: between date(':period1_1_:') and date (':period1_2_:')  
--and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(vid_oplat1))  
and t.vid_oplat_id   = vid_oplat1 
AND  v.mesto_obs mest_obs 'П'</Sql>
            </Query>
            <Query>
              <Sql>zapros4(vid_oplat1,mest_obs,target1) select count(*) from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
where f.full_doctor_id = :full_doctor_id: and     
:param4_1_: between date(':period1_1_:') and date (':period1_2_:')  
--and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(vid_oplat1))  
and t.vid_oplat_id   = vid_oplat1 
AND  v.mesto_obs mest_obs 'П' AND  
v.target_pos_id IN (target1)</Sql>
            </Query>
            <Query>
              <Sql>zaprosdd SELECT   count(*) 
 
FROM 
dop_disp_measures_tab dm 
left join full_doctor_tab f on f.full_doctor_id=dm.doctor_id 
 WHERE 
f.full_doctor_id= :full_doctor_id: and  dm.dop_disp_measure_id in (1800000, 1900000, 2200000, 2300000, 2400000, 2500000, 2600000, 2700000, 3400000, 3500000, 3800000, 3900000, 4000000, 4100000, 4800000, 5000000, 4900000, 5200000, 5500000, 5700000, 6400000, 7900000, 8300000, 9300000, 9700000) and  
dm.measure_date between date(':period1_1_:') and date (':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param3" Caption="Врач" Type="select">
              <Sql>SELECT f.full_doctor_id, f.full_doctor_id||' '||f.fio||' ('||f.dolg_doctor||')' FROm full_doctor_tab f ORDER BY 1,2</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Кол-во рабочих дней" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="param4" Caption="по" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="220010" Name="Распределение посещений по цели обращения пациентов(новый)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Распределение посещений по цели обращения пациентов(новый).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT full_doctor_id, fio FROm full_doctor_tab f 
WHERE full_doctor_id  IN 
( 
SELECT DISTINCT doctor_id FROM visit_tab v WHERE 
:param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
) 
AND :param2_1_: and :param5_1_: 
ORDER BY 1,2</Sql>
            </Query>
            <Query>
              <Sql>zapros2 select count(*) as allcount from visit_tab v where :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
AND v.doctor_id = :full_doctor_id:</Sql>
            </Query>
            <Query>
              <Sql>zapros3(vid_opl1) select count(*) from visit_tab v  
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
AND v.doctor_id = :full_doctor_id:  
and t.vid_oplat_id  = ANY(get_kind_paid_subnodes(vid_opl1))</Sql>
            </Query>
            <Query>
              <Sql>zapros4(vid_opl1,tar_pos1) select count(*) from visit_tab v  
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
AND v.doctor_id = :full_doctor_id:  
and t.vid_oplat_id = ANY(get_kind_paid_subnodes(vid_opl1)) 
and v.target_pos_id tar_pos1</Sql>
            </Query>
            <Query>
              <Sql>zapros5(vid_opl1,tar_pos1) select  round(count(*)*100.0/:allcount:) from visit_tab v  
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
AND v.doctor_id = :full_doctor_id:  
and t.vid_oplat_id = ANY(get_kind_paid_subnodes(vid_opl1)) 
and v.target_pos_id tar_pos1</Sql>
            </Query>
            <Query>
              <Sql>zapros6 select count(*) as allcount from visit_tab v where :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
AND v.doctor_id IN 
( 
SELECT full_doctor_id FROm full_doctor_tab f 
WHERE full_doctor_id IN 
( 
SELECT DISTINCT doctor_id FROM visit_tab v WHERE 
:param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
) 
AND :param2_1_: and :param5_1_: 
)</Sql>
            </Query>
            <Query>
              <Sql>zapros7(vid_opl1) select count(*) from visit_tab v  
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
AND v.doctor_id IN 
( 
SELECT full_doctor_id FROm full_doctor_tab f 
WHERE full_doctor_id IN 
( 
SELECT DISTINCT doctor_id FROM visit_tab v WHERE 
:param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
) 
AND :param2_1_: and :param5_1_: 
) 
and t.vid_oplat_id = ANY(get_kind_paid_subnodes(vid_opl1))</Sql>
            </Query>
            <Query>
              <Sql>zapros8(vid_opl1,tar_pos1) select count(*) from visit_tab v  
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
AND v.doctor_id IN 
( 
SELECT full_doctor_id FROm full_doctor_tab f 
WHERE full_doctor_id IN 
( 
SELECT DISTINCT doctor_id FROM visit_tab v WHERE 
:param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
) 
AND :param2_1_: and :param5_1_: 
) 
and t.vid_oplat_id = ANY(get_kind_paid_subnodes(vid_opl1)) 
and v.target_pos_id tar_pos1</Sql>
            </Query>
            <Query>
              <Sql>zapros9(vid_opl1,tar_pos1) select  round(count(*)*100.0/:allcount:) from visit_tab v  
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:')  
AND v.doctor_id IN 
( 
SELECT full_doctor_id FROm full_doctor_tab f 
WHERE full_doctor_id IN 
( 
SELECT DISTINCT doctor_id FROM visit_tab v WHERE 
:param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
) 
AND :param2_1_: and :param5_1_: 
) 
and t.vid_oplat_id = ANY(get_kind_paid_subnodes(vid_opl1)) 
and v.target_pos_id tar_pos1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Отдел" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0 UNION SELECT 'otdel = '||otdel::text, nam_otdel, 1 FROm otdel_tab ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="по" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Специальность врача" Type="select">
              <Sql>SELECT ' true '::text, 'Все'::text, 0  UNION  SELECT distinct 'f.dolg_doctor_id='||dolg_doctor_id::text, f.dolg_doctor, 1 FROm full_doctor_tab f ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="330010" Name="Анализ структуры посещений амбулаторно-поликлинической помощи" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Анализ структуры посещений амбулаторно-поликлинической помощи.xls">
          <Queries>
            <Query>
              <Sql>zapros1(spec_1) SELECT  round(sum(f.stavka*d.nagruzka)*get_default(':param2_1_:','1')::text::int4/*,0*/) as plan1,    
round(sum(f.stavka)::numeric,2) as stavka1, 
get_default(':param2_1_:','1') as kolvo_dney, 'spec_1' as dolg_doctor_id 
 FROM spec_doctor_tab f 
LEFT JOIN dolg_doctor_tab d On d.dolg_doctor_id = f.dolg_doctor_id 
WHERe f.dolg_doctor_id IN (spec_1)</Sql>
            </Query>
            <Query>
              <Sql>zapros10(vopl2,mest_obs2,dsss2,target2) select count(*) from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id 
left join talon_tab t on t.talon_id=v.talon_id  
where f.dolg_doctor_id IN (dsss2) and    
:param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id  = ANY(get_kind_paid_subnodes(vopl2)) AND 
v.target_pos_id IN (target2)</Sql>
            </Query>
            <Query>
              <Sql>zapros2(vid_oplat1,cond) select count(*), round(count(*)*100.0/conv_to_null(:plan1:::int4), 2) as proc1, COALESCE(:plan1:::int4,0) - count(*) as otkl 
  from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id 
left join talon_tab t on t.talon_id=v.talon_id  
where f.dolg_doctor_id IN (:dolg_doctor_id:) and    
:param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id  = ANY(get_kind_paid_subnodes(vid_oplat1)) 
cond</Sql>
            </Query>
            <Query>
              <Sql>zapros3(vid_oplat1,mest_obs) select count(*) from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id 
left join talon_tab t on t.talon_id=v.talon_id  
where f.dolg_doctor_id IN (:dolg_doctor_id:) and    
:param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id  = ANY(get_kind_paid_subnodes(vid_oplat1))</Sql>
            </Query>
            <Query>
              <Sql>zapros4(vid_oplat1,mest_obs,target1) select count(*) from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id 
left join talon_tab t on t.talon_id=v.talon_id  
where f.dolg_doctor_id IN (:dolg_doctor_id:) and    
:param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id  = ANY(get_kind_paid_subnodes(vid_oplat1)) AND 
v.target_pos_id IN (target1)</Sql>
            </Query>
            <Query>
              <Sql>zapros5(spec_2) SELECT round(sum(f.stavka*d.nagruzka)*get_default(':param2_1_:','1')::text::int4/*,0*/) as plan1, 
round(sum(f.stavka)::numeric,2) as stavka1, 
get_default(':param2_1_:','1') as kolvo_dney 
 FROM spec_doctor_tab f 
LEFT JOIN dolg_doctor_tab d On d.dolg_doctor_id = f.dolg_doctor_id 
WHERE d.dolg_doctor_id NOT IN (spec_2)</Sql>
            </Query>
            <Query>
              <Sql>zapros6(vid_oplat1,spec_2,cond) select count(*), round(count(*)*100.0/conv_to_null(:plan1:::int4), 2) as proc1,  COALESCE(:plan1:::int4,0) - count(*) as otkl from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id 
left join talon_tab t on t.talon_id=v.talon_id  
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id  = ANY(get_kind_paid_subnodes(vid_oplat1)) 
 AND f.dolg_doctor_id NOT IN (spec_2) 
cond</Sql>
            </Query>
            <Query>
              <Sql>zapros7(vid_oplat1,mest_obs,spec_2) select count(*) from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id 
left join talon_tab t on t.talon_id=v.talon_id  
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id  = ANY(get_kind_paid_subnodes(vid_oplat1)) 
 AND f.dolg_doctor_id NOT IN (spec_2)</Sql>
            </Query>
            <Query>
              <Sql>zapros8(vid_oplat1,mest_obs,target1,spec_2) select count(*) from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id 
left join talon_tab t on t.talon_id=v.talon_id  
where :param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id = ANY(get_kind_paid_subnodes(vid_oplat1)) AND  
v.target_pos_id IN (target1) 
 AND f.dolg_doctor_id NOT IN (spec_2)</Sql>
            </Query>
            <Query>
              <Sql>zapros9(vopl1,dsss1,cond) select count(*), round(count(*)*100.0/conv_to_null(:plan1:::int4), 2) as proc1, COALESCE(:plan1:::int4,0) - count(*) as otkl 
  from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id 
left join talon_tab t on t.talon_id=v.talon_id  
where f.dolg_doctor_id IN (dsss1) and    
:param3_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id  = ANY(get_kind_paid_subnodes(vopl1)) 
cond</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Кол-во рабочих дней" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="period1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="по" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="390010" Name="Отчет об объеме стоматологической помощи" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Отчет об объеме стоматологической помощи.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT v.doctor_id, f.fio, f.dolg_doctor, COUNT(DISTINCT v.visit_id) as vkol, 
round(sum(m.yet*o.kol), 2) as mkol 
FROm visit_tab v 
LEFT JOIN talon_tab t On t.talon_id = v.talon_id 
LEFT JOIN full_doctor_tab f On f.full_doctor_id = v.doctor_id 
LEFT JOIN operman_tab o ON o.visit_id = v.visit_id 
LEFT JOIN man_tab m ON m.man_id = o.man_id AND m.spec = f.dolg_doctor_id 
WHERE :param3_1_: BETWEEN date(':period1_1_:') AND date(':period1_2_:') 
AND f.dolg_doctor_id IN (97,98) 
AND :param2_1_: 
GROUP BY v.doctor_id, f.fio, f.dolg_doctor</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT  COUNT(DISTINCT v.visit_id) as vkol, 
round(sum(m.yet*o.kol), 2) as mkol 
FROm visit_tab v 
LEFT JOIN talon_tab t On t.talon_id = v.talon_id 
LEFT JOIN full_doctor_tab f On f.full_doctor_id = v.doctor_id 
LEFT JOIN operman_tab o ON o.visit_id = v.visit_id 
LEFT JOIN man_tab m ON m.man_id = o.man_id AND m.spec = f.dolg_doctor_id 
WHERE :param3_1_: BETWEEN date(':period1_1_:') AND date(':period1_2_:') 
AND f.dolg_doctor_id IN (97,98) 
AND :param2_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Вид оплаты" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text,0  UNION  SELECT 't.vid_oplat_id = '||v.vid_oplat_id, v.nam_oplat, 1 FROm vid_oplat_tab v  ORDER BY 3,2 </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="по" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="400010" Name="Сводный отчет о проведенных манипуляциях" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Сводный отчет о проведенных манипуляциях.xls">
          <Queries>
            <Query>
              <Sql>vr_fake SELECT CASE WHEN length(join_str(v.fio))&gt;120 THEN 'Все'::text ELSE join_str(v.fio) END 
FROM 
(SELECT f.full_doctor_id as doctor_id, 
f.full_doctor_id||' '||f.fio||' ('||f.dolg_doctor||')' as fio FROM full_doctor_tab f) as v 
WHERE v.doctor_id = 9701</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT  '$id',m.man,sum(o.kol) as okol, 
round(sum(m.yet*o.kol), 2) as mkol 
FROm visit_tab v 
LEFT JOIN talon_tab t On t.talon_id = v.talon_id 
LEFT JOIN full_doctor_tab f On f.full_doctor_id = v.doctor_id 
LEFT JOIN operman_tab o ON o.visit_id = v.visit_id 
LEFT JOIN man_tab m ON m.man_id = o.man_id AND m.spec = f.dolg_doctor_id 
WHERE :param3_1_: BETWEEN date(':period1_1_:') AND date(':period1_2_:') 
AND :param2_1_: 
GROUP BY  m.man, o.man_id 
ORDEr BY 2</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT  sum(o.kol) as okol, 
round(sum(m.yet*o.kol), 2) as mkol 
FROm visit_tab v 
LEFT JOIN talon_tab t On t.talon_id = v.talon_id 
LEFT JOIN full_doctor_tab f On f.full_doctor_id = v.doctor_id 
LEFT JOIN operman_tab o ON o.visit_id = v.visit_id 
LEFT JOIN man_tab m ON m.man_id = o.man_id AND m.spec = f.dolg_doctor_id 
WHERE :param3_1_: BETWEEN date(':period1_1_:') AND date(':period1_2_:') 
AND :param2_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Врач" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0  UNION  SELECT 'v.doctor_id = '||full_doctor_id, full_doctor_id||' '||fio||' ('||dolg_doctor||')',1  FROm full_doctor_tab  ORDER BY 3,2  </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="по" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008020701" Name="Работа врачей поликлиники (амбулатории), диспансера, консультации" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Работа врачей поликлиники (амбулатории), диспансера, консультации.xls">
          <Queries>
            <Query>
              <Sql>zapros1(doc_sec,other_sec,purpose_sec) SELECT COUNT(*) 
FROM visit_tab v 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
WHERE doc_sec 
 AND :param_1_: BETWEEN date(':period1_1_:') AND date (':period1_2_:') 
 AND other_sec 
 AND purpose_sec</Sql>
            </Query>
            <Query>
              <Sql>zapros2(other_sec,purpose_sec) SELECT COUNT(*) 
FROM visit_tab v 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
WHERE f.dolg_doctor_id NOT IN (11,16,79,14,15,8,17,19,25,24,26,27,6,39,10,40,43,44,7,49,35,41,2,18,50) 
 AND :param_1_: BETWEEN date(':period1_1_:') AND date (':period1_2_:') 
 AND other_sec 
 AND purpose_sec</Sql>
            </Query>
            <Query>
              <Sql>zapros3(other_sec,purpose_sec) SELECT COUNT(*) 
FROM visit_tab v 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
WHERE f.dolg_doctor_id NOT IN (11,39,10,50) 
 AND :param_1_: BETWEEN date(':period1_1_:') AND date (':period1_2_:') 
 AND other_sec 
 AND purpose_sec</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Период:" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param" Caption="по" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2010303001" Name="Количество посещений к специалистам по отделениям за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Количество посещений к специалистам по отделениям за период.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT  o.nam_otdel,count(distinct visit_id) AS num  FROM  visit_tab v   
LEFT JOIN talon_tab t On t.talon_id = v.talon_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id  
LEFT JOIN otdel_tab o ON o.otdel::text = f.otdel 
WHERE :param4_1_: &gt;= date(':period1_1_:') and  :param4_1_: &lt;=   date(':period1_2_:')  
AND f.full_doctor_id is not null AND t.vid_oplat_id  = ANY(get_kind_paid_subnodes(:param3_1_:)) 
GROUP BY o.nam_otdel ORDER BY 1;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param3" Caption="Вид оплаты" Type="select2">
              <Sql>0=ОМС|2=Платные услуги|4=Другое|5=ДМС|1=Бюджет</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param4" Caption="По" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2010503001" Name="Новый отчет" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Новый отчет.xls">
          <Queries>
            <Query>
              <Sql>zapros2 SELECT count(visit_id) FROM visit_tab v 
LEFT JOIN full_doctor_tab f ON v.doctor_id = f.full_doctor_id 
WHERE f.otdel = :otdel: AND v.date_visit BETWEEN ':date_1_ :' AND ':date_2_:'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT nam_otdel, otdel::varchar AS otdel FROM otdel_tab ORDER BY 2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="date" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2024303000" Name="Посещения по специалистам и страховым компаниям" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Посещения по специалистам и страховым компаниям.xls">
          <Queries>
            <Query>
              <Sql>z1(par1,par2) SELECT  count(distinct v.visit_id) as p1, count(distinct t.dan_id) as p2, 
sum(v.conv_price) as p3  
FROM  visit_tab v  
LEFT JOIN talon_tab t On t.talon_id = v.talon_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id 
LEFT JOIN dan_tab d on d.dan_id=t.dan_id 
WHERE v.data_pos between date(':param1_1_:') and date(':param1_2_:')    
AND (par1) 
AND (d.strcom_id = par2 OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id=par2))</Sql>
            </Query>
            <Query>
              <Sql>z2(par1,par2) SELECT count(distinct h.id) as p1, count(distinct h.dan_id) as p2, sum(e.cost) as p3 
FROM hosp_tab h 
LEFT JOIN dan_tab d on d.dan_id=h.dan_id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.code=(case when (DATE_PART('year',AGE(h.date_begin, d.date_born)) between 0 and 17) then 
	case when h.stacionar_type=4 then  '198304' 
		else '198305' end 
	else case when h.stacionar_type=4 then  '098304' 
		else '098305' end end) 
LEFT JOIN eq_uslug_cost_tab e ON e.sp_uslug_id = usl.id AND e.sp_kind_paid_id = 0 AND h.date_end BETWEEN e.date_begin AND e.date_end 
 
WHERE h.date_end BETWEEN ':param1_1_:'  AND ':param1_2_:' 
AND  (h.stacionar_type=par1) 
AND (d.strcom_id = par2 OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id=par2))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата посещения" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2024903000" Name="Характеристика объема поликлинической помощи по видам оплаты" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Характеристика объема поликлинической помощи по видам оплаты.xls">
          <Queries>
            <Query>
              <Sql>z1 SELECT f.full_doctor_id as doc_id, f.fio as p1 
 FROM full_doctor_tab f 
where :param2_1_: and :param5_1_: 
 ORDER BY 1</Sql>
            </Query>
            <Query>
              <Sql>z2(vid_oplat1,param1) select count(distinct v.visit_id), 
sum(case when get_vozrast(d.date_born,v.data_pos) between 0 and 17 then 1 else 0 end) as p2, 
sum(case when get_vozrast(d.date_born,v.data_pos) &gt;= 60 then 1 else 0 end) as p3, 
sum(case when v.target_pos_id=4 then 1 else 0 end) as p4  
from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
left join dan_tab d on d.dan_id=t.dan_id 
where f.full_doctor_id = :doc_id: and     
:param1_1_: between date(':period1_1_:') and date (':period1_2_:')  
vid_oplat1 
param1</Sql>
            </Query>
            <Query>
              <Sql>z3(param1) select count(distinct v.visit_id), 
sum(case when get_vozrast(d.date_born,v.data_pos) between 0 and 17 then 1 else 0 end) as p2, 
sum(case when get_vozrast(d.date_born,v.data_pos) &gt;= 60 then 1 else 0 end) as p3, 
sum(case when v.target_pos_id=4 then 1 else 0 end) as p4  
from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
left join dan_tab d on d.dan_id=t.dan_id 
where f.full_doctor_id = :doc_id: and     
:param1_1_: between date(':period1_1_:') and date (':period1_2_:')  
param1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Отдел" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0  UNION  SELECT 'f.otdel = '''||o.otdel||'''',o.nam_otdel, 1 FROm otdel_tab o  ORDER BY 3,2 </Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Специалист" Type="select">
              <Sql>SELECT ' true '::text, 'Все'::text, 0  UNION  SELECT distinct 'f.dolg_doctor_id='||dolg_doctor_id::text, f.dolg_doctor, 1 FROm full_doctor_tab f ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="По" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2032703000" Name="Характеристика объема поликлинической помощи (отделения)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Характеристика объема поликлинической помощи (отделения).xls">
          <Queries>
            <Query>
              <Sql>zapros1 select nam_otdel, otdel_id, sum(stavka1) as stavka1, sum(plan1) as plan1, 
sum(kolvo_dney) as kolvo_dney, sum(kolvo_pos) as kolvo_pos 
from ( 
select 
nam_otdel, q.otdel_id, 
case when kolvo_pos=0 then sum(stavka1) else sum(round(stavka1/kolvo_pos,1)) end as stavka1, 
case when kolvo_pos=0 then sum(plan1) else sum(round(plan1/kolvo_pos)) end as plan1, 
sum(kolvo_dney) as kolvo_dney, 
sum(kolvo_pos) as kolvo_pos 
from ( 
select 
ot.nam_otdel,   f.otdel as otdel_id, 
round(sum(s.stavka)::numeric,2) as stavka1, 
round(sum(s.stavka*d.nagruzka)::numeric*get_kol_days(:param4_1_:,':param2_1_:',f.full_doctor_id),0) as plan1, 
get_kol_days(:param4_1_:,':param2_1_:',f.full_doctor_id) as kolvo_dney  , 
count(v.visit_id) as kolvo_pos,f.full_doctor_id 
from visit_tab v 
left join full_doctor_tab f on f.full_doctor_id=v.doctor_id 
left join talon_tab t on t.talon_id=v.talon_id   and t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) 
LEFT JOIN spec_doctor_tab s On s.kod_doctor = f.full_doctor_id 
LEFT JOIN dolg_doctor_tab d On d.dolg_doctor_id = f.dolg_doctor_id 
left join otdel_tab ot on ot.otdel=f.otdel::bigint 
WHERe   :param3_1_: and :param5_1_: 
and :param1_1_: between date(':period1_1_:') and date (':period1_2_:')  
GROUP BY ot.nam_otdel, f.otdel,f.full_doctor_id 
) q where :pose_1_1_: 
group by 1,2,q.kolvo_pos 
) as m 
group by  1,2 
order by 1</Sql>
            </Query>
            <Query>
              <Sql>zapros2(vid_oplat1) select  round(count(distinct v.visit_id)*100.0/conv_to_null(:plan1:), 2) as proc1, count(distinct v.visit_id) 
from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id   
where f.otdel= ':otdel_id:' and     
:param1_1_: between date(':period1_1_:') and date (':period1_2_:')   
and (vid_oplat1=-1 or t.vid_oplat_id   = vid_oplat1)</Sql>
            </Query>
            <Query>
              <Sql>zapros3(vid_oplat1,mest_obs) select count(distinct t.dan_id) as cnt_pat,  count(distinct v.visit_id) 
from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id 
left join dan_tab d on d.dan_id=t.dan_id  
where f.otdel= ':otdel_id:' and    
:param1_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id   = vid_oplat1 
AND v.mesto_obs mest_obs 'П'</Sql>
            </Query>
            <Query>
              <Sql>zapros4(vid_oplat1,mest_obs,target1) select count(distinct v.visit_id) 
from visit_tab  v 
left join full_doctor_tab f On f.full_doctor_id = v.doctor_id  
left join talon_tab t on t.talon_id=v.talon_id  
where f.otdel= ':otdel_id:' and     
:param1_1_: between date(':period1_1_:') and date (':period1_2_:') 
and t.vid_oplat_id   = vid_oplat1 
AND v.mesto_obs mest_obs 'П'  AND 
v.target_pos_id IN (target1)</Sql>
            </Query>
            <Query>
              <Sql>zaprosdd SELECT   count(*) 
 
FROM 
dop_disp_measures_tab dm 
left join full_doctor_tab f on f.full_doctor_id=dm.doctor_id 
 WHERE 
f.otdel= ':otdel_id:' and   dm.dop_disp_measure_id in (1800000, 1900000, 2200000, 2300000, 2400000, 2500000, 2600000, 2700000, 3400000, 3500000, 3800000, 3900000, 4000000, 4100000, 4800000, 5000000, 4900000, 5200000, 5500000, 5700000, 6400000, 7900000, 8300000, 9300000, 9700000) and  
dm.measure_date between date(':period1_1_:') and date (':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="pose_1" Caption="Врачей с нулевыми посещениями" Type="select">
              <Sql>select 'true'::text, 'учитывать'::text UNION ALL select 'kolvo_pos&gt;0', 'не учитывать'::text</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Кол-во рабочих дней" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Отдел" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0  UNION  SELECT 'f.otdel = '''||o.otdel||'''',o.nam_otdel, 1 FROm otdel_tab o  ORDER BY 3,2 </Sql>
            </Parameter>
            <Parameter Name="param1" Caption="По" Type="select2">
              <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Расчет рабочих дней" Type="select2">
              <Sql>0=Не уточнять|1=Уточнить по врачам(справочник Число дней, которые врач в отчетном периоде работал)</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Специалист" Type="select">
              <Sql>SELECT ' true '::text, 'Все'::text, 0  UNION  SELECT distinct 'f.dolg_doctor_id='||dolg_doctor_id::text, f.dolg_doctor, 1 FROm full_doctor_tab f ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2032903000" Name="Отчет о деятельности МО в сфере ОМС (146 приказ)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Отчет о деятельности МО в сфере ОМС (146 приказ).xls">
          <Queries>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros2(param_dat,cond) SELECT count(distinct ok.id) 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
WHERE (ok.reestr_date BETWEEN param_dat::date AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id = get_our_region_code() --- Иногородний 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
cond</Sql>
            </Query>
            <Query>
              <Sql>zapros3(param_dat,cond) SELECT count(distinct ok.dan_id) 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
WHERE (ok.reestr_date BETWEEN param_dat::date AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id = get_our_region_code() --- Иногородний 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
cond</Sql>
            </Query>
            <Query>
              <Sql>zapros4(param_dat,cond) SELECT sum(ok.cost) 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
WHERE (ok.reestr_date BETWEEN param_dat::date AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id = get_our_region_code() --- Иногородний 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
cond</Sql>
            </Query>
            <Query>
              <Sql>zapros5(param_dat,cond) select count(stac.dan_id)*sum(stac.discharge_date - stac.date_visit + 1) 
FROM stacionar_tab stac  
	LEFT JOIN talon_tab t 			ON t.stacionar_id = stac.id  
where stac.discharge_date BETWEEN param_dat::date AND date(':period_2_:') 
	  and t.vid_oplat_id=0 
	cond</Sql>
            </Query>
            <Query>
              <Sql>zapros6(param_dat,cond) select sum(stac.discharge_date - stac.date_visit + 1) 
FROM stacionar_tab stac  
	LEFT JOIN talon_tab t 			ON t.stacionar_id = stac.id  
where stac.discharge_date BETWEEN param_dat::date AND date(':period_2_:') 
	 and t.vid_oplat_id=0  
	cond</Sql>
            </Query>
            <Query>
              <Sql>zapros7(param_dat,cond) select sum(l.price) as p1 
FROM stacionar_tab stac  
LEFT JOIN talon_tab t 			ON t.stacionar_id = stac.id  
LEFT JOIN doctor_tab doc 		ON doc.doctor_id = stac.doctor_id  
LEFT JOIN codifiers.otdel_tab otdel ON otdel.id = doc.sp_otdel_id 
LEFT JOIN codifiers.lpu_otdels_tab l ON l.otdel_code = otdel.code AND l.pricpol IN 
    	(SELECT code FROM codifiers.lpu_tab WHERE id IN (SELECT get_lpu_id()::int4)) 
        AND l.date_begin &lt;= stac.date_visit AND (l.date_end &gt;= stac.date_visit OR l.date_end IS NULL) 
        and doc.doctor_id=stac.doctor_id 
        AND (l.spec = doc.sp_spec_doctor_id OR l.spec = 0 OR l.spec IS NULL) 
where stac.discharge_date BETWEEN param_dat::date AND date(':period_2_:') 
	  and t.vid_oplat_id=0 
	 cond</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select 'doc.sp_otdel_id='||'9004','Амбулатория Сокол',1 union select 'doc.sp_otdel_id!='||'9004','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders>
        <Folder Name="Форма 39">
          <Reports>
            <Report Id="2014303000" Name="Форма 39 (ВСП)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Форма 39\Форма 39 (ВСП).xls">
              <Queries>
                <Query>
                  <Sql>z_date SELECT to_char(':param1_1_:'::date + f.a,'dd.mm.yy'), (':param1_1_:'::date + f.a)::date AS p1 FROM generate_series(0,1000) as f(a) 
WHERE ':param1_1_:'::date + f.a &lt;=':param1_2_:'::date ORDER BY (':param1_1_:'::date + f.a)::date</Sql>
                </Query>
                <Query>
                  <Sql>z01(v_opl,age1,age2,mm) SELECT  count(*)::text FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
AND v.mesto_obs mm 'П'</Sql>
                </Query>
                <Query>
                  <Sql>z02(v_opl,tpos,age1,age2,mm) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR 
       t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
AND v.target_pos_id IN (tpos) 
AND v.mesto_obs mm 'П'</Sql>
                </Query>
                <Query>
                  <Sql>z03(v_opl,age1,age2,m_obs) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR 
       t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
AND v.mesto_obs = 'm_obs'</Sql>
                </Query>
                <Query>
                  <Sql>z04(v_opl,age1,age2) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
and  v.target_pos_id = 5</Sql>
                </Query>
                <Query>
                  <Sql>z05(v_opl,age1,age2) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
and  v.target_pos_id =1 
AND v.mesto_obs in ('Д','А')</Sql>
                </Query>
                <Query>
                  <Sql>z06(v_opl,age1,age2) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR 
       t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
AND v.mesto_obs in ('А','Д') 
AND v.data_pos=(select min(data_pos) from visit_tab v2 where v2.talon_id = t.talon_id)</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 select full_doctor_id::text||' '||fio||' - '||dolg_doctor FROM full_doctor_tab where full_doctor_id = :param2_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zdd SELECT 
  count(*)::text 
FROM 
  public.dop_disp_measures_tab dd 
  LEFT JOIN dop_disp_main_tab ddmt ON dd.dop_disp_main_id = ddmt.id 
  LEFT JOIN dan_tab d ON d.dan_id = ddmt.dan_id 
  where dd.doctor_id=:param2_1_:  
and dd.measure_date=date(':p1:') 
AND dd.dop_disp_measure_id in (1800000, 1900000, 2200000, 2300000, 2400000, 2500000, 2600000, 2700000, 3400000, 3500000, 3800000, 3900000, 4000000, 4100000, 4800000, 5000000, 4900000, 5200000, 5500000, 5700000, 6400000, 7900000, 8300000, 9300000, 9700000) and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1)</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param2" Caption="Врач" Type="select">
                  <Sql>SELECT full_doctor_id, full_doctor_id::text||' '||fio||' - '||dolg_doctor FROM full_doctor_tab  where dolg_doctor_id!=900 --where dolg_doctor ilike '%педиат%'  ORDER BY full_doctor_id</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="по" Type="select2">
                  <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
                </Parameter>
                <Parameter Name="param4" Caption="Участок" Type="select">
                  <Sql>select -1, 'По всему ЛПУ' union SELECT uchactok_id, uchactok FROM uchactok_tab ORDER BY 1;</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2014503000" Name="Форма 39 (педиатры)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Форма 39\Форма 39 (педиатры).xls">
              <Queries>
                <Query>
                  <Sql>z_date SELECT to_char(':param1_1_:'::date + f.a,'dd.mm.yyyy'), (':param1_1_:'::date + f.a)::date AS p1 FROM generate_series(0,1000) as f(a) 
WHERE ':param1_1_:'::date + f.a &lt;=':param1_2_:'::date ORDER BY (':param1_1_:'::date + f.a)::date</Sql>
                </Query>
                <Query>
                  <Sql>z01(v_opl,age1,age2,mm) SELECT  count(*)::text   FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  
AND t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
AND (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
AND (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR 
	t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
AND v.mesto_obs mm 'П'</Sql>
                </Query>
                <Query>
                  <Sql>z02(v_opl,tpos,age1,age2,mm) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR 
       t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
AND v.target_pos_id IN (tpos) 
AND v.mesto_obs mm 'П'</Sql>
                </Query>
                <Query>
                  <Sql>z03(v_opl,age1,age2,m_obs) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR 
       t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
AND v.mesto_obs = 'm_obs'</Sql>
                </Query>
                <Query>
                  <Sql>z04(v_opl,age1,age2) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
and  v.target_pos_id = 5</Sql>
                </Query>
                <Query>
                  <Sql>z05(v_opl,age1,age2) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  
AND t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
AND (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
AND (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR 
	t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
AND v.target_pos_id =1 
AND v.mesto_obs in ('Д','А')</Sql>
                </Query>
                <Query>
                  <Sql>z06(v_opl,tpos,age1,age2,mm) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR 
       t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
AND v.target_pos_id IN (tpos) 
AND v.mesto_obs mm 'П' 
AND v.data_pos=(select min(data_pos) from visit_tab v2 where v2.talon_id = t.talon_id)</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 select full_doctor_id::text||' '||fio||' - '||dolg_doctor FROM full_doctor_tab where full_doctor_id = :param2_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zdd SELECT 
  count(*)::text 
FROM 
  public.dop_disp_measures_tab dd 
  LEFT JOIN dop_disp_main_tab ddmt ON dd.dop_disp_main_id = ddmt.id 
  LEFT JOIN dan_tab d ON d.dan_id = ddmt.dan_id 
  where dd.doctor_id=:param2_1_:  
and dd.measure_date=date(':p1:') 
AND dd.dop_disp_measure_id in (1800000, 1900000, 2200000, 2300000, 2400000, 2500000, 2600000, 2700000, 3400000, 3500000, 3800000, 3900000, 4000000, 4100000, 4800000, 5000000, 4900000, 5200000, 5500000, 5700000, 6400000, 7900000, 8300000, 9300000, 9700000) and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1)</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param2" Caption="Врач" Type="select">
                  <Sql>SELECT full_doctor_id, full_doctor_id::text||' '||fio||' - '||dolg_doctor FROM full_doctor_tab  where dolg_doctor_id!=900 --where dolg_doctor ilike '%педиат%'  ORDER BY full_doctor_id</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="по" Type="select2">
                  <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
                </Parameter>
                <Parameter Name="param4" Caption="Участок" Type="select">
                  <Sql>select -1, 'По всему ЛПУ' union SELECT uchactok_id, uchactok FROM uchactok_tab ORDER BY 1;</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2014703000" Name="Форма 39 (терапевты)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Объем поликлинической помощи\Форма 39\Форма 39 (терапевты).xls">
              <Queries>
                <Query>
                  <Sql>z01(v_opl,age1,age2,mm) SELECT count(*)::text FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  
AND t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
AND v.mesto_obs mm 'П'</Sql>
                </Query>
                <Query>
                  <Sql>z02(v_opl,tpos,age1,age2,mm) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR 
       t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND DATE_PART('year',AGE(:param3_1_:, d.date_born)) BETWEEN age1 AND age2 
AND v.target_pos_id IN (tpos) 
AND v.mesto_obs mm 'П'</Sql>
                </Query>
                <Query>
                  <Sql>z03(v_opl) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR 
       t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND v.mesto_obs = 'А'</Sql>
                </Query>
                <Query>
                  <Sql>z04(v_opl,mm) SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  AND 
t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(v_opl))  or (v_opl=-1 and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR 
       t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))) ) 
AND v.mesto_obs mm 'П' 
AND v.data_pos=(select min(data_pos) from visit_tab v2 where v2.talon_id = t.talon_id)</Sql>
                </Query>
                <Query>
                  <Sql>z05 SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  
AND t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR t.vid_oplat_id = ANY(get_kind_paid_subnodes(1)))</Sql>
                </Query>
                <Query>
                  <Sql>z06 SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE :param3_1_:=date(':p1:')  
AND t.result_id IS NOT NULL 
AND v.doctor_id=:param2_1_: 
and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1) 
and (t.vid_oplat_id = ANY(get_kind_paid_subnodes(0)) OR t.vid_oplat_id = ANY(get_kind_paid_subnodes(1))) 
and target_pos_id=1</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 SELECT to_char(':period_1_:'::date + f.a, 'dd.mm.yy'), ':period_1_:'::date + f.a AS p1 
FROM generate_series(0,31) as f(a) 
WHERE ':period_1_:'::date + f.a &lt;=':period_2_:'::date</Sql>
                </Query>
                <Query>
                  <Sql>zapros14 SELECT full_doctor_id::text||' '||fio||' - '||dolg_doctor FROM full_doctor_tab WHERE full_doctor_id=:param2_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zdd SELECT 
  count(*)::text 
FROM 
  public.dop_disp_measures_tab dd 
  LEFT JOIN dop_disp_main_tab ddmt ON dd.dop_disp_main_id = ddmt.id 
  LEFT JOIN dan_tab d ON d.dan_id = ddmt.dan_id 
  where dd.doctor_id=:param2_1_:  
and dd.measure_date=date(':p1:') 
AND dd.dop_disp_measure_id in (1800000, 1900000, 2200000, 2300000, 2400000, 2500000, 2600000, 2700000, 3400000, 3500000, 3800000, 3900000, 4000000, 4100000, 4800000, 5000000, 4900000, 5200000, 5500000, 5700000, 6400000, 7900000, 8300000, 9300000, 9700000) and (d.uchactok_id = :param4_1_: OR :param4_1_:=-1)</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param2" Caption="Врач:" Type="select">
                  <Sql>SELECT full_doctor_id, full_doctor_id::text||' '||fio||' - '||dolg_doctor FROM full_doctor_tab  where dolg_doctor_id!=900 and is_working=1 ORDER BY full_doctor_id  </Sql>
                </Parameter>
                <Parameter Name="period" Caption="Период c:" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="по" Type="select2">
                  <Sql>v.data_vnes_inf=Дате внесения|v.data_pos=Дате визита</Sql>
                </Parameter>
                <Parameter Name="param4" Caption="Участок" Type="select">
                  <Sql>select -1, 'По всему ЛПУ' union SELECT uchactok_id, uchactok FROM uchactok_tab ORDER BY 1;</Sql>
                </Parameter>
              </Parameters>
            </Report>
          </Reports>
          <Folders />
        </Folder>
      </Folders>
    </Folder>
    <Folder Name="Реестры пролеченных пациентов и отпущенных рецептов">
      <Reports>
        <Report Id="15" Name="Реестр выписанных льготных лекарств для заявки" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Реестр выписанных льготных лекарств для заявки.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select '$id', sum(c) as param_1_4_, param_1_1_, param_1_2_, param_1_3_, param_1_5_ from ( 
 select '$id', count(*) as c, lgot_preparat_tab.mnn_rus as param_1_1_, 
 lgot_preparat_tab.doza as param_1_2_, maker as param_1_3_, 
 lgot_preparat_tab.nam_rus as param_1_5_ from rezept_tab 
 left join lgot_preparat_tab on lgot_preparat_tab.kod=rezept_tab.kod_minzd 
 where not bad and date_vipiski between date(':period_1_1_:') and date(':period_1_2_:') 
 and rezept_tab.kod_minzd is not null and char_length(trim(rezept_tab.kod_lgot))&lt;3 
 and lgot_preparat_tab.mnn_rus is not null 
 group by kod_minzd, lgot_preparat_tab.mnn_rus, lgot_preparat_tab.doza, maker, lgot_preparat_tab.nam_rus 
 order by lgot_preparat_tab.mnn_rus 
) as foo group by param_1_1_, param_1_2_, param_1_3_, param_1_5_ order by param_1_1_</Sql>
            </Query>
            <Query>
              <Sql>zapros0 select '$id', sum(c) as param_1_4_, param_1_1_, param_1_2_, param_1_3_, param_1_5_ from (
 
 select '$id', count(*) as c, lgot_preparat_tab.mnn_rus as param_1_1_, 
 
 lgot_preparat_tab.doza as param_1_2_, maker as param_1_3_,
 
 lgot_preparat_tab.nam_rus as param_1_5_ from rezept_tab 
 
 left join lgot_preparat_tab on lgot_preparat_tab.kod=rezept_tab.kod_minzd 
 
 where not bad and date_vipiski between date(':period_1_1_:') and date(':period_1_2_:') 
 
 and rezept_tab.kod_minzd is not null and char_length(trim(rezept_tab.kod_lgot))=3
 
 and lgot_preparat_tab.mnn_rus is not null 
 
 group by kod_minzd, lgot_preparat_tab.mnn_rus, lgot_preparat_tab.doza, maker, lgot_preparat_tab.nam_rus 
 
 order by lgot_preparat_tab.mnn_rus
 
) as foo group by param_1_1_, param_1_2_, param_1_3_, param_1_5_ order by param_1_1_</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="131" Name="Список выписанных рецептов (с данными из аптек)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Список выписанных рецептов (с данными из аптек).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT '$id',d.fam||' '||d.nam||' '||conv_to_null(d.mid) as fio, 
r.snils, r.kod_lgot, r.rezept_ser, r.rezept_num, r.date_vipiski, 
r.kol, trunc(ra.kolvo::numeric,2) as kol_ap, trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap, 
l.name_med, l1.name_med as name_med_ap , s.sklad, ra.date_out 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
WHERE  :param2_1_: AND r.date_vipiski between date(':param1_1_: ') and  date(':param1_2_: ') 
and :param3_1_: and :param4_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param4" Caption="" Type="select">
              <Sql>SELECT ' l1.name_med is not null ', 'Только отпущенные'::text  UNION  SELECT ' l1.name_med is null ', 'Только не отпущенные'::text  UNION  SELECT ' true ', 'Все'::text  </Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Дата выписки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Льгота" Type="select">
              <Sql>SELECT 'length(trim(r.kod_lgot)) = 3'::text, 'Федеральная'::text  UNION  SELECT 'length(trim(r.kod_lgot)) = 2'::text, 'Местная'::text  UNION  SELECT 'true'::text, 'Все'::text </Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true', 'Все'::text UNION SELECT ' d.uchactok_id = '||uchactok_id::text , uchactok FROM uchactok_tab  ORDER BY 2;</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="132" Name="Список отпущенных рецептов (которых нет в базе)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Список отпущенных рецептов (которых нет в базе).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT '$id', ra.fam||' '||ra.nam||' '||conv_to_null(ra.mid) as fio,  
pens,  trunc(ra.kolvo::numeric,2) as kol_ap, trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap, 
ra.kat_lgot, ra.rezept_ser||' '||ra.rezept_num as rezept, f.fio as dfio, l1.name_med 
, ra.date_out, s.sklad 
FROM rezept_ap_tab ra 
LEFT JOIN rezept_tab r ON r.rezept_ser = ra.rezept_ser AND r.rezept_num =  ra.rezept_num 
LEFT JOIN full_doctor_tab f ON f.kod_feld = ra.pcod 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
WHERE :param1_1_: AND r.rezept_ser is null AND 
 ra.date_out between date(':period1_1_: ') and  date(':period1_2_: ')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT ' ra.sklad_id::numeric = '||sklad_id||'', sklad FROm sklad_tab  UNION  SELECT ' true ' , 'Все'::text</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Даты выдачи" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="184" Name="Список пролеченных сельских жителей по районам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Список пролеченных сельских жителей по районам.xls">
          <Queries>
            <Query>
              <Sql>mesto SELECT name||' '||socr FROM kladr_tab WHERE code = ':raion_1_:'</Sql>
            </Query>
            <Query>
              <Sql>NewZapros SELECT DISTINCT d.fam || ' ' || d.nam || ' ' || d.mid AS p0, 
t.ser_pol || '  №' || t.num_pol AS p1,  s.strcom AS p2, 
d.date_born AS p3, to_char(talon_min,'DD.MM.YYYY')||' - '||to_char(talon_max,'DD.MM.YYYY') AS p5, talon_count AS p6, 
d.address AS p4,  t.diag_osn  AS p7,talon_min,talon_max 
FROM 
( SELECT 
talon_id as talon_talon_id, 
Min(visit_tab.data_pos) as talon_min, 
Max(visit_tab.data_pos) as talon_max, count(*) as talon_count FROM visit_tab 
WHERE 
(visit_tab.data_pos between date(':period_1_:') and date(':period_2_:')) group by talon_id) 
as foo 
LEFT JOIN talon_tab t ON t.talon_id=talon_talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN strcom_tab s ON s.strcom_id=d.strcom_id 
WHERE  (d.raion_id = ':raion_1_:'  
OR d.punkt_id = ':raion_1_:' ) ORDER BY p0,talon_min,talon_max;</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT sum(talon_count) 
FROM 
( SELECT 
talon_id as talon_talon_id, 
Min(visit_tab.data_pos) as talon_min, 
Max(visit_tab.data_pos) as talon_max, count(*) as talon_count FROM visit_tab 
WHERE 
(visit_tab.data_pos between date(':period_1_:') and date(':period_2_:')) group by talon_id) 
as foo 
LEFT JOIN talon_tab t ON t.talon_id=talon_talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN strcom_tab s ON s.strcom_id=d.strcom_id 
WHERE  (d.raion_id = ':raion_1_:'  
OR d.punkt_id = ':raion_1_:' );</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата посещения:" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="raion" Caption="Район" Type="select">
              <Sql>SELECT code,name || ' ' || socr  FROM kladr_tab  ORDER BY name</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="100010" Name="РЕЕСТР на оплату (ОМС)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\РЕЕСТР на оплату (ОМС).xls">
          <Queries>
            <Query>
              <Sql>zapros SELECT distinct on (v.visit_id)  
/*'',*/ d.dan_id, v.data_pos AS p01,	 
v.data_pos AS p0,	 
1 AS p1,	 
d.fam AS p2,	 
d.nam AS p3,	 
d.mid AS p4, 	 
upper(d.sex) AS p5, 	 
d.date_born AS p6,	 
a.text_address AS p7,	 
d.dom AS p8,	 
d.korp AS p9, 		 
d.kv AS p10, 		 
'' AS p11, 
'' as nullstr,	 		 
conv_street_oms AS p13, 
3 AS usl_ok, 
res.reestr_rslt AS r_rslt, 
res.reestr_ishod AS r_ishod, 
case 
when (mkb.reestr_code ='Z10.8' and doc.sp_spec_doctor_id =97) then 'Z01.2' 
when (mkb.reestr_code ='Z10.8' and doc.sp_spec_doctor_id =39) then 'Z01.4' 
else  mkb.reestr_code end AS p14, 
 
CASE WHEN d.mesto_work_id IS NOT NULL THEN mw.mest_work ELSE ss.sozstatus END AS p15, 	 
set.value AS p16, 	 
o.reestr_code AS p17,	  	 
t.ser_pol AS p18, 	 
t.num_pol AS p19, 	 
d.data_begin as pp01, 
d.data_end as pp02, 
CASE when d.cityzen=1 then true else false end as pp03, 
v.target_pos_id as pp04, 
stp.kod_usl as pp05, 
t.strcom_id AS p20, 	 
res.reestr AS p21, 	 	 
0 AS p23, 	 
'false' AS p24, 		 
CASE WHEN d.mesto_work_id IS NOT NULL THEN 'true' ELSE 'false' END AS p25, 		 
CASE WHEN d.spolref::int8 in (select * from get_all_lpu_numbers()) THEN 
'false' ELSE 'true' END AS p26, 	 
'false' AS p27, 		 	 
0 AS p29,	 
 
(case when settings_tab.value='0055' and get_vozrast(d.date_born,v.data_pos)&lt;18 
and doc.sp_spec_doctor_id=39 then 
               (select l.price from codifiers.lpu_otdels_tab l 
			where l.spec=52 and l.date_begin &lt;= v.data_pos and 
            (l.date_end &gt; v.data_pos or l.date_end is null) 
			and l.pricpol='0054' 
	) 
 	else  v.conv_price END)  AS p30, 			 		 
'false' AS p32, 		 
4 AS p33, 		 
'' AS p34, 
case when settings_tab.value='0055' and get_vozrast(d.date_born,v.data_pos)&lt;18 
and doc.sp_spec_doctor_id=39 then 
               (select l.price from codifiers.lpu_otdels_tab l 
			where l.spec=52 and l.date_begin &lt;= v.data_pos and (l.date_end &gt; v.data_pos 
            or l.date_end is null) 
			and l.pricpol='0054' 
	) 
 	else  v.conv_price END AS p35, 	 
bl.data_begin AS p36, 	 
bl.data_end AS p37, 	 
'false' AS p38, 		 
case when d.kat is null then '' else d.kat::varchar end AS p39, 		 
v.visit_id AS p40, 	 
'false' AS p41, 		 
0 AS p42, 		 
0.00 AS p43,	 
 0 AS p47, 	 
case when settings_tab.value='0055' and get_vozrast(d.date_born,v.data_pos)&lt;18 
and doc.sp_spec_doctor_id=39 then 52 else /*doc_sp.dolg_doctor_id*/ 
sf.tfoms_code::int4 end  AS p48, 			 
v.doctor_id AS p49, 	 
d.pens AS p50, 		 
t.conv_q_z  AS p53,	 
bl.ser AS p51, 
bl.nomer AS p52, 	 
d.dan_id, 
t.conv_sop_diagn_id AS p55, 
to_char(date(':period_1_:'),'MM.YY')::float as p56, 
CASE WHEN d.fam &lt;&gt; '' THEN 1 ELSE 2 END AS p57, 
d.serdoc AS p58, 
d.numdoc AS p59 ,  
tr.reestr_code as travma_code, 
conv_np_oms AS p12, 
t.policy_type , 
d.mest_born, 
t.conv_raion_oms as p60, 
case when day_price is not null then day_price else NULL end as sum_dop, 
case when doc.sp_spec_doctor_id in (10,11) then 1 else 3 end as wid_prof,  
sf.fed_code AS prvs, 
sf.prof_code, 
vd.code as vid_doc_id, 
v.conv_ksg_code as ksg_code , 
case when v.target_pos_id in (1,2,200000) then '3' else '1' end   as vid_p, 
st.kod_s AS subject 
FROM visit_tab v 
	LEFT JOIN talon_tab t 			ON t.talon_id = v.talon_id 
	LEFT JOIN dan_tab d 			ON d.dan_id = t.dan_id 
	LEFT JOIN codifiers.travma_tab tr 	ON tr.id = t.vid_travma 
	LEFT JOIN doctor_tab doc 		ON doc.doctor_id = v.doctor_id 
    	left join codifiers.doctor_spec_tab doc_sp on doc_sp.id=doc.sp_spec_doctor_id 
	LEFT JOIN codifiers.eq_spec_fed_codes sf	ON doc_sp.eq_spec_fed_codes_id = sf.id 
	LEFT JOIN mest_work_tab mw 	ON mw.mest_work_id=d.mesto_work_id 
	left join codifiers.visit_result_common_tab res on res.id=t.result_id  
	--LEFT JOIN dolg_doctor_tab dl_doc 	ON dl_doc.dolg_doctor_id=doc_sp.dolg_doctor_id 
	LEFT JOIN strcom_tab st 		ON st.strcom_id=t.strcom_id 
	LEFT JOIN kladr_tab kl 		ON st.region_id=kl.code 
	LEFT JOIN blist_tab bl 			ON bl.dan_id=t.dan_id AND v.data_pos BETWEEN bl.data_begin AND bl.data_end and bl.type_id not in (5,8,9) 
	LEFT JOIN settings_tab set		ON set.name = 'LPU_NUMBER'	 
	LEFT JOIN otdel_tab o			ON o.otdel = doc.sp_otdel_id   
	LEFT JOIN mkb_tab mkb 		ON mkb.kod_d = t.diag_osn 
	LEFT JOIN sozstatus_tab ss		ON ss.sozstatus_id = d.sozstatus_id 
	LEFT JOIN stand_patient_tab stp 	ON stp.talon_id = t.talon_id 
	LEFT JOIN address_tab a 		ON a.dan_id=d.dan_id and a.sp_addr_type_id=1  
	left join codifiers.tar_dost_tab td on td.otdel=o.reestr_code::int4  
    	and td.lpu::int4 in (select * from get_all_lpu_numbers()) 
	LEFt JOIN settings_tab ON UPPER(settings_tab.name) = 'LPU_NUMBER' 
	--LEFT JOIN codifiers.raions_tab r	ON r.id=a.raions_id 
	LEFT JOIN codifiers.vid_doc_tab vd on vd.id=d.vid_doc_id  
 	WHERE :param10_1_: BETWEEN date(':period_1_:') AND date(':period_2_:') 
	and :param3_1_:  and :param2_1_: and :param1_1_: 
	AND (t.strcom_id&lt;97 or t.strcom_id=99) AND :param5_1_:  AND :otdel_1_: 
	and :strcom_1_:  and :param7_1_: 
	and (doc.sp_spec_doctor_id not in (57)) 
	and case when settings_tab.value in ('0152','0151') then 
(t.person_data).sozstatus_id!=6 and (t.person_data).kat!=6 else true end</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT diagn_osn AS m2 FROM diagn_tab WHERE talon_id=:p40: limit 1 OFFSET 1;</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT r.kod_oms FROM codifiers.raions_tab r 
LEFT JOIN codifiers.eq_raions_kladr_tab e ON e.raions_id = r.id 
LEFT JOIN 
(SELECT COALESCE( d.street_id, d.punkt_id,d.town_id,d.raion_id, d.region_id) as sp_street_code, d.dom::text::int4 as house_number, d.korp as building 
FROM dan_tab d 
WHERE d.dan_id = :dan_id: ) as f ON f.sp_street_code IS NOT NULL 
WHERE 
 
((e.sp_street_code = f.sp_street_code) 
 OR f.sp_street_code like trim(trailing '0' FROM e.sp_street_code)||'%' 
) 
 AND 
( 
(((f.house_number /2)::int4*2 != f.house_number) 
AND f.house_number BETWEEN e.odd_from AND e.odd_to) 
OR 
(((f.house_number /2)::int4*2 = f.house_number OR f.house_number = 0 OR f.house_number IS NULL) 
AND CASE WHEN f.house_number = 0 OR f.house_number IS NULL THEN 2 ELSE f.house_number END BETWEEN e.even_from  AND e.even_to) 
) 
AND (e.building IS NULL OR e.building = f.building) 
ORDER BY length(e.sp_street_code) DESC LIMIT 1;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param5" Caption="Вид оплаты" Type="select">
              <Sql>select 'true'::text, 'Все',0 union select 't.vid_oplat_id='||vid_oplat_tab.vid_oplat_id,vid_oplat_tab.nam_oplat,1 from vid_oplat_tab  order by 3,2</Sql>
            </Parameter>
            <Parameter Name="kat" Caption="Не учитывать категорию" Type="select">
              <Sql>select 'true',' ',0 union select '(t.person_data).kat!='||kateg_id, kateg,1 from kateg_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="status" Caption="Не учитывать статус" Type="select">
              <Sql>select 'true',' ',0 union select '(t.person_data).sozstatus_id!='||id, name,1 from codifiers.sozstatus_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="otdel" Caption="Отделение" Type="select2">
              <Sql>true=Все|doc_sp.dolg_doctor_id not in (97,98,33,34)=Поликлиника|doc_sp.dolg_doctor_id in (50,54)=Воп|doc_sp.dolg_doctor_id  in (97,98)=Стоматология|doc_sp.dolg_doctor_id  in (33,34)=Центр здоровья|doc_sp.dolg_doctor_id  in (55)=Травмпункт</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Поликлиника прикрепления в талоне" Type="select">
              <Sql>select 'true'::text, 'Все поликлиники',0 union select 't.pricpol::int4='||pricpol||'::int4', name,1 from lpu_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="strcom" Caption="Страховая компания" Type="select">
              <Sql>select 'true','Все',0  union select 't.strcom_id='||strcom_id, strcom,1 from strcom_tab where strcom_id&lt;97 or strcom_id=99 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param10" Caption="считать по" Type="select2">
              <Sql>v.data_vnes_inf=дате внесения|t.date_visit=дате посещения</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Учитывать" Type="select">
              <Sql>select 'true'::text, 'все случаи',1 union select 't.result_id IS NOT NULL and t.result_id !=11', 'только законченные случаи',2 order by 3</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Фильтр" Type="select">
              <Sql>SELECT '(v.stat_error_id != 1 OR v.stat_error_id IS NULL )', 'Без повторной подачи', 0 UNION SELECT 'true', 'Все', 1 UNION SELECT 'v.stat_error_id != 1 AND v.stat_error_id IS NOT NULL', 'С ошибками', 2 UNION SELECT ' v.stat_error_id IS NULL', 'Без ошибок', 3 ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="140010" Name="Реестр по выписанным льготным рецептам (38 приказ)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Реестр по выписанным льготным рецептам (38 приказ).xls">
          <Queries>
            <Query>
              <Sql>filename select 
case when date_part('month',date(':period_2_:'))&lt;10 
then 'RVR_'||value||'_0'||date_part('month',date(':period_2_:'))::text||date_part('year',date(':period_2_:')) 
else 'RVR_'||value||'_'||date_part('month',date(':period_2_:'))::text||date_part('year',date(':period_2_:')) 
end as file_name 
from settings_tab 
where name = 'LPU_ID'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT r.snils AS p0, d.fam AS p1, d.nam AS p2, d.mid AS p3, d.sex AS p4, 
        d.date_born AS p5, st1.value AS p6, r.kod_lgot AS p7, t.ser_pol||' '||t.num_pol AS p8, st2.value AS p9, 
CASE WHEN f.full_doctor_id is null then f1.kod_feldshera ELSE f.kod_feld END AS p10, 
CASE WHEN r.diagn_id IS NOT NULL THEN r.diagn_id ELSE t.diag_osn END AS p11, 
	r.rezept_ser||' '||r.rezept_num AS p12, r.date_vipiski AS p13, r.date_vipiski AS p14, '1' AS p15, 
	'100' AS p16, lgot_preparat_tab.kod_mnn AS p17, '' AS p18, lgot_preparat_tab.c_lf AS p19, lgot_preparat_tab.doza AS p20, 
	lgot_preparat_tab.c_dls AS p21, r.kol AS p22, '30' AS p23, '' AS p24,'' AS p25 
        FROM rezept_tab r 
        LEFT JOIN talon_tab t on t.talon_id = r.talon_id 
        LEFT JOIN dan_tab d on d.dan_id = t.dan_id 
        LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
        LEFT JOIN feldshers_tab f1 ON cast(cast(f1.kod_feldshera as text) as int) = r.doctor_id 
        LEFT JOIN lgot_preparat_tab on lgot_preparat_tab.kod = kod_minzd 
        LEFT JOIN settings_tab st1 ON st1.name = 'LPU_NUMBER' 
        LEFT JOIN settings_tab st2 ON st2.name = 'OGRN' 
        WHERE char_length(trim(r.kod_lgot))=3  and (not bad) and r.date_vipiski between date(':period_1_:') and date(':period_2_:');</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="370010" Name="Реестр региональных льготников файл 1 (02.11.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Реестр региональных льготников файл 1 (02.11.2007).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT DISTINCT CASE WHEN (length(trim(d.pens)) != 14 OR d.pens IS NULL OR d.pens ilike '%X%') THEN 
substr(lpad(d.dan_id::text, 11,'0'),1,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),4,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),7,3)||' '||substr(lpad(d.dan_id::text, 11,'0'),10,2) 
ELSE 
d.pens 
end as ss, d.ser_pol||' '||d.num_pol as SN_POL, d.fam as FAM, d.nam as IM, d.mid as ot , MYUPPER(d.sex) as W, 
 to_char(d.date_born, 'DD.MM.YYYY') as DR, 
d.serdoc||' '||d.numdoc as SN_DOC, d.vid_doc_id as С_DOC, 
d.address as ADRES, d.dom as DOM, d.korp as KOR, d.kv as KV, 
COALESCE(k1.kod_region,k2.kod_region,k3.kod_region,k4.kod_region) as OKATO_REG, 
1 as S_EDV , d.dan_id 
  FROM dan_tab d 
 LEFT JOIN kladr_tab k1 ON k1.code = d.punkt_id 
 LEFT JOIN kladr_tab k2 ON k2.code = d.town_id 
 LEFT JOIN kladr_tab k3 ON k3.code = d.raion_id 
 LEFT JOIN kladr_tab k4 ON k4.code = d.region_id 
LEFT JOIN fed_lgota_tab f ON f.dan_id = d.dan_id    AND f.pens &lt;&gt; 'XXX-XXX-XXX XX'  
WHERE d.dan_id IN 
( 
SELECT disp.dan_id FROM dispan_uchet_tab disp 
WHERe disp.lgota_id is not null AND (disp.date_sn IS NULL OR disp.date_sn &gt; now()) 
) AND d.prikreplen = 1 AND f.dan_id is null</Sql>
            </Query>
            <Query>
              <Sql>zapros1_1 SELECT DISTINCT CASE WHEN (length(trim(d.pens)) != 14 OR d.pens IS NULL OR d.pens ilike '%X%') THEN 
substr(get_lpu_number(),2,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),4,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),7,3)||' '||substr(lpad(d.dan_id::text, 11,'0'),10,2) 
ELSE 
d.pens 
end as ss, d.ser_pol||' '||d.num_pol as SN_POL, d.fam as FAM, d.nam as IM, d.mid as ot , MYUPPER(d.sex) as W, 
 to_char(d.date_born, 'DD.MM.YYYY') as DR, 
d.serdoc||' '||d.numdoc as SN_DOC, d.vid_doc_id as С_DOC, 
d.address as ADRES, d.dom as DOM, d.korp as KOR, d.kv as KV, 
COALESCE(k1.kod_region,k2.kod_region,k3.kod_region,k4.kod_region) as OKATO_REG, 
1 as S_EDV , d.dan_id, 
 to_char(disp.date, 'DD.MM.YYYY') as DB_EDV, 
CASE WHEN disp.date_sn IS NULL THEN '99.99.9999' ELSE 
to_char(disp.date_sn, 'DD.MM.YYYY') END as DE_EDV, 
'9'||(disp.lgota_id) as C_KAT1, 
to_char(disp.date, DD.MM.YYYY') as DATE_RSB , 
CASE WHEN disp.date_sn IS NULL THEN '99.99.9999' ELSE 
to_char(disp.date_sn, 'DD.MM.YYYY') END as DATE_RSE, 
0 as U_TYPE, 
'' as D_TYPE, 
''::text as C_KAT2, 
get_lpu_number() as MCOD 
 
 FROM dispan_uchet_tab disp 
 LEFT JOIN dan_tab d On d.dan_id = disp.dan_id 
 LEFT JOIN kladr_tab k1 ON k1.code = d.punkt_id 
 LEFT JOIN kladr_tab k2 ON k2.code = d.town_id 
 LEFT JOIN kladr_tab k3 ON k3.code = d.raion_id 
 LEFT JOIN kladr_tab k4 ON k4.code = d.region_id 
 WHERE disp.lgota_id is not null AND d.dan_id IS NOT  NULL AND (disp.date_sn IS NULL OR disp.date_sn &gt; now())</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT to_char(disp.date, 'DD.MM.YYYY') as DB_EDV, 
CASE WHEN disp.date_sn IS NULL THEN '99.99.9999' ELSE 
to_char(disp.date_sn, 'DD.MM.YYYY') END as DE_EDV, 
'9'||(disp.lgota_id) as C_KAT1, 
to_char(disp.date, 'DD.MM.YYYY') as DATE_RSB , 
CASE WHEN disp.date_sn IS NULL THEN '99.99.9999' ELSE 
to_char(disp.date_sn, 'DD/MM/YYYY') END as DATE_RSE, 
0 as U_TYPE, 
'' as D_TYPE 
FROm dispan_uchet_tab disp 
WHERE disp.dan_id = :dan_id: 
AND disp.lgota_id is not null AND (disp.date_sn IS NULL OR disp.date_sn &gt; now()) 
ORDER BY disp.date_sn DESC, disp.date DESC 
LIMIT 1 OFFSET 0</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT ''::text as C_KAT1, 1 
UNION 
(SELECT '9'||(disp.lgota_id) as C_KAT1, 0 
FROm dispan_uchet_tab disp 
WHERE disp.dan_id = :dan_id: 
AND disp.lgota_id is not null AND (disp.date_sn IS NULL OR disp.date_sn &gt; now()) 
ORDER BY disp.date_sn DESC, disp.date DESC 
LIMIT 1 OFFSET 1) 
ORDER BY 2 
LIMIT 1</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECT value::char(4) FROM settings_tab WHERE name = 'LPU_LGOT'</Sql>
            </Query>
          </Queries>
          <Parameters />
        </Report>
        <Report Id="380010" Name="Реестр региональных льготников файл 2 (02.11.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Реестр региональных льготников файл 2 (02.11.2007).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT DISTINCT CASE WHEN (length(trim(d.pens)) != 14 OR d.pens IS NULL OR d.pens ilike '%X%')  THEN 
substr(get_lpu_number(),2,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),4,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),7,3)||' '||substr(lpad(d.dan_id::text, 11,'0'),10,2) 
ELSE 
d.pens 
end as ss, 
'9'||(disp.lgota_id) as C_KAT, 
s.sp_lgot_doc_type as name_dl, 
disp.ser_lgot_doc||' '||disp.num_lgot_doc as SN_DL, 
to_char(disp.date, 'DD.MM.YYYY') as DATE_BL , 
CASE WHEN disp.date_sn IS NULL THEN '99.99.9999' ELSE 
to_char(disp.date_sn, 'DD.MM.YYYY') END as DATE_EL 
FROm dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
LEFT JOIN sp_lgot_doc_type_tab s ON s.sp_lgot_doc_type_id = disp.sp_lgot_doc_type_id 
LEFT JOIN fed_lgota_tab f ON f.dan_id = d.dan_id AND f.pens &lt;&gt; 'XXX-XXX-XXX XX'  
WHERE disp.lgota_id is not null AND d.dan_id is not null 
AND (disp.date_sn IS NULL OR disp.date_sn &lt; now()) 
AND d.prikreplen = 1 AND f.dan_id is null 
ORDER BY 1,2,3,4</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECT value::char(4) FROM settings_tab WHERE name = 'LPU_LGOT'</Sql>
            </Query>
          </Queries>
          <Parameters />
        </Report>
        <Report Id="460010" Name="Количество рецептов/посещений" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Количество рецептов_посещений.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT d.fam||' '||d.nam||' '||d.mid, d.date_born AS p1,sum(q1.num_vis)  AS p2,sum(q2.num_rec) AS p3 FROM 
(SELECT r.dan_id,r.doctor_id,count(*) AS num_rec FROM rezept_tab r 
WHERE r.date_vipiski BETWEEN ':period_1_:' AND ':period_2_:' 
GROUP BY r.dan_id,r.doctor_id) 
AS q2 
LEFT JOIN 
(SELECT t.dan_id,v.doctor_id,count(v.visit_id) AS num_vis FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
WHERE v.data_pos BETWEEN ':period_1_:' AND ':period_2_:' 
GROUP BY t.dan_id,v.doctor_id) 
AS q1 ON q1.dan_id = q2.dan_id AND q1.doctor_id = q2.doctor_id 
LEFT JOIN dan_tab d ON q2.dan_id = d.dan_id 
WHERE d.dan_id IS NOT NULL GROUP BY d.fam||' '||d.nam||' '||d.mid, d.date_born;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата посещения/выписки:" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="510010" Name="Реестр иногородних" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Реестр иногородних.xls">
          <Queries>
            <Query>
              <Sql>zapros6 select 
/*''::text*/d.dan_id,  
d.fam, 
d.nam, 
d.mid, 
t.ser_pol, 
t.num_pol, 
d.serdoc, 
lpad(d.numdoc,6,'0') AS numdoc, 
t.strcom_id, 
'', 
d.date_born, 
case when d.kat=4 or d.kat=12 then uz.name else 
 CASE WHEN d.mesto_work_id IS NOT NULL THEN mw.mest_work ELSE  ss.sozstatus END end AS mest_work, 
v.data_pos, 
coalesce(t.town_id,t.punkt_id,t.raion_id,t.region_id) as kladr_kod, 
'1', 
case when settings_tab.value='0055' and get_vozrast(d.date_born,v.data_pos)&lt;18 and sdt.dolg_doctor_id=39 then 
               (select zena from zena_inogorod_tab, ( 
			select max(zena_data) as d from zena_inogorod_tab 
			where dolg_doctor_id=52 and zena_data&lt;=v.data_pos 
			) as foo 
		 where dolg_doctor_id=52 and zena_data=d limit 1 
		) 
 		else 
			CASE WHEN settings_tab.value='0035' AND sdt.dolg_doctor_id = 42 AND stp.kod_usl='01.002' 
			THEN 339.07 ELSE v.conv_price END 
		end as cena1, 
case when settings_tab.value='0055' and get_vozrast(d.date_born,v.data_pos)&lt;18 and sdt.dolg_doctor_id=39 then 
               (select zena from zena_inogorod_tab, ( 
			select max(zena_data) as d from zena_inogorod_tab 
			where dolg_doctor_id=52 and zena_data&lt;=v.data_pos 
			) as foo 
		 where dolg_doctor_id=52 and zena_data=d limit 1 
		) 
 		else 
			CASE WHEN settings_tab.value='0035' AND sdt.dolg_doctor_id = 42 AND stp.kod_usl='01.002' 
			THEN 339.07 ELSE case when day_price is not null then v.conv_price + day_price else v.conv_price end END 
		end as cena2, 
case when day_price is not null then day_price else NULL end as sum_dop, 
t.region_id, 
t.raion_id, 
t.punkt_id, 
t.town_id, 
t.street_id, 
t.korp, 
t.dom, 
case when text_to_int(t.kv) =0 then '' else text_to_int(t.kv)::text end as kvart, 
CASE WHEN t.address IS NULL THEN d.address ELSE t.address END as address, 
'' as LITKWAR, 
'', d.metka_work, 
d.mest_work, 
upper(d.sex) as sex, 
cv.reestr as reestr, 
case when kat.reestr_code !='1' and (d.mesto_work_id is not null or d.mest_work is not null or d.metka_work='+') then '1' else  kat.reestr_code end as kat, 
v.visit_id, 
kl.kod_s, 
case when settings_tab.value='0055' and get_vozrast(d.date_born,v.data_pos)&lt;18 and sdt.dolg_doctor_id=39 then 52 else sdt.dolg_doctor_id end as dolg_doctor_id, 
v.doctor_id, 
d.pens, 
'0' as q_z, 
'' as nullstr, 
settings_tab.value as lpu, 
CASE WHEN d.ser_pol is not null Or d.num_pol is not null THEN 1 ELSE 2 END as SUBJECT, 
to_char(date(':period1_1_:'),'MM.YY') as DAT_REESTR, 
o.reestr_code AS r_c , 
case when stp.kod_usl='01.002' then '01.002' else '' end as kod_usl , 
d.data_begin, 
case when d.data_end is null then '9999-12-31' else d.data_end end, 
d.vid_doc_id, 
d.punkt_id, 
d.street_id, 
case when d.cityzen=1 then true else false end as is_city, 
case when t.is_emergency = true then true else false end as is_emergency, 
case when t.is_first = true then true else false end as is_first, 
v.target_pos_id , 
tr.reestr_code as travma_code , 
min(case 
when (t.diag_osn ='J03.1')  then 'J03.8' 
when (t.diag_osn ='J03.2')  then 'J03.8' 
when (t.diag_osn ='J03.3')  then 'J03.8' 
when (t.diag_osn ='J03.4')  then 'J03.8'  
when t.diag_osn is null then 
case 
when (mkb.reestr_code ='Z10.8' and sdt.dolg_doctor_id =97) then 'Z01.2' 
when (mkb.reestr_code ='Z10.8' and sdt.dolg_doctor_id =39) then 'Z01.4' 
when (mkb.reestr_code ='J03.1')  then 'J03.8' 
when (mkb.reestr_code ='J03.2')  then 'J03.8' 
when (mkb.reestr_code ='J03.3')  then 'J03.8' 
when (mkb.reestr_code ='J03.4')  then 'J03.8' 
when mkb.reestr_code is null then t.diag_osn 
else  mkb.reestr_code end 
else t.diag_osn 
 end) AS diag_osn, 
d.mest_born, 
t.policy_type,   
CASE WHEN d.mesto_work_id IS NOT NULL THEN 'true' ELSE 'false' END AS working 
FROM visit_tab v  
		LEFT JOIN talon_tab t 		on t.talon_id=v.talon_id 
		LEFT JOIN codifiers.ucheb_zaved_tab uz on uz.id=t.kod_vuz 
		LEFT JOIN dan_tab d on d.dan_id=t.dan_id 
		LEFT JOIN codifiers.travma_tab tr ON tr.id = t.vid_travma 
		LEFT JOIN mest_work_tab mw on mw.mest_work_id=d.mesto_work_id 
		LEFT JOIN spec_doctor_tab sdt on sdt.kod_doctor=v.doctor_id 
		LEFT JOIN dolg_doctor_tab dt on dt.dolg_doctor_id=sdt.dolg_doctor_id 
		LEFT JOIN result_tab res on t.result_id=res.result_id 
		LEFT JOIN codifiers.kateg_tab kat ON d.kat=kat.id 
		--LEFT JOIN codifiers.eq_region_kod_oms_tab reg 		ON reg.code=d.region_id 
		LEFT JOIN strcom_tab st on st.strcom_id=t.strcom_id 
		LEFT JOIN kladr_tab kl on t.strcom_region_id=kl.code	 
		LEFT JOIN stand_patient_tab stp ON stp.talon_id = t.talon_id and v.data_pos = stp.date_usl 
		LEFT JOIN sozstatus_tab ss ON ss.sozstatus_id = d.sozstatus_id 
		LEFT JOIN otdel_tab o ON o.otdel::text = sdt.otdel 	 
		LEFt JOIN settings_tab ON UPPER(settings_tab.name) = 'LPU_NUMBER' 
		LEFT JOIN mkb_tab mkb ON trim(mkb.kod_d) = trim(t.diag_osn) 
		LEFT JOIN codifiers.visit_result_common_tab cv on cv.id=t.result_id 
 		left join codifiers.tar_dost_tab td on td.otdel=o.reestr_code::int4  
    	and td.lpu::int4 in (select * from get_all_lpu_numbers()) 
 
WHERE t.strcom_region_id != '7000000000000' and  :param5_1_:  and 
	v.data_vnes_inf between date(':period1_1_:') and date (':period1_2_:') 
	AND CASE WHEN length(':param2_1_:')&gt;0 THEN t.diag_osn like ':param2_1_:'||'%' ELSE true END 
	AND :param3_1_: AND :param4_1_:  AND :otdel_1_: 
	 and  :stat_1_:  and :kat_1_: 
group by 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,33, 
34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53, d.mest_born, t.policy_type,kat.reestr_code, 
d.mesto_work_id,tr.reestr_code,d.sex,t.is_first,v.target_pos_id,CASE WHEN d.mesto_work_id IS NOT NULL THEN 'true' ELSE 'false' END</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param5" Caption="Вид оплаты" Type="select">
              <Sql>select 'true'::text, 'Все',0 union --select 't.vid_oplat_id='||vid_oplat_tab.vid_oplat_id,vid_oplat_tab.nam_oplat,1 from vid_oplat_tab select '(t.vid_oplat_id=0 or t.vid_oplat_id=10000 or t.vid_oplat_id=6) ','ОМС',1  order by 1</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Диагноз" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="kat" Caption="Не учитывать категорию" Type="select">
              <Sql>select 'true',' ',0 union select '(t.person_data).kat!='||kateg_id, kateg,1 from kateg_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="stat" Caption="Не учитывать статус" Type="select">
              <Sql>select 'true',' ',0 union select '(t.person_data).sozstatus_id!='||id, name,1 from codifiers.sozstatus_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="otdel" Caption="Отделение" Type="select2">
              <Sql>true=Все|sdt.dolg_doctor_id not in (97,98,33,34)=Поликлиника|sdt.dolg_doctor_id in (50,54)=Воп|sdt.dolg_doctor_id  in (97,98)=Стоматология|sdt.dolg_doctor_id  in (33,34)=Центр здоровья</Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Поликлиника прикрепления в талоне" Type="select">
              <Sql>select 'true'::text, 'Все поликлиники',0 union select 't.pricpol::int4='||pricpol||'::int4', name,1 from lpu_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Фильтр" Type="select">
              <Sql>SELECT '(v.stat_error_id != 1 OR v.stat_error_id IS NULL )', 'Без повторной подачи', 0 UNION SELECT 'true', 'Все', 1 UNION SELECT 'v.stat_error_id != 1 AND v.stat_error_id IS NOT NULL', 'С ошибками', 2 UNION SELECT ' v.stat_error_id IS NULL', 'Без ошибок', 3 ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="12600000" Name="Реестр региональных льготников ф.1 (приказ 92 от 14.11.2008)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Реестр региональных льготников ф.1 (приказ 92 от 14.11.2008).xls">
          <Queries>
            <Query>
              <Sql>filename select 'p'||value||'_01'|| 
(case when date_part('month',date(':param1_1_:'))::integer&lt;10 then '0'||date_part('month',date(':param1_1_:'))::text else 
date_part('month',date(':param1_1_:'))::text end)|| 
date_part('year',date(':param1_1_:'))  from settings_tab where name = 'LPU_ID'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT DISTINCT CASE WHEN (length(trim(d.pens)) != 14 OR d.pens IS NULL OR d.pens ilike '%X%') THEN 
substr(lpad(d.dan_id::text, 11,'0'),1,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),4,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),7,3)||' '||substr(lpad(d.dan_id::text, 11,'0'),10,2) 
ELSE d.pens end as ss, 
CASE WHEN (length(trim(d.pens)) != 14 OR d.pens IS NULL OR d.pens ilike '%X%') THEN 0 
ELSE 1 end as ss_ist, 
d.ser_pol||' '||d.num_pol as SN_POL, d.fam as FAM, d.nam as IM, d.mid as ot , MYUPPER(d.sex) as W, 
d.date_born as DR, 
d.serdoc||' '||d.numdoc as SN_DOC, d.vid_doc_id as С_DOC, 
d.address as ADRES, 
COALESCE(k1.kod_region,k2.kod_region,k3.kod_region,k4.kod_region) as OKATO_REG, 
1 as S_EDV , d.dan_id as patient_id 
  FROM dan_tab d 
 LEFT JOIN kladr_tab k1 ON k1.code = d.punkt_id 
 LEFT JOIN kladr_tab k2 ON k2.code = d.town_id 
 LEFT JOIN kladr_tab k3 ON k3.code = d.raion_id 
 LEFT JOIN kladr_tab k4 ON k4.code = d.region_id 
LEFT JOIN fed_lgota_tab f ON f.dan_id = d.dan_id    AND f.pens &lt;&gt; 'XXX-XXX-XXX XX'  
WHERE d.dan_id IN 
( 
SELECT disp.dan_id FROM dispan_uchet_tab disp 
WHERe disp.lgota_id is not null AND (disp.date_sn IS NULL OR disp.date_sn &gt; ':param1_1_:') 
) AND d.prikreplen = 1 AND f.dan_id is null</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT disp.date as DB_EDV, 
/*CASE WHEN disp.date_sn IS NULL THEN date('01.01.2999') ELSE */ 
disp.date_sn /*END*/ as DE_EDV, 
disp.date  as DATE_RSB 
 
FROm dispan_uchet_tab disp 
WHERE disp.dan_id = :patient_id: 
AND disp.lgota_id is not null AND (disp.date_sn IS NULL OR disp.date_sn &gt; ':param1_1_:') 
ORDER BY disp.date_sn DESC, disp.date DESC 
LIMIT 1 OFFSET 0</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT value::char(4) FROM settings_tab WHERE name = 'LPU_ID'</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECT value::char(13) FROM settings_tab WHERE name = 'OGRN'</Sql>
            </Query>
            <Query>
              <Sql>zapros5 select 
case when sost=0 or sost is null then 2 else 
   case when min_disp&lt;date(':param1_1_:')-interval '40 days' and min_dan&lt;date(':param1_1_:')-interval '40 days' 
   and max_disp&lt;date(':param1_1_:')-interval '40 days' and max_dan&lt;date(':param1_1_:')-interval '40 days' 
   then 0 
        when min_disp&gt;date(':param1_1_:')-interval '40 days' and min_dan&gt;date(':param1_1_:')-interval '40 days' 
   and max_disp&gt;date(':param1_1_:')-interval '40 days' and max_dan&gt;date(':param1_1_:')-interval '40 days' 
   then 1 
   else 3 end end as u_type, '000' as D_TYPE 
from ( 
 SELECT min(disp.date_vnes_inf) as  min_disp,min(d.date_vnes_inf) as min_dan, 
 max(disp.date_vnes_inf) as max_disp,max(d.date_vnes_inf) as max_dan, 
 SUM(CASE WHEN disp.leave_date IS NULL OR disp.leave_date &gt; ':param1_1_:' THEN 1 ELSE 0 END) as sost 
 
FROm dispensary_registration_tab disp 
LEFT jOIN dan_tab d On d.dan_id = disp.dan_id 
LEFT JOIN fed_lgota_tab f ON f.dan_id = d.dan_id    AND f.pens &lt;&gt; 'XXX-XXX-XXX XX'  
WHERE disp.dan_id = :patient_id: AND f.dan_id is null 
AND disp.lgota_id is not null ) as f</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="12800000" Name="Реестр региональных льготников ф.2 (приказ 92 от 14.11.2008)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Реестр региональных льготников ф.2 (приказ 92 от 14.11.2008).xls">
          <Queries>
            <Query>
              <Sql>filename select 'l'||value||'_01'|| 
(case when date_part('month',date(':param1_1_:'))::integer&lt;10 then '0'||date_part('month',date(':param1_1_:'))::text else 
date_part('month',date(':param1_1_:'))::text end)|| 
date_part('year',date(':param1_1_:'))  from settings_tab where name = 'LPU_ID'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT DISTINCT CASE WHEN (length(trim(d.pens)) != 14 OR d.pens IS NULL OR d.pens ilike '%X%')  THEN 
substr(get_lpu_number(),2,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),4,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),7,3)||' '||substr(lpad(d.dan_id::text, 11,'0'),10,2) 
ELSE d.pens end as ss, 
'9'||(disp.lgota_id) as C_KAT, 
s.sp_lgot_doc_type as name_dl, 
disp.ser_lgot_doc||' '||disp.num_lgot_doc as SN_DL, 
disp.date as DATE_BL , 
/*CASE WHEN disp.date_sn IS NULL THEN date('01.01.2999') ELSE */ 
disp.date_sn /*END*/ as DATE_EL 
FROm dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
LEFT JOIN sp_lgot_doc_type_tab s ON s.sp_lgot_doc_type_id = disp.sp_lgot_doc_type_id 
LEFT JOIN fed_lgota_tab f ON f.dan_id = d.dan_id AND f.pens &lt;&gt; 'XXX-XXX-XXX XX'  
WHERE disp.lgota_id is not null AND d.dan_id is not null 
AND (disp.date_sn IS NULL OR disp.date_sn &lt; now()) 
AND d.prikreplen = 1 AND f.dan_id is null 
ORDER BY 1,2,3,4</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT value::char(4) FROM settings_tab WHERE name = 'LPU_ID'</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2012103000" Name="Реестр ОМС (рецепты)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Реестр ОМС (рецепты).xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'Q'||get_lpu_number()::text</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT r.snils AS p0, d.fam AS p1, d.nam AS p2, d.mid AS p3, d.sex AS p4, 
        d.date_born AS p5, st1.value AS p6, r.kod_lgot AS p7, t.ser_pol||' '||t.num_pol AS p8, st2.value AS p9, 
CASE WHEN f.full_doctor_id is null then f1.kod_feldshera ELSE f.kod_feld END AS p10, 
CASE WHEN r.diagn_id IS NOT NULL THEN r.diagn_id ELSE t.diag_osn END AS p11, 
	r.rezept_ser||' '||r.rezept_num AS p12, r.date_vipiski AS p13, r.date_vipiski AS p14, '1' AS p15, 
	'100' AS p16, lgot_preparat_tab.kod_mnn AS p17, '' AS p18, lgot_preparat_tab.c_lf AS p19, lgot_preparat_tab.doza AS p20, 
	lgot_preparat_tab.c_dls AS p21, r.kol AS p22, '30' AS p23, '' AS p24,'' AS p25 
        FROM rezept_tab r 
        LEFT JOIN talon_tab t on t.talon_id = r.talon_id 
        LEFT JOIN dan_tab d on d.dan_id = t.dan_id 
        LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
        LEFT JOIN feldshers_tab f1 ON cast(cast(f1.kod_feldshera as text) as int) = r.doctor_id 
        LEFT JOIN lgot_preparat_tab on lgot_preparat_tab.kod = kod_minzd 
        LEFT JOIN settings_tab st1 ON st1.name = 'LPU_NUMBER' 
        LEFT JOIN settings_tab st2 ON st2.name = 'OGRN' 
        WHERE char_length(trim(r.kod_lgot))=3  and (not bad) and r.date_vipiski between date(':period_1_:') and date(':period_2_:') 
	and (t.vid_oplat_id in (0,3,6,7))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все' UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2021103000" Name="Реестр Иногородних (печатная форма)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Реестр Иногородних (печатная форма).xls">
          <Queries>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select * from (SELECT DISTINCT on (d.id) '$id'::text, d.fio as p1,  
conv_to_null(d.ser_pol)||' '||conv_to_null(d.num_pol)||' '||conv_to_null(d.mest_work) as p2, 
s.name as p3, d.date_born as p4, d.address as p5, 
v.data_pos as p6, 
t.diag_osn as p7, 
ds.reestr_uslug_code as p8, '' as p9, ds.zena_inogorod as p10 
 
FROM visit_tab v 
LEFT JOIN talon_tab t 	ON t.talon_id = v.talon_id 
LEFT JOIN dan_tab d  ON t.dan_id = d.dan_id 
LEFT JOIN codifiers.strcom_tab s ON s.id = t.strcom_id 
LEFT JOIN doctor_tab doc ON doc.id=v.doctor_id 
LEFT JOIN codifiers.doctor_spec_tab ds ON doc.sp_spec_doctor_id=ds.id  
 
WHERE v.data_vnes_inf BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and t.strcom_region_id !='0300000000000' 
) as sub 
order by 2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все' UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2022303000" Name="Список госпитализированных пациентов" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Список госпитализированных пациентов.xls">
          <Queries>
            <Query>
              <Sql>z1 select stac.name, d.fio as p1, get_vozrast(d.date_born) as p2, h.date_end as p3, 
h.diagn as p4, conv_to_null(d.ser_pol)||' '||conv_to_null(d.num_pol) as p5, 
h.date_begin as p6, h.duration as p7, f.full_fio as p8, 
d.sex as p9, s.sozstatus as p10 , i.nam_inval as p20 
  
from hosp_tab h 
left join dan_tab d on d.dan_id=h.dan_id 
left join codifiers.stacionar_type_tab stac on stac.id=h.stacionar_type 
left join full_doctor_tab f on f.full_doctor_id=h.operator_id 
left join sozstatus_tab s on s.sozstatus_id=d.sozstatus_id 
left join inval_tab i on i.inval_id=d.inval_id 
where h.date_end BETWEEN ':period_1_:'  AND ':period_2_:' 
order by 1,2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2026103000" Name="Реестр Роспотребнадзор (S_DIAG)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры пролеченных пациентов и отпущенных рецептов\Реестр Роспотребнадзор (S_DIAG).xls">
          <Queries>
            <Query>
              <Sql>filename select 'S_DIAG'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT distinct on (v.visit_id) '' as nullstr, 
(select get_lpu_number()) as lpu, 
f.otdel as otdel, 
u.code as tu, 
v.doctor_id as vrach, 
sf.profil_code as profil, 
v.data_pos as dreg, 
case when d.ser_pol is null then d.num_pol else COALESCE(d.ser_pol,'')||COALESCE(' '||d.num_pol,'') end as card, 
d.date_born as dr, 
case when d.sex='м' then '1' when d.sex='ж' then '2' else '' end as pol, 
v.target_pos_id as cel, 
travm.bur_reestr_code as travma, 
t.diag_osn as diag, 
result.bur_reestr_code as isx, 
m.inn as innw, 
d.mesto_work_id as work, 
s.name as ul, 
d.dom as dom 
 
FROM visit_tab v 
LEFT JOIN talon_tab t 			ON t.talon_id = v.talon_id 
LEFT JOIN dan_tab d 			ON d.dan_id = t.dan_id 
LEFT JOIN doctor_tab doc 		ON doc.id=v.doctor_id 
LEFT JOIN codifiers.doctor_spec_tab ds ON doc.sp_spec_doctor_id=ds.id 
LEFT JOIN codifiers.eq_spec_fed_codes sf	ON ds.eq_spec_fed_codes_id = sf.id 
left join full_doctor_tab f on f.full_doctor_id=v.doctor_id 
LEFT JOIN codifiers.reestr_mkb_tab r on r.mkb=t.diag_osn 
LEFT JOIN address_tab a ON a.dan_id = d.dan_id 
LEFT JOIN codifiers.sp_street_tab s ON s.code = a.sp_street_code 
 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id 
left join codifiers.travma_tab travm on travm.id=t.vid_travma 
left join codifiers.visit_result_common_tab result on result.id=t.result_id  
LEFT JOIN codifiers.mest_work_tab m on m.id=d.mesto_work_id 
WHERE v.data_pos BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and t.strcom_region_id ='0300000000000'  
and (t.vid_oplat_id in (0,3,6,7)) 
and f.dolg_doctor_id not in (167,13,152,159,900,403,603001) 
and (f.otdel!='2001' or f.otdel != '203001' or f.otdel is null) 
and :otdel_param_1_: and v.conv_usl_code IS NOT NULL 
and t.diag_osn is not null and r.oms!=1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select '(f.otdel='||'''9004'')','Амбулатория Сокол',1 union select '(f.otdel!='||'''9004'')','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все',1 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,2 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Артериальная гипертония">
      <Reports>
        <Report Id="66" Name="Отчет по законченому случаю (20.11.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Отчет по законченому случаю (20.11.2007).xls">
          <Queries>
            <Query>
              <Sql>zapros1 select distinct dan_tab.fam, dan_tab.nam as param_1_, dan_tab.mid as param_2_, dan_tab.date_born as param_3_, 
talon_tab.diag_osn as param_4_, 
result_tab.result as param_5_, target_pos_tab.target_pos as param_6_ from visit_tab 
left join talon_tab on visit_tab.talon_id=talon_tab.talon_id 
left join dan_tab on dan_tab.dan_id=talon_tab.dan_id 
left join result_tab on result_tab.result_id=talon_tab.result_id 
left join target_pos_tab on target_pos_tab.target_pos_id=visit_tab.target_pos_id 
where talon_tab.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:') 
and talon_tab.diag_osn between 'I10' and 'I15.9' 
and talon_tab.dan_id in (select distinct dan_id from ag_visit_data_tab) 
and :param2_1_: 
order by result_tab.result, target_pos_tab.target_pos</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 :param_2_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 :param_3_:</Sql>
            </Query>
            <Query>
              <Sql>zapros5 :param_4_:</Sql>
            </Query>
            <Query>
              <Sql>zapros6 :param_5_:</Sql>
            </Query>
            <Query>
              <Sql>zapros7 :param_6_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, -1  UNION  SELECT 'dan_tab.uchactok_id = '||uchactok_id::text, uchactok, uchactok_id FROM uchactok_tab  ORDER BY 3 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="192" Name="Отчет по неполностью заполненным картам (20.11.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Отчет по неполностью заполненным картам (20.11.2007).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT d.fam||' '||d.nam||' '||d.mid as name, 
d.date_born as p1 ,v.data_pos as p2, v.talon_id  as p3, 
CASE 
	WHEN ag.not_enough_blood =0 
	THEN 'Не указано' 
	ELSE '+'  
END as p4, 
CASE 
	WHEN ag.stepen_risk =0 
	THEN 'Не указано' 
	ELSE '+'  
END as p5, 
CASE 
	WHEN ag.diabet =0 
	THEN 'Не указано' 
	ELSE '+'  
END as p6, 
CASE 
	WHEN ag.level_stress =0 
	THEN 'Не указано' 
	ELSE '+' 
END as  p7, 
CASE 
	WHEN ag.phisical_activ =0 
	THEN 'Не указано' 
	ELSE '+' 
END as  p8, 
CASE 
	WHEN ag.kurenie =0 
	THEN 'Не указано' 
	ELSE '+' 
END as p9 , 
CASE 
	WHEN ag.alcogol_frequency =0 
	THEN 'Не указано' 
	ELSE '+' 
END as  p10 
 FROM ag_visit_data_tab ag 
LEFT JOIN dan_tab d ON d.dan_id = ag.dan_id 
LEFT JOIN visit_tab v ON v.visit_id = ag.visit_id 
WHERE  :param2_1_:  AND  (ag.not_enough_blood =0 OR ag.stepen_risk =0 
OR ag.diabet =0 OR ag.level_stress =0 OR ag.phisical_activ =0 OR ag.kurenie =0 OR ag.alcogol_frequency =0 ) 
AND v.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:') 
ORDER BY name;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Участок:" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' d.uchactok_id = '||uchactok_id::text, uchactok,1  FROM uchactok_tab  ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="201" Name="Список больных, на которых не заполнена карта диспансерного наблюдения (т.е. не проставлены физические характеристики) (20.11.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Список больных, на которых не заполнена карта диспансерного наблюдения (т.е. не проставлены физические характеристики) (20.11.2007).xls">
          <Queries>
            <Query>
              <Sql>str_uchastok select uchactok from uchactok_tab where uchactok_id=:period_2_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select distinct '$id',d.fam, 
d.nam as param_1_, d.mid as param_2_, d.date_born as param_3_, 
d.address 
FROM dan_tab d 
where d.dan_id not in (select distinct dan_id from ag_visit_data_tab) 
and d.dan_id in ( 
select  dan_tab.dan_id from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (now())) and  
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (now()))))  
and diagn_id between 'I10' and 'I15.9' 
) 
AND d.uchactok_id = :period_2_1_: 
ORDER BY 1,2,3,4</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 :param_2_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 :param_3_:</Sql>
            </Query>
            <Query>
              <Sql>zapros5 :param_4_:</Sql>
            </Query>
            <Query>
              <Sql>zapros6 :param_5_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>select uchactok_id, uchactok from uchactok_tab order by uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="207" Name="Работа Школы Здоровья гипертоников (20.11.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Работа Школы Здоровья гипертоников (20.11.2007).xls">
          <Queries>
            <Query>
              <Sql>zapros1 select count( DISTINCT dan_tab.dan_id) from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':param1_1_:')) and  
((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date  (':param1_1_:')))) 
and diagn_id between 'I10' and 'I15.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros2 select count(distinct dan_id) from ag_visit_data_tab 
left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id 
where data_vnes_inf &lt;= date (':param1_1_:')	and school_health=1  
AND dan_id IN  
( 
select  dan_tab.dan_id from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':param1_1_:')) and  
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (':param1_1_:'))))  
and diagn_id between 'I10' and 'I15.9' 
)</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select count(DISTINCT dan_id) from ag_visit_data_tab 
left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id 
where data_vnes_inf &lt;= date (':param1_1_:') 
AND dan_id IN  
( 
select  dan_tab.dan_id from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':param1_1_:')) and  
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (':param1_1_:'))))  
and diagn_id between 'I10' and 'I15.9' 
)</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECT  
mround((select count(distinct dan_id) from ag_visit_data_tab 
left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id 
where data_vnes_inf &lt;= date (':param1_1_:')	and school_health=1  
AND dan_id IN  
( 
select  dan_tab.dan_id from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':param1_1_:')) and  
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (':param1_1_:'))))  
and diagn_id between 'I10' and 'I15.9' 
) 
)::float 
 *100.0/ 
(select count( DISTINCT dan_tab.dan_id) from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':param1_1_:')) and  
((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date  (':param1_1_:')))) 
and diagn_id between 'I10' and 'I15.9')::float 
)</Sql>
            </Query>
            <Query>
              <Sql>zapros5 select count(distinct dan_id) from ag_visit_data_tab 
left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id 
where data_vnes_inf &lt;= date (':param1_1_:')	and school_health=1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="209" Name="Сведения о заболеваемости гипертонией (по дате взятия на Д-учет)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Сведения о заболеваемости гипертонией (по дате взятия на Д-учет).xls">
          <Queries>
            <Query>
              <Sql>diagns_list (select (ARRAY['I10', 
	'I11', 'I11.0', 'I11.9', 
	'I12', 'I12.0', 'I12.9', 
	'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
	'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_ from generate_series(1,18) as s(a)) as foo;</Sql>
            </Query>
            <Query>
              <Sql>zapros_1 select (select case when char_length(param_2_)=3 
	then (select diagn_kod_mkb from diagn_kod_mkb_tab where kodname=param_2_)
	else (select mkb from mkb_tab where kod_d=param_2_)
	end), * from (select
(ARRAY['I10', 
'I11.0-I11.9', 'I11.0', 'I11.9', 
'I12.0-I12.9', 'I12.0', 'I12.9', 
'I13.0-I13.9', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15.0-I15.9', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_,
(ARRAY['I10', 
'I11', 'I11.0', 'I11.9', 
'I12', 'I12.0', 'I12.9', 
'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_2_ from generate_series(1,18) as s(a)) as foo;</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_:</Sql>
            </Query>
            <Query>
              <Sql>sostoit1 select count(distinct dan_tab.dan_id), count(distinct dan_tab.dan_id) as param_3_ from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id like ':param_2_:%'</Sql>
            </Query>
            <Query>
              <Sql>sostoit2(_val_) select count(distinct dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id like ':param_2_:%' and sex='_val_'</Sql>
            </Query>
            <Query>
              <Sql>sostoit3(age1,age2) select count(distinct dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id like ':param_2_:%'
	and DATE_PART('year',AGE(date(':period_1_1_:'), date_born)) between age1 and age2</Sql>
            </Query>
            <Query>
              <Sql>sostoit4(_val_) select case when :param_3_:&gt;0 then round((count(distinct dan_tab.dan_id)*100.0/:param_3_:), 2) else 0 end from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id like ':param_2_:%' and sex='_val_'</Sql>
            </Query>
            <Query>
              <Sql>sostoit5(age1,age2) select case when :param_3_:&gt;0 then round((count(distinct dan_tab.dan_id)*100.0/:param_3_:), 2) else 0 end from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id like ':param_2_:%'
	and DATE_PART('year',AGE(date(':period_1_1_:'), date_born)) between age1 and age2</Sql>
            </Query>
            <Query>
              <Sql>zapros3 sostoit1</Sql>
            </Query>
            <Query>
              <Sql>zapros4 sostoit2(м)</Sql>
            </Query>
            <Query>
              <Sql>zapros5 sostoit2(ж)</Sql>
            </Query>
            <Query>
              <Sql>zapros6 sostoit3(0, 14)</Sql>
            </Query>
            <Query>
              <Sql>zapros7 sostoit3(15, 17)</Sql>
            </Query>
            <Query>
              <Sql>zapros8 sostoit3(18, 200)</Sql>
            </Query>
            <Query>
              <Sql>zapros9 sostoit4(м)</Sql>
            </Query>
            <Query>
              <Sql>zapros10 sostoit4(ж)</Sql>
            </Query>
            <Query>
              <Sql>zapros11 sostoit5(0, 14)</Sql>
            </Query>
            <Query>
              <Sql>zapros12 sostoit5(15, 17)</Sql>
            </Query>
            <Query>
              <Sql>zapros13 sostoit5(18, 200)</Sql>
            </Query>
            <Query>
              <Sql>sostoit_1 select count(distinct dan_tab.dan_id), count(distinct dan_tab.dan_id) as param_3_ from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id between 'I10' and 'I15.9'</Sql>
            </Query>
            <Query>
              <Sql>sostoit_2(_val_) select count(distinct dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id between 'I10' and 'I15.9' and sex='_val_'</Sql>
            </Query>
            <Query>
              <Sql>sostoit_3(age1,age2) select count(distinct dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id between 'I10' and 'I15.9'
	and DATE_PART('year',AGE(date(':period_1_1_:'), date_born)) between age1 and age2</Sql>
            </Query>
            <Query>
              <Sql>sostoit_4(_val_) select case when :param_3_:&gt;0 then round((count(distinct dan_tab.dan_id)*100.0/:param_3_:), 2) else 0 end from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id between 'I10' and 'I15.9' and sex='_val_'</Sql>
            </Query>
            <Query>
              <Sql>sostoit_5(age1,age2) select case when :param_3_:&gt;0 then round((count(distinct dan_tab.dan_id)*100.0/:param_3_:), 2) else 0 end from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id between 'I10' and 'I15.9'
	and DATE_PART('year',AGE(date(':period_1_1_:'), date_born)) between age1 and age2</Sql>
            </Query>
            <Query>
              <Sql>zapros__3 sostoit_1</Sql>
            </Query>
            <Query>
              <Sql>zapros__4 sostoit_2(м)</Sql>
            </Query>
            <Query>
              <Sql>zapros__5 sostoit_2(ж)</Sql>
            </Query>
            <Query>
              <Sql>zapros__6 sostoit_3(0, 14)</Sql>
            </Query>
            <Query>
              <Sql>zapros__7 sostoit_3(15, 17)</Sql>
            </Query>
            <Query>
              <Sql>zapros__8 sostoit_3(18, 200)</Sql>
            </Query>
            <Query>
              <Sql>zapros__9 sostoit_4(м)</Sql>
            </Query>
            <Query>
              <Sql>zapros__10 sostoit_4(ж)</Sql>
            </Query>
            <Query>
              <Sql>zapros__11 sostoit_5(0, 14)</Sql>
            </Query>
            <Query>
              <Sql>zapros__12 sostoit_5(15, 17)</Sql>
            </Query>
            <Query>
              <Sql>zapros__13 sostoit_5(18, 200)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="210" Name="Количество листов диспансерного наблюдения за период (20.11.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Количество листов диспансерного наблюдения за период (20.11.2007).xls">
          <Queries>
            <Query>
              <Sql>zapros1 select f.dolg_doctor, f.fio, f.full_doctor_id ,count(DISTINCT ag_visit_data_id ) as count1 from ag_visit_data_tab 
left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id 
LEFT JOIN full_doctor_tab f On f.full_doctor_id = ag_visit_data_tab.kod_doctor 
where visit_tab.data_vnes_inf &gt;= date (':period_1_1_:') AND  visit_tab.data_vnes_inf &lt;= date (':period_1_2_:') 
GROUP BY  f.dolg_doctor, f.fio, f.full_doctor_id 
ORDER BY 1,2</Sql>
            </Query>
            <Query>
              <Sql>zapros2 select count(DISTINCT ag_visit_data_id ) as count1 from ag_visit_data_tab 
left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id 
LEFT JOIN full_doctor_tab f On f.full_doctor_id = ag_visit_data_tab.kod_doctor 
where visit_tab.data_vnes_inf &gt;= date (':period_1_1_:') AND  visit_tab.data_vnes_inf &lt;= date (':period_1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select count(DISTINCT ag_visit_data_id ) from ag_visit_data_tab 
left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id 
where visit_tab.data_vnes_inf &gt;= date (':period_1_1_:') AND  visit_tab.data_vnes_inf &lt;= date (':period_1_2_:') 
AND ag_visit_data_tab.kod_doctor = :full_doctor_id: 
AND ag_visit_data_tab.dan_id IN 
( 
select  dan_tab.dan_id from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':period_1_2_:')) and  
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (':period_1_2_:'))))  
and diagn_id between 'I10' and 'I15.9' 
)</Sql>
            </Query>
            <Query>
              <Sql>zapros4 select count(DISTINCT ag_visit_data_id ) as count1 from ag_visit_data_tab 
left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id 
where visit_tab.data_vnes_inf &gt;= date (':period_1_1_:') AND  visit_tab.data_vnes_inf &lt;= date (':period_1_2_:') 
AND ag_visit_data_tab.dan_id IN 
( 
select  dan_tab.dan_id from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':period_1_2_:')) and  
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (':period_1_2_:'))))  
and diagn_id between 'I10' and 'I15.9' 
)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="211" Name="Сведения о больных гипертонией (20.11.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Сведения о больных гипертонией (20.11.2007).xls">
          <Queries>
            <Query>
              <Sql>zapros1 select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros2 select value from settings_tab where name='LPU_NUMBER'</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select count(DISTINCT dan_tab.dan_id) from dispan_uchet_tab 
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':period_1_2_:')) and 
((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_2_:')))) 
and diagn_id between 'I10' and 'I15.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros4 select count(*) from visit_tab v 
left join talon_tab t on v.talon_id=t.talon_id  
where v.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:') 
and t.dan_id in ( 
select  dan_tab.dan_id from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':period_1_2_:')) and  
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (':period_1_2_:'))))  
and diagn_id between 'I10' and 'I15.9' 
)</Sql>
            </Query>
            <Query>
              <Sql>zapros5 select count(DISTINCT dan_id) from ag_visit_data_tab 
left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id 
where  visit_tab.data_vnes_inf &lt;= date (':period_1_2_:') 
AND dan_id IN  
( 
select  dan_tab.dan_id from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':period_1_2_:')) and  
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (':period_1_2_:'))))  
and diagn_id between 'I10' and 'I15.9' 
)</Sql>
            </Query>
            <Query>
              <Sql>zapros6 select count(DISTINCT ag_visit_data_id ) from ag_visit_data_tab 
left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id 
where visit_tab.data_vnes_inf &gt;= date (':period_1_1_:') AND  data_vnes_inf &lt;= date (':period_1_2_:') 
AND dan_id IN  
( 
select  dan_tab.dan_id from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':period_1_2_:')) and  
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (':period_1_2_:'))))  
and diagn_id between 'I10' and 'I15.9' 
)</Sql>
            </Query>
            <Query>
              <Sql>zapros7 select count(DISTINCT v.visit_id) from visit_tab v 
left join talon_tab t on v.talon_id=t.talon_id  
left join diagn_tab diag On diag.talon_id = t.talon_id 
where v.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:') 
and t.dan_id in ( 
select  dan_tab.dan_id from dispan_uchet_tab  
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (':period_1_2_:')) and  
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (':period_1_2_:'))))  
and diagn_id between 'I10' and 'I15.9' 
) 
AND diag.diagn_osn between 'I10' and 'I15.9'</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="212" Name="Поражение органов - &quot;мишеней&quot;" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Поражение органов - _мишеней_.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select count(DISTINCT dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn is NULL) AND dispan_uchet_tab.date &lt; now() 
	and diagn_id between 'I10' and 'I15.9'</Sql>
            </Query>
            <Query>
              <Sql>viborka1(code) select count(DISTINCT dan_id) from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and code=1 
AND dan_id IN (select dan_tab.dan_id from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
	where (dispan_uchet_tab.date_sn is NULL) AND dispan_uchet_tab.date &lt; now()  
	and diagn_id between 'I10' and 'I15.9')</Sql>
            </Query>
            <Query>
              <Sql>viborka2(code) select round((count(DISTINCT dan_id)*100.0/
(select count(DISTINCT dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn is NULL) AND dispan_uchet_tab.date &lt; now() 
	and diagn_id between 'I10' and 'I15.9')
), 2) from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and code=1 
AND dan_id IN (select dan_tab.dan_id from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
	where (dispan_uchet_tab.date_sn is NULL) AND dispan_uchet_tab.date &lt; now()  
	and diagn_id between 'I10' and 'I15.9')</Sql>
            </Query>
            <Query>
              <Sql>zapros2 viborka1(atero_scleroz_kr_sosud)</Sql>
            </Query>
            <Query>
              <Sql>zapros3 viborka1(proterinurya)</Sql>
            </Query>
            <Query>
              <Sql>zapros4 viborka1(suzhenie_sos_setchat)</Sql>
            </Query>
            <Query>
              <Sql>zapros5 viborka1(gipertrof_left_zhelud)</Sql>
            </Query>
            <Query>
              <Sql>zapros6 viborka2(atero_scleroz_kr_sosud)</Sql>
            </Query>
            <Query>
              <Sql>zapros7 viborka2(proterinurya)</Sql>
            </Query>
            <Query>
              <Sql>zapros8 viborka2(suzhenie_sos_setchat)</Sql>
            </Query>
            <Query>
              <Sql>zapros9 viborka2(gipertrof_left_zhelud)</Sql>
            </Query>
          </Queries>
          <Parameters />
        </Report>
        <Report Id="410010" Name="Прием лекарственных средств (по дате рождения пациента)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Прием лекарственных средств (по дате рождения пациента).xls">
          <Queries>
            <Query>
              <Sql>zapros1 select distinct dan_tab.fam, dan_tab.nam as param_1_, dan_tab.mid as param_2_, dan_tab.date_born as param_3_, 
(select diagn_id from dispan_uchet_tab where dispan_uchet_tab.dan_id=ag_vipis_preparat_tab.dan_id 
and diagn_id between 'I10' and 'I15.9' limit 1) as param_4_, 
lgot_preparat_tab.mnn_rus||' '||lgot_preparat_tab.doza as param_5_, 
ag_vipis_preparat_tab.date_begin as param_6_, ag_vipis_preparat_tab.date_end as param_7_ from ag_vipis_preparat_tab 
left join dan_tab on dan_tab.dan_id=ag_vipis_preparat_tab.dan_id 
left join lgot_preparat_tab on lgot_preparat_tab.kod=ag_vipis_preparat_tab.kod_minzd 
where dan_tab.date_born between date(':period_1_1_:') and date(':period_1_2_:') 
order by dan_tab.fam, dan_tab.nam, dan_tab.mid</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 :param_2_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 :param_3_:</Sql>
            </Query>
            <Query>
              <Sql>zapros5 :param_4_:</Sql>
            </Query>
            <Query>
              <Sql>zapros6 :param_5_:</Sql>
            </Query>
            <Query>
              <Sql>zapros7 :param_6_:</Sql>
            </Query>
            <Query>
              <Sql>zapros8 :param_7_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="420010" Name="Распределение больных с вредными привычками" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Распределение больных с вредными привычками.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select count(dan_id) from ag_visit_data_tab where visit_id in 
(select max(visit_id) from ag_visit_data_tab group by dan_id)</Sql>
            </Query>
            <Query>
              <Sql>zapros2(code) select count(dan_id) from ag_visit_data_tab where visit_id in
 
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and kurenie=code</Sql>
            </Query>
            <Query>
              <Sql>zapros3(code) select count(dan_id) from ag_visit_data_tab where visit_id in
 
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and alcogol_frequency=code</Sql>
            </Query>
            <Query>
              <Sql>zapros4(code) select count(dan_id) from ag_visit_data_tab where visit_id in
 
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and phisical_activ=code</Sql>
            </Query>
            <Query>
              <Sql>zapros5(code) select count(dan_id) from ag_visit_data_tab where visit_id in
 
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and level_stress=code</Sql>
            </Query>
          </Queries>
          <Parameters />
        </Report>
        <Report Id="430010" Name="Сведения о больных артериальной гипертонией, обученных в Школе гипертоников" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Сведения о больных артериальной гипертонией, обученных в Школе гипертоников.xls">
          <Queries>
            <Query>
              <Sql>diagns_list (select (ARRAY['I10', 
	'I11', 'I11.0', 'I11.9', 
	'I12', 'I12.0', 'I12.9', 
	'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9', 
	'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_ from generate_series(1,18) as s(a)) as foo;</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select (select case when char_length(param_2_)=3 
 
	then (select diagn_kod_mkb from diagn_kod_mkb_tab where kodname=param_2_)
 
	else (select mkb from mkb_tab where kod_d=param_2_)
 
	end), * from (select
 
(ARRAY['I10', 
 
'I11.0-I11.9', 'I11.0', 'I11.9', 
 
'I12.0-I12.9', 'I12.0', 'I12.9', 
 
'I13.0-I13.9', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
 
'I15.0-I15.9', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_,
 
(ARRAY['I10', 
 
'I11', 'I11.0', 'I11.9', 
 
'I12', 'I12.0', 'I12.9', 
 
'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
 
'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_2_ from generate_series(1,18) as s(a)) as foo;</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select count(distinct dan_id) from ag_visit_data_tab
 
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
 
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
 
				and school_health=1 and diagn like ':param_2_:%'</Sql>
            </Query>
            <Query>
              <Sql>zapros4 select count(distinct dan_tab.dan_id) from ag_visit_data_tab
 
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
 
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
 
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
 
				and school_health=1 and diagn like ':param_2_:%' and sex='м'</Sql>
            </Query>
            <Query>
              <Sql>zapros5 select count(distinct dan_tab.dan_id) from ag_visit_data_tab
 
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
 
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
 
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
 
				and school_health=1 and diagn like ':param_2_:%' and sex='ж'</Sql>
            </Query>
            <Query>
              <Sql>zapros_6(age1,age2) select count(distinct dan_tab.dan_id) from ag_visit_data_tab
 
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
 
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
 
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
 
				and school_health=1 and diagn like ':param_2_:%' and DATE_PART('year',AGE(date(':period_1_2_:'), date_born)) between age1 and age2</Sql>
            </Query>
            <Query>
              <Sql>zapros6 zapros_6(0,14)</Sql>
            </Query>
            <Query>
              <Sql>zapros7 zapros_6(15,17)</Sql>
            </Query>
            <Query>
              <Sql>zapros8 zapros_6(18,200)</Sql>
            </Query>
            <Query>
              <Sql>zapros__3 select count(distinct dan_id) from ag_visit_data_tab
 
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
 
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
 
				and school_health=1 and diagn between 'I10' and 'I15.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros__4 select count(distinct dan_tab.dan_id) from ag_visit_data_tab
 
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
 
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
 
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
 
				and school_health=1 and diagn between 'I10' and 'I15.9' and sex='м'</Sql>
            </Query>
            <Query>
              <Sql>zapros__5 select count(distinct dan_tab.dan_id) from ag_visit_data_tab
 
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
 
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
 
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
 
				and school_health=1 and diagn between 'I10' and 'I15.9' and sex='ж'</Sql>
            </Query>
            <Query>
              <Sql>zapros___6(age1,age2) select count(distinct dan_tab.dan_id) from ag_visit_data_tab
 
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
 
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
 
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
 
				and school_health=1 and diagn between 'I10' and 'I15.9' and DATE_PART('year',AGE(date(':period_1_2_:'), date_born)) between age1 and age2</Sql>
            </Query>
            <Query>
              <Sql>zapros__6 zapros___6(0,14)</Sql>
            </Query>
            <Query>
              <Sql>zapros__7 zapros___6(15,17)</Sql>
            </Query>
            <Query>
              <Sql>zapros__8 zapros___6(18,200)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="440010" Name="Список пациентов имеющих зарегистрированный гипертонический диагноз и не состоящих на Д-учете (20.11.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Список пациентов имеющих зарегистрированный гипертонический диагноз и не состоящих на Д-учете (20.11.2007).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT '$id',d.dan_id, conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) as fio 
, d.date_born, u.uchactok, d.address 
, join_str(DISTINCT t.talon_id::text) as talons 
FROM talon_tab t 
LEFT JOIN dan_tab d On d.dan_id = t.dan_id 
LEFT JOIN uchactok_tab u On u.uchactok_id = d.uchactok_id 
LEFT JOIN diagn_tab diag On diag.talon_id = t.talon_id 
WHERE diag.diagn_osn BETWEEN 'I10' and 'I15.9' 
and d.dan_id NOT IN ( 
select  dan_tab.dan_id from dispan_uchet_tab 
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (now())) and 
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (now())))) 
and diagn_id between 'I10' and 'I15.9' 
) 
AND t.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:') 
AND :param2_1_: 
GROUP BY 
d.dan_id, conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) 
, d.date_born, u.uchactok, d.address 
ORDER BY 3</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0  UNION  SELECT 'd.uchactok_id = '||uchactok_id::text, uchactok, 1 FROM uchactok_tab  ORDER BY 3,2 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="450010" Name="Список посещений гипертоников (20.11.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Артериальная гипертония\Список посещений гипертоников (20.11.2007).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT DISTINCT '$id',d.dan_id, conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) as fio 
, d.date_born, d.address, v.data_pos, 
CASE WHEN ag.visit_id IS NULL THEN 'Нет'::text 
ELSE 'Заполнен' END as list1, f.full_fio 
FROM talon_tab t 
LEFT JOIN dan_tab d On d.dan_id = t.dan_id 
LEFT JOIN visit_tab v On v.talon_id = t.talon_id 
LEFT JOIN full_doctor_tab f On f.full_doctor_id = v.doctor_id 
LEFT JOIN ag_visit_data_tab ag On ag.visit_id = v.visit_id 
LEFT JOIN diagn_tab diag On diag.talon_id = t.talon_id 
WHERE diag.diagn_osn BETWEEN 'I10' and 'I15.9' 
and d.dan_id IN ( 
select  dan_tab.dan_id from dispan_uchet_tab 
left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
where (dispan_uchet_tab.date&lt;=date (now())) and 
((dispan_uchet_tab.date_sn is NULL) or  ((dispan_uchet_tab.date_sn is not NULL) and  (dispan_uchet_tab.date_sn&gt;date  (now())))) 
and diagn_id between 'I10' and 'I15.9' 
) 
AND v.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:') 
AND :param2_1_: AND :param3_1_:  AND :param4_1_: 
ORDER BY 1,2,3,4 
LIMIT 5000</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param4" Caption="" Type="select2">
              <Sql>true=Все|ag.visit_id IS NULL=Незаполненные|ag.visit_id IS NOT NULL=Заполненные</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Врач" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0  UNION  SELECT 'v.doctor_id = '||f.full_doctor_id, f.full_fio, 1 FROM full_doctor_tab f  ORDER BY 3,2   </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' d.uchactok_id = '||uchactok_id::text, uchactok,1  FROM uchactok_tab  ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Астма и рассеянный склероз">
      <Reports>
        <Report Id="81" Name="Список лиц, состоящих на Д-учете с диагнозом бронхиальная астма" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Астма и рассеянный склероз\Список лиц, состоящих на Д-учете с диагнозом бронхиальная астма.xls">
          <Queries>
            <Query>
              <Sql>zapros0 select distinct '$id',  
	dan_tab.fam as param_1_1_, dan_tab.nam as param_1_2_, dan_tab.mid as param_1_3_,  
	dan_tab.date_born as param_1_4_, case when inval_id&gt;0 then inval_id else NULL end  as param_1_5_, address as param_1_6_  
	from dispan_uchet_tab  
	left join dan_tab on dispan_uchet_tab.dan_id = dan_tab.dan_id  
	where true and (dispan_uchet_tab.diagn_id between 'J45' and 'J46.9') 
	and (dispan_uchet_tab.prichin_sn_id is NULL and dispan_uchet_tab.date_sn is NULL);</Sql>
            </Query>
          </Queries>
          <Parameters />
        </Report>
        <Report Id="82" Name="Список лиц с заболеванием Бронхиальная астма, получивших лекарственные препараты" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Астма и рассеянный склероз\Список лиц с заболеванием Бронхиальная астма, получивших лекарственные препараты.xls">
          <Queries>
            <Query>
              <Sql>zapros0 select distinct '$id', 
 
	dan_tab.fam as param_1_1_, dan_tab.nam as param_1_2_, dan_tab.mid as param_1_3_, 
 
	dan_tab.date_born as param_1_4_, address as param_1_6_, case when inval_id&gt;0 then inval_id else NULL end  as param_1_5_, mnn_rus  as param_1_7_
 
	from rezept_tab
 
	left join lgot_preparat_tab on lgot_preparat_tab.kod=kod_minzd
 
	left join dan_tab on rezept_tab.dan_id = dan_tab.dan_id 
 
	where not bad and date_vipiski between date(':period_1_1_:') and date(':period_1_2_:') and
 
	trim(kod_minzd) in ('61095', '112942', '61091', '61092'
 
	, '112905', '112906', '100276', '90194', 
 
	'90196', '100277', '89731', '1000446', 
 
	'1200170', '90781', '56786', '90782', 
 
	'83944', '83946', '90252', '89268',
 
	'89269', '89729', '89728', '66190', 
 
	'77634')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Частичное фондодержание">
      <Reports>
        <Report Id="85" Name="Реестр по оказанным услугам (DBF формат)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Частичное фондодержание\Реестр по оказанным услугам (DBF формат).xls">
          <Queries>
            <Query>
              <Sql>dt_reestr select date_part('month', date(':period_1_2_:'))||'.'||substring(date_part('year', date(':period_1_2_:'))::text from 3 for 2)</Sql>
            </Query>
            <Query>
              <Sql>smo select strcom from strcom_tab where strcom_id=:period_2_1_:</Sql>
            </Query>
            <Query>
              <Sql>u_pol_id select value from settings_tab where name='LPU_NUMBER'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT * FROM 
(SELECT distinct on (s.stand_patient_id)  
'' as nullstr,s.date_usl, d.fam, d.nam, d.mid, 
CASE WHEN t.talon_id IS NOT NULL 
	THEN t.ser_pol 
	ELSE d.ser_pol 
END AS ser_pol, 
CASE WHEN t.talon_id IS NOT NULL 
	THEN t.num_pol 
	ELSE d.num_pol 
END AS num_pol, 
CASE WHEN t.talon_id IS NOT NULL 
	THEN t.strcom_id 
	ELSE d.strcom_id 
END AS strcom_id, 
a.text_address AS address, d.date_born AS date_born, 
(CASE WHEN d.metka_work='+' 
	THEN 	(CASE WHEN d.mesto_work_id IS NOT NULL 
    			THEN (SELECT mest_work FROM mest_work_tab WHERE mest_work_id=d.mesto_work_id) 
	            ELSE d.mest_work 
    	    END) 
	ELSE '' 
    END) AS work_place, 
date_usl , TRIM(TRIM(both 'Д' FROM TRIM(both '*' FROM TRIM(kod_usl)))) as param_1_2_, 
kod_usl, s.pricpol, d.dan_id, s.kol_vo_usl,  
	d.sex, d.kat, 
CASE WHEN t.talon_id IS NOT NULL 
	THEN s.talon_id 
    ELSE -1 
END AS talon_id, 
CASE WHEN t.data_vnes_inf IS NOT NULL 
	THEN t.data_vnes_inf 
    ELSE s.date_vnes_inf 
END AS date_vnes, 	(SELECT f.dolg_doctor FROM visit_tab v 
			LEFT JOIN full_doctor_tab f ON v.doctor_id=f.doctor_id  
			WHERE v.talon_id=t.talon_id LIMIT 1) AS spec_usl, 
			(SELECT doctor_id FROM visit_tab WHERE talon_id=t.talon_id LIMIT 1) AS kod_doc, 
round(s.price, 2) AS usl_price, round(s.price*s.kol_vo_usl, 2) AS total_sum, 
CASE WHEN d.spolref::int8 in (select * from get_all_lpu_numbers()) 
	THEN 'false' 
	ELSE 'true' 
END AS prik, 
d.dom, st.kod_oms as street, reg.kod_oms as region, d.korp, d.kv, 
CASE WHEN d.town_id IS NULL 
	THEN npref.kod_oms 
	ELSE town.kod_oms 
END AS npref, t.diag_osn , d.mest_born, d.data_begin as pp01, 
CASE WHEN d.mesto_work_id THEN 'true' ELSE 'false' END AS working, 
d.data_end as pp02 
CASE WHEN  
FROM stand_patient_tab s 
LEFT JOIN dan_tab d ON d.dan_id=s.dan_id 
LEFT JOIN address_tab a on a.dan_id=d.dan_id and a.sp_addr_type_id=1 
LEFT JOIN talon_tab t ON t.talon_id=s.talon_id 
LEFT JOIN codifiers.sp_uslug_tab spu ON spu.code=s.kod_usl 
LEFT JOIN eq_uslug_cost_view eq ON eq.sp_uslug_id=spu.id   AND eq.sp_lpu_id = s.place_usl::integer 
LEFT JOIN kladr_tab reg ON reg.code=d.region_id 
LEFT JOIN kladr_tab npref on npref.code=d.punkt_id 
LEFT JOIN kladr_tab town on town.code=d.town_id 
LEFT JOIN st_tab st on st.code=d.street_id 
--left join visit_tab on visit_tab.talon_id=t.talon_id 
WHERE spu.sp_usl_program_id=1 AND 
:period_2_1_: 
AND :period_3_1_: AND :period_4_1_:  
and :sch_1_: BETWEEN date(':period_1_1_:') AND date(':period_1_2_:') 
) AS foo 
/*WHERE --AND 
date_vnes BETWEEN date(':period_1_1_:') and date(':period_1_2_:')*/</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_4" Caption="Вид оплаты" Type="select">
              <Sql>SELECT 'true'::text,'Все'::text,0 UNION SELECT ' t.vid_oplat_id = '||vid_oplat_id, nam_oplat, 1 FRom vid_oplat_tab ORDER By 3,2</Sql>
            </Parameter>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_3" Caption="Место жительства" Type="select">
              <Sql>SELECT 'true'::text , 'Все', 0 UNION SELECT 'd.town_id::int8!=7000000100000'::text , 'Сельские', 1 UNION SELECT 'd.town_id::int8=7000000100000'::text , 'Городские', 2 ORDER BY 3 </Sql>
            </Parameter>
            <Parameter Name="period_2" Caption="СМО" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text,0 UNION select 'CASE WHEN t.talon_id IS NOT NULL   THEN t.strcom_id   ELSE d.strcom_id  END= '||strcom_id::text, strcom,1 from strcom_tab where strcom_id&lt;97 or strcom_id=99 ORDER By 3,2 </Sql>
            </Parameter>
            <Parameter Name="sch" Caption="Считать по " Type="select2">
              <Sql>s.date_usl=Дате оказания услуги|s.date_vnes_inf=Дате внесения информации</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="87" Name="Реестр пациентов, застрахованных в СМО, которым оказаны внешние медицинские услуги" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Частичное фондодержание\Реестр пациентов, застрахованных в СМО, которым оказаны внешние медицинские услуги.xls">
          <Queries>
            <Query>
              <Sql>itogo select sum(c) from ( 
	select round(cast(sp_uslug_tab.cost*kol_vo_usl as numeric), 2) as c,  
	case when talon_tab.talon_id is not null then talon_tab.data_vnes_inf else stand_patient_tab.date_vnes_inf end as date_vnes from stand_patient_tab 
	left join sp_uslug_tab on sp_uslug_tab.uslug_kod=stand_patient_tab.kod_usl  
	left join dan_tab d on d.dan_id=stand_patient_tab.dan_id 
	left join talon_tab on talon_tab.talon_id=stand_patient_tab.talon_id 
	left join visit_tab v on v.talon_id=talon_tab.talon_id 
	where :period_2_1_: and v.data_pos between  date(':period_1_1_:') AND date(':period_1_2_:') 
) as foo 
/*where date_vnes between date(':period_1_1_:') and date(':period_1_2_:')*/</Sql>
            </Query>
            <Query>
              <Sql>main_query SELECT * FROM 
	(SELECT d.fio, 
	COALESCE(d.ser_pol,'')||' '||COALESCE(d.num_pol,'')||' '||COALESCE(i.strcom,'') AS polis, 
	a.text_address AS address, 
	d.date_born AS date_born, 
	(CASE WHEN d.metka_work='+' 
    	THEN 	(CASE WHEN d.mesto_work_id IS NOT NULL 
        		THEN (SELECT mest_work FROM mest_work_tab WHERE mest_work_id = d.mesto_work_id) 
        		ELSE d.mest_work 
        		END) 
		ELSE '' 
		END) AS mrab, 
	s.date_usl, t.diag_osn AS mkb, 
    TRIM(TRIM(both 'Д' FROM TRIM(both '*' FROM TRIM(kod_usl)))) 
    , '"'||s.kod_usl||'"' as kod_usl, 
    s.pricpol, 
	d.dan_id , s.kol_vo_usl, 
	CASE WHEN t.talon_id IS NOT NULL 
    	THEN s.talon_id 
    	ELSE -1 
    END AS talon_id, 
   
	CASE WHEN t.talon_id IS NOT NULL 
    	THEN t.data_vnes_inf 
    	ELSE s.date_vnes_inf 
    END AS date_vnes, 
    
     round(s.price, 2) AS usl_price, round(s.price*s.kol_vo_usl, 2) AS total_sum,(SELECT dolg_doctor FROM visit_tab 
	LEFT JOIN spec_doctor_tab ON visit_tab.doctor_id=spec_doctor_tab.kod_doctor 
	LEFT JOIN dolg_doctor_tab ON dolg_doctor_tab.dolg_doctor_id=spec_doctor_tab.dolg_doctor_id 
	WHERE talon_id=t.talon_id LIMIT 1) AS spec_usl 
	FROM stand_patient_tab s 
	LEFT JOIN dan_tab d ON d.dan_id = s.dan_id 
	LEFT JOIN address_tab a on a.dan_id=d.dan_id and a.sp_addr_type_id=1 
	LEFT JOIN strcom_tab i ON d.strcom_id = i.strcom_id 
	LEFT JOIN talon_tab t ON t.talon_id = s.talon_id 
	LEFT JOIN naprav_tab n ON t.talon_id = n.talon_id 
	--left join visit_tab on visit_tab.talon_id=t.talon_id  
    LEFT JOIN sp_uslug_tab ON sp_uslug_tab.uslug_kod = s.kod_usl 
	WHERE sp_uslug_tab.sp_usl_program_id = 1 
	and :period_2_1_: and :period_3_1_: and :period_4_1_: 
	and :sch_1_: BETWEEN date(':period_1_1_:') AND date(':period_1_2_:') ) AS foo 
ORDER BY 1</Sql>
            </Query>
            <Query>
              <Sql>pol_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>smo select case when ':period_2_1_:' = 'true' then 'все СМО' else strcom end from strcom_tab d where :period_2_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_4" Caption="Вид оплаты" Type="select">
              <Sql>SELECT 'true'::text,'Все'::text,0 UNION SELECT ' talon_tab.vid_oplat_id = ANY(get_kind_paid_subnodes('||vid_oplat_id||'))', nam_oplat, 1 FRom vid_oplat_tab ORDER By 3,2 </Sql>
            </Parameter>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_3" Caption="Место жительства" Type="select">
              <Sql>SELECT 'true'::text , 'Все', 0 UNION SELECT 'd.town_id::int8!=7000000100000'::text , 'Сельские', 1 UNION SELECT 'd.town_id::int8=7000000100000'::text , 'Городские', 2 ORDER BY 3</Sql>
            </Parameter>
            <Parameter Name="period_2" Caption="СМО" Type="select">
              <Sql>SELECT 'true'::text, 'Все страховые компании'::text,0 UNION select 'd.strcom_id= '||strcom_id::text, strcom,1 from strcom_tab where strcom_id&lt;97 or strcom_id=99 ORDER By 3,2</Sql>
            </Parameter>
            <Parameter Name="sch" Caption="Считать по " Type="select2">
              <Sql>s.date_usl=Дате оказания услуги|s.date_vnes_inf=Дате внесения информации</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="90" Name="Список людей направленных на консультации в другие ЛПУ(по дате направления)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Частичное фондодержание\Список людей направленных на консультации в другие ЛПУ(по дате направления).xls">
          <Queries>
            <Query>
              <Sql>napr_zapros SELECT s.sp_type_napr FROm  sp_type_napr_tab s WHERE  s.sp_type_napr_id = :period2_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select  
 DISTINCT /*np.id,n.id,*/ 
conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid), d.date_born as param_1_1_, 
     d.ser_pol||' '||d.num_pol as param_1_2_, lp.name as  param_1_3_, 
     dolg_doctor as  param_1_4_, date_destination as  param_1_5_, t.diag_osn as  param_1_6_ ,'"'||u.kod_usl||'"' as param_1_7_,u.kol_vo_usl as param_1_8_, 
 e.otdel_name , n.naprav_number as naprav_num, n.otdel_code, n.sp_type_napr_id,n.sp_naprav_lpu_id, 
CASE  
     when n.sp_type_napr_id=0 and np.id is not null then np.price  
            when (n.sp_type_napr_id=1 and d.strcom_region_id = '7000000000000') then e.price 
            when (n.sp_type_napr_id=1 and d.strcom_region_id != '7000000000000') then e.price_inogorod 
     when n.sp_type_napr_id=0 and np.id is null then NULL  
END as tarif 
 
     from naprav_tab n 
     left join talon_tab t on t.talon_id=n.talon_id 
     left join lpu_tab lp on lp.lpu_id=n.sp_naprav_lpu_id 
     left join dolg_doctor_tab on dolg_doctor_tab.dolg_doctor_id=n.doctor_id 
     left join dan_tab d on n.dan_id=d.dan_id 
    left join naprav_cons_usl_tab u on n.id=u.naprav_cons_id  
     left join sp_uslug_tab sp on sp.code=u.kod_usl 
          left join codifiers.lpu_otdels_tab e on e.pricpol::integer=n.sp_naprav_lpu_id 
          and e.date_begin&lt;=n.date_destination 
  and (e.date_end&gt;n.date_destination or e.date_end is null) and n.otdel_code=e.otdel_code::int8 
left join naprav_part_tab np on np.naprav_id=n.id AND np.id = u.naprav_cons_usl_id 
where n.date_destination between date(':period_1_1_:') and date(':period_1_2_:') 
AND  n.sp_type_napr_id = :period2_1_: AND :param_strcom_1_: and :inogorod_1_: and :voenkomat_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 :param_1_2_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 :param_1_3_:</Sql>
            </Query>
            <Query>
              <Sql>zapros5 :param_1_4_:</Sql>
            </Query>
            <Query>
              <Sql>zapros6 :param_1_5_:</Sql>
            </Query>
            <Query>
              <Sql>zapros7 :param_1_6_:</Sql>
            </Query>
            <Query>
              <Sql>zapros8 :param_1_7_:</Sql>
            </Query>
            <Query>
              <Sql>zapros9 :param_1_8_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param_strcom" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0 UNION SELECT ' d.strcom_id = '||s.strcom_id::text, s.strcom, 1 FROm strcom_tab s WHERE s.strcom_id IN (SELECT distinct d.strcom_id FROM naprav_cons_tab n LEFT JOIN talon_tab t On t.talon_id = n.talon_id LEFT JOIN dan_Tab d On d.dan_id = t.dan_id) ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="period2" Caption="Тип направления" Type="select">
              <Sql>SELECT s.sp_type_napr_id, s.sp_type_napr FROm sp_type_napr_tab s</Sql>
            </Parameter>
            <Parameter Name="voenkomat" Caption="Только из военкомата" Type="select">
              <Sql>select 'true','Нет',0 union select 'from_voenkomat=1', 'Да',1 order by 3</Sql>
            </Parameter>
            <Parameter Name="inogorod" Caption="Только иногородние" Type="select">
              <Sql>select 'true','Нет',0 union select 'is_inogorod=1', 'Да',1 order by 3</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="92" Name="Распределение направлений на консультации по ЛПУ за период (по дате направления)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Частичное фондодержание\Распределение направлений на консультации по ЛПУ за период (по дате направления).xls">
          <Queries>
            <Query>
              <Sql>type_zapros SELECT s.sp_type_napr FROm  sp_type_napr_tab s WHERE  s.sp_type_napr_id  = :period2_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select name, otdel_name, count(*) as param_1_1_, SUM(price) as param2_1_ , join_str(uslug1) as uslug1, 
round(SUM(sum1)::numeric,2) as sum1 
from ( 
select  lp.name, lo.otdel_name, lo.price, f.uslug1, f.sum1 	 
from naprav_cons_tab nap 
	left join lpu_tab lp on lp.pricpol=nap.pricpol 
	left join talon_tab t on t.talon_id=nap.talon_id 
	left join dan_tab d on t.dan_id=d.dan_id  
    LEFT JOIn lpu_otdels_tab lo ON lo.otdel_code = nap.otdel_code::text AND   lo.pricpol = nap.pricpol  
 
    LEFT JOIN 
    ( 
    SELECT nu.naprav_cons_id, JOIN_STR(nu.kod_usl||'-'||nu.kol_vo_usl::text) as uslug1, 
      SUM(CASE WHEN (tar.tarif IS NULL) THEN 0 ELSE tar.tarif END *nu.kol_vo_usl) as sum1 FROm naprav_cons_usl_tab nu 
    LEFt JOIN naprav_cons_tab n On n.naprav_cons_id = nu.naprav_cons_id 
    LEFT JOIN tarif_tab tar ON tar.kod_usl = nu.kod_usl AND tar.pricpol = n.pricpol 
    GROUP BY nu.naprav_cons_id 
    ) as f ON f.naprav_cons_id = nap.naprav_cons_id 
 
	where nap.date_naprav_cons between date(':period_1_1_:') and date(':period_1_2_:') 
AND sp_type_napr_id = :period2_1_: AND :param_strcom_1_:  and :inogorod_1_: and :voenkomat_1_: 
AND ((nap.date_naprav_cons between lo.date_begin and lo.date_end ) OR  (nap.date_naprav_cons &gt;lo.date_begin and lo.date_end is null) ) 
) q 
	group by name, otdel_name 
	order by 1,2,3</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select 'Итого'::text, count(*) as param_1_1_, SUM(lo.price) as param2_1_ , join_str(f.uslug1) as uslug1, round(SUM(f.sum1)::numeric,2) as sum1 
	from naprav_cons_tab nap 
	left join talon_tab t on t.talon_id=nap.talon_id 
	left join dan_tab d on t.dan_id=d.dan_id 
   LEFT JOIn lpu_otdels_tab lo ON lo.otdel_code = nap.otdel_code::text AND   lo.pricpol = nap.pricpol  
    LEFT JOIN 
    ( 
    SELECT nu.naprav_cons_id, JOIN_STR(nu.kod_usl||'-'||nu.kol_vo_usl::text) as uslug1, 
      SUM(CASE WHEN (tar.tarif IS NULL) THEN 0 ELSE tar.tarif END *nu.kol_vo_usl) as sum1 FROm naprav_cons_usl_tab nu 
    LEFt JOIN naprav_cons_tab n On n.naprav_cons_id = nu.naprav_cons_id 
    LEFT JOIN tarif_tab tar ON tar.kod_usl = nu.kod_usl AND tar.pricpol = n.pricpol 
    GROUP BY nu.naprav_cons_id 
    ) as f ON f.naprav_cons_id = nap.naprav_cons_id 
	where nap.date_naprav_cons between date(':period_1_1_:') and date(':period_1_2_:') 
AND sp_type_napr_id = :period2_1_: AND :param_strcom_1_: and :inogorod_1_: and :voenkomat_1_: 
AND ((nap.date_naprav_cons between lo.date_begin and lo.date_end ) OR  (nap.date_naprav_cons &gt;lo.date_begin and lo.date_end is null) )</Sql>
            </Query>
            <Query>
              <Sql>zapros4 :param2_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param_strcom" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0 UNION SELECT ' d.strcom_id = '||s.strcom_id::text, s.strcom, 1 FROm strcom_tab s WHERE s.strcom_id IN (SELECT DISTINCT t.strcom_id FROM naprav_cons_tab n LEFT JOIN talon_tab t On t.talon_id = n.talon_id) ORDER BY 3,2 </Sql>
            </Parameter>
            <Parameter Name="period2" Caption="Тип направления" Type="select">
              <Sql>SELECT s.sp_type_napr_id, s.sp_type_napr FROm sp_type_napr_tab s</Sql>
            </Parameter>
            <Parameter Name="voenkomat" Caption="Только из военкомата" Type="select">
              <Sql>select 'true','Нет',0 union select 'from_voenkomat=1', 'Да',1 order by 3</Sql>
            </Parameter>
            <Parameter Name="inogorod" Caption="Только иногородние" Type="select">
              <Sql>select 'true','Нет',0 union select 'is_inogorod=1', 'Да',1 order by 3</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="20002" Name="Распределение направлений на госпитализацию по ЛПУ за период (по дате направления)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Частичное фондодержание\Распределение направлений на госпитализацию по ЛПУ за период (по дате направления).xls">
          <Queries>
            <Query>
              <Sql>total SELECT sum(sub1.p2) AS kol, round(sum(sub1.p4)) AS summa FROM 
(SELECT lpu.name, lo.otdel_name AS p1, count(n.naprav_cons_id) AS p2, lo.price AS p3, sum(lo.price) AS p4 FROM naprav_cons_tab n 
LEFT JOIN lpu_tab lpu ON lpu.pricpol = n.pricpol 
LEFT JOIN lpu_otdels_tab lo ON lo.otdel_code = n.otdel_code::text AND   lo.pricpol = n.pricpol 
LEFT JOIN talon_tab t ON t.talon_id = n.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE n.sp_type_napr_id = 1 AND n.date_naprav_cons 
BETWEEN ':period_1_:' AND ':period_2_:' 
GROUP BY lpu.name, lo.otdel_name, lo.price 
ORDER BY 1,2) AS sub1</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT lpu.name, lo.otdel_name AS p1, count(n.naprav_cons_id) AS p2, lo.price AS p3, sum(lo.price) AS p4 FROM naprav_cons_tab n 
LEFT JOIN lpu_tab lpu ON lpu.pricpol = n.pricpol 
LEFT JOIN lpu_otdels_tab lo ON lo.otdel_code = n.otdel_code::text AND   lo.pricpol = n.pricpol 
LEFT JOIN talon_tab t ON t.talon_id = n.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE n.sp_type_napr_id = 1 AND n.date_naprav_cons 
BETWEEN ':period_1_:' AND ':period_2_:' 
GROUP BY lpu.name, lo.otdel_name, lo.price 
ORDER BY 1,2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период:" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="30002" Name="Распределение направлений на консультацию и обследование по ЛПУ за период (по дате направления)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Частичное фондодержание\Распределение направлений на консультацию и обследование по ЛПУ за период (по дате направления).xls">
          <Queries>
            <Query>
              <Sql>total SELECT sum(sub1.num) AS p1, sum(sub1.s) AS p2 FROM 
(SELECT n.pricpol, nu.kod_usl AS usl, count(nu.naprav_cons_usl_id) as num, tar.tarif AS tarif, sum(tar.tarif) AS s 
FROM naprav_cons_usl_tab nu 
LEFT JOIN naprav_cons_tab n ON nu.naprav_cons_id = n.naprav_cons_id 
LEFT JOIN tarif_tab tar ON tar.kod_usl = nu.kod_usl AND tar.pricpol = n.pricpol 
WHERE n.sp_type_napr_id = :type_1_: AND 
n.date_naprav_cons BETWEEN ':period_1_:' AND ':period_2_:' 
GROUP BY n.pricpol, nu.kod_usl, tar.tarif) AS sub1 
ORDER BY 1,2</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT lpu.name, nu.kod_usl AS usl, count(nu.naprav_cons_usl_id) as num, round(tar.tarif::numeric,2) AS tarif, round(sum(tar.tarif)::numeric,2) AS s 
FROM naprav_cons_usl_tab nu 
LEFT JOIN naprav_cons_tab n ON nu.naprav_cons_id = n.naprav_cons_id 
LEFT JOIN tarif_tab tar ON tar.kod_usl = nu.kod_usl AND tar.pricpol = n.pricpol 
LEFT JOIN lpu_tab lpu ON n.pricpol = lpu.pricpol 
WHERE n.sp_type_napr_id = :type_1_: AND 
n.date_naprav_cons BETWEEN ':period_1_:' AND ':period_2_:' 
GROUP BY lpu.name, nu.kod_usl, tar.tarif 
ORDER BY 1,2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="type" Caption="Тип направления" Type="select">
              <Sql>SELECT sp_type_napr_id, sp_type_napr FROM sp_type_napr_tab WHERE sp_type_napr_id &lt;&gt; 1 ORDER BY 1</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="110001" Name="Распределение направлений по докторам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Частичное фондодержание\Распределение направлений по докторам.xls">
          <Queries>
            <Query>
              <Sql>zapros SELECT d.fio, l.name AS p1, count(n.naprav_cons_id) AS p2 
FROM naprav_cons_tab n 
LEFT JOIN lpu_tab l ON l.pricpol = n.pricpol 
LEFT JOIN talon_tab t ON t.talon_id = n.talon_id 
LEFT JOIN full_doctor_view d ON d.full_doctor_id = n.doctor_id 
WHERE n.date_naprav_cons  BETWEEN ':period_1_:' AND ':period_2_:' 
AND n.sp_type_napr_id = :type_1_: 
GROUP BY d.fio, l.name 
ORDER BY 1,2;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период:" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="type" Caption="Тип направления" Type="select">
              <Sql>SELECT sp_type_napr_id, sp_type_napr FROM sp_type_napr_tab ORDER BY 1;</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="12200000" Name="Реестр пациентов, застрахованных в СМО, которым оказаны внешние медицинские услуги (03/12/2008)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Частичное фондодержание\Реестр пациентов, застрахованных в СМО, которым оказаны внешние медицинские услуги (03_12_2008).xls">
          <Queries>
            <Query>
              <Sql>adres :param_1_11_:</Sql>
            </Query>
            <Query>
              <Sql>data_born :param_1_9_:</Sql>
            </Query>
            <Query>
              <Sql>data_usl :param_1_1_:</Sql>
            </Query>
            <Query>
              <Sql>fio select * from (select d.fam||' '||d.nam||' '||d.mid, 
	d.ser_pol||' '||d.num_pol||' '||strcom as param_1_10_, 
	d.address as param_1_11_, 
	d.date_born as param_1_9_, 
	(case when d.metka_work='+' then 
		(case when d.mesto_work_id is not null then (select mest_work from mest_work_tab where mest_work_id=d.mesto_work_id) else d.mest_work end) 
		else '' 
	end) as param_1_8_, 
	date_usl as param_1_1_, 
        TRIM(TRIM(both 'Д' FROM TRIM(both '*' FROM TRIM(kod_usl)))) as param_1_2_, kod_usl as param_1_500_, 
        stand_patient_tab.pricpol as param_1_3_, 
	d.dan_id as param_1_4_, kol_vo_usl as param_1_5_, 
	case when talon_tab.talon_id is not null then stand_patient_tab.talon_id else -1 end as param_1_6_, 
	stand_patient_id as param_2_6_, 
	case when talon_tab.talon_id is not null then talon_tab.data_vnes_inf else stand_patient_tab.date_vnes_inf end as date_vnes 
	from stand_patient_tab 
	left join dan_tab d on d.dan_id=stand_patient_tab.dan_id 
	left join strcom_tab on d.strcom_id=strcom_tab.strcom_id 
	left join talon_tab on talon_tab.talon_id=stand_patient_tab.talon_id 
        left join sp_uslug_tab on sp_uslug_tab.uslug_kod=stand_patient_tab.kod_usl 
	where sp_uslug_tab.sp_usl_program_id=1 
	and :period_2_1_: and :period_3_1_: and :period_4_1_:) as foo 
	where date_vnes between date(':period_1_1_:') and date(':period_1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>full_sum :param_2_1_:</Sql>
            </Query>
            <Query>
              <Sql>itogo select sum(c) from ( 
	select round(cast(sp_uslug_tab.cost*kol_vo_usl as numeric), 2) as c,  
	case when talon_tab.talon_id is not null then talon_tab.data_vnes_inf else stand_patient_tab.date_vnes_inf end as date_vnes from stand_patient_tab 
	left join sp_uslug_tab on sp_uslug_tab.uslug_kod=stand_patient_tab.kod_usl  
	left join dan_tab d on d.dan_id=stand_patient_tab.dan_id 
	left join talon_tab on talon_tab.talon_id=stand_patient_tab.talon_id 
	where :period_2_1_: 
) as foo 
where date_vnes between date(':period_1_1_:') and date(':period_1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>kod_uslugi ':param_1_2_:</Sql>
            </Query>
            <Query>
              <Sql>kol_usl :param_1_5_:</Sql>
            </Query>
            <Query>
              <Sql>mkb select case when talon_tab.diag_osn is not null then talon_tab.diag_osn 
else stand_patient_tab.diagn_id end as _diagn_kod_ 
from stand_patient_tab 
left join talon_tab ON talon_tab.talon_id = stand_patient_tab.talon_id 
where stand_patient_tab.stand_patient_id =  :param_2_6_:</Sql>
            </Query>
            <Query>
              <Sql>mrab :param_1_8_:</Sql>
            </Query>
            <Query>
              <Sql>naprav_pol :param_1_3_:</Sql>
            </Query>
            <Query>
              <Sql>pol_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>polis :param_1_10_:</Sql>
            </Query>
            <Query>
              <Sql>smo select strcom from strcom_tab d where :period_2_1_:</Sql>
            </Query>
            <Query>
              <Sql>spec_usl select distinct case when visit_tab.doctor_id is not null then (select dolg_doctor from visit_tab 
	left join spec_doctor_tab on visit_tab.doctor_id=spec_doctor_tab.kod_doctor 
	left join dolg_doctor_tab on dolg_doctor_tab.dolg_doctor_id=spec_doctor_tab.dolg_doctor_id 
	where talon_id=:param_1_6_: limit 1) else dolg_doctor_tab.dolg_doctor end 
from stand_patient_tab 
left join visit_tab on visit_tab.talon_id=stand_patient_tab.talon_id 
left join spec_doctor_tab on stand_patient_tab.doctor_id=spec_doctor_tab.kod_doctor 
left join dolg_doctor_tab on dolg_doctor_tab.dolg_doctor_id=spec_doctor_tab.dolg_doctor_id 
where stand_patient_tab.stand_patient_id =  :param_2_6_:</Sql>
            </Query>
            <Query>
              <Sql>usl_cena select case when (select count(*) from sp_uslug_tab where uslug_kod=':param_1_500_:')=0 then 0 else  
(select round(cast(cost as numeric), 2) 
from sp_uslug_tab where uslug_kod=':param_1_500_:') end,  
case when (select count(*) from sp_uslug_tab where uslug_kod=':param_1_500_:')=0 then 0 else  
(select round(cast(cost*:param_1_5_: as numeric), 2) 
from sp_uslug_tab where uslug_kod=':param_1_500_:') end as param_2_1_</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_4" Caption="Вид оплаты" Type="select">
              <Sql>SELECT 'true'::text,'Все'::text,0 UNION SELECT ' talon_tab.vid_oplat_id = '||vid_oplat_id, nam_oplat, 1 FRom vid_oplat_tab ORDER By 3,2</Sql>
            </Parameter>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_3" Caption="Место жительства" Type="select">
              <Sql>SELECT 'true'::text , 'Все', 0 UNION SELECT 'd.town_id::int8!=7000000100000'::text , 'Сельские', 1 UNION SELECT 'd.town_id::int8=7000000100000'::text , 'Городские', 2 ORDER BY 3</Sql>
            </Parameter>
            <Parameter Name="period_2" Caption="СМО" Type="select">
              <Sql>SELECT 'true'::text, 'Все страховые компании'::text,0 UNION select 'd.strcom_id= '||strcom_id::text, strcom,1 from strcom_tab where strcom_id&lt;97 or strcom_id=99 ORDER By 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2032303000" Name="Аннулирование направлений" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Частичное фондодержание\Аннулирование направлений.xls">
          <Queries>
            <Query>
              <Sql>z1 select n.naprav_number, 
n.date_destination as p1, 
d.fam as p2, 
d.nam as p3, 
d.mid as p4, 
d.sex as p5, 
d.date_born as p6, 
'' as p7, 
lp.name as p8, 
nc.name as p9 
from naprav_tab n 
     left join codifiers.lpu_tab lp on lp.id=n.sp_naprav_lpu_id 
     left join dan_tab d on n.dan_id=d.dan_id 
	left join full_doctor_tab f on f.full_doctor_id=n.doctor_id 
    left join codifiers.napr_cancel_reasons_tab nc on nc.id=n.napr_cancel_reason_id 
where n.date_destination between date(':param1_1_:') and date(':param1_2_:') 
and n.sp_type_napr_id=1 
and :param2_1_: and :param3_1_: 
and get_vozrast(d.date_born) between 0 and 17 
and n.napr_cancel_reason_id  is not null 
order by 3,4,5</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Врач" Type="select">
              <Sql>select 'true','Все',0 union select 'n.doctor_id='||full_doctor_id,full_fio,1 from full_doctor_tab  order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2032503000" Name="Сведения о направлении на госпитализацию" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Частичное фондодержание\Сведения о направлении на госпитализацию.xls">
          <Queries>
            <Query>
              <Sql>z1 select n.naprav_number, 
n.date_destination as p1, 
nf.name as p2, 
l.name as p3, 
o.nam_otdel as p4, 
lp.name as p5, 
o1.name as p6, 
d.ser_pol as p7, 
d.num_pol as p8, 
s.name as p9, 
d.fam as p10, 
d.nam as p11, 
d.mid as p12, 
d.sex as p13, 
d.date_born as p14, 
coalesce(d.telephon||' ','')||coalesce(d.phone_mobile||' ','')|| 
coalesce(d.work_phone||' ','') as p15, 
n.sp_mkb_code as p16, 
doc.otdel_profile as p17, 
doc.koika_profile as p18, 
f.full_fio as p19, 
to_char(n.date_destination + '1 month'::interval,'dd.mm.yyyy') as p20 
from naprav_tab n 
     left join codifiers.lpu_tab lp on lp.id=n.sp_naprav_lpu_id 
     left join dan_tab d on n.dan_id=d.dan_id 
     left join codifiers.lpu_tab l on l.id=n.lpy_from_id 
	left join full_doctor_tab f on f.full_doctor_id=n.doctor_id 
    left join codifiers.strcom_tab s on s.id=d.strcom_id 
   left join codifiers.napr_form_okaz_tab nf on nf.id=n.form_okaz_id 
left join otdel_tab o on o.otdel=f.otdel::int 
left join codifiers.sp_lpu_otdels_tab o1 on o1.code::int=n.otdel_code 
and o1.pricpol::int4=n.sp_naprav_lpu_id 
left join codifiers.doctor_spec_tab doc on doc.id=f.dolg_doctor_id 
where n.date_destination between date(':param1_1_:') and date(':param1_2_:') 
and n.sp_type_napr_id=1 
and :param2_1_: and :param3_1_: 
and get_vozrast(d.date_born) between :vozr_1_: and :vozr_2_: 
order by 11,12,13</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="vozr" Caption="Возраст" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Врач" Type="select">
              <Sql>select 'true','Все',0 union select 'n.doctor_id='||full_doctor_id,full_fio,1 from full_doctor_tab  order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2034303000" Name="Список направлений" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Частичное фондодержание\Список направлений.xls">
          <Queries>
            <Query>
              <Sql>z1 select '$id'::text, 
d.fio as p1, 
d.date_born as p2, 
COALESCE(d.ser_pol||' ','')||COALESCE(d.num_pol,'') as p3, 
l.name as p4, 
lo.otdel_name as p5, 
dst.name as p13, 
n.date_naprav_cons as p6, 
n.diagn_osn as p7, 
n.naprav_num as p8, 
f.fio as p9, 
o.nam_otdel as p10, 
u.name as p11, 
l1.name as p12 
FROM naprav_cons_tab n 
left join naprav_tab n1 on n1.id=n.naprav_cons_id 
LEFT JOIN codifiers.doctor_spec_tab dst ON dst.id=n1.spec_doctor_id 
LEFT JOIN dan_tab d ON d.dan_id = n1.dan_id 
left join codifiers.lpu_tab l on l.id=n.pricpol::bigint 
LEFT JOIN lpu_otdels_tab lo ON lo.otdel_code::int4 = n.otdel_code 
			AND   lo.pricpol = n.pricpol 
left join full_doctor_tab f on f.full_doctor_id=n.doctor_id 
left join otdel_tab o on o.otdel=f.otdel::int4 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id 
left join codifiers.lpu_tab l1 on l1.id=d.spolref::bigint  
WHERE n.date_naprav_cons BETWEEN ':param1_1_:' and ':param1_2_:' 
and :param2_1_: and :param3_1_: and :param4_1_: 
order by 2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Тип направления" Type="select">
              <Sql>select 'true','Все',0 union select 'n.sp_type_napr_id='||id,name,1 from codifiers.napr_type_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Участок" Type="select">
              <Sql>select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Отчеты по умершим">
      <Reports>
        <Report Id="94" Name="Список умерших за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по умершим\Список умерших за период.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select 
distinct fam||' '||nam||' '||(case when mid is not null then mid else '' end), d.date_born as param_1_1, t.diag_osn as param_1_2, 
d.date_smerti as param_1_3, u.uchactok as param_1_4 
from dan_tab d 
left join talon_tab t ON d.dan_id = t.dan_id and t.result_id = 9 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
where life=1  
and :param1_1_: between date(':period_1_1_:') and date(':period_1_2_:') 
and (get_vozrast(d.date_born) between :vozrast_1_: and :vozrast_2_: ) 
and :pol_1_: 
order by 1 
 
/*select fam||' '||nam||' '||mid, dan_tab.date_born as param_1_1, talon_tab.diag_osn as param_1_2, talon_tab.data_end as param_1_3, 
	uchactok_tab.uchactok as param_1_4 from talon_tab 
	left join dan_tab on dan_tab.dan_id=talon_tab.dan_id 
	left join uchactok_tab on uchactok_tab.uchactok_id=dan_tab.uchactok_id 
	where result_id=9 
	and :param1_1_: between date(':period_1_1_:') and date(':period_1_2_:') 
	order by uchactok_tab.uchactok */</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_1:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 :param_1_2:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 :param_1_3:</Sql>
            </Query>
            <Query>
              <Sql>zapros5 :param_1_4:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="vozrast" Caption="Возраст" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="pol" Caption="Пол" Type="select">
              <Sql>select 'true','Все',0 union select 'd.sex='''||'м'||'''','М',1 union  select 'd.sex='''||'ж'||'''','Ж',2 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Считать период по" Type="select2">
              <Sql>(case when data_vnes_inf is not null then data_vnes_inf else date_smerti end)=дате внесения|(case when t.data_end is not null then t.data_end else date_smerti end)=дате смерти</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="95" Name="Распределение умерших по участкам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по умершим\Распределение умерших по участкам.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select uchactok_tab.uchactok, count(*) as param_1_1 from talon_tab 
	left join dan_tab on dan_tab.dan_id=talon_tab.dan_id 
	left join uchactok_tab on uchactok_tab.uchactok_id=dan_tab.uchactok_id 
	where result_id=9 
	and :param1_1_: between date(':period_1_1_:') and date(':period_1_2_:') 
	group by uchactok_tab.uchactok 
	order by uchactok_tab.uchactok</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_1:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select 'Итого', count(*) as param_1_1 from talon_tab 
 
	left join dan_tab on dan_tab.dan_id=talon_tab.dan_id
 
	left join uchactok_tab on uchactok_tab.uchactok_id=dan_tab.uchactok_id
 
	where result_id=9
 
	and data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Считать период по" Type="select2">
              <Sql>data_vnes_inf=дате внесения|talon_tab.data_end=дате смерти</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="96" Name="Список умерших на определенном участке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по умершим\Список умерших на определенном участке.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select 
distinct fam||' '||nam||' '||(case when mid is not null then mid else '' end), d.date_born as param_1_1, t.diag_osn as param_1_2, 
d.date_smerti as param_1_3, u.uchactok as param_1_4 
from dan_tab d 
left join talon_tab t ON d.dan_id = t.dan_id and t.result_id = 9 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
where life=1 
and :param1_1_: between date(':period_1_1_:') and date(':period_1_2_:') 
and d.uchactok_id=:period_2_1_: 
order by 5,1 
 
/*select fam||' '||nam||' '||mid, dan_tab.date_born as param_1_1, talon_tab.diag_osn as param_1_2, talon_tab.data_end as param_1_3, 
	uchactok_tab.uchactok as param_1_4 from talon_tab 
	left join dan_tab on dan_tab.dan_id=talon_tab.dan_id 
	left join uchactok_tab on uchactok_tab.uchactok_id=dan_tab.uchactok_id 
	where result_id=9 
	and  :param1_1_: between date(':period_1_1_:') and date(':period_1_2_:') 
	and dan_tab.uchactok_id=:period_2_1_: 
	order by uchactok_tab.uchactok*/</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_1:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 :param_1_2:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 :param_1_3:</Sql>
            </Query>
            <Query>
              <Sql>zapros5 :param_1_4:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Считать период по" Type="select2">
              <Sql>(case when data_vnes_inf is not null then data_vnes_inf else date_smerti end)=дате внесения|(case when t.data_end is not null then t.data_end else date_smerti end)=дате смерти</Sql>
            </Parameter>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>select uchactok_id, uchactok from uchactok_tab order by uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Вакцинация">
      <Reports>
        <Report Id="99" Name="Общий список прошедших вакцинацию за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Вакцинация\Общий список прошедших вакцинацию за период.xls">
          <Queries>
            <Query>
              <Sql>zapros0 select '$id', fam||' '||nam||' '||mid as param_1_1_, date_born as param_1_2_, address as param_1_3_, 
 sp_priv_univ_tab.sp_priv_univ as param_1_4_, priviv_tab.date_priviv as param_1_5_, c.name 
 from priviv_tab 
 left join sp_priv_univ_tab on sp_priv_univ_tab.sp_priv_univ_id=priviv_tab.preparat 
 left join dan_tab on dan_tab.dan_id=priviv_tab.dan_id 
left join codifiers.uchactok_tab  c on  dan_tab.uchactok_id =c.id  
 where /*sp_priv_univ_tab.parent in (3, 4) 
 and*/ date_priviv between date(':period_1_1_:') and date(':period_1_2_:') and :uchactok_1_: 
and (get_vozrast(dan_tab.date_born) between :v_1_: and :v_2_: )  
 order by 2;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="v" Caption="Возраст" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="uchactok" Caption="Участок" Type="select">
              <Sql>select 'true','Все',0 union select 'dan_tab.uchactok_id='||id, name,1 from codifiers.uchactok_tab order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="100" Name="Список пациентов прошедших вакцинацию за период (участок)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Вакцинация\Список пациентов прошедших вакцинацию за период (участок).xls">
          <Queries>
            <Query>
              <Sql>str_uchastok select uchactok from uchactok_tab where uchactok_id=:period_2_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros0 select '$id', fam||' '||nam||' '||mid as param_1_1_, date_born as param_1_2_, address as param_1_3_, 
/* case when parent=3 then 'от '||sp_priv_univ_tab.sp_priv_univ 
 when parent=4 then 'прививка '||sp_priv_univ_tab.sp_priv_univ end as param_1_4_, */ 
trim(conv_to_null(s2.sp_priv_univ)||conv_to_null(' от '||sp_priv_univ_tab.sp_priv_univ)) as param_1_4_, 
priviv_tab.date_priviv as param_1_5_ 
 from priviv_tab 
left join sp_priv_univ_tab on sp_priv_univ_tab.sp_priv_univ_id=priviv_tab.infection and sp_priv_univ_tab.parent=3 
left join sp_priv_univ_tab s2 on s2.sp_priv_univ_id=priviv_tab.vid_priviv and s2.parent=4 
left join dan_tab on dan_tab.dan_id=priviv_tab.dan_id 
 where dan_tab.uchactok_id=:period_2_1_: 
 and date_priviv between date(':period_1_1_:') and date(':period_1_2_:') 
 order by fam, nam, mid,priviv_tab.date_priviv</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>select uchactok_id, uchactok from uchactok_tab order by uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="101" Name="Общий список прошедших выбранную вакцинацию за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Вакцинация\Общий список прошедших выбранную вакцинацию за период.xls">
          <Queries>
            <Query>
              <Sql>zapros0 select '$id', fam||' '||nam||' '||mid as param_1_1_, date_born as param_1_2_, address as param_1_3_, 
'от '||sp_priv_univ_tab.sp_priv_univ||', '||spp.sp_priv_univ  as param_1_4_, priviv_tab.date_priviv as param_1_5_ 
 from priviv_tab 
 left join sp_priv_univ_tab on sp_priv_univ_tab.sp_priv_univ_id=priviv_tab.infection 
 left join sp_priv_univ_tab spp on spp.sp_priv_univ_id=priviv_tab.vid_priviv 
 left join dan_tab on dan_tab.dan_id=priviv_tab.dan_id 
 where sp_priv_univ_tab.parent =3 
 and :param1_1_: 
 and sp_priv_univ_tab.sp_priv_univ_id=:period_2_1_: 
 and date_priviv between date(':period_1_1_:') and date(':period_1_2_:') 
 order by fam, nam, mid 
 
/*select '$id', fam||' '||nam||' '||mid as param_1_1_, date_born as param_1_2_, address as param_1_3_,
 
 case when parent=3 then 'от '||sp_priv_univ_tab.sp_priv_univ
 
 when parent=4 then 'прививка '||sp_priv_univ_tab.sp_priv_univ end as param_1_4_, priviv_tab.date_priviv as param_1_5_
 
 from priviv_tab
 
 left join sp_priv_univ_tab on sp_priv_univ_tab.sp_priv_univ_id=priviv_tab.infection
 
 left join dan_tab on dan_tab.dan_id=priviv_tab.dan_id
 
 where sp_priv_univ_tab.parent in (3, 4) and sp_priv_univ_tab.sp_priv_univ_id=:period_2_1_:
 
  and date_priviv between date(':period_1_1_:') and date(':period_1_2_:')
 
 order by fam, nam, mid*/</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_2" Caption="Вид" Type="select">
              <Sql>select sp_priv_univ_id, case when parent=3 then 'от '||sp_priv_univ_tab.sp_priv_univ when parent=4 then 'прививка '||sp_priv_univ_tab.sp_priv_univ end from sp_priv_univ_tab where sp_priv_univ_tab.parent in (3, 4) order by parent, sp_priv_univ_tab.sp_priv_univ</Sql>
            </Parameter>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Прививка" Type="select">
              <Sql>select 'true', 'Все',0 union select 'spp.sp_priv_univ_id='||sp_priv_univ_id, trim(sp_priv_univ_tab.sp_priv_univ)::text,1 from  sp_priv_univ_tab where sp_priv_univ_tab.parent=4 union select 'spp.sp_priv_univ_id in (9,12)', 'V - V3',2 from  sp_priv_univ_tab where sp_priv_univ_tab.parent=4 union select 'spp.sp_priv_univ_id in (13,20)', 'RV - RV7',3 from  sp_priv_univ_tab where sp_priv_univ_tab.parent=4 order by 3,1 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="102" Name="Список пациентов прошедших выбранную вакцинацию за период (участок)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Вакцинация\Список пациентов прошедших выбранную вакцинацию за период (участок).xls">
          <Queries>
            <Query>
              <Sql>count_all select count(priviv_tab.priviv_id) 
from priviv_tab 
left join sp_priv_univ_tab on sp_priv_univ_tab.sp_priv_univ_id=priviv_tab.infection and sp_priv_univ_tab.parent=3 
left join sp_priv_univ_tab s2 on s2.sp_priv_univ_id=priviv_tab.vid_priviv and s2.parent=4 
left join dan_tab on dan_tab.dan_id=priviv_tab.dan_id 
where dan_tab.uchactok_id=:period_2_1_: 
 and (sp_priv_univ_tab.sp_priv_univ_id=:period_3_1_: OR s2.sp_priv_univ_id=:period_3_1_:) 
 and date_priviv between date(':period_1_1_:') and date(':period_1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>str_uchastok select uchactok from uchactok_tab where uchactok_id=:period_2_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros0 select '$id', fam||' '||nam||' '||mid as param_1_1_, date_born as param_1_2_, address as param_1_3_, 
/*case when parent=3 then 'от '||sp_priv_univ_tab.sp_priv_univ 
when parent=4 then 'прививка '||sp_priv_univ_tab.sp_priv_univ end as param_1_4_, */ 
trim(conv_to_null(s2.sp_priv_univ)||conv_to_null(' от '||sp_priv_univ_tab.sp_priv_univ)) as param_1_4_, 
priviv_tab.date_priviv as param_1_5_ , priviv_tab.seria as param_1_6_ 
from priviv_tab 
left join sp_priv_univ_tab on sp_priv_univ_tab.sp_priv_univ_id=priviv_tab.infection and sp_priv_univ_tab.parent=3 
left join sp_priv_univ_tab s2 on s2.sp_priv_univ_id=priviv_tab.vid_priviv and s2.parent=4 
left join dan_tab on dan_tab.dan_id=priviv_tab.dan_id 
where dan_tab.uchactok_id=:period_2_1_: 
 and (sp_priv_univ_tab.sp_priv_univ_id=:period_3_1_: OR s2.sp_priv_univ_id=:period_3_1_:) 
 and date_priviv between date(':period_1_1_:') and date(':period_1_2_:') 
 order by fam, nam, mid, priviv_tab.date_priviv</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_3" Caption="Вид" Type="select">
              <Sql>select sp_priv_univ_id, case when parent=3 then 'от '||sp_priv_univ_tab.sp_priv_univ when parent=4 then 'прививка '||sp_priv_univ_tab.sp_priv_univ end from sp_priv_univ_tab where sp_priv_univ_tab.parent in (3, 4) order by parent, sp_priv_univ_tab.sp_priv_univ</Sql>
            </Parameter>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>select uchactok_id, uchactok from uchactok_tab order by uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="127" Name="Количества прививок по возрастам (за период по виду)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Вакцинация\Количества прививок по возрастам (за период по виду).xls">
          <Queries>
            <Query>
              <Sql>priv_zapr SELECT sp_priv_univ  FROm sp_priv_univ_tab WHERe parent = 3 AND 
sp_priv_univ_id = :vid_priv_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4(from_1,for_1,vpr) SELECT  kol2,kol1, 
case when kol2 = 0 then round(0.0,2) 
else 
round(kol1*100.0/kol2,2) 
end as proc 
FROM 
(SELECT COUNT(*) as kol1 
FROM priviv_tab p 
LEFT JOIN dan_tab d ON d.dan_id = p.dan_id 
WHERE p.infection = :vid_priv_1_:  
AND (p.date_priviv &gt;= ':period1_1_:' AND p.date_priviv &lt;= ':period1_2_:' ) 
AND get_vozrast(d.date_born,p.date_priviv) &gt;= from_1 AND get_vozrast(d.date_born,p.date_priviv) &lt;=  for_1 :param2_1_:  
and p.vid_priviv=vpr ) as f1, 
 
(SELECT COUNT(*) as kol2 
FROm dan_tab 
WHERE prikreplen = 1 
AND get_vozrast(date_born) &gt;= from_1 AND  get_vozrast(date_born) &lt;= for_1 ) as f2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="vid_priv" Caption="Вид инфекции" Type="select">
              <Sql>SELECT sp_priv_univ_id, sp_priv_univ  FROm sp_priv_univ_tab WHERe parent = 3   ORDER BY sp_priv_univ </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата прививки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Прикрепленные" Type="select">
              <Sql>SELECT 'AND prikreplen = 1', 'Только прикрепленные'::text UNION SELECT ' AND true', 'Все'::text ORDER BY 1 DESC</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="128" Name="Количество прививок по ВУЗам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Вакцинация\Количество прививок по ВУЗам.xls">
          <Queries>
            <Query>
              <Sql>zapros0 SELECT  u.name as vuz,f.name as fakult, COUNT(DISTINCT :kol_1_:) 
FROM priviv_tab p 
LEFT JOIN dan_tab d ON d.dan_id = p.dan_id 
LEFT JOIN fakult_tab f ON f.kod_fak = d.kod_fak 
LEFT JOIN ucheb_zaved_tab u ON u.kod = d.kod_vuz 
WHERE :vid_priv_1_:  AND p.date_priviv &gt;= ':period1_1_:' AND p.date_priviv &lt;= ':period1_2_:' 
GROUP BY u.name, f.name 
ORDER BY 1,2</Sql>
            </Query>
            <Query>
              <Sql>priv_zapr SELECT distinct case when ':vid_priv_1_:' = ' true' then '- все инфекции' else sp_priv_univ  end 
FROm sp_priv_univ_tab s JOIN priviv_tab p ON p.infection=sp_priv_univ_id 
WHERe  :vid_priv_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="vid_priv" Caption="Вакцина" Type="select">
              <Sql>SELECT ' true', 'Все', 0  UNION SELECT 'p.preparat ='||sp_priv_univ_id::text, sp_priv_univ,1  FROm sp_priv_univ_tab WHERe parent = 5 ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата прививки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="kol" Caption="Количество" Type="select2">
              <Sql>d.dan_id = Человек| p.priviv_id = Прививок</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="180" Name="Список прививок по возрасту и виду за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Вакцинация\Список прививок по возрасту и виду за период.xls">
          <Queries>
            <Query>
              <Sql>priv_zapr SELECT sp_priv_univ  FROm sp_priv_univ_tab WHERe parent = 3 AND 
sp_priv_univ_id = :vid_priv_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECT d.fam as p1,d.nam as p2,d.mid as p3,d.date_born as p4, get_vozrast(d.date_born,p.date_priviv) as p5, 
p.date_priviv as p6, u.name as uch 
FROM priviv_tab p 
LEFT JOIN dan_tab d ON p.dan_id = d.dan_id 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id 
WHERE  p.infection = :vid_priv_1_: 
 AND p.date_priviv &gt;= ':period1_1_:' AND p.date_priviv &lt;= ':period1_2_:' 
AND 
get_vozrast(d.date_born,p.date_priviv) &gt;= :from_age_1_: 
AND 
get_vozrast(d.date_born,p.date_priviv) &lt;=   :for_age_1_: 
and p.vid_priviv=9  :param2_1_: 
ORDER BY p1,p2,p3</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="from_age" Caption="C возраста" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="vid_priv" Caption="Вид инфекции" Type="select">
              <Sql>SELECT sp_priv_univ_id, sp_priv_univ  FROm sp_priv_univ_tab WHERe parent = 3   ORDER BY sp_priv_univ </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата прививки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="for_age" Caption="По возраст" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Прикрепленные" Type="select">
              <Sql>SELECT 'AND prikreplen = 1', 'Только прикрепленные'::text UNION SELECT ' AND true', 'Все'::text ORDER BY 1 DESC</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="185" Name="Кол - во прививок по видам вакцинации и возрастам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Вакцинация\Кол - во прививок по видам вакцинации и возрастам.xls">
          <Queries>
            <Query>
              <Sql>privzapr SELECT sp_priv_univ  
FROM sp_priv_univ_tab 
WHERE sp_priv_univ_id = :vid_priv_1_:;</Sql>
            </Query>
            <Query>
              <Sql>zapros4(from_1,for_1,vpr) SELECT COUNT(*) as kol1 
FROM priviv_tab p 
LEFT JOIN dan_tab d ON d.dan_id = p.dan_id 
WHERE p.infection = :vid_priv_1_:  
AND (p.date_priviv between date(':period1_1_:') and date(':period1_2_:') ) 
AND (get_vozrast(d.date_born,p.date_priviv) between from_1 and  for_1 ) 
AND  p.vid_priviv = vpr  :param2_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата прививки: " Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="vid_priv" Caption="Инфекция: " Type="select">
              <Sql>SELECT sp_priv_univ_id, sp_priv_univ FROM  sp_priv_univ_tab WHERE parent = 3;</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Прикрепленные" Type="select">
              <Sql>SELECT 'AND prikreplen = 1', 'Только прикрепленные'::text UNION SELECT ' AND true', 'Все'::text ORDER BY 1 DESC</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2015303001" Name="Мониторинг по дате внесения" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Вакцинация\Мониторинг по дате внесения.xls">
          <Queries>
            <Query>
              <Sql>zapros0 select  distinct fam||' '||nam||' '||mid as param_1_1_, date_born as param_1_2_, address as param_1_3_,c.name 
 from priviv_tab 
 left join sp_priv_univ_tab on sp_priv_univ_tab.sp_priv_univ_id=priviv_tab.preparat 
 left join dan_tab on dan_tab.dan_id=priviv_tab.dan_id 
left join codifiers.uchactok_tab  c on  dan_tab.uchactok_id =c.id  
 where /*sp_priv_univ_tab.parent in (3, 4) 
 and*/ priviv_tab.date_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:') and :uchactok_1_: 
and (get_vozrast(dan_tab.date_born) between :v_1_: and :v_2_: )  
 order by 2;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="v" Caption="Возраст" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_1" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="uchactok" Caption="Участок" Type="select">
              <Sql>select 'true','Все',0 union select 'dan_tab.uchactok_id='||id, name,1 from codifiers.uchactok_tab order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2015903001" Name="Список прививок" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Вакцинация\Список прививок.xls">
          <Queries>
            <Query>
              <Sql>priv_zapr SELECT sp_priv_univ  FROm sp_priv_univ_tab WHERe parent = 3 AND 
sp_priv_univ_id = :vid_priv_1_:</Sql>
            </Query>
            <Query>
              <Sql>str_uchastok select uchactok from uchactok_tab where uchactok_id=:period_2_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECT d.fam as p1,d.nam as p2,d.mid as p3,d.date_born as p4, get_vozrast(d.date_born,p.date_priviv) as p5, priv.name as pr, p.preparat as pr1, p.date_priviv as p6, u.name as uch 
FROM priviv_tab p 
LEFT JOIN dan_tab d ON p.dan_id = d.dan_id 
left join codifiers.priv_preparat_tab priv ON priv.id= p.preparat 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id 
WHERE  d.uchactok_id=:period_2_1_: 
ORDER BY p1,p2,p3</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Прикрепленные" Type="select">
              <Sql>SELECT 'AND prikreplen = 1', 'Только прикрепленные'::text UNION SELECT ' AND true', 'Все'::text ORDER BY 1 DESC</Sql>
            </Parameter>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>select uchactok_id, uchactok from uchactok_tab order by uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="214 Приказ">
      <Reports>
        <Report Id="108" Name="Отчет об использовании лекарственных средств и изделий медицинского назначения за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\Отчет об использовании лекарственных средств и изделий медицинского назначения за период.xls">
          <Queries>
            <Query>
              <Sql>zapros0 SELECT '$id', s1.uslug_name as param_1_1_,SUM(s.kol_vo_usl) as param_1_2_, COUNT(s1.uslug_name) as param_1_3_ 
 FROm stand_patient_tab s 
LEFT JOIn sp_uslug_tab s1 ON s.kod_usl = s1.uslug_kod 
WHERE s1.parent_id = ':period_2_1_:' AND s.date_usl BETWEEN date(':period_1_1_:') AND date(':period_1_2_:') 
GROUP BY s1.uslug_name;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_2" Caption="Программа" Type="select">
              <Sql>SELECT s.uslug_kod, s.uslug_name FROm sp_uslug_tab s WHERE s.parent_id IS NULL AND s.uslug_kod between '39' and '60'</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="109" Name="Сводный отчет по целевым программам за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\Сводный отчет по целевым программам за период.xls">
          <Queries>
            <Query>
              <Sql>zapros0 SELECT (SELECT value FROm settings_tab WHERe name = 'LPU' LIMIT 1), 
 s1.uslug_name as param_1_1_,SUM(s.kol_vo_usl) as param_1_2_, COUNT(s1.uslug_name) as param_1_3_ 
 , s2.uslug_name as param_1_4_ 
 FROm stand_patient_tab s 
LEFT JOIn sp_uslug_tab s1 ON s.kod_usl = s1.uslug_kod 
LEFT JOIn sp_uslug_tab s2 ON s2.uslug_kod = s1.parent_id 
WHERE  s.date_usl BETWEEN date(':period_1_1_:') AND date(':period_1_2_:')  
and (s1.sp_usl_program_id=2)  
GROUP BY s1.uslug_name, s2.uslug_name ORDER BY s2.uslug_name, s1.uslug_name;
</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period" />
          </Parameters>
        </Report>
        <Report Id="110" Name="Журнал лекарственных средств" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\Журнал лекарственных средств.xls">
          <Queries>
            <Query>
              <Sql>zapros0 SELECT '$id', conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) as param_1_1_, 
d.address as param_1_2_, 
s1.uslug_name as param_1_3_,s.kol_vo_usl as param_1_4_ , 
s.date_usl 
 FROm stand_patient_tab s 
LEFT JOIn sp_uslug_tab s1 ON s.kod_usl = s1.uslug_kod 
LEFT JOIN dan_tab d ON d.dan_id = s.dan_id 
WHERE s1.parent_id = ':period_2_1_:' AND s.date_usl BETWEEN date(':period_1_1_:') AND date(':period_1_2_:')  
ORDER BY s.date_usl , param_1_1_</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_2" Caption="Программа" Type="select">
              <Sql>SELECT s.uslug_kod, s.uslug_name FROm sp_uslug_tab s WHERE s.parent_id IS NULL AND s.uslug_kod between '39' and '60'</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="125" Name="Отчет об использовании лекарственных препаратов и проведенных мероприятиях" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\Отчет об использовании лекарственных препаратов и проведенных мероприятиях.xls">
          <Queries>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros0(period_3_1_) SELECT '', count(distinct s.dan_id) as param_1_3_, sum(s.kol_vo_usl) as param_1_2_
 
         FROm sp_uslug_tab s1   	
 
         LEFT JOIn stand_patient_tab s ON s.kod_usl = s1.uslug_kod  
 
	 WHERE s1.uslug_kod = 'period_3_1_' AND s.date_usl BETWEEN date(':period_1_1_:') AND date(':period_1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="138" Name="Тест-полоски за период " Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\Тест-полоски за период .xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT  
SUM(kol_vo_usl) as sum1, COUNT(*)as kol1 
FROm stand_patient_tab s WHERE   
(kod_usl = '101'OR kod_usl = '888') AND date_usl &gt;= date(':period1_1_:') AND  date_usl &lt;= date(':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="139" Name="Путевки" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\Путевки.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT set.value as lpu,s1.uslug_name as prog1, s.uslug_name as usl1,  SUM(t.kol_vo_usl) as kol FROM  
sp_uslug_tab s 
LEFT JOIN stand_patient_tab t ON t.kod_usl = s.uslug_kod AND t.date_usl &gt;=  date(':period1_1_:') AND t.date_usl &lt;= date(':period1_2_:') 
LEFT JOIN sp_uslug_tab s1 ON s1.parent_id is null AND s1.uslug_kod =  s.parent_id 
LEFT JOIN settings_tab set ON set.NAME = 'LPU' 
 WHERE s.parent_id = ':param1_1_:' 
GROUP BY set.value ,s1.uslug_name , s.uslug_name 
ORDER BY s.uslug_name</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Программа" Type="select">
              <Sql>SELECT s.uslug_kod, s.uslug_name FROm sp_uslug_tab s WHERE s.parent_id IS NULL AND s.uslug_kod between '55' and '56'</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="145" Name="Профилактические прививки" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\Профилактические прививки.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT distinct '$id',conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid)  as fio, d.date_born, 
d.address,mw.mest_work, s.uslug_name, p.doza, p.seria , p.date_priviv,f.fio AS doctor, sp.sp_priv_univ 
FROm priviv_tab p 
LEFT JOIN stand_patient_tab st ON st.priv_id = p.priviv_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = st.doctor_id 
LEFT JOIN sp_priv_univ_tab sp ON sp.sp_priv_univ_id = p.vid_priviv 
LEFT JOIN sp_uslug_tab s ON s.uslug_kod = p.preparat ::text 
LEFT JOIN dan_tab d On d.dan_id = p.dan_id 
LEFT JOIN mest_work_tab mw ON mw.mest_work_id = d.mesto_work_id 
WHERE s.uslug_kod is not null AND p.date_priviv &gt;= date(':period1_1_:') 
AND p.date_priviv &lt;= date(':period1_2_:') 
AND s.parent_id IN (':param1_1_:') 
AND :param3_1_: AND :param4_1_:  AND :param5_1_: 
ORDER BY p.date_priviv, fio</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата прививки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param5" Caption="Доктор:" Type="select">
              <Sql>SELECT ' true ' AS p1, 'Все' AS p2 UNION SELECT 'st.doctor_id = '||full_doctor_id::text AS p1, full_doctor_id::text||' - '||fio||' '||dolg_doctor FROM full_doctor_tab AS p2;</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Место работы" Type="select">
              <Sql>SELECT ' true '::text, 'Все'::text, 0 UNION SELECT 'd.mesto_work_id = '||m.mest_work_id, m.mest_work, 1 FROm mest_work_tab m WHERE m.mest_work_id IN (SELECT DISTINCT d.mesto_work_id FROm stand_patient_tab s LEFt JOIN dan_tab d On d.dan_id = s.dan_id) ORDEr By 3,2 </Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Программа" Type="select2">
              <Sql>48','49','50','51=Все|48=700 Вакцинопрофилактиа (ФБ)|49=720 Национальный календарь прививок из ФБ|50=750 Вакцинопрофилактика (ОБ)|51=770 Вакцинопрофилактика (Муниц.Б)</Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Участок" Type="select">
              <Sql>SELECT ' true '::text, 'Все'::text, 0 UNION SELECT 'd.uchactok_id = '||u.uchactok_id, u.uchactok, 1 FROm uchactok_tab u WHERE u.uchactok_id IN (SELECT DISTINCT d.uchactok_id FROm stand_patient_tab s LEFt JOIN dan_tab d On d.dan_id = s.dan_id) ORDEr By 3,2 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="146" Name="О расходовании вакцины против клещевого энцефалита за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\О расходовании вакцины против клещевого энцефалита за период.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT sp.uslug_name, SUM(s.kol_vo_usl) as sum1 FROm stand_patient_tab s 
LEFT JOIN sp_uslug_tab sp ON sp.uslug_kod = s.kod_usl 
WHERe sp.parent_id = ':param1_1_:' AND MYUPPER(sp.uslug_name) like  MYUPPER('%энцефалит%') 
AND s.date_usl &gt;= date(':period1_1_:') AND s.date_usl &lt;= date(':period1_2_:') 
GROUP BY sp.uslug_name</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Программа" Type="select">
              <Sql>SELECT s.uslug_kod, s.uslug_name FROm sp_uslug_tab s  WHERe s.uslug_kod = 50 OR s.uslug_kod = 51</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="147" Name="О расходовании МИБП за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\О расходовании МИБП за период.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT sp.uslug_name, SUM(s.kol_vo_usl) as sum1 FROm stand_patient_tab s 
LEFT JOIN sp_uslug_tab sp ON sp.uslug_kod = s.kod_usl 
WHERe sp.parent_id = ':param1_1_:' 
AND s.date_usl &gt;= date(':period1_1_:') AND s.date_usl &lt;= date(':period1_2_:') 
GROUP BY sp.uslug_name 
ORDER BY 1;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Программа" Type="select2">
              <Sql>48=700 Вакцинопрофилактиа (ФБ)|49=720 Национальный календарь прививок из ФБ|50=750 Вакцинопрофилактика (ОБ)|51=770 Вакцинопрофилактика (Муниц.Б)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="148" Name="Санаторно-курортное лечение (журнал)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\Санаторно-курортное лечение (журнал).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT '$id',d.fam,d.nam,d.mid, d.address, sp.uslug_name, s.date_usl FROm stand_patient_tab s  
LEFT JOIn sp_uslug_tab sp ON sp.uslug_kod = s.kod_usl 
LEFT JOIN dan_tab d ON d.dan_id = s.dan_id 
WHERe sp.parent_id = ':param1_1_:' AND s.date_usl &gt;= date(':period1_1_:') AND s.date_usl &lt;= date(':period1_2_:')  
ORDER BY date_usl, fam,nam,mid</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата заезда" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Программа" Type="select">
              <Sql>SELECT s.uslug_kod, s.uslug_name FROm sp_uslug_tab s WHERE s.uslug_kod = 55 OR s.uslug_kod = 56</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="50010" Name="Вакцинация по виду прививок" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\Вакцинация по виду прививок.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT d.fam||' '||d.nam||' '||d.mid, d.date_born AS p1, d.address AS p2, s.date_usl AS p3,doc.fio AS p4 FROm 
(SELECT q.dan_id, 
(SELECT s1.oid FROM stand_patient_tab s1 WHERE 
s1.kod_usl = ':preparat_1_:' AND s1.dan_id = q.dan_id ORDER BY 1 LIMIT 1 OFFSET :priv_1_:-1) 
AS num 
FROM (   SELECT DISTINCT dan_id,count(*) FROM stand_patient_tab 
         WHERE kod_usl = ':preparat_1_:' 
         GROUP BY dan_id, kod_usl 
         HAVING count(*) &gt;= :priv_1_:) 
         AS q 
LEFT JOIN dan_tab d ON q.dan_id = d.dan_id) as f 
LEFT JOIN dan_tab d ON f.dan_id = d.dan_id 
LEFT JOIN stand_patient_tab s ON s.oid = f.num 
LEFT JOIN full_doctor_tab doc ON doc.full_doctor_id = s.doctor_id 
WHERE s.date_usl BETWEEN ':period_1_:' AND ':period_2_:';</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="priv" Caption="Номер прививки" Type="select2">
              <Sql>1=Первая вакцинация|2=Вторая вакцинация|3=Третья вакцинация</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период:" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="preparat" Caption="Препарат:" Type="select">
              <Sql>SELECT sp_priv_univ_id, sp_priv_univ_id::text||' '||sp_priv_univ FROM sp_priv_univ_tab WHERE parent = 5 ORDER BY sp_priv_univ_id;</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="70011" Name="Сводный отчет по видам прививок" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\214 Приказ\Сводный отчет по видам прививок.xls">
          <Queries>
            <Query>
              <Sql>doc_zapros SELECT p1 FROM 
(SELECT ' true ' AS p0, 'Все'  AS p1, 0 
UNION 
SELECT ' s.doctor_id = '||full_doctor_id::text AS p0,full_doctor_id::text||' '||fio||' - '||dolg_doctor AS p1,1 
FROM full_doctor_tab 
ORDER BY 3,1) as s 
WHERE s.p0 = ':doctor_1_:'</Sql>
            </Query>
            <Query>
              <Sql>first SELECT DISTINCT  s.kod_usl   AS preparatik 
,spr.sp_priv_univ AS vakcine  FROM stand_patient_tab s 
LEFT JOIN sp_priv_univ_tab spr ON spr.sp_priv_univ_id::text = s.kod_usl AND spr.parent = 5 
WHERE spr.sp_priv_univ IS NOT NULL AND :period_1_: AND :doctor_1_: 
/*s.date_usl BETWEEN ':period_1_:' AND ':period_2_:'  AND :doctor_1_: */ 
ORDER BY 1;</Sql>
            </Query>
            <Query>
              <Sql>privv(vpr) SELECT count(distinct s.stand_patient_id) FROM stand_patient_tab s 
LEFT JOIN priviv_tab p ON p.priviv_id = s.priv_id AND p.vid_priviv = vpr 
LEFT JOIN dan_tab d ON d.dan_id = s.dan_id 
WHERE :period_1_: AND :doctor_1_: AND :age_1_:  AND :p_seria_1_: 
/*s.date_usl BETWEEN ':period_1_:' AND ':period_2_:' AND :doctor_1_: */ 
AND p.priviv_id IS NOT NULL AND s.kod_usl = ':preparatik:'</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="age" Caption="Возраст" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="doctor" Caption="Врач" Type="select">
              <Sql>SELECT full_doctor_id::text,full_doctor_id::text||' '||fio||' - '||dolg_doctor,1 FROM full_doctor_tab  /* SELECT ' true ', 'Все' , 0 UNION SELECT ' s.doctor_id = '||full_doctor_id::text,full_doctor_id::text||' '||fio||' - '||dolg_doctor,1 FROM full_doctor_tab ORDER BY 3,1;*/</Sql>
            </Parameter>
            <Parameter Name="p_seria" Caption="Серия препарата" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Журналы анализов">
      <Reports>
        <Report Id="135" Name="Общий анализ крови" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Журналы анализов\Общий анализ крови.xls">
          <Queries>
            <Query>
              <Sql>journal SELECT 
a.where_output as p, a.date_analisis as p0, d.date_born as p1,conv_to_null(d.fam) ||' '||substring(conv_to_null(d.nam) from 1 for 1)||'.'||substring(conv_to_null(d.mid) from 1 for 1)||'. ' AS p2, a.roe as p3, a.leykocity as p4, a.gemoglobin as hb, a.eritrozity as p5, a.cp as p6, a.sge::text as p7, substring(a.svert_krovi from 1 for 6) ||' '|| a.svertkrovi_begin::varchar||' - '||a.svertkrovi_end::varchar AS p8, a.trombocity as p9, a.segment as p10, a.limfocity as p11, a.monocity as p12, a.eozinofily as p13, a.palot as p14, a.bazofily as p15, a.retikylozity as p16, plus.name as p17,plus1.name as p18	 
FROM researches.analizkrovi_tab a 
left join dan_tab d on d.dan_id=a.dan_id 
left join codifiers.plus_tab plus on plus.id=a.anazotioz::int8	 
left join codifiers.plus_tab plus1 on plus.id=a.anizochromia::int8 
where a.date_analisis &gt;= date(':date_1_:') 	 
AND a.date_analisis &lt;= date(':date_2_:') 	 
ORDER BY p2 , p1;</Sql>
            </Query>
            <Query>
              <Sql>total SELECT count(sub1.p0) AS t0, count(sub1.p1) AS t1, count(sub1.p2) AS t2, sum(sub1.p3) AS t3, count(sub1.p4) AS t4,count(sub1.hb) as thb, count(sub1.p5) AS t5,count(sub1.p6) AS t6,sum(sub1.p7) AS t7, 
 count(sub1.p8) AS t8, count(sub1.p9) AS t9, count(sub1.p10) AS t10, count(sub1.p11) AS t11, count(sub1.p12) AS t12, count(sub1.p13) AS t13, count(sub1.p14) AS t14, count(sub1.p15) AS t15, count(sub1.p16) AS t16, count(sub1.p17) AS t17, count(sub1.p18) AS t18 
 
FROM (SELECT 
a.where_output as p, a.data as p0, d.date_born as p1,d.fam ||' '||substring(d.nam from 1 for 1)||'.'||substring(d.mid from 1 for 1)||'. ' AS p2, case when text_to_int(a.roe)&gt;0 then 1 else 0 end as p3, a.leykocity as p4, a.gemoglobin as hb, a.eritrozity as p5, a.cp as p6, case when a.sge&gt;0 then 1 else 0 end as p7, substring(a.svert_krovi from 1 for 6) ||' '|| a.svertkrovi_begin::varchar||' - '||a.svertkrovi_end::varchar AS p8, a.trombocity as p9, a.segment as p10, a.limfocity as p11, a.monocity as p12, a.eozinofily as p13, a.palot as p14, a.bazofily as p15, a.retikylozity as p16, a.anazotioz as p17,a.anizochromia as p18	 
FROM analizkrovi_tab a,dan_tab d 
WHERE a.dan_id = d.dan_id	 
AND a.data &gt;= date(':date_1_:') 	 
AND a.data &lt;= date(':date_2_:') 	) AS sub1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="date" Caption="Дата анализа" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="136" Name="Общий анализ мочи" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Журналы анализов\Общий анализ мочи.xls">
          <Queries>
            <Query>
              <Sql>journalm SELECT a.where_output as p0, 
a.date_analisis as p1,d.date_born as p2, conv_to_null(d.fam) ||' '||substring(conv_to_null(d.nam) from 1 for 1)||'.'||substring(conv_to_null(d.mid) from 1 for 1)||'. ' AS p3,	 
a.color as p4, a.otn_plot as p5,a.reak as p6,a.belok as p7,a.gljukoza as p8, 
a.ket_tela as p9 ,a.gel_kislot as p10,a.bilirubin as p11,a.urobilipoud as p12, 
a.epit_round as p13, a.epit_pl as p14,a.epit_pereh as p15, a.epit_poch as p16, 
a.epit_fat_distr as p17,a.leykocity as p18,a.eritrocity as p19, 
a.eritrocity_n as p20,a.zil_gial as p21,a.zil_ser as p22, 
a.zil_voc as p23,a.zil_epit as p24,a.sliz as p25,a.soli as p26,a.bakter as p27 
FROM researches.analiz_mochi_tab a 
left join dan_tab d on d.dan_id=a.dan_id  
WHERE a.date_analisis &gt;= date(':date_1_:') 	 
AND a.date_analisis &lt;= date(':date_2_:') 	 
ORDER BY p3;</Sql>
            </Query>
            <Query>
              <Sql>total SELECT  count(sub1.p1) AS t1, count(sub1.p2) AS t2, count(sub1.p3) AS t3, count(sub1.p4) AS t4, count(sub1.p5) AS t5, count(sub1.p6) AS t6, count(sub1.p7) AS t7, count(sub1.p8) AS t8, count(sub1.p9) AS t9, count(sub1.p10) AS t10,  count(sub1.p11) AS t11, count(sub1.p12) AS t12, count(sub1.p13) AS t13, count(sub1.p14) AS t14, count(sub1.p15) AS t15, count(sub1.p16) AS t16, count(sub1.p17) AS t17, count(sub1.p18) AS t18, count(sub1.p19) AS t19, count(sub1.p20) AS t20, count(sub1.p21) AS t21, count(sub1.p22) AS t22, count(sub1.p23) AS t23, count(sub1.p24) AS t24, count(sub1.p25) AS t25, count(sub1.p26) AS t26, count(sub1.p27) AS t27 
FROM (SELECT a.where_output as p0, 
a.data as p1,d.date_born as p2, d.fam ||' '||substring(d.nam from 1 for 1)||'.'||substring(d.mid from 1 for 1)||'. ' AS p3,	 
a.color as p4, a.otn_plot as p5,a.reak as p6,a.belok as p7,a.gljukoza as p8, 
a.ket_tela as p9 ,a.gel_kislot as p10,a.bilirubin as p11,a.urobilipoud as p12, 
a.epit_round as p13, a.epit_pl as p14,a.epit_pereh as p15, a.epit_poch as p16, 
a.epit_fat_distr as p17,a.leykocity as p18,a.eritrocity as p19, 
a.eritrocity_n as p20,a.zil_gial as p21,a.zil_ser as p22, 
a.zil_voc as p23,a.zil_epit as p24,a.sliz as p25,a.soli as p26,a.bakter as p27 
FROM analiz_mochi_tab a,dan_tab d	 
WHERE a.dan_id = d.dan_id 
AND a.data &gt;= date(':date_1_:') 	 
AND a.data&lt;= date(':date_2_:') 	) AS sub1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="date" Caption="Дата анализа" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="191" Name="Журнал автоматического анализатора" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Журналы анализов\Журнал автоматического анализатора.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT a.date, d.fam||' '||d.nam||' '||d.mid as p1, d.date_born as p2, d.sex as p3, a.wbc as p4, a.lympr as p5, a.lymresh as p6, a.monpr as p7, a.monresh as p8, a.grapr as p9, a.graresh as p10, a.rbc as p11, a.hgb as p12, a.hct as p13, a.mcv as p14, a.mch as p15, a.mchc as p16, a.rdw as p17, a.plt as p18, a.mpv as p19, a.pct as p20, a.pwd as p21, b.roe as p22 FROM analizkrovi_auto_tab a LEFT JOIN dan_tab d ON d.dan_id = a.dan_id LEFT JOIN analizkrovi_tab b ON b.analizkrovi_flag = a.analizkrovi_auto_id WHERE a.date BETWEEN ':param1_1_:' AND ':param1_2_:';</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2015103000" Name="Исследования за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Журналы анализов\Исследования за период.xls">
          <Queries>
            <Query>
              <Sql>zapros select '$id'::text, d.fio, d.date_born, d.address, d.ser_pol||' '||d.num_pol as polis, lpu.name, a.date_analisis, conv_to_null(a.analisis_number::text) as analisis_number, r.name as analis_name 
from researches.main_research_tab a 
left join dan_tab d ON a.dan_id =d.dan_id 
left join lpu_tab lpu ON lpu.lpu_id = d.spolref::int4 
left join researches.researches_tab r on r.id=a.researches_types_id 
left join codifiers.uslug_groups_tab ugt1 on r.id = ugt1.researches_id 
left join codifiers.uslug_groups_tab ugt2 on ugt1.parent_id = ugt2.id 
where :param2_1_: between ':param1_1_:' and ':param1_2_:' 
and :param3_1_: 
and :param4_1_: 
and :gr_issl_1_: 
order by 2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param3" Caption="Вид исследования" Type="select">
              <Sql>select 'true'::text, 'Все виды', 0 union  select 'a.researches_types_id='||id, name,1 from researches.researches_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="gr_issl" Caption="Группа исследований" Type="select">
              <Sql>select 'true','Все группы исследований' union select 'ugt2.name ='||'''БИОХИМ''','БИОХИМ' union select 'ugt2.name ='||'''Кровь''','Кровь' union select 'ugt2.name ='||'''Лаборатория дет.''','Лаборатория дет.' union select 'ugt2.name ='||'''Новое''','Новое' union select 'ugt2.name ='||'''ОЛД''','ОЛД' union select 'ugt2.name ='||'''ОФД''','ОФД' union select 'ugt2.name ='||'''ОФД дет.''','ОФД дет.' union select 'ugt2.name ='||'''Рентгенография''','Рентгенография' union select 'ugt2.name ='||'''УЗИ''','УЗИ' union select 'ugt2.name ='||'''УЗИ дет.''','УЗИ дет.' union select 'ugt2.name ='||'''Флюорография''','Флюорография' union select 'ugt2.name ='||'''Эндоскопический центр''','Эндоскопический центр' order by 1</Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Прикреплён" Type="select">
              <Sql>select 'true'::text, 'не учитывать', 0 union select 'd.spolref::int4 in (select * from get_all_lpu_numbers())', 'к поликлинике',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())', 'нет',2 order by 3</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="по" Type="select2">
              <Sql>a.date_analisis=дате исследования|a.date_vnes_inf=дате внесения</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2019103000" Name="Количество исследований" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Журналы анализов\Количество исследований.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select rt.name,  d.uchactok, 
count(distinct a.dan_id) as count1 
from  researches.main_research_tab a  
 left join dan_tab b ON a.dan_id=b.dan_id 
 left join researches.researches_tab rt on rt.id=a.researches_types_id 
 left join uchactok_tab d ON d.uchactok_id=b.uchactok_id 
left join codifiers.uslug_groups_tab ugt1 on rt.id = ugt1.researches_id 
left join codifiers.uslug_groups_tab ugt2 on ugt1.parent_id = ugt2.id 
WHERE a.date_analisis BETWEEN ':dat_issl_1_:' AND ':dat_issl_2_:' 
AND :naim_issl_1_:   
and :gr_issl_1_:  
group by 1,2 
order by 1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="gr_issl" Caption="Группа исследований" Type="select">
              <Sql>select 'true','Все группы исследований' union select 'ugt2.name ='||'''БИОХИМ''','БИОХИМ' union select 'ugt2.name ='||'''Кровь''','Кровь' union select 'ugt2.name ='||'''Лаборатория дет.''','Лаборатория дет.' union select 'ugt2.name ='||'''Новое''','Новое' union select 'ugt2.name ='||'''ОЛД''','ОЛД' union select 'ugt2.name ='||'''ОФД''','ОФД' union select 'ugt2.name ='||'''ОФД дет.''','ОФД дет.' union select 'ugt2.name ='||'''Рентгенография''','Рентгенография' union select 'ugt2.name ='||'''УЗИ''','УЗИ' union select 'ugt2.name ='||'''УЗИ дет.''','УЗИ дет.' union select 'ugt2.name ='||'''Флюорография''','Флюорография' union select 'ugt2.name ='||'''Эндоскопический центр''','Эндоскопический центр' order by 1</Sql>
            </Parameter>
            <Parameter Name="dat_issl" Caption="Дата исследования" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="naim_issl" Caption="Наименование исследования" Type="select">
              <Sql>select 'true'::text, 'Все исследования',0 union select 'a.researches_types_id='||id, name,1 from researches.researches_tab order by 3,2 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2020303000" Name="Отчет по видам исследований (количество по участкам)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Журналы анализов\Отчет по видам исследований (количество по участкам).xls">
          <Queries>
            <Query>
              <Sql>clear_report SELECT ' '; 
SELECT drop_if_exists('report_issl_tab');</Sql>
            </Query>
            <Query>
              <Sql>report_init SELECT ' '; 
SELECT drop_if_exists('report_issl_tab'); 
 
CREATE TEMP TABLE report_issl_tab 
(id INTEGER, 
sex VARCHAR, 
uchactok INTEGER, 
researches_types_id INTEGER, 
prikreplen INTEGER, 
name VARCHAR, 
issl_id INTEGER   
); 
 
INSERT INTO report_issl_tab( 
id, 
sex, 
uchactok, 
researches_types_id, 
prikreplen, 
name, 
issl_id ) 
( 
SELECT distinct a.dan_id, 
 d.sex, 
d.uchactok_id, 
a.researches_types_id, 
d.prikreplen, 
r.name, 
r.id 
FROM researches.main_research_tab a 
LEFT JOIN dan_tab d ON a.dan_id =d.dan_id 
LEFT JOIN researches.researches_tab r ON r.id=a.researches_types_id 
left join codifiers.uslug_groups_tab ugt1 on r.id = ugt1.researches_id 
left join codifiers.uslug_groups_tab ugt2 on ugt1.parent_id = ugt2.id 
WHERE a.date_analisis BETWEEN ':period1_1_:' AND ':period1_2_:' 
and :vid_issl_1_: 
and get_vozrast(d.date_born)  between :vozrast_1_: and :vozrast_2_: 
and :gr_issl_1_: 
); 
 
 CREATE INDEX "report_issl_tab_uch_idx" ON "report_issl_tab" 
  USING btree ("uchactok"); 
CREATE INDEX "report_issl_tab_pol_idx" ON "report_issl_tab" 
  USING btree ("sex"); 
 
SELECT ' ';</Sql>
            </Query>
            <Query>
              <Sql>zapros1(_pol_,yuych,res_id) select count(distinct id) 
from report_issl_tab  
WHERE sex=':_pol_:' and researches_types_id=res_id  and uchactok=yuych</Sql>
            </Query>
            <Query>
              <Sql>zapros2(_pol_,res_id) select count(distinct id) 
from report_issl_tab 
WHERE  researches_types_id=res_id  and prikreplen!=1 and sex=':_pol_:'</Sql>
            </Query>
            <Query>
              <Sql>zapros3(_pol_) select DISTINCT name as nam_issl, issl_id as res_id  
from report_issl_tab 
where  sex=':_pol_:'  and :prik_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="vid_issl" Caption="Вид исследования" Type="select">
              <Sql>select 'true'::text, 'Все виды', 0 union  select 'a.researches_types_id='||id, name,1 from researches.researches_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="vozrast" Caption="Возраст " Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="gr_issl" Caption="Группа исследований" Type="select">
              <Sql>select 'true','Все группы исследований' union select 'ugt2.name ='||'''БИОХИМ''','БИОХИМ' union select 'ugt2.name ='||'''Кровь''','Кровь' union select 'ugt2.name ='||'''Лаборатория дет.''','Лаборатория дет.' union select 'ugt2.name ='||'''Новое''','Новое' union select 'ugt2.name ='||'''ОЛД''','ОЛД' union select 'ugt2.name ='||'''ОФД''','ОФД' union select 'ugt2.name ='||'''ОФД дет.''','ОФД дет.' union select 'ugt2.name ='||'''Рентгенография''','Рентгенография' union select 'ugt2.name ='||'''УЗИ''','УЗИ' union select 'ugt2.name ='||'''УЗИ дет.''','УЗИ дет.' union select 'ugt2.name ='||'''Флюорография''','Флюорография' union select 'ugt2.name ='||'''Эндоскопический центр''','Эндоскопический центр' order by 1</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="За период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="prik" Caption="Прикреплен" Type="select">
              <Sql>select 'true','Все',0  union select 'prikreplen=1','Прикреплен',1  union select 'prikreplen=0 or d.prikreplen is NULL','Не прикреплен',2   union select 'prikreplen=2','Прикреплен к другому ЛПУ',3 order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Отчеты по аптекам и отпущенным рецептам">
      <Reports>
        <Report Id="158" Name="Остатки препаратов" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по аптекам и отпущенным рецептам\Остатки препаратов.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT s.sklad, trim(both '!' from l.name_med) as name_med, r.kolvo, 
round(r.cost::numeric,2) as cost,  r.date_time_mod,r.kod_minzd   
FROM remains_tab r 
LEFT JOIn sklad_tab s On s.sklad_id = r.sklad_id 
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_minzd 
WHERe :param1_1_: AND :param2_1_: 
ORDER BY 1 , 2 
LIMIT 3000</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT 'true', 'Все'::text  UNION  SELECT ' r.sklad_id::numeric  = '||s.sklad_id::text||'', s.sklad FROM sklad_tab s  WHERe s.sklad_id IN (SELECT DISTINCT r.sklad_id FROm remains_tab r)  ORDER BY 1 ASC   </Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Препарат" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, '0' UNION SELECT  ' r.kod_minzd = '||l.kod, substr(TRIM(both '!' from  l.name_med),1,130), TRIM(both '!' from l.name_med) FROm lgot_preparat_tab l WHERE l.kod IN (SELECT DISTINCT r.kod_minzd FROm remains_tab r) ORDEr BY 3 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="159" Name="Отпущенные рецепты" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по аптекам и отпущенным рецептам\Отпущенные рецепты.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT lp.name, s.sklad,r.fam, r.nam, r.mid, name_med 
, r.kod_miznd , r.rezept_ser||' '||r.rezept_num as rezept, r.date_out, r.kat_lgot 
, r.kolvo, r.diagn_id, mround(r.kolvo)*mround(r.cost) as sum1  
FROm rezept_ap_tab r 
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn 
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id 
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:  
AND r.date_out &gt;= date(':period1_1_:')  
AND r.date_out &lt;= date(':period1_2_:')  
ORDEr BY 1,2,3,4,5,6   
--LIMIt 3000</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT SUM(mround(r.kolvo)), SUM(mround(r.kolvo)*mround(r.cost)) as sum1,  
COUNT(*) as count1  
FROm rezept_ap_tab r 
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd 
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn 
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id 
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:  
AND r.date_out &gt;= date(':period1_1_:') 
AND r.date_out &lt;= date(':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' r.sklad_id  = '||s.sklad_id::text||'', s.sklad, 1 FROM sklad_tab s  WHERe s.sklad_id IN (SELECT  r.sklad_id FROm rezept_ap_tab r)  ORDER BY 3,1 ASC </Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Врач" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT  ' r.pcod::text::int4 = '||f.pcod||' ',  f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') ', 1  FROm feldshers_tab f WHERe pcod IN   (SELECT  r.pcod FROm   rezept_ap_tab r)  ORDEr BY 3,2  </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата оптуска" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="ЛПУ" Type="select">
              <Sql>SELECT ' true ', 'Все'::text   UNION   SELECT ' r.c_ogrn = '||l.ogrn, l.name FROm lpu_tab l   WHERE l.ogrn In (SELECt  r.c_ogrn FROm rezept_ap_tab r)  ORDER BY 2   </Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Препарат" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, '0'  UNION  SELECT  ' r.kod_miznd = '||l.kod||' ', substr(TRIM(both '!' from   l.name_med),1,130), TRIM(both '!' from l.name_med) FROm lgot_preparat_tab l  WHERE l.kod IN (SELECT  r.kod_miznd FROm rezept_ap_tab r)  ORDEr BY 3 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="160" Name="Отпущенные препараты" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по аптекам и отпущенным рецептам\Отпущенные препараты.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT lp.name, s.sklad, trim(both '!' from l.name_med) as  name_med 
, r.kod_miznd , sum(mround(r.kolvo)) as kolvo, COUNT(*) as kovrez, 
SUM(mround(r.cost)*mround(r.kolvo)) as sum1 
FROm rezept_ap_tab r 
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd 
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn 
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id 
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:  
AND r.date_out &gt;= date(':period1_1_:') 
AND r.date_out &lt;= date(':period1_2_:') 
GROUP BY lp.name, s.sklad, trim(both '!' from l.name_med) 
, r.kod_miznd 
ORDEr BY 1,2,3,4,5,6   
LIMIt 3000</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT sum(mround(r.kolvo)) as kolvo, COUNT(*) as kovrez, 
SUM(mround(r.cost)*mround(r.kolvo)) as sum1 
FROm rezept_ap_tab r 
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd 
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn 
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id 
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_: AND :param4_1_:  
AND r.date_out &gt;= date(':period1_1_:')  
AND r.date_out &lt;= date(':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' r.sklad_id  = '||s.sklad_id::text||'', s.sklad, 1 FROM sklad_tab s  WHERe s.sklad_id IN (SELECT  r.sklad_id FROm rezept_ap_tab r)  ORDER BY 3,1 ASC </Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Врач " Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT  ' r.pcod::text::int4 = '||f.pcod||' ',  f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') ', 1  FROm feldshers_tab f WHERe pcod IN   (SELECT  r.pcod FROm   rezept_ap_tab r)  ORDEr BY 3,2   </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата отпуска" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="ЛПУ" Type="select">
              <Sql>SELECT ' true ', 'Все'::text   UNION   SELECT ' r.c_ogrn = '||l.ogrn, l.name FROm lpu_tab l   WHERE l.ogrn In (SELECt  r.c_ogrn FROm rezept_ap_tab r)  ORDER BY 2   </Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Препарат" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, '0'  UNION  SELECT  ' r.kod_miznd = '||l.kod||' ', substr(TRIM(both '!' from   l.name_med),1,130), TRIM(both '!' from l.name_med) FROm lgot_preparat_tab l  WHERE l.kod IN (SELECT  r.kod_miznd FROm rezept_ap_tab r)  ORDEr BY 3 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="161" Name="Затраты на ДЛО с разбивкой по аптекам и ЛПУ" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по аптекам и отпущенным рецептам\Затраты на ДЛО с разбивкой по аптекам и ЛПУ.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT lp.name, s.sklad, 
/*round(SUM(r.cost*r.kolvo)::numeric,2) as*/ 
SUM(mround(r.cost)*mround(r.kolvo)) as   sum1  
FROm rezept_ap_tab r  
LEFT JOIN lgot_preparat_tab l On l.kod =  r.kod_miznd  
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn  
LEFT JOIN sklad_tab s ON s.sklad_id =  r.sklad_id  
WHERe :param1_1_: AND :param2_1_:  ANd :param3_1_:  AND :param4_1_:   
AND r.date_out &gt;= date(':period1_1_:')  
AND r.date_out &lt;= date(':period1_2_:')  
GROUP BY lp.name, s.sklad 
 
ORDEr BY 1,2,3</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT /*round(SUM(r.cost*r.kolvo)::numeric,2)*/  
SUM(mround(r.cost)*mround(r.kolvo)) as   sum1  
FROm rezept_ap_tab r  
LEFT JOIN lgot_preparat_tab l On l.kod =  r.kod_miznd  
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn  
LEFT JOIN sklad_tab s ON s.sklad_id =  r.sklad_id  
WHERe :param1_1_: AND :param2_1_:  ANd :param3_1_:  AND :param4_1_:   
AND r.date_out &gt;= date(':period1_1_:')  
AND r.date_out &lt;= date(':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' r.sklad_id  = '||s.sklad_id::text||'', s.sklad, 1 FROM sklad_tab s  WHERe s.sklad_id IN (SELECT  r.sklad_id FROm rezept_ap_tab r)  ORDER BY 3,1 ASC </Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Врач" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT  ' r.pcod::text::int4 = '||f.pcod||' ',  f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') ', 1  FROm feldshers_tab f WHERe pcod IN   (SELECT  r.pcod FROm   rezept_ap_tab r)  ORDEr BY 3,2   </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="ЛПУ" Type="select">
              <Sql>SELECT ' true ', 'Все'::text   UNION   SELECT ' r.c_ogrn = '||l.ogrn, l.name FROm lpu_tab l   WHERE l.ogrn In (SELECt  r.c_ogrn FROm rezept_ap_tab r)  ORDER BY 2 </Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Препарат" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, '0'  UNION  SELECT  ' r.kod_miznd = '||l.kod||' ', substr(TRIM(both '!' from   l.name_med),1,130), TRIM(both '!' from l.name_med) FROm lgot_preparat_tab l  WHERE l.kod IN (SELECT  r.kod_miznd FROm rezept_ap_tab r)  ORDEr BY 3 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="162" Name="Отпущенные препараты с разбивкой по врачам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по аптекам и отпущенным рецептам\Отпущенные препараты с разбивкой по врачам.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT lp.name, f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') ' as vrach, trim(both  '!' from  l.name_med) as  name_med  
, r.kod_miznd , sum(mround(r.kolvo)) as kolvo, COUNT(*) as kovrez,  
SUM(mround(r.cost)*mround(r.kolvo)) as sum1  
FROm rezept_ap_tab r  
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd  
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn  
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id  
LEFT JOIN feldshers_tab f ON f.pcod = r.pcod  
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:   
AND r.date_out &gt;= date(':period1_1_:')  
AND r.date_out &lt;= date(':period1_2_:')  
GROUP BY lp.name,  f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') ', trim(both '!'  from  l.name_med) 
, r.kod_miznd 
ORDEr BY 1,2,3,4,5,6   
LIMIt 3000</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT sum(mround(r.kolvo)) as kolvo, COUNT(*) as kovrez, 
SUM(mround(r.cost)*mround(r.kolvo)) as sum1 
FROm rezept_ap_tab r  
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd 
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn 
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id 
LEFT JOIN feldshers_tab f ON f.pcod = r.pcod 
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_: AND :param4_1_:  
AND r.date_out &gt;= date(':period1_1_:') 
AND r.date_out &lt;= date(':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата отпуска" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' r.sklad_id  = '||s.sklad_id::text||'', s.sklad, 1 FROM sklad_tab s  WHERe s.sklad_id IN (SELECT  r.sklad_id FROm rezept_ap_tab r)  ORDER BY 3,1 ASC </Sql>
            </Parameter>
            <Parameter Name="param2" Caption="ЛПУ" Type="select">
              <Sql>SELECT ' true ', 'Все'::text   UNION   SELECT ' r.c_ogrn = '||l.ogrn, l.name FROm lpu_tab l   WHERE l.ogrn In (SELECt  r.c_ogrn FROm rezept_ap_tab r)  ORDER BY 2   </Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Препарат" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, '0'  UNION  SELECT  ' r.kod_miznd = '||l.kod||' ', substr(TRIM(both '!' from   l.name_med),1,130), TRIM(both '!' from l.name_med) FROm lgot_preparat_tab l  WHERE l.kod IN (SELECT  r.kod_miznd FROm rezept_ap_tab r)  ORDEr BY 3 </Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Врач " Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT  ' r.pcod::text::int4 = '||f.pcod||' ',  f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') ', 1  FROm feldshers_tab f WHERe pcod IN   (SELECT  r.pcod FROm   rezept_ap_tab r)  ORDEr BY 3,2   </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="163" Name="Отпущенные рецепты с разбивкой по врачам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по аптекам и отпущенным рецептам\Отпущенные рецепты с разбивкой по врачам.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT lp.name,  f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||doc.federal_code||') ' as vrach,r.fam,  r.nam, r.mid, trim(both '!' from l.name_med) as  name_med 
, r.kod_miznd , r.rezept_ser||' '||r.rezept_num as rezept, r.date_out, r.kat_lgot 
, r.kolvo, r.diagn_id, mround(r.kolvo)*mround(r.cost) as sum1  
FROm rezept_ap_tab r 
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd 
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn 
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id 
LEFT JOIN doctor_tab doc ON r.pcod = doc.federal_code 
LEFT JOIN full_doctor_tab f ON doc.doctor_id = f.doctor_id 
--feldshers_tab f ON f.pcod = r.pcod 
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:  
AND r.date_out &gt;= date(':period1_1_:')  
AND r.date_out &lt;= date(':period1_2_:')  
ORDER BY 1,2,3,4,5,9 
LIMIt 3000</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT SUM(mround(r.kolvo)), SUM(mround(r.kolvo)*mround(r.cost)) as sum1,   
COUNT(*) as count1   
FROm rezept_ap_tab r  
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd  
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn  
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id  
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:   
AND r.date_out &gt;= date(':period1_1_:')  
AND r.date_out &lt;= date(':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' r.sklad_id  = '||s.sklad_id::text||'', s.sklad, 1 FROM sklad_tab s  WHERe s.sklad_id IN (SELECT  r.sklad_id FROm rezept_ap_tab r)  ORDER BY 3,1 ASC </Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Врач" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT  ' text_to_int(r.pcod) = '||f.doctor_id||' ',   f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.doctor_id||') ', 1  FROm full_doctor_tab f  where f.doctor_id IN (SELECT distinct text_to_int(r.pcod) FROm   rezept_ap_tab r)   --feldshers_tab f WHERe pcod IN (SELECT  r.pcod FROm   rezept_ap_tab r)   ORDEr BY 3,2  </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата оптуска" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="ЛПУ" Type="select">
              <Sql>SELECT ' true ', 'Все'::text   UNION   SELECT ' r.c_ogrn = '||l.ogrn, l.name FROm lpu_tab l   WHERE l.ogrn In (SELECt  r.c_ogrn FROm rezept_ap_tab r)  ORDER BY 2   </Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Препарат" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, '0'  UNION  SELECT  ' r.kod_miznd = '||l.kod||' ', substr(TRIM(both '!' from   l.name_med),1,130), TRIM(both '!' from l.name_med) FROm lgot_preparat_tab l  WHERE l.kod IN (SELECT  r.kod_miznd FROm rezept_ap_tab r)  ORDEr BY 3 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="164" Name="Затраты на ДЛО с разбивкой по ЛПУ и врачам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по аптекам и отпущенным рецептам\Затраты на ДЛО с разбивкой по ЛПУ и врачам.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT lp.name, f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') ' as vrach,   
/*round(SUM(r.cost*r.kolvo)::numeric,2) as*/ 
SUM(mround(r.cost)*mround(r.kolvo)) as  sum1  
FROm rezept_ap_tab r  
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd  
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn  
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id  
LEFT JOIN feldshers_tab f ON f.pcod = r.pcod  
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:   
AND r.date_out &gt;= date(':period1_1_:')  
AND r.date_out &lt;= date(':period1_2_:')   
GROUP BY lp.name, f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') '  
 
ORDEr BY 3 DESC,1,2</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT /*round(SUM(r.cost*r.kolvo)::numeric,2)*/  
SUM(mround(r.cost)*mround(r.kolvo)) as  sum1  
FROm rezept_ap_tab r  
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd  
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn  
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id  
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:   
AND r.date_out &gt;= date(':period1_1_:')  
AND r.date_out &lt;= date(':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' r.sklad_id  = '||s.sklad_id::text||'', s.sklad, 1 FROM sklad_tab s  WHERe s.sklad_id IN (SELECT  r.sklad_id FROm rezept_ap_tab r)  ORDER BY 3,1 ASC </Sql>
            </Parameter>
            <Parameter Name="param2" Caption="ЛПУ" Type="select">
              <Sql>SELECT ' true ', 'Все'::text   UNION   SELECT ' r.c_ogrn = '||l.ogrn, l.name FROm lpu_tab l   WHERE l.ogrn In (SELECt  r.c_ogrn FROm rezept_ap_tab r)  ORDER BY 2 </Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Препарат" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, '0'  UNION  SELECT  ' r.kod_miznd = '||l.kod||' ', substr(TRIM(both '!' from   l.name_med),1,130), TRIM(both '!' from l.name_med) FROm lgot_preparat_tab l  WHERE l.kod IN (SELECT  r.kod_miznd FROm rezept_ap_tab r)  ORDEr BY 3 </Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Врач" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT  ' r.pcod::text::int4 = '||f.pcod||' ',  f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') ', 1  FROm feldshers_tab f WHERe pcod IN   (SELECT  r.pcod FROm   rezept_ap_tab r)  ORDEr BY 3,2   </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="165" Name="Отпущенные рецепты по льготнику (по СНИЛСу)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по аптекам и отпущенным рецептам\Отпущенные рецепты по льготнику (по СНИЛСу).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT lp.name, s.sklad,r.fam, r.nam, r.mid, trim(both '!' from l.name_med) as  name_med 
, r.kod_miznd , r.rezept_ser||' '||r.rezept_num as rezept, r.date_out, r.kat_lgot 
, r.kolvo, r.diagn_id, mround(r.kolvo)*mround(r.cost) as sum1  
FROm rezept_ap_tab r 
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd 
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn 
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id 
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:  
AND r.date_out &gt;= date(':period1_1_:')  
AND r.date_out &lt;= date(':period1_2_:')  
AND pens like ':param5_1_:%' 
ORDEr BY 9,1,2,3,4,5,6   
LIMIt 3000</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT SUM(mround(r.kolvo)), SUM(mround(r.kolvo)*mround(r.cost)) as sum1,  
COUNT(*) as count1  
FROm rezept_ap_tab r 
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd 
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn 
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id 
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:  
AND r.date_out &gt;= date(':period1_1_:') 
AND r.date_out &lt;= date(':period1_2_:') 
AND pens like ':param5_1_:%'</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' r.sklad_id  = '||s.sklad_id::text||'', s.sklad, 1 FROM sklad_tab s  WHERe s.sklad_id IN (SELECT  r.sklad_id FROm rezept_ap_tab r)  ORDER BY 3,1 ASC </Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Врач" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT  ' r.pcod::text::int4 = '||f.pcod||' ',  f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') ', 1  FROm feldshers_tab f WHERe pcod IN   (SELECT  r.pcod FROm   rezept_ap_tab r)  ORDEr BY 3,2  </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата оптуска" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="ЛПУ" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0    UNION   SELECT ' r.c_ogrn = '||l.ogrn, l.name, 1  FROm lpu_tab l   WHERE l.ogrn In (SELECt  r.c_ogrn FROm rezept_ap_tab r)  ORDER BY 3, 2   </Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Препарат" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, '0'  UNION  SELECT  ' r.kod_miznd = '||l.kod||' ', substr(TRIM(both '!' from   l.name_med),1,130), TRIM(both '!' from l.name_med) FROm lgot_preparat_tab l  WHERE l.kod IN (SELECT  r.kod_miznd FROm rezept_ap_tab r)  ORDEr BY 3 </Sql>
            </Parameter>
            <Parameter Name="param5" Caption="СНИЛС льготника" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="166" Name="Список льготников сумма отпущенных препаратов которых превысила указанную сумму" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по аптекам и отпущенным рецептам\Список льготников сумма отпущенных препаратов которых превысила указанную сумму.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT r.pens,r.fam, r.nam, r.mid,SUM(mround(r.kolvo)) as kolvo, SUM(mround(mround(r.kolvo)*mround(r.cost))) as sum1,  
COUNT(*) as count1  
FROm rezept_ap_tab r 
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd 
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn 
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id 
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:  
AND r.date_out &gt;= date(':period1_1_:') 
AND r.date_out &lt;= date(':period1_2_:') 
GROUP BY r.pens,r.fam, r.nam, r.mid 
HAVING SUM(mround(mround(r.kolvo)*mround(r.cost))) &gt; ':param5_1_:' 
ORDER BY 6 DESC, 2,3,4 
LIMIT 1000</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' r.sklad_id  = '||s.sklad_id::text||'', s.sklad, 1 FROM sklad_tab s  WHERe s.sklad_id IN (SELECT  r.sklad_id FROm rezept_ap_tab r)  ORDER BY 3,1 ASC </Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Врач" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT  ' r.pcod::text::int4 = '||f.pcod||' ',  f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') ', 1  FROm feldshers_tab f WHERe pcod IN   (SELECT  r.pcod FROm   rezept_ap_tab r)  ORDEr BY 3,2  </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата оптуска" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="ЛПУ" Type="select">
              <Sql>SELECT ' true ', 'Все'::text   UNION   SELECT ' r.c_ogrn = '||l.ogrn, l.name FROm lpu_tab l   WHERE l.ogrn In (SELECt  r.c_ogrn FROm rezept_ap_tab r)  ORDER BY 2   </Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Препарат" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, '0'  UNION  SELECT  ' r.kod_miznd = '||l.kod||' ', substr(TRIM(both '!' from   l.name_med),1,130), TRIM(both '!' from l.name_med) FROm lgot_preparat_tab l  WHERE l.kod IN (SELECT  r.kod_miznd FROm rezept_ap_tab r)  ORDEr BY 3 </Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Сумма" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="167" Name="Список льготников кол-во рецептов который превысило указанное кол-во" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по аптекам и отпущенным рецептам\Список льготников кол-во рецептов который превысило указанное кол-во.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT r.pens,r.fam, r.nam, r.mid,SUM(mround(r.kolvo)) as kolvo, SUM(mround(mround(r.kolvo)*mround(r.cost))) as sum1,  
COUNT(*) as count1  
FROm rezept_ap_tab r 
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_miznd 
LEFT JOIN lpu_tab lp On lp.ogrn = r.c_ogrn 
LEFT JOIN sklad_tab s ON s.sklad_id = r.sklad_id 
WHERe :param1_1_: AND :param2_1_: ANd :param3_1_:  AND :param4_1_:  
AND r.date_out &gt;= date(':period1_1_:') 
AND r.date_out &lt;= date(':period1_2_:') 
GROUP BY r.pens,r.fam, r.nam, r.mid 
HAVING COUNT(*)   &gt; ':param5_1_:' 
ORDER BY 7 DESC, 2,3,4 
LIMIT 1000</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' r.sklad_id  = '||s.sklad_id::text||'', s.sklad, 1 FROM sklad_tab s  WHERe s.sklad_id IN (SELECT  r.sklad_id FROm rezept_ap_tab r)  ORDER BY 3,1 ASC </Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Врач" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT  ' r.pcod::text::int4 = '||f.pcod||' ',  f.fam||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid)||' ('||f.pcod||') ', 1  FROm feldshers_tab f WHERe pcod IN   (SELECT  r.pcod FROm   rezept_ap_tab r)  ORDEr BY 3,2  </Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата оптуска" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param5" Caption="Кол-во рецептов &gt;" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="ЛПУ" Type="select">
              <Sql>SELECT ' true ', 'Все'::text   UNION   SELECT ' r.c_ogrn = '||l.ogrn, l.name FROm lpu_tab l   WHERE l.ogrn In (SELECt  r.c_ogrn FROm rezept_ap_tab r)  ORDER BY 2   </Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Препарат" Type="select">
              <Sql>SELECT ' true ', 'Все'::text, '0'  UNION  SELECT  ' r.kod_miznd = '||l.kod||' ', substr(TRIM(both '!' from   l.name_med),1,130), TRIM(both '!' from l.name_med) FROm lgot_preparat_tab l  WHERE l.kod IN (SELECT  r.kod_miznd FROm rezept_ap_tab r)  ORDEr BY 3 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="168" Name="Поиск препарата в аптеке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по аптекам и отпущенным рецептам\Поиск препарата в аптеке.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT s.sklad, trim(both '!' from l.name_med) as name_med, r.kolvo, 
round(r.cost::numeric,2) as cost,  r.date_time_mod,r.kod_minzd   
FROM remains_tab r 
LEFT JOIn sklad_tab s On s.sklad_id = r.sklad_id 
LEFT JOIN lgot_preparat_tab l On l.kod = r.kod_minzd 
WHERe :param1_1_: AND MYUPPER(l.name_med) like MYUPPER('%:param2_1_:%') 
ORDER BY 1 , 2 
LIMIT 3000</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Аптека" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION  SELECT ' r.sklad_id  = '||s.sklad_id::text||'', s.sklad, 1 FROM sklad_tab s  WHERe s.sklad_id IN (SELECT DISTINCT r.sklad_id FROm remains_tab r)  ORDER BY 3,1 ASC   </Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Препарат" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Отчеты по участкам">
      <Reports>
        <Report Id="42" Name="Поло-возрастной состав прикрепленного населения по участкам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по участкам\Поло-возрастной состав прикрепленного населения по участкам.xls">
          <Queries>
            <Query>
              <Sql>zapros select distinct case when ':param1_1_:'='uchactok_id&gt;=0' then 'по всему ЛПУ' else uchactok end 
from uchactok_tab u where :param1_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT uch1.uchactok, * FROM (SELECT  uchactok_id, uchactok,  
'uchactok_id = '||uchactok_id::text as uch11  
FROM uchactok_tab u UNION SELECT  5000, 'Итого'::text, 'true') as uch1 
LEFT JOIN (SELECT 'м'::text as sex1 UNION  SELECT 'ж'::text) as pol1 ON pol1.sex1 =  pol1.sex1 
WHERE :param1_1_: 
ORDER BY uchactok_id, uch1.uchactok,  sex1 DESC</Sql>
            </Query>
            <Query>
              <Sql>zapros2(let1,let2) SELECT 
 
count(distinct dan_id) 
FROm dan_tab d --, settings_tab s 
WHERE :uch11: AND sex = ':sex1:' AND   
get_vozrast(date_born) &gt;= let1 AND  get_vozrast(date_born) &lt;= let2 
--and s.name='LPU_ID' 
and spolref::int4 in (select * from get_all_lpu_numbers()) 
and :param2_1_: and :param3_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT get_vozrast(d.date_born) as vozrast, 
sum(case when d.sex='м' then 1 else 0 end) as cnt_m, sum(case when d.sex='ж' then 1 else 0 end) as cnt_f, count(d.dan_id) as p1 
FROM dan_tab d --uchactok_tab u 
--LEFT JOIN dan_tab d ON d.uchactok_id =  u.uchactok_id  AND d.:param1_1_: 
--and spolref::int4 in (select * from get_all_lpu_numbers()) 
where d.strcom_id is not null 
and :param2_1_: and :param3_1_: 
group by 1 
--having DATE_PART('year',AGE(now(), date_born)) is not null 
order by 1</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECT sum(case when d.sex='м' then 1 else 0 end) as cnt_m, sum(case when d.sex='ж' then 1 else 0 end) as cnt_f, count(d.dan_id) as p1 
FROM uchactok_tab u 
LEFT JOIN dan_tab d ON d.uchactok_id =  u.uchactok_id AND  d.:param1_1_: 
and spolref::int4 in (select * from get_all_lpu_numbers()) 
and :param2_1_: and :param3_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Прикреплен" Type="select">
              <Sql>select 'spolref::int4 in (select * from get_all_lpu_numbers())', 'да' ,0  union  select 'true', 'нет', 1 union select 'sstomref::int4 in (select * from get_all_lpu_numbers())', 'к стоматологии' ,2 union select 'swconref::int4 in (select * from get_all_lpu_numbers())', 'к женской консультации' ,3 order by 3</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Состояние пациента" Type="select">
              <Sql>select 'true', 'Любое', 0 union select 'd.life='||sp_patient_state_id, sp_patient_state, 1 from sp_patient_state_tab order by 3,1</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Участок" Type="select">
              <Sql> SELECT uchtext, uchactok  FROm   (SELECT ' uchactok_id = '||uchactok_id::text as uchtext, uchactok,   uchactok_id FROM uchactok_tab u UNION SELECT 'uchactok_id&gt;=0' , 'ЛПУ'::text, -1) as uch  ORDER BY uch.uchactok_id </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="56" Name="Паспорт участка (Форма 030-П/у)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по участкам\Паспорт участка (Форма 030-П_у).xls">
          <Queries>
            <Query>
              <Sql>lpu_address select value from settings_tab where name ='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name = 'LPU'</Sql>
            </Query>
            <Query>
              <Sql>ogrn SELECT value FROm settings_tab WHERE UPPER(trim(name))  = 'OGRN'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT '$id' as id,d.fam||' '||d.nam||' '||conv_to_null(d.mid) as fio,/*q.row_number, */ 
r.snils, case when length(r.kod_lgot)&lt;3 then '9'||r.kod_lgot else r.kod_Lgot end as kod_lgot, r.rezept_ser, r.rezept_num, r.date_vipiski,  r.diagn_id, 
r.kol, trunc(ra.kolvo::numeric,2) as kol_ap, trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap, d.ser_pol, d.num_pol, d.date_born, m.mkb, d.dan_id, 
l.name_med, ra.name_med as name_med_ap , s.sklad, ra.date_out 
 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
/*left join 
(SELECT row_number, oldtable.* 
FROM (SELECT rezept_id FROM dan_tab d 
left join rezept_tab r ON r.dan_id = d.dan_id 
where  :param2_1_: AND :param5_1_: between date(':param1_1_: ') and  date(':param1_2_: ') 
and :param3_1_:  AND not r.bad order by d.fam,d.nam,d.mid) As oldtable 
CROSS JOIN (SELECT ARRAY(SELECT rezept_id  
        FROM dan_tab d 
left join rezept_tab r ON r.dan_id = d.dan_id 
where  :param2_1_: AND :param5_1_: between date(':param1_1_: ') and  date(':param1_2_: ') 
and :param3_1_:  AND not r.bad order by d.fam,d.nam,d.mid 
        ) As id)  AS oldids 
CROSS JOIN generate_series(1, (SELECT COUNT(*) 
                    FROM dan_tab d 
left join rezept_tab r ON r.dan_id = d.dan_id  
where  :param2_1_: AND :param5_1_: between date(':param1_1_: ') and  date(':param1_2_: ') 
and :param3_1_:  AND not r.bad)) AS row_number 
WHERE oldids.id[row_number] =  oldtable.rezept_id 
) q ON q.rezept_id = r.rezept_id */ 
 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND trim(leading '0' FROM ra.rezept_num)  = trim(leading '0' FROM r.rezept_num ) 
LEFT JOIN talon_tab t ON t.talon_id = r.talon_id 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
/*--LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls */ 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN mkb_tab m ON m.kod_d = r.diagn_id 
 
WHERE  :param2_1_: AND :param5_1_: between date(':param1_1_: ') and  date(':param1_2_: ') 
and :param3_1_: and :param4_1_: AND not r.bad and :prik_1_: 
and (r.doctor_id = :param6_1_: or :param6_1_:=-1) 
order by 3,2</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT 
case when d.date is null then '0' else to_char(d.date,'dd.mm.yyyy') end as date_vz, 
case when d.date_sn is null then '0' else to_char(d.date_sn,'dd.mm.yyyy') end as date_sn , d.date, d.date_sn as dt_sn 
FROm dispan_uchet_tab d 
WHERe d.dan_id = :dan_id: AND d.diagn_id = ':diagn_id:'  AND (d.dispan_uchet_id = 
(SELECT max(d1.dispan_uchet_id) FROm dispan_uchet_tab d1 
WHERe d.dan_id = d1.dan_id AND d.diagn_id = d1.diagn_id 
) OR d.date_sn IS NULL) 
UNION 
SELECT '0','0' , NULL, NULL 
ORDEr BY 3 desc nulls last 
LIMIT 1</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT COUNT(DISTINCT v.visit_id) FROM talon_tab t 
LEFT JOIN rezept_tab r On r.talon_id = t.talon_id 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
LEFT JOIN diagn_tab diag On diag.talon_id = t.talon_id 
WHERe :param5_1_: &gt;= date(':param1_1_:') 
AND :param5_1_: &lt;= date(':param1_2_:') 
AND diag.diagn_osn = ':diagn_id:' AND t.dan_id = :dan_id: 
and (r.doctor_id = :param6_1_: or :param6_1_:=-1)</Sql>
            </Query>
            <Query>
              <Sql>zapros4 select distinct case when :param6_1_:=-1 then 'Все врачи' else fio end from full_doctor_tab where (full_doctor_id=:param6_1_: or :param6_1_:=-1)</Sql>
            </Query>
            <Query>
              <Sql>zapros5 SELECT CASE WHEN SUM(naznacheno::integer) is null THEN '0' 
ELSE SUM(naznacheno::integer)::text END 
 FROM kurort_tab WHERE dan_id = :dan_id: AND date BETWEEN ':param1_1_:' AND ':param1_2_:'</Sql>
            </Query>
            <Query>
              <Sql>zapros6 SELECT CASE WHEN SUM(proshel::integer) is null THEN '0' 
ELSE SUM(proshel::integer)::text END 
FROM kurort_tab WHERE dan_id = :dan_id: AND date BETWEEN ':param1_1_:' AND ':param1_2_:'</Sql>
            </Query>
            <Query>
              <Sql>zapros7 select distinct case when :param6_1_:=-1 then 'Все специалисты' else dolg_doctor end from full_doctor_tab where (full_doctor_id=:param6_1_: or :param6_1_:=-1)</Sql>
            </Query>
            <Query>
              <Sql>zapros8 select distinct  case when :param6_1_:=-1 and ':param2_1_:'='true' then 'Неопределено' else 
(case when ':param2_1_:'='true' then 'Все участки' else u.name end) end from codifiers.uchactok_tab u  left join dan_tab d ON d.uchactok_id = u.id 
where (doctor_id = :param6_1_: or :param6_1_:=-1) and :param2_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros9 select count(fio), sum(summa_ap) as summ_ap, sum(kol_ap) as koll_ap from ( 
SELECT '$id' as id,d.fam||' '||d.nam||' '||conv_to_null(d.mid) as fio, 
r.snils, case when length(r.kod_lgot)&lt;3 then '9'||r.kod_lgot else r.kod_Lgot end as kod_lgot, r.rezept_ser, r.rezept_num, r.date_vipiski,  r.diagn_id, 
r.kol, trunc(ra.kolvo::numeric,2) as kol_ap, trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap, d.ser_pol, d.num_pol, d.date_born, m.mkb, d.dan_id, 
l.name_med, ra.name_med as name_med_ap , s.sklad, ra.date_out 
 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND trim(leading '0' FROM ra.rezept_num)  = trim(leading '0' FROM r.rezept_num ) 
LEFT JOIN talon_tab t ON t.talon_id = r.talon_id 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
/*--LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls */ 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN mkb_tab m ON m.kod_d = r.diagn_id 
 
WHERE  :param2_1_: AND :param5_1_: between date(':param1_1_: ') and  date(':param1_2_: ') 
and :param3_1_: and :param4_1_: AND not r.bad and :prik_1_: 
and (r.doctor_id = :param6_1_: or :param6_1_:=-1) ) qw 
 
/*select count(fio), sum(summa_ap) as summ_ap, sum(kol_ap) as koll_ap from ( 
SELECT '$id' as id,d.fam||' '||d.nam||' '||conv_to_null(d.mid) as fio, 
r.snils, r.kod_lgot, r.rezept_ser, r.rezept_num, r.date_vipiski,  r.diagn_id, 
r.kol, trunc(ra.kolvo::numeric,2) as kol_ap, trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap, d.ser_pol, d.num_pol, d.date_born, m.mkb, d.dan_id, 
l.name_med, ra.name_med as name_med_ap , s.sklad, ra.date_out 
 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND ra.rezept_num  = r.rezept_num 
LEFT JOIN talon_tab t ON t.talon_id = r.talon_id 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
/*--LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls */ 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN mkb_tab m ON m.kod_d = r.diagn_id 
WHERE  :param2_1_: AND :param5_1_: between date(':param1_1_: ') and  date(':param1_2_: ') 
and :param3_1_: and :param4_1_: AND not r.bad 
and (r.doctor_id = :param6_1_: or :param6_1_:=-1) ) q*/</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param4" Caption="" Type="select">
              <Sql>SELECT ' true ', 'Все'::text,0  UNION  SELECT 'ra.name_med is not null ', 'Только отпущенные'::text,1  UNION  SELECT ' ra.name_med is null ', 'Только не отпущенные'::text,2 order by 3   </Sql>
            </Parameter>
            <Parameter Name="param6" Caption="Врач" Type="select">
              <Sql>select -1, 'Все', 0 union SELECT full_doctor_id, full_fio,1 FROM full_doctor_view where expiration_date&gt;=now() ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Генерировать по" Type="select2">
              <Sql>r.date_vipiski=Дате выписки рецепта|t.data_vnes_inf=Дате внесения талона|r.dt_vnes_rezept=Дате внесения рецепта</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Дата выписки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Льгота" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text , 0 UNION  SELECT 'length(trim(r.kod_lgot)) = 3'::text, 'Федеральная'::text , 1 UNION  SELECT 'length(trim(r.kod_lgot)) = 2'::text, 'Местная'::text , 2 ORDER BY 3</Sql>
            </Parameter>
            <Parameter Name="prik" Caption="Прикреплен" Type="select">
              <Sql>select '(d.spolref::int8 in (select * from get_all_lpu_numbers()))', 'Да', 0 union  select 'true', 'Все', 1 order by 2</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true', 'Все'::text,-1 UNION SELECT ' d.uchactok_id = '||uchactok_id::text , uchactok,uchactok_id FROM uchactok_tab  ORDER BY 3;</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="190" Name="Распределение населения по участкам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по участкам\Распределение населения по участкам.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT s.uchactok, count(d.dan_id) as p1 
FROM uchactok_tab s 
LEFT JOIN dan_tab d ON d.uchactok_id =  s.uchactok_id AND d.prikreplen = 1 AND :param1_1_: 
GROUP BY s.uchactok,s.uchactok_id ORDER BY  s.uchactok_id;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Пациент" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0 UNION SELECT 'd.life = '||sp_patient_state_id::text, sp_patient_state, 1 FROm sp_patient_state_tab  ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="120010" Name="Паспорт участка (форма 030/У)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по участкам\Паспорт участка (форма 030_У).xls">
          <Queries>
            <Query>
              <Sql>amb_lech(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE d.uchactok_id = :uch_1_: AND d.prikreplen = 1 AND t.data_vnes_inf BETWEEN date(':otchet_date_1_:') - interval '1 year' AND date(':otchet_date_1_:') AND t.result_id IS NOT NULL AND t.result_id &lt;10 AND usl</Sql>
            </Query>
            <Query>
              <Sql>consultations(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE v.data_vnes_inf BETWEEN date(':otchet_date_1_:') - interval '1 year' AND date(':otchet_date_1_:') AND d.prikreplen = 1 AND d.uchactok_id = :uch_1_: AND v.target_pos_id = 2 AND usl</Sql>
            </Query>
            <Query>
              <Sql>count_privs(usl) SELECT CASE WHEN count(DISTINCT p.priviv_id) &gt; 0 THEN count(DISTINCT p.priviv_id)::text ELSE '' END FROM dan_tab d 
LEFT JOIN priviv_tab p ON p.dan_id = d.dan_id 
WHERE d.uchactok_id = :uch_1_: AND p.date_priviv BETWEEN date(':otchet_date_1_:') - interval '1 year' AND date(':otchet_date_1_:') AND d.prikreplen = 1 AND usl</Sql>
            </Query>
            <Query>
              <Sql>day_stacionar(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE d.uchactok_id = :uch_1_: AND t.data_vnes_inf BETWEEN date(':otchet_date_1_:') - interval '1 year' AND date(':otchet_date_1_:') AND  t.result_id =5 AND d.prikreplen = 1  AND usl</Sql>
            </Query>
            <Query>
              <Sql>disp_this_year(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON disp.dan_id = d.dan_id 
WHERE disp.date_sn IS NULL AND disp.date BETWEEN 
date(':otchet_date_1_:') - interval '1 year' AND date(':otchet_date_1_:') AND d.uchactok_id = :uch_1_: AND d.prikreplen = 1  AND usl;</Sql>
            </Query>
            <Query>
              <Sql>disp_total(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
WHERE date_sn IS NULL AND d.uchactok_id = :uch_1_: AND d.prikreplen = 1 AND usl;</Sql>
            </Query>
            <Query>
              <Sql>fed_lgota(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END   FROM dan_tab d 
LEFT JOIN fed_lgota_tab fl ON fl.dan_id = d.dan_id AND fl.pens&lt;&gt;'XXX-XXX-XXX XX' AND fl.pens &lt;&gt; 'ОТКАЗ ОТ ДЛО!' 
LEFT JOIN dispan_uchet_tab disp ON disp.dan_id = d.dan_id AND date_sn IS NULL 
WHERE fl.date_born IS NOT NULL AND d.uchactok_id = :uch_1_: AND d.life = 0 AND d.prikreplen = 1 AND usl;</Sql>
            </Query>
            <Query>
              <Sql>inval_1gr(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM dan_tab d 
LEFT JOIN dispan_uchet_tab disp ON disp.dan_id = d.dan_id AND date_sn IS NULL 
WHERE d.uchactok_id = :uch_1_: AND d.life = 0 AND d.inval_id =1 AND d.prikreplen = 1 AND usl;</Sql>
            </Query>
            <Query>
              <Sql>inval_2gr(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM dan_tab d 
LEFT JOIN dispan_uchet_tab disp ON disp.dan_id = d.dan_id AND date_sn IS NULL 
WHERE d.uchactok_id = :uch_1_: AND d.life = 0 AND d.inval_id =2 AND d.prikreplen = 1 AND usl;</Sql>
            </Query>
            <Query>
              <Sql>inval_3gr(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM dan_tab d 
LEFT JOIN dispan_uchet_tab disp ON disp.dan_id = d.dan_id AND date_sn IS NULL 
WHERE d.uchactok_id = :uch_1_: AND d.life = 0 AND d.inval_id =3 AND d.prikreplen = 1 AND usl;</Sql>
            </Query>
            <Query>
              <Sql>inval_total(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM dan_tab d 
LEFT JOIN dispan_uchet_tab disp ON disp.dan_id = d.dan_id AND date_sn IS NULL 
WHERE d.uchactok_id = :uch_1_: AND d.life = 0 AND d.inval_id BETWEEN 1 AND 4 AND d.prikreplen = 1 AND usl;</Sql>
            </Query>
            <Query>
              <Sql>local_lgota(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM dan_tab d 
LEFT JOIN dispan_uchet_tab disp ON disp.dan_id = d.dan_id AND disp.lgota_id IS NOT NULL  AND date_sn IS NULL 
WHERE disp.dispan_uchet_id IS NOT NULL AND d.uchactok_id = :uch_1_: AND d.life = 0 AND d.prikreplen = 1 AND usl;</Sql>
            </Query>
            <Query>
              <Sql>san_kur(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END from kurort_tab k 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
WHERE d.uchactok_id = :uch_1_: AND k.date BETWEEN date(':otchet_date_1_:') - interval '1 year' AND date(':otchet_date_1_:') AND d.prikreplen = 1 AND usl</Sql>
            </Query>
            <Query>
              <Sql>stacionar_lech(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE d.uchactok_id = :uch_1_: AND t.data_vnes_inf BETWEEN date(':otchet_date_1_:') - interval '1 year' AND date(':otchet_date_1_:') AND d.prikreplen = 1 AND t.result_id =7  AND usl</Sql>
            </Query>
            <Query>
              <Sql>total_uch(usl) SELECT CASE WHEN count(DISTINCT d.dan_id) &gt; 0 THEN count(DISTINCT d.dan_id)::text ELSE '' END FROM dan_tab d 
LEFT JOIN dispan_uchet_tab disp ON disp.dan_id = d.dan_id AND date_sn IS NULL 
WHERE d.uchactok_id = :uch_1_: AND d.life = 0 AND d.prikreplen = 1 AND usl;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otchet_date" Caption="Дата" Type="date">
              <Sql />
            </Parameter>
            <Parameter Name="uch" Caption="Участок" Type="select">
              <Sql>SELECT uchactok_id, uchactok FROM uchactok_tab ORDER BY uchactok_id;</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="500010" Name="Количество прикрепленного населения по адресам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по участкам\Количество прикрепленного населения по адресам.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select distinct u.uchactok , d.street_id, 
trim(conv_to_null(st.socr||'. ')||st.name||', '||conv_to_null('д. '||d.dom)||conv_to_null('/'||d.korp),'. ') as adr, 
COUNT(distinct d.dan_id) as count1 
from uchactok_tab u 
left join dan_tab d On u.uchactok_id = d.uchactok_id  and prikreplen=1 and :param2_1_: 
left join codifiers.sp_street_tab st ON d.street_id = st.code 
where :param1_1_: 
group by 1 ,2,3 
 
/*select u.uchactok , d.street_id, 
trim(conv_to_null(st.socr||'. ')||st.name||', '||conv_to_null('д. '||d.dom)||conv_to_null('/'||d.korp),'. ') as adr , 
COUNT(distinct d.dan_id) as count1 
from dan_tab d 
left join uchactok_tab u On u.uchactok_id = d.uchactok_id 
left join codifiers.sp_street_tab st ON d.street_id = st.code 
where prikreplen=1 and d.life&lt;&gt;1 
AND :param1_1_: 
group by 1,2,3*/</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Пациент" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0 UNION SELECT 'd.life = '||sp_patient_state_id::text, sp_patient_state, 1 FROm sp_patient_state_tab  ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Участок" Type="select">
              <Sql>SELECT ' true '::text,'Все'::text, 0 UNION SELECT ' d.uchactok_id = '||u.uchactok_id::text::int4, u.uchactok, 1 FROm uchactok_tab u ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2024703000" Name="Численность прикрепленного населения" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по участкам\Численность прикрепленного населения.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select sub.s1,sub.s2,sub.s3,sum(sub.p1) as p1,sum(sub.p2) as p2,sum(sub.p3) as p3,sum(sub.p5) as p5 
from ( 
SELECT distinct on (d.dan_id) COALESCE(k1.name,'')||' '||COALESCE(k1.socr,'')||'  '|| 
COALESCE(k3.socr,'')||'  '||COALESCE(k3.name,a.text_address) as s1, 
    COALESCE(s.name,'') as s2, 
    COALESCE(a.house_number::varchar,'')||' '||COALESCE(a.building,'') as s3, 
    sum(case when get_vozrast(d.date_born) between 0 and 14 then 1 else 0 end) as p1, 
    sum(case when get_vozrast(d.date_born) between 15 and 17 then 1 else 0 end) as p2, 
    sum(case when get_vozrast(d.date_born) &gt; 18 then 1 else 0 end) as p3, 
    
    sum(case when (get_vozrast(d.date_born) between 15 and 49 and d.sex='ж') 
    		then 1 else 0 end) as p5 
    FROM dan_tab d 
	LEFT JOIN address_tab a ON a.dan_id = d.dan_id 
	LEFT JOIN codifiers.sp_kladr_tab k1 ON rpad(substring(a.street_id for 2),13,'0') = k1.code 
	LEFT JOIN codifiers.sp_kladr_tab k3 ON rpad(substring(a.street_id for 8),13,'0') = k3.code 
	LEFT JOIN codifiers.sp_street_tab s ON s.code = a.sp_street_code 
	WHERE d.spolref::int8 in (select * from get_all_lpu_numbers()) and a.sp_addr_type_id=:param2_1_: 
     and :param1_1_: and (d.date_smerti is null or d.life=0) 
    group by d.dan_id,1,2,3) as sub 
group by 1,2,3 
order by 1,2,3</Sql>
            </Query>
            <Query>
              <Sql>zapros2 select case when :param2_1_:=1 then 'по адресу по прописке' else 'по фактическому адресу' end</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Участок прикрепления" Type="select">
              <Sql>select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Формировать по " Type="select2">
              <Sql>1=адресу по прописке||0=фактическому адресу</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2030503000" Name="Адреса по участкам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по участкам\Адреса по участкам.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select  u.name as uchastok,conv_to_null(trim(street.socr)||'. '||trim(street.name)||' ') as street, 
    case when (join_str(s1.doma_chet) is null or join_str(s1.doma_chet)='') 
    	then join_str(s1.doma_nechet) 
    	when (join_str(s1.doma_nechet) is null or join_str(s1.doma_nechet)='') 
    	then join_str(s1.doma_chet) 
    	else join_str(s1.doma_chet)||', '||COALESCE(join_str(s1.doma_nechet),'') end as doma 
from  ( 
select m1.uchactok_id as uchactok_id, m1.street_code as street_code, 
case when m1.even_from=m1.even_for 
then join_str(m1.even_from||case when m1.korp is not null then '/'||m1.korp ELSE '' end) else 
join_str(m1.even_from||case when m1.korp is not null then '/'||m1.korp ELSE '' end 
||' - '||m1.even_for||case when m1.korp is not null then '/'||m1.korp ELSE '' end) end as doma_chet, 
case when m1.odd_from=m1.odd_for 
then join_str(m1.odd_from::text||case when m1.korp is not null then '/'||m1.korp ELSE '' end) else 
join_str(m1.odd_from||case when m1.korp is not null then '/'||m1.korp ELSE '' end||' - ' 
||m1.odd_for||case when m1.korp is not null then '/'||m1.korp ELSE '' end) end as doma_nechet 
from codifiers.sp_street_tab s 
left join mapping_uchactok_tab m1 on m1.street_code=m1.street_code 
where  s.code=m1.street_code 
and :uch_1_: 
group by 1,2,m1.even_from,m1.even_for,m1.odd_from,m1.odd_for 
order by 3,4 
) as s1 
left join codifiers.sp_street_tab street on street.code=s1.street_code 
left join codifiers.uchactok_tab u on u.id=s1.uchactok_id 
group by 1,2,u.id 
order by u.id,3,2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="uch" Caption="Участок" Type="select">
              <Sql>select 'true','Все',0,0 union select 'm1.uchactok_id='||id,name,1,id from codifiers.uchactok_tab order by 3,4</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Отчеты по флюорографии">
      <Reports>
        <Report Id="104" Name="Распределение пациентов прошедших флюорографию по группам риска" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Распределение пациентов прошедших флюорографию по группам риска.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select gr_risk, count(*) as param_1_1_, gr_risk_tab.gr_risk_id as param_1_2_ from  dan_tab d 
 left join gr_risk_tab on gr_risk_tab.gr_risk_id = d.risk_id 
 where gr_risk is not null AND :param1_1_: 
 group by gr_risk, gr_risk_tab.gr_risk_id order by gr_risk</Sql>
            </Query>
            <Query>
              <Sql>zapros2 select count(*), count(*) as param_1_1_ from dan_tab d 
 left join gr_risk_tab on gr_risk_tab.gr_risk_id=d.risk_id 
 where gr_risk is not null 
  AND :param1_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT count(*), round((count(*)*100/:param_1_1_:),2) as param_2_1_ from dan_tab d 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
where risk_id=:param_1_2_: and /*date_fluog*/ fluo.date_analisis between date(':period_1_1_:') and  date(':period_1_2_:') 
 AND :param1_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECT count(*), round((count(*)*100/:param_1_1_:),2) as param_2_1_ from dan_tab d 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
where risk_id is not null and /*date_fluog*/ fluo.date_analisis between date(':period_1_1_:') and  date(':period_1_2_:') 
 AND :param1_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Участок" Type="select">
              <Sql>SELECT 'true'::text, 'все'::text, 0 UNION SELECT 'd.uchactok_id = '||u.id::text,u.name, 1 FROm codifiers.uchactok_tab u ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="106" Name="Список пациентов прошедших флюорографию" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Список пациентов прошедших флюорографию.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select distinct '$id', d.fam||' '||d.nam||' '||d.mid as param_1_1_, d.address as param_1_2_,risk.name as param_1_5_, uchactok as param_1_3_, d.date_born, /*'№ '||analisis_number||' от '||*/to_char(fluo.date_analisis,'dd.mm.yyyy') as param_1_4_, /*sn.name,*/ o.nam_otdel, 
(SELECT date_analisis 
FROM researches.fluorography_tab fluo 
WHERE d.dan_id = fluo.dan_id 
ORDER BY date_analisis DESC OFFSET 1 LIMIT 1) as date_pred_osmotr 
from dan_tab d 
 left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
--LEFT JOIN codifiers.reexam_source_tab sn ON sn.id = fluo.reexam_source 
LEFT JOIN codifiers.uchactok_tab u1 ON d.uchactok_id = u1.id  LEFT JOIN codifiers.gr_risk_tab risk ON d.risk_id =risk.id 
left join otdel_tab o on o.otdel=u1.otdel_id 
 where fluo.date_analisis between date(':period_1_1_:') and date(':period_1_2_:') 
AND d.dan_id IN 
(SELECT dan_id FROM researches.fluorography_tab 
GROUP BY dan_id 
HAVING max(date_analisis) between date(':period_1_1_:') and date(':period_1_2_:') 
AND count(id) &gt; 1) 
 :period_2_1_: 
 order by param_1_1_</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>(select 'and d.uchactok_id='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="156" Name="Кол-во пациентов прошедших флюорографию (по участкам)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Кол-во пациентов прошедших флюорографию (по участкам).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT u.uchactok, COUNT(d.dan_id) as kolvo, u.uchactok_id 
FROM dan_tab d 
 LEFT JOIN uchactok_tab u On u.uchactok_id = d.uchactok_id 
left join researches.fluorography_tab f on f.dan_id=d.dan_id 
 WHERe :param1_1_: AND d.date_fluog &gt;= date(':period1_1_:') 
 AND d.date_fluog &lt;= date(':period1_2_:') 
and :ist_f_1_: 
 GROUP BY u.uchactok, u.uchactok_id 
 ORDEr BY u.uchactok_id</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT COUNT(d.dan_id) as kolvo FROM dan_tab d 
 LEFT JOIN uchactok_tab u On u.uchactok_id = d.uchactok_id 
 WHERe :param1_1_: AND d.date_fluog &gt;= date(':period1_1_:') 
 AND d.date_fluog &lt;= date(':period1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="" Type="select">
              <Sql>SELECT 'true', 'Все'::text UNION SELECT 'd.spolref::int8 in (select * from get_all_lpu_numbers())', 'Прикрепленные'::text</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="ist_f" Caption="Источник финансирования" Type="select">
              <Sql>select 'true'::text, 'Все',0 union select 'f.sp_kind_paid_id='||vid_oplat_tab.vid_oplat_id,vid_oplat_tab.nam_oplat,1 from vid_oplat_tab  order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="9803000" Name="Отчёт по противотуберкулёзной работе" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Отчёт по противотуберкулёзной работе.xls">
          <Queries>
            <Query>
              <Sql>count_all select count(*) 
from researches.fluorography_tab fluo 
LEFT JOIN dan_tab d ON d.dan_id = fluo.dan_id 
left join naprav_tab n ON n.id = fluo.naprav_id 
left join visit_tab v ON v.talon_id = n.talon_id 
where v.target_pos_id = 4 ---профосмотр 
and fluo.date_analisis between ':param1_1_:' and ':param1_2_:' 
AND :param2_1_:</Sql>
            </Query>
            <Query>
              <Sql>count_vuz_all select count(*) 
from researches.fluorography_tab fluo 
left join naprav_tab n ON n.id = fluo.naprav_id 
LEFT JOIN dan_tab d ON fluo.dan_id = d.dan_id 
left join visit_tab v ON v.talon_id = n.talon_id 
where v.target_pos_id = 4 ---профосмотр 
and fluo.date_analisis between ':param1_1_:' and ':param1_2_:' 
and d.kod_vuz is not null 
AND :param2_1_:</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true'::text, 'все'::text, 0 UNION SELECT 'd.uchactok_id = '||u.id::text,u.name, 1 FROm codifiers.uchactok_tab u ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008203000" Name="Журнал регистрации флюорообследований" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Журнал регистрации флюорообследований.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT '$id', d.fio, d.date_born,d.address, m.mest_work, f.analisis_number, 
 f.date_analisis, fv1.name as result_1, fv2.name as result_2,  fp.name as target_pos, 
rs.name as p1 
 FROm researches.fluorography_tab f 
LEFT JOIN codifiers.fluorography_visit_purpose_tab fp On fp.id = f.fluorography_visit_purpose_id 
LEFT JOIN codifiers.fluorography_values_tab fv1 ON fv1.id = f.result1 
LEFT JOIN codifiers.fluorography_values_tab fv2 ON fv2.id = f.result2 
LEFT JOIN dan_tab d On d.dan_id = f.dan_id 
LEFT JOIN mest_work_tab m On m.mest_work_id = d.mesto_work_id 
LEFT JOIN codifiers.uchactok_tab u ON d.uchactok_id = u.id 
left join codifiers.reexam_source_tab rs on rs.id=f.exam_source 
WHERE f.date_analisis BETWEEN ':param1_1_:' AND ':param1_2_:' 
AND :param2_1_: 
and :param6_1_: 
and (':param3_1_:'='-1' or u.otdel_id = ':param3_1_:') 
order by 2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param6" Caption="Место проведения" Type="select">
              <Sql>select 'true','ВСЕ',0 union select 'f.exam_source='||id,name,1 from codifiers.reexam_source_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Отделение" Type="select">
              <Sql>select '-1', 'Все отделения',0 union select otdel, nam_otdel,1 from otdel_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true'::text, 'все'::text, 0 UNION SELECT 'd.uchactok_id = '||u.id::text,u.name, 1 FROm codifiers.uchactok_tab u ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008303000" Name="Журнал дообследований" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Журнал дообследований.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT '$id', sn.name as sn_name, d.fio, d.date_born,d.address, m.mest_work, f.analisis_number, 
 f.date_analisis, /*fv.name*/ reexam_result,  fp.name as target_pos , reexam_date, 
/*trim(conv_to_null(f.diagnosis_date::text)||', '||conv_to_null(mkb.mkb),', ')*/ /* trim(conv_to_null(f.diagnosis_date::text)||', '||conv_to_null(approved_diagnosis),', ') as date_ds */ 
f.diagnosis_date, f.result as approved_diagnosis 
 FROm researches.fluorography_tab f 
LEFT JOIN codifiers.fluorography_visit_purpose_tab fp On fp.id = f.fluorography_visit_purpose_id 
LEFT JOIN codifiers.fluorography_values_tab fv ON fv.id = f.result2 
LEFT JOIN dan_tab d On d.dan_id = f.dan_id 
LEFT JOIN mest_work_tab m On m.mest_work_id = d.mesto_work_id 
LEFT JOIN mkb_tab mkb ON f.approved_diagnosis=mkb.kod_d 
LEFT JOIN codifiers.uchactok_tab u ON d.uchactok_id = u.id 
LEFT JOIN codifiers.reexam_source_tab sn ON sn.id = f.reexam_source 
WHERE f.date_analisis BETWEEN ':param1_1_:' AND ':param1_2_:' 
AND :param2_1_: 
--AND f.result IS NOT NULL 
AND /*f.fluorography_visit_purpose_id = 900000 f.result!=1 and*/ /*f.result1!=1 and f.result2!=1 
and f.result1!=6 and f.result2!=6*//* f.result1 in (2,3,4,5,7,8,9) and f.result2 in (2,3,4,5,7,8,9) */ 
f.result1 in (2,9)  and f.result2 in (2,9) 
and :param3_1_: 
and (':param4_1_:'='-1' or u.otdel_id = ':param4_1_:') 
and (f.reexam_source=:param5_1_: or :param5_1_:=-1) 
order by 2,8,7,3</Sql>
            </Query>
            <Query>
              <Sql>zapros2(par) select count(*)  
from dan_tab d 
LEFT JOIN codifiers.uchactok_tab u ON d.uchactok_id = u.id 
left join researches.fluorography_tab f ON f.dan_id = d.dan_id 
left join gr_risk_tab g on g.gr_risk_id=d.risk_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
where  f.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
and f.result1 in (2,9)  and f.result2 in (2,9) 
and :param3_1_: AND :param2_1_: 
and (':param4_1_:'='-1' or u.otdel_id = ':param4_1_:') 
and (f.reexam_source=:param5_1_: or :param5_1_:=-1) 
and par</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param3" Caption="" Type="select2">
              <Sql>true= |reexam_date-date_analisis&gt;14=Дата дообследования свыше 14 дней</Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Отделение" Type="select">
              <Sql>select '-1', 'Все отделения' union select o.otdel, o.nam_otdel from otdel_tab o</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Откуда направлен на дообследование" Type="select">
              <Sql>select -1, 'Любой' union select id, name from codifiers.reexam_source_tab</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true'::text, 'Все участки'::text, 0 UNION SELECT 'd.uchactok_id = '||u.id::text,u.name, 1 FROm codifiers.uchactok_tab u ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008403000" Name="Журнал регистрации выявленной активной патологии" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Журнал регистрации выявленной активной патологии.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT '$id', d.fio, d.date_born,d.address, m.mest_work, f.analisis_number, 
 f.date_analisis, 
conv_to_null(f.result||', ')||conv_to_null('с '||to_char(f.diagnosis_date,'dd.mm.yyyy')) as res1, 
fp.name as target_pos , d.dan_id --, f.approved_diagnosis 
 FROm researches.fluorography_tab f 
LEFT JOIN codifiers.fluorography_visit_purpose_tab fp On fp.id = f.fluorography_visit_purpose_id 
--LEFT JOIN codifiers.fluorography_values_tab fv ON fv.id::text = f.result 
LEFT JOIN dan_tab d On d.dan_id = f.dan_id 
LEFT JOIN mest_work_tab m On m.mest_work_id = d.mesto_work_id 
WHERE f.date_analisis BETWEEN ':param1_1_:' AND ':param1_2_:' 
AND :param2_1_: 
--AND  f.approved_diagnosis IS NOT NULL 
--AND (f.result = '2' or f.result1=2 or f.result2=2) 
and f.reexam_result ilike '%РПТД%'</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT min(disp.date) FROM 
dispan_uchet_tab disp 
WHERE disp.dan_id = :dan_id: AND disp.date &gt;=date(case when ':date_analisis:'='' then '1900-01-01' else ':date_analisis:' end) 
AND disp.diagn_id = ':approved_diagnosis:'</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true'::text, 'все'::text, 0 UNION SELECT 'd.uchactok_id = '||u.id::text,u.name, 1 FROm codifiers.uchactok_tab u ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008503000" Name="Список пациентов прошедших флюорографию (с отделениями)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Список пациентов прошедших флюорографию (с отделениями).xls">
          <Queries>
            <Query>
              <Sql>zapros1 select distinct '$id', fam||' '||nam||' '||mid as param_1_1_, address as param_1_2_, dan_tab.date_born, uchactok as param_1_3_, o.nam_otdel as param_1_5_, '№ '||analisis_number||' от '||to_char(fluo.date_analisis,'dd.mm.yyyy') as param_1_4_ 
from dan_tab 
left join uchactok_tab on uchactok_tab.uchactok_id=dan_tab.uchactok_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = dan_tab.dan_id 
--left join naprav_tab n ON fluo.naprav_id = n.id 
--left join okaz_uslug_tab u ON u.research_id = fluo.id 
left join doctor_tab doc ON doc.doctor_id = uchactok_tab.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
 where fluo.date_analisis between date(':period_1_1_:') and date(':period_1_2_:') 
 :period_2_1_: 
 order by param_1_1_</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Отделение" Type="select">
              <Sql>(select 'and otdel_tab.otdel='||otdel, nam_otdel from otdel_tab order by otdel) union (select ' and true', 'Все')</Sql>
            </Parameter>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>(select 'and dan_tab.uchactok_id='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2009703000" Name="Карта профилактических флюорографических обследований" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Карта профилактических флюорографических обследований.xls">
          <Queries>
            <Query>
              <Sql>z_address select address from dan_tab where dan_id = :param1_1_:</Sql>
            </Query>
            <Query>
              <Sql>z_date_born select to_char(date_born,'dd.mm.yyyy') from dan_tab where dan_id = :param1_1_:</Sql>
            </Query>
            <Query>
              <Sql>z_date_zaved select to_char(now(),'dd.mm.yyyy')</Sql>
            </Query>
            <Query>
              <Sql>z_fio select conv_to_null(fam)||' '||conv_to_null(nam)||' '||conv_to_null(mid) from dan_tab where dan_id = :param1_1_:</Sql>
            </Query>
            <Query>
              <Sql>z_mest_work select mest_work from dan_tab where dan_id = :param1_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros select date_part('year', fluo.date_analisis), to_char(date_analisis,'dd.mm.yyyy') as date_analisis, 
f1.name as res1, f2.name as res2, analisis_number, mkb.mkb as res , reexam_date, reexam_result 
from 
researches.fluorography_tab fluo 
left join codifiers.fluorography_values_tab f1 ON f1.code = fluo.result1::text 
left join codifiers.fluorography_values_tab f2 ON f2.code = fluo.result2::text 
left join mkb_tab mkb ON mkb.kod_d = fluo.result 
where dan_id = :param1_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="id пациента" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2016503000" Name="Список вызванных на дообследование" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Список вызванных на дообследование.xls">
          <Queries>
            <Query>
              <Sql>zapros select distinct '$id', d.fam||' '||d.nam||' '||d.mid as fio, 
d.address, d.uchactok_id, d.date_born, g.gr_risk, fluo.result,fluo.date_analisis, 
fluo.reexam_date, fluo.reexam_result, d.mest_work, fluo.reexam_source 
from dan_tab d 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join gr_risk_tab g on g.gr_risk_id=d.risk_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
where  fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
and fluo.result1 in (2,9)  and fluo.result2 in (2,9) 
 :param2_1_: :param3_1_: 
order by fio</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Отделение" Type="select">
              <Sql>(select 'and o.otdel='||otdel, nam_otdel from otdel_tab order by otdel) union (select ' and true', 'Все')</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>(select 'and d.uchactok_id='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2016703000" Name="Противотуберкулезная работа" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Противотуберкулезная работа.xls">
          <Queries>
            <Query>
              <Sql>count_all select count(*) 
from researches.fluorography_tab fluo 
LEFT JOIN dan_tab d ON d.dan_id = fluo.dan_id 
left join naprav_tab n ON n.id = fluo.naprav_id 
left join visit_tab v ON v.talon_id = n.talon_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id  
where  fluo.date_analisis between ':param1_1_:' and ':param1_2_:' 
 :param2_1_: :param3_1_: and d.kat!=12</Sql>
            </Query>
            <Query>
              <Sql>count_all1 select count(*) 
from researches.fluorography_tab fluo 
LEFT JOIN dan_tab d ON d.dan_id = fluo.dan_id 
left join naprav_tab n ON n.id = fluo.naprav_id 
left join visit_tab v ON v.talon_id = n.talon_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id  
where  fluo.date_analisis between ':param1_1_:' and ':param1_2_:' 
 :param2_1_: :param3_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros(par) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id  
 where gr.gr_risk_id=par and d.kat!=12 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
 :param2_1_: :param3_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select count(*) 
from researches.fluorography_tab fluo 
LEFT JOIN dan_tab d ON d.dan_id = fluo.dan_id 
left join naprav_tab n ON n.id = fluo.naprav_id 
left join visit_tab v ON v.talon_id = n.talon_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
where  fluo.date_analisis between ':param1_1_:' and ':param1_2_:' 
 :param2_1_: :param3_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros2(par2) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id  
 where fluo.result='%par2%' 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
 :param2_1_: :param3_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id  
 where gr.gr_risk_id is not null and d.kat!=12 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
 :param2_1_: :param3_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id  
 where fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
 :param2_1_:  :param3_1_: 
AND d.dan_id IN 
(SELECT dan_id FROM researches.fluorography_tab 
GROUP BY dan_id 
HAVING max(date_analisis) between date(':param1_1_:') and date(':param1_2_:') 
AND count(id) =1) and d.kat!=12</Sql>
            </Query>
            <Query>
              <Sql>zapros5 select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id  
 where fluo.result not in ('%бронхит%', '%ссз%', '%туберкулез%', '%о.пневмония%', '%онко%', '%норма%', '%R+%') 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
 :param2_1_: :param3_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Отделение" Type="select">
              <Sql>(select 'and o.otdel='||otdel, nam_otdel from otdel_tab order by otdel) union (select ' and true', 'Все')</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>(select 'and d.uchactok_id='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2016903000" Name="Список не явившихся на дообследование" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Список не явившихся на дообследование.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select distinct '$id', d.fam||' '||d.nam||' '||d.mid as fio, 
d.address, d.uchactok_id, d.date_born, g.gr_risk, fluo.result, fluo.date_analisis, 
fluo.reexam_date, fluo.reexam_result, d.mest_work, fluo.reexam_source 
from dan_tab d 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join gr_risk_tab g on g.gr_risk_id=d.risk_id 
where  fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
and (fluo.result1=9  or fluo.result2=9) 
and fluo.reexam_date not between fluo.date_analisis and fluo.date_analisis+'14 days'::interval 
and fluo.reexam_date &gt; fluo.date_analisis 
order by fio</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2017103000" Name="Отчет по форме флюоропаспорта" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Отчет по форме флюоропаспорта.xls">
          <Queries>
            <Query>
              <Sql>count_all select count(*) 
from researches.fluorography_tab fluo 
LEFT JOIN dan_tab d ON d.dan_id = fluo.dan_id 
left join naprav_tab n ON n.id = fluo.naprav_id 
left join visit_tab v ON v.talon_id = n.talon_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
where  fluo.date_analisis between ':param1_1_:' and ':param1_2_:'  
AND :param2_1_: :param3_1_: and :param4_1_:</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros(par) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id    
 where gr.gr_risk_id=par 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')  
and :param2_1_: :param3_1_:  and :param4_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros1(par1) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id   
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
 where gr.gr_risk_id=par1 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')  
and :param2_1_:  :param3_1_: 
AND d.dan_id IN 
(SELECT dan_id FROM researches.fluorography_tab 
GROUP BY dan_id 
HAVING max(date_analisis) between date(':param1_1_:') and date(':param1_2_:') 
AND count(id) &gt; 1)  and :param4_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros2(par2) select count(*) from  dan_tab d 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id   
where fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')  
and fluo.fluorography_visit_purpose_id=par2 
and :param2_1_: :param3_1_:  and :param4_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select count(*) from  dan_tab d 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id   
where fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')  
and fluo.fluorography_visit_purpose_id in (600000,700000) 
and :param2_1_: :param3_1_:  and :param4_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 select count(*) from  dan_tab d 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id  
where fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')  
and gr.gr_risk_id=1203001 
and get_vozrast(d.date_born)&gt;15 
and :param2_1_: :param3_1_:  and :param4_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros5 select count(*) from  dan_tab d 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id  
where fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')  
and gr.gr_risk_id is not null 
and :param2_1_: :param3_1_:  and :param4_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Отделение" Type="select">
              <Sql>(select 'and o.otdel='||otdel, nam_otdel from otdel_tab order by otdel) union (select ' and true', 'Все')</Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Прикреплен" Type="select">
              <Sql>select 'd.prikreplen=1', 'Да', 0 union  select 'd.prikreplen!=1', 'Нет', 1 union  select 'true','Все',2 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true'::text, 'все'::text, 0 UNION SELECT 'd.uchactok_id = '||u.id::text,u.name, 1 FROm codifiers.uchactok_tab u ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2017303000" Name="2 ПОЛ Список пациентов прошедших флюорографию" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\2 ПОЛ Список пациентов прошедших флюорографию.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select distinct '$id', d.fam||' '||d.nam||' '||d.mid as fio, 
d.address, d.uchactok_id, d.date_born, g.gr_risk, fluo.result, 
fluo.date_analisis, d.mest_work, 
(SELECT date_analisis FROM researches.fluorography_tab WHERE dan_id = fluo.dan_id 
ORDER BY date_analisis DESC OFFSET 1 LIMIT 1) as date_pred_osmotr 
from dan_tab d 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join gr_risk_tab g on g.gr_risk_id=d.risk_id 
where  fluo.date_analisis between date(':period_1_1_:') and date(':period_1_2_:') 
AND d.dan_id IN 
(SELECT dan_id FROM researches.fluorography_tab 
GROUP BY dan_id 
HAVING max(date_analisis) between date(':period_1_1_:') and date(':period_1_2_:') 
AND count(id) &gt; 0)  :period_2_1_: and :param3_1_: 
order by fio</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Прикреплен" Type="select">
              <Sql>select 'd.prikreplen=1', 'Да', 0 union  select 'd.prikreplen!=1', 'Нет', 1 union  select 'true','Все',2 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>(select 'and d.uchactok_id='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2017503000" Name="2 ПОЛ Список пациентов прошедших флюорографию (с отделениями)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\2 ПОЛ Список пациентов прошедших флюорографию (с отделениями).xls">
          <Queries>
            <Query>
              <Sql>zapros1 select distinct '$id', d.fam||' '||d.nam||' '||d.mid as fio, 
d.address, d.uchactok_id, d.date_born, g.gr_risk, fluo.result, 
fluo.date_analisis, d.mest_work, 
(SELECT date_analisis FROM researches.fluorography_tab WHERE dan_id = fluo.dan_id 
ORDER BY date_analisis DESC OFFSET 1 LIMIT 1) as date_pred_osmotr 
from dan_tab d 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join gr_risk_tab g on g.gr_risk_id=d.risk_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
where  fluo.date_analisis between date(':period_1_1_:') and date(':period_1_2_:') 
AND d.dan_id IN 
(SELECT dan_id FROM researches.fluorography_tab 
GROUP BY dan_id 
HAVING max(date_analisis) between date(':period_1_1_:') and date(':period_1_2_:') 
AND count(id) &gt; 0)  :period_2_1_:  :period_3_1_: 
order by fio</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_3" Caption="Отделение" Type="select">
              <Sql>(select 'and o.otdel='||otdel, nam_otdel from otdel_tab order by otdel) union (select ' and true', 'Все')</Sql>
            </Parameter>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>(select 'and d.uchactok_id='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2017703000" Name="Не прошедшие флюорографию 2 и более года" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Не прошедшие флюорографию 2 и более года.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select distinct '$id', d.fam||' '||d.nam||' '||d.mid as fio, 
d.address, d.uchactok_id, d.date_born, g.gr_risk, fluo.result, 
fluo.date_analisis, fluo.exam_lpu, 
(SELECT date_analisis FROM researches.fluorography_tab WHERE dan_id = fluo.dan_id 
ORDER BY date_analisis DESC OFFSET 1 LIMIT 1) as date_pred_osmotr 
from dan_tab d 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join gr_risk_tab g on g.gr_risk_id=d.risk_id 
where  /*d.dan_id IN 
(SELECT dan_id FROM researches.fluorography_tab 
GROUP BY dan_id  
having count(id) &gt; 0)  :period_2_1_: 
and*/ g.gr_risk_id=2403001  :period_2_1_: 
order by fio</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>(select 'and d.uchactok_id='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2018103000" Name="Отчет по работе аппарата" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Отчет по работе аппарата.xls">
          <Queries>
            <Query>
              <Sql>_zapros(_par) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref 
 where gr.gr_risk_id=_par and d.spolref!='2301002' 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>count_all select count(*) from  researches.fluorography_tab fluo 
where fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>count_face select count(*) from  dan_tab d 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
 where fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
and d.dan_id is not null</Sql>
            </Query>
            <Query>
              <Sql>zapros(par) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
 where gr.gr_risk_id=par 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros_(par_) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref 
 where gr.gr_risk_id=par_ and d.spolref='2301002' 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros_1(_par1) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref 
 where fluo.fluorography_visit_purpose_id=_par1 and d.spolref!='2301002' 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros_2(_par2) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref  
 where d.sozstatus_id=_par2  and d.spolref!='2301002' 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros_3 select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref  
 where get_vozrast(d.date_born)&gt;18 and d.spolref!='2301002'  
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros_4 select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref  
 where d.sozstatus_id=7 and d.kat=4  and d.spolref!='2301002'  
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros_5 select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref   
 where fluo.fluorography_visit_purpose_id in (600000,700000) and d.spolref!='2301002'  
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros_6(_p1,_p2) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref  
 where gr.gr_risk_id=_p1 and d.sozstatus_id=_p2  and d.spolref!='2301002' 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros1(par1) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
 where fluo.fluorography_visit_purpose_id=par1 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros1_(par1_) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref 
 where fluo.fluorography_visit_purpose_id=par1_ and d.spolref='2301002' 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros2(par2) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
 where d.sozstatus_id=par2 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros2_(par2_) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref  
 where d.sozstatus_id=par2_  and d.spolref='2301002' 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
 where get_vozrast(d.date_born)&gt;18 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros3_ select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref  
 where get_vozrast(d.date_born)&gt;18 and d.spolref='2301002'  
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros4 select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
 where d.sozstatus_id=7 and d.kat=4 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros4_ select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref  
 where d.sozstatus_id=7 and d.kat=4  and d.spolref='2301002'  
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros5 select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
 where fluo.fluorography_visit_purpose_id in (600000,700000) 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros5_ select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref   
 where fluo.fluorography_visit_purpose_id in (600000,700000) and d.spolref='2301002'  
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros6(p1,p2) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
 where gr.gr_risk_id=p1 and d.sozstatus_id=p27 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros6_(p1_,p2_) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join lpu_tab l on l.pricpol=d.spolref  
 where gr.gr_risk_id=p1_ and d.sozstatus_id=p2_  and d.spolref='2301002' 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2018703000" Name="Отчет по дообследованию" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Отчет по дообследованию.xls">
          <Queries>
            <Query>
              <Sql>z1(par2) select count(*) from  dan_tab d 
left join gr_risk_tab gr on gr.gr_risk_id = d.risk_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id  
 where fluo.result='%par2%' 
 and fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
 :param2_1_: :param3_1_:</Sql>
            </Query>
            <Query>
              <Sql>z2 select count(d.dan_id) 
from dan_tab d 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join gr_risk_tab g on g.gr_risk_id=d.risk_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
where  fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
and fluo.result1 in (2,9)  and fluo.result2 in (2,9) 
 :param2_1_: :param3_1_:</Sql>
            </Query>
            <Query>
              <Sql>z3 select count(d.dan_id) 
from dan_tab d 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join researches.fluorography_tab fluo ON fluo.dan_id = d.dan_id 
left join gr_risk_tab g on g.gr_risk_id=d.risk_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
where  fluo.date_analisis between date(':param1_1_:') and date(':param1_2_:') 
and fluo.result1 in (2,9)  and fluo.result2 in (2,9) 
 :param2_1_: :param3_1_: 
and (fluo.date_analisis-fluo.reexam_date&lt;=14)</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Отделение" Type="select">
              <Sql>(select 'and o.otdel='||otdel, nam_otdel from otdel_tab order by otdel) union (select ' and true', 'Все')</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>(select 'and d.uchactok_id='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2021703000" Name="Список пациентов по дате след.явки на флюорографию" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по флюорографии\Список пациентов по дате след.явки на флюорографию.xls">
          <Queries>
            <Query>
              <Sql>zapros0 select * from ( 
select d.fio, d.date_born as p2 ,d.address as p3,g.gr_risk as p4,max(d.date_fluog) as p5,u.uchactok as p6,  u.uchactok_id as p7, 
case when (d.risk_id in (1203001,1303001,20,1403001,2503001,2603001,1703001)) 
then max(d.date_fluog) + '1 year'::interval 
else max(d.date_fluog) + '2 year'::interval end as p1 
from dan_tab d 
left join uchactok_tab u  ON u.uchactok_id = d.uchactok_id 
left join gr_risk_tab g on g.gr_risk_id=d.risk_id 
group by 1,2,3,4,6,7,d.risk_id 
) as sub 
where sub.p1 between ':dat_param_1_:' and ':dat_param_2_:' 
:param1_1_: 
order by 1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="dat_param" Caption="Дата следующей явки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Участок" Type="select">
              <Sql>(select 'and sub.p7='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Отчеты по льготникам и льготным рецептам">
      <Reports>
        <Report Id="103" Name="Информацию о гражданах, имеющих право на дополнительное лекарственное обеспечение (федеральные льготники)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Информацию о гражданах, имеющих право на дополнительное лекарственное обеспечение (федеральные льготники).xls">
          <Queries>
            <Query>
              <Sql>fake_zapros select ''/*, a[1] as param_2_1_, a[2] as param_2_2_ from (select string_to_array(':period_2_1_:', '-') as a) as foo*/</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select DISTINCT dan_tab.fam, dan_tab.nam as param_1_1_, dan_tab.mid as param_1_2_, dan_tab.date_born as param_1_3_, diagn_tab.diagn_osn  from dan_tab left join talon_tab t ON t.dan_id = dan_tab.dan_id LEFT JOIN diagn_tab ON diagn_tab.talon_id = t.talon_id AND diagn_tab.count = '1' 
 left join fed_lgota_tab on fed_lgota_tab.dan_id=dan_tab.dan_id AND fed_lgota_tab.pens like '___-___-___ __' AND fed_lgota_tab.pens not like 'XXX-XXX-XXX XX' 
 where fed_lgota_tab.floga is not null 
 and diagn_tab.diagn_osn between :period_2_1_: 
 and (diagn_tab.data_vnes_inf&gt;date(':period_1_1_:')) 
 and (diagn_tab.data_vnes_inf&lt;date(':period_1_2_:'))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_2" Caption="Нозология" Type="select2">
              <Sql>'E10' AND 'E14.9'=Сахарный диабет(E10-E14)|'D66' AND 'D67.9'=Наследственные коагулопатии (гемофилия)(D66-D67)|'G35' AND 'G35.9'=Демиелинизирующие заболевания (рассеянный склероз)(G35)|'C81' AND 'C96.9'=Онкогематологические заболевания(C81-C96)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="117" Name="(Форма 030 Р/У)Сведения о лекарственных средствах, выписанных и отпущенных гражданам, имеющим право на получение набора социальных услуг" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\(Форма 030 Р_У)Сведения о лекарственных средствах, выписанных и отпущенных гражданам, имеющим право на получение набора социальных услуг.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>zapros2 select value from settings_tab where name='OGRN'</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select r.date_vipiski, kod_feld as param_1_1_, fio as param_1_2_, 
conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) as param_1_3_, 
t.ser_pol as param_1_4_, t.num_pol as param_1_5_, d.pens as param_1_6_, 
r.rezept_ser as param_1_7_, r.rezept_num as param_1_8_ 
,trunc(ra.kolvo::numeric,2) as kol_ap, trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap , l1.name_med as name_med_ap 
,trunc(ra.cost::numeric,2) as cost_ap , ra.date_out 
        from rezept_tab r 
	left join full_doctor_tab on r.doctor_id=full_doctor_tab.full_doctor_id 
        left join talon_tab t on t.talon_id = r.talon_id 
        left join dan_tab d on d.dan_id = t.dan_id 
LEFT JOIN rezept_ap_tab ra ON /*ra.rezept_ser = r.rezept_ser AND ra.rezept_num  = r.rezept_num */ 
upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
        where  :param2_1_: AND :param3_1_: and 
 r.date_vipiski between date(':period_1_1_:') and date(':period_1_2_:')  
AND not r.bad 
ORDER BY r.date_vipiski</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Льгота" Type="select">
              <Sql>SELECT 'length(trim(r.kod_lgot)) = 3'::text, 'Федеральная'::text  UNION  SELECT 'length(trim(r.kod_lgot)) = 2'::text, 'Местная'::text  UNION  SELECT 'true'::text, 'Все'::text </Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true', 'Все'::text UNION SELECT ' d.uchactok_id = '||uchactok_id::text , uchactok FROM uchactok_tab  ORDER BY 2;</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="129" Name="Рецепты для ДЗ" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Рецепты для ДЗ.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select DISTINCT dan_tab.fam, dan_tab.nam, dan_tab.mid, dan_tab.date_born, 
kod_lgot, kod_minzd, trim(leading  '!' from lgot_preparat_tab.name_med) as  prep_name, rezept_tab.diagn_id, 
k1.name as raion, k2.name as nas_punkt, st_tab.name as street, dan_tab.dom,  dan_tab.kv,  
full_doctor_tab.fam as doctor_fam 
from rezept_tab  
left join dan_tab on dan_tab.dan_id=rezept_tab.dan_id 
left join lgot_preparat_tab on rezept_tab.kod_minzd=lgot_preparat_tab.kod 
left join full_doctor_tab on full_doctor_tab.full_doctor_id=rezept_tab.doctor_id 
left join kladr_tab k1 on k1.code = dan_tab.raion_id 
left join kladr_tab k2 on k2.code = case when dan_tab.town_id is not null then  dan_tab.town_id else dan_tab.punkt_id end 
left join st_tab on st_tab.code=dan_tab.street_id 
where  kod_minzd is not null AND length(trim(kod_lgot)) &gt; 2 and trim(kod_minzd)::text::int4 in (:period_1_1_:) and rezept_tab.date_vipiski  between date(':period_2_1_:') and date(':period_2_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_2" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_1" Caption="Препарат" Type="select2">
              <Sql>1402052,1402028,1402029,1401969,1401970,1402023,1402021,1402022,1401977,1401978,1401979,1401962,1401963,1401964,1401968,1401967,1401958,1401959,1401960,1401985,1401984,1401986,1401965,1401966,1402030,1402051,1402050,1402327,1401804,1401805=Гемофилия|1402387,1402203,1402139=Онкология| 1402407,1401864,1401865,1401559=Рассеянный склероз| 1402056,1401807,1401859,1401536,1401537,1401538,1401815,1401539,1401540,1402412,1401543,1401811,1401812,1401546,1401547,1401544,1401545,1401549,1401548,1401552,1401553,1401550,1401551,1401813,1401814,1401542,1402504=Сахарныйдиабет</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="130" Name="Численность лиц, имеющих право на получение набора социальных услуг (человек)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Численность лиц, имеющих право на получение набора социальных услуг (человек).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT (SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX') -

(SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'E10' AND 'E14.9')  - 

(SELECT COUNT(distinct d.dan_id) FROm dan_tab d  
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'D66' AND 'D67.9') - 

(SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'C81' AND 'C96.9') - 

(SELECT COUNT(distinct d.dan_id) FROm dan_tab d  
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'G35' AND 'G35.9')</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT COUNT(distinct d.dan_id) FROm dan_tab d  
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'D66' AND 'D67.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'C81' AND 'C96.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros5 SELECT COUNT(distinct d.dan_id) FROm dan_tab d  
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'G35' AND 'G35.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'E10' AND 'E14.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros0 SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders>
        <Folder Name="Отчеты о выписанных льготных рецептах ">
          <Reports>
            <Report Id="29" Name="Отчет о количестве выписанных льготных рецептов с начала месяца и с начала года" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчеты о выписанных льготных рецептах \Отчет о количестве выписанных льготных рецептов с начала месяца и с начала года.xls">
              <Queries>
                <Query>
                  <Sql>zapros0(lg_len) select count(*), COUNT(distinct dan_id) as pat_from_year from rezept_tab rez_t 
where not bad and rez_t.date_vipiski between   (date_part('year',':period1_1_:'::date/*current_timestamp*/)::text||'-01-01')::date and date  (':period1_2_:')  and  char_length(trim(rez_t.kod_lgot))=lg_len</Sql>
                </Query>
                <Query>
                  <Sql>zapros1(lg_len) select count(*), COUNT(distinct dan_id) as pat_from_month from rezept_tab rez_t 
where not bad and rez_t.date_vipiski between   date(':period1_1_:') and date  (':period1_2_:')  and  char_length(trim(rez_t.kod_lgot))=lg_len</Sql>
                </Query>
                <Query>
                  <Sql>zapros10 select count(*) from visit_tab v 
left join talon_tab ON talon_tab.talon_id = v.talon_id 
left join fed_lgota_tab on fed_lgota_tab.dan_id=talon_tab.dan_id 
where :param2_1_: between date(':period1_1_:') and date  (':period1_2_:')  and floga is not null</Sql>
                </Query>
                <Query>
                  <Sql>zapros11 select count(*) from ( 
select distinct t.dan_id from talon_tab as t 
left join lgot_client_tab on lgot_client_tab.dan_id=t.dan_id 
where (case when ':param2_1_:'='v.data_vnes_inf' then t.date_vnes_inf else t.date_visit end)  between date(':period1_1_:') and date  (':period1_2_:') and lgota is not null 
) q</Sql>
                </Query>
                <Query>
                  <Sql>zapros12 select count(*) from ( 
select distinct t.dan_id from talon_tab as t 
left join fed_lgota_tab on fed_lgota_tab.dan_id=t.dan_id 
where (case when ':param2_1_:'='v.data_vnes_inf' then t.date_vnes_inf else t.date_visit end) between date(':period1_1_:') and date  (':period1_2_:')  and floga is not null 
) q</Sql>
                </Query>
                <Query>
                  <Sql>zapros2(lg_len) select count(distinct dan_id)  from rezept_tab rez_t 
where rez_t.date_vipiski between  date(':period1_1_:') and  date  (':period1_2_:') 
and not bad and char_length(trim(rez_t.kod_lgot))=lg_len and  dan_id not in (select distinct dan_id from rezept_tab rez_t 
where not bad and rez_t.date_vipiski between  (date_part('year',current_timestamp)::text||'-01-01')::date  and (date  (':period1_1_:') -  interval '1 day') and char_length(trim(rez_t.kod_lgot))=lg_len )</Sql>
                </Query>
                <Query>
                  <Sql>zapros3(lg_len) SELECT COUNT(*) FROM 
(select distinct dan_id, date_vipiski 
 from rezept_tab rez_t 
 where not bad and rez_t.date_vipiski between    (date_part('year',':period1_1_:'::date/*current_timestamp*/)::text||'-01-01')::date and date  (':period1_2_:')  and   char_length(trim(rez_t.kod_lgot))=lg_len 
) as ff</Sql>
                </Query>
                <Query>
                  <Sql>zapros4(lg_len) SELECT COUNT(*) FROM 
(select distinct dan_id, date_vipiski 
 from rezept_tab rez_t 
 where not bad and rez_t.date_vipiski between    date(':period1_1_:')  and date  (':period1_2_:')  and   char_length(trim(rez_t.kod_lgot))=lg_len 
) as ff</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 select count(*) from 
visit_tab v 
left join talon_tab ON talon_tab.talon_id = v.talon_id 
left join fed_lgota_tab on fed_lgota_tab.dan_id=talon_tab.dan_id 
where :param2_1_: between (date_part('year',':period1_1_:'::date/*current_timestamp*/)::text||'-01-01')::date and date(':period1_2_:')  and floga is not null and result_id=7</Sql>
                </Query>
                <Query>
                  <Sql>zapros6 select count(*) from visit_tab v 
left join talon_tab ON talon_tab.talon_id = v.talon_id 
left join fed_lgota_tab on fed_lgota_tab.dan_id=talon_tab.dan_id 
where :param2_1_: between date(':period1_1_:') and date  (':period1_2_:')  and floga is not null and result_id=7</Sql>
                </Query>
                <Query>
                  <Sql>zapros7 select count(*) from visit_tab v 
left join talon_tab ON talon_tab.talon_id = v.talon_id 
left join lgot_client_tab on lgot_client_tab.dan_id=talon_tab.dan_id 
where :param2_1_: between (date_part('year',':period1_1_:'::date/*current_timestamp*/)::text||'-01-01')::date and date  (':period1_2_:') and lgota is not null and result_id=7</Sql>
                </Query>
                <Query>
                  <Sql>zapros8 select count(*) from visit_tab v 
left join talon_tab ON talon_tab.talon_id = v.talon_id 
left join lgot_client_tab on lgot_client_tab.dan_id=talon_tab.dan_id 
where :param2_1_: between date(':period1_1_:')  and date  (':period1_2_:') and lgota is not null and result_id=7</Sql>
                </Query>
                <Query>
                  <Sql>zapros9 select count(*) from visit_tab v 
left join talon_tab ON talon_tab.talon_id = v.talon_id 
left join lgot_client_tab on lgot_client_tab.dan_id=talon_tab.dan_id 
where :param2_1_: between date(':period1_1_:') and date  (':period1_2_:') and lgota is not null</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Считать визиты по" Type="select2">
                  <Sql>v.data_pos=дате посещения|v.data_vnes_inf=дате внесения</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="123" Name="Сведения о рецептах на получение необходимых лекарственных средств, выписанных врачами отдельным категориям граждан" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчеты о выписанных льготных рецептах \123.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select distinct kod_lgot||' '||nam_lgota, kod_lgot as param_1_1_
from rezept_tab r
left join lgota_tab l on l.lgota_id=r.kod_lgot
where  r.date_vipiski between date(':period_1_1_:') and date(':period_1_2_:')
and char_length(kod_lgot)=3 and nam_lgota is not null
order by kod_lgot
</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 select count(distinct t.dan_id)
from rezept_tab r
left join talon_tab t on t.talon_id=r.talon_id
where r.date_vipiski between date(':period_1_1_:') and date(':period_1_2_:')
and r.kod_lgot=':param_1_1_:'
</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 select count(distinct t.dan_id)
from rezept_tab r
left join talon_tab t on t.talon_id=r.talon_id
where t.strcom_id&gt;=97 and t.strcom_id!=99 
and r.date_vipiski between date(':period_1_1_:') and date(':period_1_2_:')
and r.kod_lgot=':param_1_1_:'
</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 select count(*)
from rezept_tab r
left join talon_tab t on t.talon_id=r.talon_id
where r.date_vipiski between date(':period_1_1_:') and date(':period_1_2_:')
and r.kod_lgot=':param_1_1_:'
</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 select count(*)
from rezept_tab r
left join talon_tab t on t.talon_id=r.talon_id
where t.strcom_id&gt;=97 and t.strcom_id!=99 
and r.date_vipiski between date(':period_1_1_:') and date(':period_1_2_:')
and r.kod_lgot=':param_1_1_:'
</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="177" Name="Сведения о кол-ве и стоимости выписанных рецептах по врачам и участкам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчеты о выписанных льготных рецептах \Сведения о кол-ве и стоимости выписанных рецептах по врачам и участкам.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 SELECT r.fio, r.uchactok, SUM(mround(mround(kol)*mround(price_lim))) as cost, 
COUNT(*) as rkol 
FROM 
( 
SELECT DISTINCT f.fio, u.uchactok, l.price_lim, r.rezept_num, r.rezept_ser, r.kol 
FROM rezept_tab r 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN dan_tab d ON d.dan_id = r.dan_id 
LEFT JOIN uchactok_tab u On u.uchactok_id = d.uchactok_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE r.bad != TRUE AND r.date_vipiski &gt;= date(':period1_1_:')  
ANd r.date_vipiski &lt;= date(':period1_2_:') 
AND :period3_1_: 
AND :period2_1_: 
AND length(trim(r.kod_lgot)) = :period4_1_:
) as r 
GROUP BY r.fio, r.uchactok 
ORDER BY 1,2</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 SELECT COUNT(*) as rkol,  
SUM(mround(mround(kol)*mround(price_lim))) as cost  
FROM 
( 
SELECT DISTINCT f.fio, u.uchactok, l.price_lim, r.rezept_num, r.rezept_ser, r.kol 
FROM rezept_tab r 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN dan_tab d ON d.dan_id = r.dan_id 
LEFT JOIN uchactok_tab u On u.uchactok_id = d.uchactok_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE r.bad != TRUE AND r.date_vipiski &gt;= date(':period1_1_:')  
ANd r.date_vipiski &lt;= date(':period1_2_:') 
AND :period3_1_: 
AND :period2_1_: 
AND length(trim(r.kod_lgot)) = :period4_1_:
) as r 
ORDER BY 1,2</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period1" Caption="Дата выписки" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="period2" Caption="Врач" Type="select">
                  <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT ' r.doctor_id = '||f.full_doctor_id, f.full_doctor_id||' '||f.fio, 1  FROm full_doctor_tab f  ORDER BY 3,2 </Sql>
                </Parameter>
                <Parameter Name="period3" Caption="Участок" Type="select">
                  <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT ' d.uchactok_id = '||u.uchactok_id::text, u.uchactok, 1 FROM uchactok_tab u  ORDER BY 3,2 </Sql>
                </Parameter>
                <Parameter Name="period4" Caption="Льгота" Type="select2">
                  <Sql>3=Федеральная|2=Местная</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="178" Name="Список выписанных рецептов по льготнику" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчеты о выписанных льготных рецептах \Список выписанных рецептов по льготнику.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 SELECT '$id',d.fam||' '||d.nam||' '||conv_to_null(d.mid) as fio,  
r.snils, r.kod_lgot, r.rezept_ser, r.rezept_num, r.date_vipiski,  
r.kol, trunc(ra.kolvo::numeric,2) as kol_ap,  trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap,  
l.name_med, l1.name_med as name_med_ap , s.sklad, ra.date_out  
, f.kod_feld||' '||f.fio as doctor 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  /*:param2_1_: AND*/  
r.date_vipiski between date(':param1_1_: ')  and  date(':param1_2_: ') 
and :param3_1_: and :param4_1_:  AND not r.bad AND :param6_1_: 
AND conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) ilike replace('%:param5_1_:%', ' ', '%') 
AND :param7_1_:</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param4" Caption="" Type="select">
                  <Sql>SELECT ' l1.name_med is not null ', 'Только отпущенные'::text , 1 UNION  SELECT ' l1.name_med is null ', 'Только не отпущенные'::text , 1 UNION  SELECT ' true ', 'Все'::text , 0 ORDER BY 3 </Sql>
                </Parameter>
                <Parameter Name="param6" Caption="Врач" Type="select">
                  <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT ' r.doctor_id = '||f.full_doctor_id,f.fio, 1 FROm full_doctor_tab f  WHERe f.kod_feld is not null  ORDER BY 3,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Дата выписки" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="Льгота" Type="select">
                  <Sql>SELECT 'length(trim(r.kod_lgot)) = 3'::text, 'Федеральная'::text  ,0  UNION  SELECT 'length(trim(r.kod_lgot)) = 2'::text, 'Местная'::text , 1  UNION  SELECT 'true'::text, 'Все'::text , 2  ORDER BY 3</Sql>
                </Parameter>
                <Parameter Name="param7" Caption="Участок" Type="select">
                  <Sql>SELECT ' true '::text,'Все'::text, 0 UNION SELECT ' d.uchactok_id = '||u.uchactok_id::text::int4, u.uchactok, 1 FROm uchactok_tab u ORDER BY 3,2</Sql>
                </Parameter>
                <Parameter Name="param5" Caption="ФИО льготника" Type="text">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="179" Name="Список выписанных рецептов по названию препарата" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчеты о выписанных льготных рецептах \Список выписанных рецептов по названию препарата.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 SELECT '$id',d.fam||' '||d.nam||' '||conv_to_null(d.mid) as fio,  
r.snils, r.kod_lgot, r.rezept_ser, r.rezept_num, r.date_vipiski,  
r.kol, trunc(ra.kolvo::numeric,2) as kol_ap,  trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap,  
l.name_med, l1.name_med as name_med_ap , s.sklad, ra.date_out  
, f.kod_feld||' '||f.fio as doctor 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  /*:param2_1_: AND*/  
r.date_vipiski between date(':param1_1_: ')  and  date(':param1_2_: ') 
and :param3_1_: and :param4_1_:    AND not r.bad  AND :param6_1_: 
AND l.name_med ILIKE '%:param5_1_:%' 
AND :param7_1_:</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param4" Caption="" Type="select">
                  <Sql>SELECT ' l1.name_med is not null ', 'Только отпущенные'::text , 1 UNION  SELECT ' l1.name_med is null ', 'Только не отпущенные'::text , 1 UNION  SELECT ' true ', 'Все'::text , 0 ORDER BY 3 </Sql>
                </Parameter>
                <Parameter Name="param6" Caption="Врач" Type="select">
                  <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT ' r.doctor_id = '||f.full_doctor_id,f.fio, 1 FROm full_doctor_tab f  WHERe f.kod_feld is not null  ORDER BY 3,2 </Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Дата выписки" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param5" Caption="Код препарата" Type="text">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="Льгота" Type="select">
                  <Sql>SELECT 'length(trim(r.kod_lgot)) = 3'::text, 'Федеральная'::text  ,0  UNION  SELECT 'length(trim(r.kod_lgot)) = 2'::text, 'Местная'::text , 1  UNION  SELECT 'true'::text, 'Все'::text , 2  ORDER BY 3</Sql>
                </Parameter>
                <Parameter Name="param7" Caption="Участок" Type="select">
                  <Sql>SELECT ' true '::text,'Все'::text, 0 UNION SELECT ' d.uchactok_id = '||u.uchactok_id::text::int4, u.uchactok, 1 FROm uchactok_tab u ORDER BY 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="490010" Name="Список выписанных рецептов" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчеты о выписанных льготных рецептах \Список выписанных рецептов.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 SELECT '$id',d.fam||' '||d.nam||' '||conv_to_null(d.mid) as fio,  
r.snils, r.kod_lgot, r.rezept_ser, r.rezept_num, r.date_vipiski,  
r.kol, trunc(ra.kolvo::numeric,2) as kol_ap,  trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap,  
l.name_med, l1.name_med as name_med_ap , s.sklad, ra.date_out 
, f.kod_feld||' '||f.fio as doctor 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  /*:param2_1_: AND*/  
r.date_vipiski between date(':param1_1_: ')  and  date(':param1_2_: ') 
and :param3_1_: and :param4_1_:  AND not r.bad AND :param6_1_: 
AND :param7_1_:</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param4" Caption="" Type="select">
                  <Sql>SELECT ' l1.name_med is not null ', 'Только отпущенные'::text , 1 UNION  SELECT ' l1.name_med is null ', 'Только не отпущенные'::text , 1 UNION  SELECT ' true ', 'Все'::text , 0 ORDER BY 3 </Sql>
                </Parameter>
                <Parameter Name="param6" Caption="Врач" Type="select">
                  <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT ' r.doctor_id = '||f.full_doctor_id,f.fio, 1 FROm full_doctor_tab f  WHERe f.kod_feld is not null  ORDER BY 3,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Дата выписки" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="Льгота" Type="select">
                  <Sql>SELECT 'length(trim(r.kod_lgot)) = 3'::text, 'Федеральная'::text  ,0  UNION  SELECT 'length(trim(r.kod_lgot)) = 2'::text, 'Местная'::text , 1  UNION  SELECT 'true'::text, 'Все'::text , 2  ORDER BY 3</Sql>
                </Parameter>
                <Parameter Name="param7" Caption="Участок" Type="select">
                  <Sql>SELECT ' true '::text,'Все'::text, 0 UNION SELECT ' d.uchactok_id = '||u.uchactok_id::text::int4, u.uchactok, 1 FROm uchactok_tab u ORDER BY 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="530010" Name="Количество выписанных ЛС по месяцам за квартал" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчеты о выписанных льготных рецептах \Количество выписанных ЛС по месяцам за квартал.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 SELECT d.fam||' '||d.nam||' '||conv_to_null(d.mid) as p1, d.date_born AS p2, d.address AS p3, r.diagn_id AS p4,l.name_med AS p5, 
SUM(CASE WHEN r.date_vipiski BETWEEN date(':period_1_:')  and  date(':period_1_:')+ interval '1 month' THEN r.kol else 0 END) AS p6, 
SUM(CASE WHEN r.date_vipiski BETWEEN date(':period_1_:')+ interval '1 month'+ interval '1 day'   and  date(':period_1_:')+ interval '2 month' THEN r.kol else 0 END) AS p7, 
SUM(CASE WHEN r.date_vipiski BETWEEN date(':period_1_:')+ interval '2 month'+ interval '1 day'  and  date(':period_1_:')+ interval '3 month' THEN r.kol else 0 END) AS p8, 
SUM(r.kol) AS p9 
FROM dan_tab d 
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE 
r.date_vipiski between date(':period_1_:')  and  date(':period_1_:')+ interval '3 month' 
 AND not r.bad AND :doctor_1_: AND :uch_1_:  AND :lgota_1_: 
GROUP BY 
d.fam||' '||d.nam||' '||conv_to_null(d.mid), d.date_born, d.address, r.diagn_id,l.name_med 
ORDER BY 1,2;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="doctor" Caption="Врач:" Type="select">
                  <Sql>SELECT ' true ', 'Все'::text, 0  UNION  SELECT ' r.doctor_id = '||f.full_doctor_id,f.fio, 1 FROm full_doctor_tab f  WHERe f.kod_feld is not null  ORDER BY 3,2</Sql>
                </Parameter>
                <Parameter Name="lgota" Caption="Льгота" Type="select">
                  <Sql>SELECT 'length(trim(r.kod_lgot)) = 3'::text, 'Федеральная'::text  ,0  UNION  SELECT 'length(trim(r.kod_lgot)) = 2'::text, 'Местная'::text , 1  UNION  SELECT 'true'::text, 'Все'::text , 2  ORDER BY 3</Sql>
                </Parameter>
                <Parameter Name="period" Caption="Начало периода" Type="date">
                  <Sql />
                </Parameter>
                <Parameter Name="uch" Caption="Участок" Type="select">
                  <Sql>SELECT ' true '::text,'Все'::text, 0 UNION SELECT ' d.uchactok_id = '||u.uchactok_id::text::int4, u.uchactok, 1 FROm uchactok_tab u ORDER BY 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="6603000" Name="Рецепты для ДЗ" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчеты о выписанных льготных рецептах \Рецепты для ДЗ.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select DISTINCT dan_tab.fam, dan_tab.nam, dan_tab.mid, dan_tab.date_born, 
kod_lgot, kod_minzd, trim(leading  '!' from lgot_preparat_tab.name_med) as  prep_name, rezept_tab.diagn_id, 
k1.name as raion, k2.name as nas_punkt, st_tab.name as street, dan_tab.dom,  dan_tab.kv,  
full_doctor_tab.fam as doctor_fam 
from rezept_tab  
left join dan_tab on dan_tab.dan_id=rezept_tab.dan_id 
left join lgot_preparat_tab on rezept_tab.kod_minzd=lgot_preparat_tab.kod 
left join full_doctor_tab on full_doctor_tab.full_doctor_id=rezept_tab.doctor_id 
left join kladr_tab k1 on k1.code = dan_tab.raion_id 
left join kladr_tab k2 on k2.code = case when dan_tab.town_id is not null then  dan_tab.town_id else dan_tab.punkt_id end 
left join st_tab on st_tab.code=dan_tab.street_id 
where  kod_minzd is not null AND length(trim(kod_lgot)) &gt; 2 and trim(kod_minzd)::text::int4 in (:period_1_1_:) and rezept_tab.date_vipiski  between date(':period_2_1_:') and date(':period_2_2_:')</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period_2" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="period_1" Caption="Препарат" Type="select2">
                  <Sql>1402052,1402028,1402029,1401969,1401970,1402023,1402021,1402022,1401977,1401978,1401979,1401962,1401963,1401964,1401968,1401967,1401958,1401959,1401960,1401985,1401984,1401986,1401965,1401966,1402030,1402051,1402050,1402327,1401804,1401805=Гемофилия|1402387,1402203,1402139=Онкология| 1402407,1401864,1401865,1401559=Рассеянный склероз| 1402056,1401807,1401859,1401536,1401537,1401538,1401815,1401539,1401540,1402412,1401543,1401811,1401812,1401546,1401547,1401544,1401545,1401549,1401548,1401552,1401553,1401550,1401551,1401813,1401814,1401542,1402504=Сахарныйдиабет</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="6803000" Name="Информацию о гражданах, имеющих право на дополнительное лекарственное обеспечение (федеральные льготники)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчеты о выписанных льготных рецептах \6803000.xls">
              <Queries>
                <Query>
                  <Sql>fake_zapros select ''/*, a[1] as param_2_1_, a[2] as param_2_2_ from (select string_to_array(':period_2_1_:', '-') as a) as foo*/</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 select DISTINCT dan_tab.fam, dan_tab.nam as param_1_1_, dan_tab.mid as param_1_2_, dan_tab.date_born as param_1_3_, diagn_tab.diagn_osn  from dan_tab left join talon_tab t ON t.dan_id = dan_tab.dan_id LEFT JOIN diagn_tab ON diagn_tab.talon_id = t.talon_id AND diagn_tab.count = '1' 
 left join fed_lgota_tab on fed_lgota_tab.dan_id=dan_tab.dan_id AND fed_lgota_tab.pens like '___-___-___ __' AND fed_lgota_tab.pens not like 'XXX-XXX-XXX XX' 
 where fed_lgota_tab.floga is not null 
 and diagn_tab.diagn_osn between :period_2_1_: 
 and (diagn_tab.data_vnes_inf&gt;date(':period_1_1_:')) 
 and (diagn_tab.data_vnes_inf&lt;date(':period_1_2_:'))</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period_1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="period_2" Caption="Нозология" Type="select2">
                  <Sql>'E10' AND 'E14.9'=Сахарный диабет(E10-E14)|'D66' AND 'D67.9'=Наследственные коагулопатии (гемофилия)(D66-D67)|'G35' AND 'G35.9'=Демиелинизирующие заболевания (рассеянный склероз)(G35)|'C81' AND 'C96.9'=Онкогематологические заболевания(C81-C96)</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="7003000" Name="(Форма 030 Р/У)Сведения о лекарственных средствах, выписанных и отпущенных гражданам, имеющим право на получение набора социальных услуг" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчеты о выписанных льготных рецептах \7003000.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select value from settings_tab where name='ADDRESS'</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 select value from settings_tab where name='OGRN'</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 select r.date_vipiski, kod_feld as param_1_1_, fio as param_1_2_, 
conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) as param_1_3_, 
t.ser_pol as param_1_4_, t.num_pol as param_1_5_, d.pens as param_1_6_, 
r.rezept_ser as param_1_7_, r.rezept_num as param_1_8_ 
,trunc(ra.kolvo::numeric,2) as kol_ap, trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap , l1.name_med as name_med_ap 
,trunc(ra.cost::numeric,2) as cost_ap , ra.date_out 
        from rezept_tab r 
	left join full_doctor_tab on r.doctor_id=full_doctor_tab.full_doctor_id 
        left join talon_tab t on t.talon_id = r.talon_id 
        left join dan_tab d on d.dan_id = t.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
        where  :param2_1_: AND :param3_1_: and 
 r.date_vipiski between date(':period_1_1_:') and date(':period_1_2_:')  
AND not r.bad 
ORDER BY r.date_vipiski</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period_1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="Льгота" Type="select">
                  <Sql>SELECT 'length(trim(r.kod_lgot)) = 3'::text, 'Федеральная'::text  UNION  SELECT 'length(trim(r.kod_lgot)) = 2'::text, 'Местная'::text  UNION  SELECT 'true'::text, 'Все'::text </Sql>
                </Parameter>
                <Parameter Name="param2" Caption="Участок" Type="select">
                  <Sql>SELECT 'true', 'Все'::text UNION SELECT ' d.uchactok_id = '||uchactok_id::text , uchactok FROM uchactok_tab  ORDER BY 2;</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="7203000" Name="Численность лиц, имеющих право на получение набора социальных услуг (человек)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчеты о выписанных льготных рецептах \Численность лиц, имеющих право на получение набора социальных услуг (человек).xls">
              <Queries>
                <Query>
                  <Sql>zapros1 SELECT (SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX') -

(SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'E10' AND 'E14.9')  - 

(SELECT COUNT(distinct d.dan_id) FROm dan_tab d  
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'D66' AND 'D67.9') - 

(SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'C81' AND 'C96.9') - 

(SELECT COUNT(distinct d.dan_id) FROm dan_tab d  
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'G35' AND 'G35.9')</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 SELECT COUNT(distinct d.dan_id) FROm dan_tab d  
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'D66' AND 'D67.9'</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'C81' AND 'C96.9'</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 SELECT COUNT(distinct d.dan_id) FROm dan_tab d  
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'G35' AND 'G35.9'</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
LEFt JOIn talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN diagn_tab d1 ON d1.talon_id = t.talon_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'  
AND t.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')  
AND d1.diagn_osn between 'E10' AND 'E14.9'</Sql>
                </Query>
                <Query>
                  <Sql>zapros0 SELECT COUNT(distinct d.dan_id) FROm dan_tab d 
LEFT JOIN fed_lgota_tab f On f.dan_id = d.dan_id 
WHERE d.prikreplen = 1 AND f.pens like '___-___-___ __' AND f.pens !=  'XXX-XXX-XXX XX'</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period_1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
          </Reports>
          <Folders />
        </Folder>
        <Folder Name="Отчёты по льготникам и выписанным льготным рецептам">
          <Reports>
            <Report Id="7603000" Name="Отчет о лекарственных средствах, выписанных льготнику" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Отчет о лекарственных средствах, выписанных льготнику.xls">
              <Queries>
                <Query>
                  <Sql>lpu_name select upper(value) from settings_tab where name = 'LPU'</Sql>
                </Query>
                <Query>
                  <Sql>otchet_date select to_char(now(),'dd.mm.yyyy')</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 SELECT '$id', r.date_vipiski,  r.lekarstv_id, r.kod_minzd,r.proc_oplat,r.diagn_id, 
 r.rezept_ser||' '||r.rezept_num as rez_sernum, conv_to_null(f.fam)||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid) as doctor, f.dolg_doctor , ra.date_out as date_otpusk, ra.cost as summa 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad 
AND conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) ilike replace('%:param2_1_:%', ' ', '%') 
and d.pens like replace(replace('%:param3_1_:%',' ','%'),'-','%')</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 SELECT distinct d.fam||' '||d.nam||' '||conv_to_null(d.mid)||' ('||d.date_born||') '||', СНИЛС '||r.snils||', ' 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad 
AND conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) ilike replace('%:param2_1_:%', ' ', '%') 
and d.pens like replace(replace('%:param3_1_:%',' ','%'),'-','%')</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 SELECT distinct d.address, d.dan_id 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad 
AND conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) ilike replace('%:param2_1_:%', ' ', '%') 
and d.pens like replace(replace('%:param3_1_:%',' ','%'),'-','%')</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 SELECT count(r.rezept_id) 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad 
AND conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) ilike replace('%:param2_1_:%', ' ', '%') 
and d.pens like replace(replace('%:param3_1_:%',' ','%'),'-','%')</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="СНИЛС льготника" Type="text">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="ФИО льготника" Type="text">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="7803000" Name="Отчет по врачам ЛПУ" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Отчет по врачам ЛПУ.xls">
              <Queries>
                <Query>
                  <Sql>count_pats select sum(cnt_pat) from ( 
SELECT f.kod_feld, count(distinct d.dan_id) as cnt_pat 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  r.date_vipiski between date(':param1_1_: ')  and  date(':param1_2_: ') 
AND not r.bad 
group by 1) as q</Sql>
                </Query>
                <Query>
                  <Sql>count_recs SELECT count(*) as cnt 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  r.date_vipiski between date(':param1_1_: ')  and  date(':param1_2_: ') 
AND not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>count_rez SELECT count(r.rezept_id) as cnt_rez 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  r.date_vipiski between date(':param1_1_: ')  and  date(':param1_2_: ') 
AND not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>lpu_name select upper(value) from settings_tab where name = 'LPU'</Sql>
                </Query>
                <Query>
                  <Sql>otchet_date select to_char(now(),'dd.mm.yyyy')</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 SELECT '$id', f.kod_feld||' '||conv_to_null(f.fam)||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid) as doctor , count(distinct d.dan_id) as cnt_pat, count(r.rezept_id) as cnt_rez, count(*) as cnt 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  r.date_vipiski between date(':param1_1_: ')  and  date(':param1_2_: ') 
AND not r.bad 
group by 2</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="8003000" Name="Отчет по выписанным медикаментам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Отчет по выписанным медикаментам.xls">
              <Queries>
                <Query>
                  <Sql>count_pats select sum(cnt_pat) from ( 
SELECT f.kod_feld, count(distinct d.dan_id) as cnt_pat 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  r.date_vipiski between date(':param1_1_: ')  and  date(':param1_2_: ') 
AND not r.bad and (d.uchactok_id = :param2_1_: or :param2_1_:=-1) 
and (f.otdel = ':param3_1_:' or :param3_1_:=-1) 
and :param4_1_: 
group by 1) as q</Sql>
                </Query>
                <Query>
                  <Sql>count_recs SELECT count(*) as cnt 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  r.date_vipiski between date(':param1_1_: ')  and  date(':param1_2_: ') 
AND not r.bad and (d.uchactok_id = :param2_1_: or :param2_1_:=-1) 
and (f.otdel = ':param3_1_:' or :param3_1_:=-1) 
and :param4_1_:</Sql>
                </Query>
                <Query>
                  <Sql>count_rez SELECT count(r.rezept_id) as cnt_rez 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  r.date_vipiski between date(':param1_1_: ')  and  date(':param1_2_: ') 
AND not r.bad and (d.uchactok_id = :param2_1_: or :param2_1_:=-1) 
and (f.otdel = ':param3_1_:' or :param3_1_:=-1) 
and :param4_1_:</Sql>
                </Query>
                <Query>
                  <Sql>lpu_name select upper(value) from settings_tab where name = 'LPU'</Sql>
                </Query>
                <Query>
                  <Sql>otchet_date select to_char(now(),'dd.mm.yyyy')</Sql>
                </Query>
                <Query>
                  <Sql>z_otd select distinct case when :param3_1_:=-1 then 'Все отделения' else nam_otdel end from otdel_tab where otdel =:param3_1_: or :param3_1_: =-1</Sql>
                </Query>
                <Query>
                  <Sql>z_uch select distinct case when :param2_1_: =-1 then 'Все участки' else uchactok end from uchactok_tab where uchactok_id = :param2_1_: or :param2_1_: =-1</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 SELECT '$id', 
case when length(l.mnn_lat)&lt;2 then '(торг.) '||conv_to_null(l.nam_lat)||', '||conv_to_null(lf.name)||', '||conv_to_null(l.doza) else '(MHH) '||conv_to_null(l.mnn_lat)||', '||conv_to_null(lf.name)||', '||conv_to_null(l.doza) end as name_med, 
max(r.kod_minzd) as kod, l.d_ls, count(r.rezept_id) as cnt_rez 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
LEFT JOIN codifiers.sp_lf_tab lf ON lf.id = l.c_lf 
WHERE  r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad and (d.uchactok_id = :param2_1_: or :param2_1_:=-1) 
and (f.otdel = ':param3_1_:' or :param3_1_:=-1) 
and :param4_1_: 
group by 2,4 
order by 2</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param4" Caption="Льгота" Type="select">
                  <Sql>SELECT 'length(trim(r.kod_lgot)) = 3'::text, 'Федеральная'::text  UNION  SELECT 'length(trim(r.kod_lgot)) = 2'::text, 'Местная'::text  UNION  SELECT 'true'::text, 'Все'::text </Sql>
                </Parameter>
                <Parameter Name="param3" Caption="Отделение" Type="select">
                  <Sql>select -1, 'Все отделения', 0 union select otdel, nam_otdel, 1 from otdel_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Участок" Type="select">
                  <Sql>select -1, 'Все участки', 0 union  select uchactok_id, uchactok,1 from uchactok_tab  order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="8203000" Name="Отчет по категориям пациентов за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Отчет по категориям пациентов за период.xls">
              <Queries>
                <Query>
                  <Sql>lpu_name select upper(value) from settings_tab where name = 'LPU'</Sql>
                </Query>
                <Query>
                  <Sql>otchet_date select to_char(now(),'dd.mm.yyyy')</Sql>
                </Query>
                <Query>
                  <Sql>zapros_total SELECT count(distinct d.dan_id) as cnt_pat, count(DISTINCT r.rezept_id) as cnt_rez 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON /*ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num */ 
upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
LEFT JOIN lgota_tab lg ON lg.code = r.kod_lgot 
WHERE  r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad  and (d.uchactok_id = :param3_1_: or :param3_1_:=-1) 
and (f.otdel = ':param2_1_:' or :param2_1_:=-1)</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 SELECT '$id', r.kod_lgot||' ' ||lg.nam_lgota as nam_lgota, count(distinct d.dan_id) as cnt_pat, count(DISTINCT r.rezept_id) as cnt_rez 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON /*ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num */ 
upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
LEFT JOIN lgota_tab lg ON lg.code = r.kod_lgot 
WHERE  r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad  and (d.uchactok_id = :param3_1_: or :param3_1_:=-1) 
and (f.otdel = ':param2_1_:' or :param2_1_:=-1) 
group by 2 
order by 2</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param2" Caption="Отделение" Type="select">
                  <Sql>select -1, 'Все отделения', 0 union select otdel, nam_otdel, 1 from otdel_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="Участок" Type="select">
                  <Sql>select -1, 'Все участки', 0 union  select uchactok_id, uchactok,1 from uchactok_tab  order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="8403000" Name="Паспорт врачебного участка граждан, имеющих право на получение набора социальных услуг" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Паспорт врачебного участка граждан, имеющих право на получение набора социальных услуг.xls">
              <Queries>
                <Query>
                  <Sql>lpu_address select value from settings_tab where name = 'ADDRESS'</Sql>
                </Query>
                <Query>
                  <Sql>lpu_name select upper(value) from settings_tab where name = 'LPU'</Sql>
                </Query>
                <Query>
                  <Sql>zapros_doctor select distinct case when :param2_1_:=-1 then 'Все врачи' else f.full_doctor_id||' '||conv_to_null(f.fam)||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid) end 
from full_doctor_tab f 
where (f.full_doctor_id = :param2_1_: Or :param2_1_:=-1)</Sql>
                </Query>
                <Query>
                  <Sql>zapros_dolg_doctor select f.dolg_doctor from full_doctor_tab f where f.full_doctor_id = :param2_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros_uchastok select case when ':param3_1_:'!='-1' then (select name from codifiers.uchactok_tab where id =:param3_1_:) else 
case when ':param2_1_:'='-1' then 'Все участки' else (select name from codifiers.uchactok_tab where doctor_id = :param2_1_:) end end</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 SELECT distinct '$id',conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) as fio,  
d.date_born, r.kod_lgot, d.pens, d.ser_pol||' '||d.num_pol as polis, mkb.mkb, r.diagn_id, 
/*disp.diagn_id as diagnoz,*/ r.dan_id as danid, r.talon_id as talonid, f.fio as doc_fio, 
f.doctor_id, to_char(r.date_vipiski, 'dd.mm.yyyy') as date_vipiski, 
coalesce(replace(replace(l.name,'&gt;',''),'&lt;',''),'')||' '||coalesce(l.doza,'') as name_med, 
r.rezept_ser||' '||r.rezept_num as sernum_rez, 
trunc(ra.kolvo::numeric,2) as kol_ap,  trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap,  
coalesce(l1.name,'')||' '||coalesce(l1.doza,'') as name_med_ap 
FROM rezept_tab r  
LEFT JOIN  dan_tab d On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
LEFT JOIN codifiers.preparat_tab l ON l.code = r.kod_minzd 
LEFT JOIN codifiers.preparat_tab l1 ON l1.code = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
left join dispensary_registration_tab disp ON disp.dan_id = d.dan_id and (disp.leave_date&gt;now() or disp.leave_date is null) 
left join mkb_tab mkb ON r.diagn_id = mkb.kod_d 
WHERE  r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad and (f.doctor_id = :param2_1_: or :param2_1_:=-1) 
and (d.uchactok_id = :param3_1_: or :param3_1_:=-1) 
order by 2</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 select distinct to_char(d2.date, 'dd.mm.yyyy'), to_char(d2.date_sn,'dd.mm.yyyy') as date_sn from ( 
select date, dispan_uchet_id 
from dispan_uchet_tab 
where date=(select max(d1.date) from dispan_uchet_tab d1 where d1.dan_id = :danid: and d1.diagn_id = ':diagnoz:') 
) q 
join dispan_uchet_tab d2 ON d2.dispan_uchet_id = q.dispan_uchet_id</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 select count(distinct visit_id) from visit_tab v 
join talon_tab t on t.talon_id = v.talon_id 
where v.data_pos BETWEEN ':param1_1_:' and ':param1_2_:' and t.dan_id = :danid: 
and t.diag_osn =':diagn_id:'</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 SELECT CASE WHEN SUM(naznacheno::integer) is null THEN '0' 
ELSE SUM(naznacheno::integer)::text END 
 FROM kurort_tab WHERE dan_id = :danid: AND date BETWEEN ':param1_1_:' AND ':param1_2_:'</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 SELECT CASE WHEN SUM(proshel::integer) is null THEN '0' 
ELSE SUM(proshel::integer)::text END 
FROM kurort_tab WHERE dan_id = :danid: AND date BETWEEN ':param1_1_:' AND ':param1_2_:'</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param2" Caption="Врач:" Type="select">
                  <Sql>select -1, 'Все врачи' union SELECT f.full_doctor_id, f.full_doctor_id||' '||f.fio||' ('||f.dolg_doctor||')' FROm full_doctor_tab f where f.dolg_doctor_id !=900 ORDER BY 1,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="Участок" Type="select">
                  <Sql>select -1, 'Все участки' union SELECT uchactok_id, uchactok from uchactok_tab order by 1</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="8603000" Name="Сведения о рецептах на получение необходимых лекарственных средств, выписанных врачом (фельдшером) отдельным категориям граждан" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\8603000.xls">
              <Queries>
                <Query>
                  <Sql>lpu_name select upper(value) from settings_tab where name = 'LPU'</Sql>
                </Query>
                <Query>
                  <Sql>zapros1(vidlg) SELECT count(distinct d.dan_id), count(r.rezept_id) as cnt_rez 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
LEFT JOIN lgota_tab lg ON lg.code = trim(r.kod_lgot) 
WHERE  r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad  and trim(r.kod_lgot) in (vidlg)</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="8803000" Name="Сведения о лекарствах, выписанных и отпущенных гражданам, имеющим право льготу" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Сведения о лекарствах, выписанных и отпущенных гражданам, имеющим право льготу.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 SELECT '$id',d.fam||' '||d.nam||' '||conv_to_null(d.mid) as fio,  d.ser_pol||' '||d.num_pol as polis, 
r.snils, r.rezept_ser||' '||r.rezept_num as sernum_rez, r.date_vipiski,  
trunc(ra.kolvo::numeric,2) as kol_ap,  trunc((ra.cost*ra.kolvo)::numeric,2) as  summa_ap,  
trunc(ra.cost::numeric,2) as cost_ap, 
l.mnn_rus||', '||l.doza as name_med, ra.date_out 
, f.kod_feld||' ('||f.fio||')' as doctor,r.kod_lgot as lgota 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  r.date_vipiski between date(':param1_1_: ')  and  date(':param1_2_: ') 
AND not r.bad</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="9003000" Name="Перечень рецептов, выписанных по конкретному ЛС" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Перечень рецептов, выписанных по конкретному ЛС.xls">
              <Queries>
                <Query>
                  <Sql>lpu_name select upper(value) from settings_tab where name = 'LPU'</Sql>
                </Query>
                <Query>
                  <Sql>otchet_date select to_char(now(),'dd.mm.yyyy')</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 SELECT '$id',conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) as fio,  
r.snils, d.date_born, r.date_vipiski,  r.doza, 
r.kol, f.full_fio as doctor 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad  
AND l.name_med ILIKE '%:param2_1_:%' 
order by 2</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Препарат" Type="text">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="9203000" Name="Перечень льготников с количеством рецептов за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Перечень льготников с количеством рецептов за период.xls">
              <Queries>
                <Query>
                  <Sql>lpu_name select upper(value) from settings_tab where name = 'LPU'</Sql>
                </Query>
                <Query>
                  <Sql>otchet_date select to_char(now(),'dd.mm.yyyy')</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 SELECT '$id',conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) as fio,  
d.date_born, case when length(trim(r.kod_lgot)) = 2 then '9'||r.kod_lgot else r.kod_lgot end as kod_lgot, 
conv_to_null(f.fam)||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid) as doctor, 
count(r.rezept_id) as kolvo_rez 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
WHERE  r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad 
group by 1,2,3,4,5 
order by 2</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2009103001" Name="Отчет по ЛПУ" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Отчет по ЛПУ.xls">
              <Queries>
                <Query>
                  <Sql>lpu_zapros SELECT (SELECT value FROM settings_tab WHERE name ilike 'ogrn' LIMIT 1)||' '||(SELECT value FROM settings_tab WHERE name ilike 'lpu' LIMIT 1)</Sql>
                </Query>
                <Query>
                  <Sql>now_zapros SELECT to_char(now(),'dd.mm.yyyy hh.mi.ss')</Sql>
                </Query>
                <Query>
                  <Sql>pat_kol_zap SELECT COUNT(DISTINCT r.dan_id) as par_kol, COUNT(r.rezept_id) as rez_kol FROm rezept_tab r 
WHERE r.date_vipiski BETWEEN ':period1_1_:' AND ':period1_2_:' AND bad != true</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period1" Caption="Дата выписки" Type="date_period">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2011303000" Name="Сведения о выписке и обслуживании рецептов для льготных категорий граждан с начала года" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\2011303000.xls">
              <Queries>
                <Query>
                  <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
                </Query>
                <Query>
                  <Sql>zapros01 select (select count(distinct f.dan_id) from fed_lgota_tab f join dan_tab d ON d.dan_id = f.dan_id 
where f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX' and d.prikreplen=1) 
+ (select count(distinct l.dan_id) from local_lgota_tab l join dan_tab d ON d.dan_id = l.dan_id and d.prikreplen=1 
where date_end is null or date_end&gt;':param1_2_:') 
 
/*SELECT count(distinct d.dan_id) as cnt_pat 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
LEFT JOIN lgota_tab lg ON lg.code = r.kod_lgot 
WHERE  --r.date_vipiski between date(':param1_1_:')  and  date(':param1_2_:') AND 
not r.bad  
*/ 
---select count(*) from dan_tab where prikreplen =1 and kodlg is not null</Sql>
                </Query>
                <Query>
                  <Sql>zapros02 SELECT count(distinct d.dan_id) as cnt_pat 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON ra.rezept_ser = r.rezept_ser AND  ra.rezept_num  = r.rezept_num 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN lgot_preparat_tab l1 ON l1.kod = ra.nomk_ls 
LEFT JOIN sklad_tab s ON s.sklad_id = ra.sklad_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
LEFT JOIN lgota_tab lg ON lg.code = r.kod_lgot 
WHERE  r.date_vipiski between date(to_char(':param1_1_:'::date,'yyyy')||'-01-01')  and  date(':param1_2_:') AND 
not r.bad  
 
/* 
select count(distinct d.dan_id) from dan_tab d join talon_tab t ON t.dan_id = d.dan_id 
where prikreplen =1 and kodlg is not null 
and date_visit between ':param1_1_:' and ':param1_2_:'*/</Sql>
                </Query>
                <Query>
                  <Sql>zapros03 select count(distinct s.sklad_id) from sklad_tab s</Sql>
                </Query>
                <Query>
                  <Sql>zapros04 select count(distinct f.dan_id) from full_doctor_tab f 
JOIN rezept_tab r ON r.doctor_id = f.doctor_id 
where f.dolg_doctor_id!=900 
and f.is_working=1 
and f.kod_feld is not null</Sql>
                </Query>
                <Query>
                  <Sql>zapros05 select count(distinct f.doctor_id) from full_doctor_tab f 
JOIN rezept_tab r ON r.doctor_id = f.doctor_id 
where f.dolg_doctor_id in (403,404)</Sql>
                </Query>
                <Query>
                  <Sql>zapros06 select count(distinct t.talon_id) from talon_tab t 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
where  prikreplen =1 and (t.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR t.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and date_visit between ':param1_1_:' and ':param1_2_:'</Sql>
                </Query>
                <Query>
                  <Sql>zapros07 select count(distinct t.talon_id) from talon_tab t 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
where  prikreplen =1 and (t.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR t.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and date_visit between ':param1_1_:' and ':param1_2_:' 
and result_id = 7</Sql>
                </Query>
                <Query>
                  <Sql>zapros08 select count(distinct t.talon_id) from talon_tab t 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
where  prikreplen =1 and (t.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR t.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and date_visit between ':param1_1_:' and ':param1_2_:' 
and result_id =6</Sql>
                </Query>
                <Query>
                  <Sql>zapros09 select count(distinct r.rezept_id) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where prikreplen =1 and (r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR r.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros10 select  sum(summa) 
from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where prikreplen =1 and (r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR r.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros11 select count(rezept_id) from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  prikreplen =1 and (r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR r.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros12 select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  prikreplen =1 and (r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR r.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros13 select count(*) from lpu_tab</Sql>
                </Query>
                <Query>
                  <Sql>zapros14 select count(distinct r.rezept_id) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where prikreplen =1 and r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros15 select  sum(summa) 
from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where prikreplen =1 and r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  
and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros16 select count(rezept_id) from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  prikreplen =1 and r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  
and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros17 select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  prikreplen =1 and r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  
and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros18 select count(distinct r.rezept_id) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
LEFT JOIN talon_tab t ON t.talon_id = r.talon_id 
where prikreplen =1 and (r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR r.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad 
and ((t.diag_osn between 'D66' and 'D68.9') OR (t.diag_osn between 'E84' and 'E84.9') OR (t.diag_osn ='E23.0') 
	OR (t.diag_osn between 'C92' and 'C92.9') OR (t.diag_osn between 'G35' and 'G35.9') 
	OR (t.diag_osn between 'Z94' and 'Z94.9') OR (t.diag_osn between 'E75' and 'E75.9') )</Sql>
                </Query>
                <Query>
                  <Sql>zapros19 select  sum(summa) 
from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
LEFT JOIN talon_tab t ON t.talon_id = r.talon_id 
where prikreplen =1 and (r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR r.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad 
and ((t.diag_osn between 'D66' and 'D68.9') OR (t.diag_osn between 'E84' and 'E84.9') OR (t.diag_osn ='E23.0') 
	OR (t.diag_osn between 'C92' and 'C92.9') OR (t.diag_osn between 'G35' and 'G35.9') 
	OR (t.diag_osn between 'Z94' and 'Z94.9') OR (t.diag_osn between 'E75' and 'E75.9') )</Sql>
                </Query>
                <Query>
                  <Sql>zapros20 select count(rezept_id) from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
LEFT JOIN talon_tab t ON t.talon_id = r.talon_id 
WHERE  prikreplen =1 and (r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR r.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad 
and ((t.diag_osn between 'D66' and 'D68.9') OR (t.diag_osn between 'E84' and 'E84.9') OR (t.diag_osn ='E23.0') 
	OR (t.diag_osn between 'C92' and 'C92.9') OR (t.diag_osn between 'G35' and 'G35.9') 
	OR (t.diag_osn between 'Z94' and 'Z94.9') OR (t.diag_osn between 'E75' and 'E75.9') )</Sql>
                </Query>
                <Query>
                  <Sql>zapros21 select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
LEFT JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
LEFT JOIN talon_tab t ON t.talon_id = r.talon_id 
WHERE  prikreplen =1 and (r.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR r.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and date_vipiski between ':param1_1_:' and ':param1_2_:' 
and not r.bad 
and ((t.diag_osn between 'D66' and 'D68.9') OR (t.diag_osn between 'E84' and 'E84.9') OR (t.diag_osn ='E23.0') 
	OR (t.diag_osn between 'C92' and 'C92.9') OR (t.diag_osn between 'G35' and 'G35.9') 
	OR (t.diag_osn between 'Z94' and 'Z94.9') OR (t.diag_osn between 'E75' and 'E75.9') )</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2015303000" Name="Протоколы ДЛО" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Протоколы ДЛО.xls">
              <Queries>
                <Query>
                  <Sql>zapros SELECT '$id'::text, :param4_1_: as date_v, d.fio, d.date_born, d.address, d.ser_pol||' '||d.num_pol as polis, d.pens as snils, 
nam_rus, r.diagn_id,r.doctor_id,r.rezept_num 
FROM dan_tab d  
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
LEFT JOIN lgot_preparat_tab l ON l.kod = r.kod_minzd 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = r.doctor_id 
LEFT JOIN codifiers.sp_lf_tab lf ON lf.id = l.c_lf 
WHERE  :param4_1_: between date(':param1_1_:')  and  date(':param1_2_:') 
AND not r.bad and (d.uchactok_id = :param2_1_: or :param2_1_:=-1) 
and (f.otdel = ':param3_1_:' or :param3_1_:=-1) 
and r.p_kek=1 
order by 2,3</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param3" Caption="Отделение" Type="select">
                  <Sql>select -1, 'Все отделения', 0 union select otdel, nam_otdel, 1 from otdel_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param4" Caption="По" Type="select2">
                  <Sql>r.date_vipiski=дате выписки|r.dt_vnes_rezept=дате внесения рецепта</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Участок" Type="select">
                  <Sql>select -1, 'Все участки', 0 union  select uchactok_id, uchactok,1 from uchactok_tab  order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2016303000" Name="Сведения о выписке и обслуживании рецептов УВОВ ИВОВ" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Сведения о выписке и обслуживании рецептов УВОВ ИВОВ.xls">
              <Queries>
                <Query>
                  <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
                </Query>
                <Query>
                  <Sql>zapros01 select count(distinct d.dan_id) 
from dan_tab d 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
where d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null))</Sql>
                </Query>
                <Query>
                  <Sql>zapros02 select count(distinct d.dan_id) 
from dan_tab d 
join talon_tab t ON t.dan_id = d.dan_id 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
where d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt; ':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and (t.data_vnes_inf between '2012-01-01' and ':param1_2_:' )</Sql>
                </Query>
                <Query>
                  <Sql>zapros03 select count(distinct s.sklad_id) from sklad_tab s</Sql>
                </Query>
                <Query>
                  <Sql>zapros04 select count(distinct f.dan_id) from full_doctor_tab f 
where f.dolg_doctor_id not in (404,900) 
and f.kod_feld is not null</Sql>
                </Query>
                <Query>
                  <Sql>zapros05 select count(distinct f.doctor_id) from full_doctor_tab f 
where f.dolg_doctor_id=404</Sql>
                </Query>
                <Query>
                  <Sql>zapros06 select count(distinct v.visit_id) from visit_tab v 
join talon_tab t on v.talon_id=t.talon_id 
JOIN dan_tab d ON t.dan_id = d.dan_id 
join fed_lgota_tab f on  f.dan_id=d.dan_id 
join dispensary_registration_tab l on l.dan_id=d.dan_id 
where d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and (v.data_pos between ':param1_1_:' and ':param1_2_:')</Sql>
                </Query>
                <Query>
                  <Sql>zapros07 select count(distinct t.talon_id) from talon_tab t 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
where  d.prikreplen =1 and (t.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  
OR t.dan_id in (select count(distinct dan_id) from local_lgota_tab 
where date_end is null or date_end&gt;':param1_2_:') ) 
and (date_visit between ':param1_1_:' and ':param1_2_:' ) 
and result_id = 7</Sql>
                </Query>
                <Query>
                  <Sql>zapros08 select count(distinct t.talon_id) from talon_tab t 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
where  d.prikreplen =1 and (t.dan_id in (select distinct f.dan_id from  fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR t.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and (date_visit between ':param1_1_:' and ':param1_2_:' ) 
and result_id =6</Sql>
                </Query>
                <Query>
                  <Sql>zapros09 select count(distinct r.rezept_id) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1  
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros10 select  sum(summa) 
from rezept_tab r 
where (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros11 select count(distinct rezept_id) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros12 select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros13 select count(*) from lpu_tab</Sql>
                </Query>
                <Query>
                  <Sql>zapros14 select count(distinct r.rezept_id) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 AND length(r.kod_lgot) = 3 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros15 select  sum(r.summa) 
from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 AND length(r.kod_lgot) = 3 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros16 select count(distinct rezept_id) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1 and length(r.kod_lgot)=3 
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros17 select sum(ra.cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1 and length(r.kod_lgot)=3 
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros18 select  count(distinct r.rezept_id) 
from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')</Sql>
                </Query>
                <Query>
                  <Sql>zapros19 select  sum(r.summa) 
from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')</Sql>
                </Query>
                <Query>
                  <Sql>zapros20 select count(distinct r.rezept_id) 
from rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
where d.prikreplen =1 and 
(substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75' ) 
and (ra.date_out between ':param1_1_:' and ':param1_2_:') and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros21 select sum(ra.cost) 
from rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
where d.prikreplen =1 and 
(substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75' ) 
and (ra.date_out between ':param1_1_:' and ':param1_2_:') and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros22 select count(distinct d.dan_id) 
from dan_tab d 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
where r.kod_lgot in ('010','020') 
and d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null))</Sql>
                </Query>
                <Query>
                  <Sql>zapros23 select count(distinct r.rezept_id) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 AND r.kod_lgot in ('010','020') 
and (date_vipiski between '2012-01-01' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros24 select count(distinct r.rezept_id) 
from rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
where d.prikreplen =1 and r.kod_lgot in ('010','020') and 
(substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75' ) 
and (r.date_vipiski between '2012-01-01' and ':param1_2_:')  and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros25 --Количество врачей, занятых выпиской льготных рецептов	увов ивов	 
 
/*select count(distinct f.dan_id) from full_doctor_tab f 
JOIN rezept_tab r ON r.doctor_id = f.doctor_id 
where f.dolg_doctor_id!=900 and r.kod_lgot in ('010','020') */ 
/*and f.is_working=1 */ 
/*and f.kod_feld is not null and (r.date_vipiski between ':param1_1_:' and ':param1_2_:' ) */ 
 
/*select count(distinct f.dan_id) from full_doctor_tab f 
JOIN rezept_tab r ON r.doctor_id = f.doctor_id 
 JOIN (select * from (SELECT distinct f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, 
f.pens as pens FROm fed_lgota_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null) as q where lgota IN ('010','020')) as fed1 ON fed1.dan_id = r.dan_id 
where f.dolg_doctor_id!=900 
and f.is_working=1 
and f.kod_feld is not null*/</Sql>
                </Query>
                <Query>
                  <Sql>zapros26 select count(distinct d.dan_id) 
from dan_tab d 
join talon_tab t ON t.dan_id = d.dan_id 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
where d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt; ':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and (t.data_vnes_inf between '2012-01-01' and ':param1_2_:') 
and 
(substr(t.diag_osn, 1, 3) ilike 'd66' 
OR substr(t.diag_osn, 1, 3) ilike 'd67' 
OR substr(t.diag_osn, 1, 3) ilike 'd68' 
OR substr(t.diag_osn, 1, 3) ilike 'E84' 
OR substr(t.diag_osn, 1, 3) ilike 'E23.0' 
OR substr(t.diag_osn, 1, 3) ilike 'C92' 
OR substr(t.diag_osn, 1, 3) ilike 'G35' 
OR substr(t.diag_osn, 1, 3) ilike 'Z94' 
OR substr(t.diag_osn, 1, 3) ilike 'E75')</Sql>
                </Query>
                <Query>
                  <Sql>zapros27 --Количество фельдшеров занятых выпиской льготных рецептов		увов ивов 
 
/*select count(distinct f.doctor_id) from full_doctor_tab f 
JOIN rezept_tab r ON r.doctor_id = f.doctor_id 
where f.dolg_doctor_id in (403,404) and r.kod_lgot in ('010','020') */ 
 
/*select count(distinct f.doctor_id) from full_doctor_tab f 
JOIN rezept_tab r ON r.doctor_id = f.doctor_id 
JOIN (select * from (SELECT distinct f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, 
f.pens as pens FROm fed_lgota_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null) as q where lgota IN ('010','020')) as fed1 ON fed1.dan_id = r.dan_id 
where f.dolg_doctor_id in (403,404)*/</Sql>
                </Query>
                <Query>
                  <Sql>zapros28 select count(distinct v.visit_id) from visit_tab v 
join talon_tab t on v.talon_id=t.talon_id 
JOIN dan_tab d ON t.dan_id = d.dan_id 
join fed_lgota_tab f on  f.dan_id=d.dan_id 
join dispensary_registration_tab l on l.dan_id=d.dan_id 
JOIN rezept_tab r ON r.doctor_id = v.doctor_id 
where r.kod_lgot in ('010','020')  and 
d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and (v.data_pos between ':param1_1_:' and ':param1_2_:')</Sql>
                </Query>
                <Query>
                  <Sql>zapros29 select count(distinct t.talon_id) from talon_tab t 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
JOIN rezept_tab r ON r.doctor_id = t.doctor_id 
where  d.prikreplen =1 and (t.dan_id in (select distinct f.dan_id from  fed_lgota_tab f 
 where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  OR t.dan_id 
 in (select count(distinct dan_id) from local_lgota_tab where date_end is null or date_end&gt;':param1_2_:') ) 
and (date_visit between ':param1_1_:' and ':param1_2_:' ) and r.kod_lgot in ('010','020') 
and result_id = 7</Sql>
                </Query>
                <Query>
                  <Sql>zapros30 select count(distinct t.talon_id) from talon_tab t 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
JOIN rezept_tab r ON r.doctor_id = t.doctor_id 
where  prikreplen =1 and (t.dan_id in (select distinct f.dan_id from  
fed_lgota_tab f where pens like '___-___-___ __' AND pens != 'XXX-XXX-XXX XX')  
OR t.dan_id in (select count(distinct dan_id) from local_lgota_tab where date_end is null 
or date_end&gt;':param1_2_:' ) ) 
and (date_visit between ':param1_1_:' and ':param1_2_:' ) and r.kod_lgot in ('010','020') 
and result_id =7</Sql>
                </Query>
                <Query>
                  <Sql>zapros31 select count(distinct r.rezept_id) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 and r.kod_lgot in ('010','020') 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros32 select  sum(summa) 
from rezept_tab r 
where (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad and r.kod_lgot in ('010','020')</Sql>
                </Query>
                <Query>
                  <Sql>zapros33 select count(distinct r.rezept_id) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where prikreplen =1  and r.kod_lgot in ('010','020') 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros34 select  sum(summa) 
from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 and r.kod_lgot in ('010','020') 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros35 select  count(distinct r.rezept_id) 
from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 and r.kod_lgot in ('010','020') 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad  
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')</Sql>
                </Query>
                <Query>
                  <Sql>zapros36 select  sum(summa) 
from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 and r.kod_lgot in ('010','020') 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')</Sql>
                </Query>
                <Query>
                  <Sql>zapros37 select count(distinct rezept_id) from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE d.prikreplen = 1 
and (ra.date_out between  ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros38 select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE d.prikreplen = 1 
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros39 select count(distinct r.rezept_id) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1 and r.kod_lgot in ('010','020') 
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros40 select sum(ra.cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  prikreplen =1 and r.kod_lgot in ('010','020') 
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros41 select count(distinct r.rezept_id) 
from rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
where d.prikreplen =1 and 
(substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75' ) 
and (ra.date_out between ':param1_1_:' and ':param1_2_:')  and not r.bad 
and r.kod_lgot in ('010','020')</Sql>
                </Query>
                <Query>
                  <Sql>zapros42 select sum(ra.cost) 
from rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
where d.prikreplen =1 and 
(substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75' ) 
and (ra.date_out between ':param1_1_:' and ':param1_2_:')  and not r.bad 
and r.kod_lgot in ('010','020')</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2018303000" Name="Отчет ОНЛС" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по льготникам и льготным рецептам\Отчёты по льготникам и выписанным льготным рецептам\Отчет ОНЛС.xls">
              <Queries>
                <Query>
                  <Sql>z1_f(par2) select count(distinct d.dan_id) 
from dan_tab d 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
where d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and length(r.kod_lgot) = 3 
and par2</Sql>
                </Query>
                <Query>
                  <Sql>z1_r(par3) select count(distinct d.dan_id) 
from dan_tab d 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
where d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and r.ist_financing=1 
and par3</Sql>
                </Query>
                <Query>
                  <Sql>z1_uvov_f select count(distinct d.dan_id) 
from dan_tab d 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
where r.kod_lgot in ('010','020') 
and d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and length(r.kod_lgot) = 3</Sql>
                </Query>
                <Query>
                  <Sql>z1_uvov_r select count(distinct d.dan_id) 
from dan_tab d 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
where r.kod_lgot in ('010','020') 
and d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z1_uvov_vzn select count(distinct d.dan_id) 
from dan_tab d 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
where r.kod_lgot in ('010','020') 
and d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and (substr(l.diagn_id, 1, 3) ilike 'd66' 
OR substr(l.diagn_id, 1, 3) ilike 'd67' 
OR substr(l.diagn_id, 1, 3) ilike 'd68' 
OR substr(l.diagn_id, 1, 3) ilike 'E84' 
OR substr(l.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(l.diagn_id, 1, 3) ilike 'C92' 
OR substr(l.diagn_id, 1, 3) ilike 'G35' 
OR substr(l.diagn_id, 1, 3) ilike 'Z94' 
OR substr(l.diagn_id, 1, 3) ilike 'E75')</Sql>
                </Query>
                <Query>
                  <Sql>z1_vzn(par1) select count(distinct d.dan_id) 
from dan_tab d 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
where d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and (substr(l.diagn_id, 1, 3) ilike 'd66' 
OR substr(l.diagn_id, 1, 3) ilike 'd67' 
OR substr(l.diagn_id, 1, 3) ilike 'd68' 
OR substr(l.diagn_id, 1, 3) ilike 'E84' 
OR substr(l.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(l.diagn_id, 1, 3) ilike 'C92' 
OR substr(l.diagn_id, 1, 3) ilike 'G35' 
OR substr(l.diagn_id, 1, 3) ilike 'Z94' 
OR substr(l.diagn_id, 1, 3) ilike 'E75') 
and par1</Sql>
                </Query>
                <Query>
                  <Sql>z10_f(mkb1,mkb2) select  sum(summa) 
from rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
where (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and length(r.kod_lgot) = 3 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z10_r(mkb1,mkb2) select  sum(summa) 
from rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
where (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and r.ist_financing=1 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z10_vzn(mkb1,mkb2) select  sum(summa) 
from rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
where (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2') 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')</Sql>
                </Query>
                <Query>
                  <Sql>z11_f(mkb1,mkb2) select count(distinct rezept_id) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and length(r.kod_lgot) = 3  
and r.ist_financing=1 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z11_vzn(mkb1,mkb2) select count(distinct rezept_id) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and r.ist_financing=1 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2') 
and(substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')</Sql>
                </Query>
                <Query>
                  <Sql>z12_f(mkb1,mkb2) select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and length(r.kod_lgot) = 3  
and r.ist_financing=1 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z12_vzn(mkb1,mkb2) select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and r.ist_financing=1 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75') 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z2_f(par2) select sum(r.kol) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1  
and (r.date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad  
and length(r.kod_lgot) = 3  
and par2</Sql>
                </Query>
                <Query>
                  <Sql>z2_r(par3) select sum(r.kol) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1  
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad  
and r.ist_financing=1  
and par3</Sql>
                </Query>
                <Query>
                  <Sql>z2_uvov_f select sum(r.kol) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 and r.kod_lgot in ('010','020') 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and length(r.kod_lgot) = 3</Sql>
                </Query>
                <Query>
                  <Sql>z2_uvov_r select sum(r.kol) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 and r.kod_lgot in ('010','020') 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z2_uvov_vzn select sum(r.kol) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1 and r.kod_lgot in ('010','020') 
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')</Sql>
                </Query>
                <Query>
                  <Sql>z2_vzn(par1) select sum(r.kol) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1  
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad  
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75') 
and par1</Sql>
                </Query>
                <Query>
                  <Sql>z3_f(par2) select sum(r.kol) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and length(r.kod_lgot) = 3   
and par2</Sql>
                </Query>
                <Query>
                  <Sql>z3_r(par3) select sum(r.kol) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and r.ist_financing=1    
and par3</Sql>
                </Query>
                <Query>
                  <Sql>z3_uvov_f select sum(r.kol) from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE d.prikreplen = 1 
and (ra.date_out between  ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad 
and length(r.kod_lgot) = 3</Sql>
                </Query>
                <Query>
                  <Sql>z3_uvov_r select sum(r.kol) from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE d.prikreplen = 1 
and (ra.date_out between  ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad 
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z3_uvov_vzn select sum(r.kol) from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE d.prikreplen = 1 
and (ra.date_out between  ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')</Sql>
                </Query>
                <Query>
                  <Sql>z3_vzn(par1) select sum(r.kol) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')  
and par1</Sql>
                </Query>
                <Query>
                  <Sql>z4_f(par2) select  sum(summa) 
from rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
where (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and length(r.kod_lgot) = 3   
and par2</Sql>
                </Query>
                <Query>
                  <Sql>z4_r(par3) select  sum(summa) 
from rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
where (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and r.ist_financing=1    
and par3</Sql>
                </Query>
                <Query>
                  <Sql>z4_uvov_f select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE d.prikreplen = 1 
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad 
and length(r.kod_lgot) = 3</Sql>
                </Query>
                <Query>
                  <Sql>z4_uvov_r select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE d.prikreplen = 1 
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad 
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z4_uvov_vzn select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE d.prikreplen = 1 
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')</Sql>
                </Query>
                <Query>
                  <Sql>z4_vzn(par1) select  sum(summa) 
from rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
where (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')  
and par1</Sql>
                </Query>
                <Query>
                  <Sql>z5_f(par2) select count(distinct rezept_id) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and length(r.kod_lgot) = 3  
and par2 
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z5_uvov_f select count(distinct rezept_id) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad 
and length(r.kod_lgot) = 3   
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z5_uvov_vzn select count(distinct rezept_id) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')  
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z5_vzn(par1) select count(distinct rezept_id) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75') 
and par1 
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z6_f(par2) select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and length(r.kod_lgot) = 3   
and par2 
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z6_uvov_f select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE d.prikreplen = 1 
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad 
and length(r.kod_lgot) = 3   
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z6_uvov_vzn select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE d.prikreplen = 1 
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and r.kod_lgot in ('010','020') 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')  
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z6_vzn(par1) select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75')  
and par1 
and r.ist_financing=1</Sql>
                </Query>
                <Query>
                  <Sql>z7_f(mkb1,mkb2) select count(distinct d.dan_id) 
from dan_tab d 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
where d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and length(r.kod_lgot) = 3 
and (substr(l.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(l.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z7_r(mkb1,mkb2) select count(distinct d.dan_id) 
from dan_tab d 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
where d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and r.ist_financing=1 
and (substr(l.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(l.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z7_vzn(mkb1,mkb2) select count(distinct d.dan_id) 
from dan_tab d 
left join fed_lgota_tab f on  f.dan_id=d.dan_id 
left join dispensary_registration_tab l on l.dan_id=d.dan_id 
LEFT JOIN rezept_tab r On r.dan_id = d.dan_id 
where d.prikreplen=1 AND 
((l.dan_id is NOT NULL AND l.lgota_id is not null and 
(l.leave_date is null or l.leave_date&gt;':param1_2_:')) 
OR 
((f.pens like '___-___-___ __' AND f.pens != 'XXX-XXX-XXX XX') AND f.dan_id is not null)) 
and (substr(l.diagn_id, 1, 3) ilike 'd66' 
OR substr(l.diagn_id, 1, 3) ilike 'd67' 
OR substr(l.diagn_id, 1, 3) ilike 'd68' 
OR substr(l.diagn_id, 1, 3) ilike 'E84' 
OR substr(l.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(l.diagn_id, 1, 3) ilike 'C92' 
OR substr(l.diagn_id, 1, 3) ilike 'G35' 
OR substr(l.diagn_id, 1, 3) ilike 'Z94' 
OR substr(l.diagn_id, 1, 3) ilike 'E75') 
and (substr(l.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(l.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z8_f(mkb1,mkb2) select sum(r.kol) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1  
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad  
and length(r.kod_lgot) = 3 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z8_r(mkb1,mkb2) select sum(r.kol) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1  
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad  
and r.ist_financing=1 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z8_vzn(mkb1,mkb2) select sum(r.kol) from rezept_tab r 
JOIN dan_tab d ON d.dan_id = r.dan_id 
where d.prikreplen =1  
and (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad  
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75') 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z9_f(mkb1,mkb2) select sum(r.kol) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and length(r.kod_lgot) = 3 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z9_r(mkb1,mkb2) select sum(r.kol) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and r.ist_financing=1 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>z9_vzn(mkb1,mkb2) select sum(r.kol) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad 
and (substr(r.diagn_id, 1, 3) ilike 'd66' 
OR substr(r.diagn_id, 1, 3) ilike 'd67' 
OR substr(r.diagn_id, 1, 3) ilike 'd68' 
OR substr(r.diagn_id, 1, 3) ilike 'E84' 
OR substr(r.diagn_id, 1, 3) ilike 'E23.0' 
OR substr(r.diagn_id, 1, 3) ilike 'C92' 
OR substr(r.diagn_id, 1, 3) ilike 'G35' 
OR substr(r.diagn_id, 1, 3) ilike 'Z94' 
OR substr(r.diagn_id, 1, 3) ilike 'E75') 
and (substr(r.diagn_id, 1, 3) ilike 'mkb1' 
OR substr(r.diagn_id, 1, 3) ilike 'mkb2')</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 select count(distinct s.sklad_id) from sklad_tab s</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 select count(distinct f.dan_id) from full_doctor_tab f 
where f.dolg_doctor_id not in (404,900) 
and f.kod_feld is not null</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 select count(distinct f.doctor_id) from full_doctor_tab f 
where f.dolg_doctor_id=404</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 select  sum(summa) 
from rezept_tab r 
where (date_vipiski between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 select  sum(summa) 
from rezept_tab r 
where (date_vipiski between '2012-01-01' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
                <Query>
                  <Sql>zapros6 select count(*) from lpu_tab</Sql>
                </Query>
                <Query>
                  <Sql>zapros7 select sum(cost) 
from  rezept_tab r 
LEFT JOIN dan_tab d On r.dan_id = d.dan_id 
JOIN rezept_ap_tab ra ON upper(ltrim(ra.rezept_ser,'0')) = upper(ltrim(r.rezept_ser,'0')) 
AND  upper(ltrim(ra.rezept_num,'0'))  = upper(ltrim(r.rezept_num,'0')) 
WHERE  d.prikreplen =1  
and (ra.date_out between ':param1_1_:' and ':param1_2_:' ) 
and not r.bad</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
          </Reports>
          <Folders />
        </Folder>
      </Folders>
    </Folder>
    <Folder Name="Отчеты по больничным листам и временной нетрудоспособности">
      <Reports>
        <Report Id="137" Name="Журнал больничных листов" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по больничным листам и временной нетрудоспособности\Журнал больничных листов.xls">
          <Queries>
            <Query>
              <Sql>zzz SELECT distinct b.prev_blist_num as p1, b.nomer as p2, b.num_other_first as p3, 
b.num_other_next as p4 ,d.fam||' '||d.nam||' '||d.mid as p5, 
b.talon_id as p6, d.address as p7, m.mest_work as p8, b.diag_mkb_id as p9, 
b.last_diagn as p10, doc1.fio as p11, 
doc2.fio as p12, b.data_begin as p13, b.data_end as p14, 
b.data_end - b.data_begin as p15 
FROM blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num and :param4_1_: 
LEFT join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
LEFT JOIN mest_work_tab m ON d.mesto_work_id = m.mest_work_id 
LEFT JOIN full_doctor_tab doc1 ON doc1.full_doctor_id = b.doctor_id 
LEFT JOIN full_doctor_tab doc2 ON doc2.full_doctor_id = b.doctor_id_closed 
WHERE :param2_1_: between date(':period1_1_:') and date(':period1_2_:') 
and :param3_1_: 
and (:param5_1_:=-1 OR b.doctor_id = :param5_1_:) 
and ( (:param8_1_: = 1 and d.prikreplen = 1 ) OR :param8_1_:=2)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param3" Caption="Больничный закрыт" Type="select2">
              <Sql>b.fl_clos in (1)=да|b.fl_clos in (0)=нет|true=не важно</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Врач, выдавший больничный" Type="select">
              <Sql>SELECT -1 as  doctor_id, 'Все врачи'::text, 0  UNION  SELECT f.full_doctor_id, f.full_doctor_id||' '||f.fio||' ('||f.dolg_doctor||')',1 FROm full_doctor_tab f where full_doctor_id in (select distinct doctor_id from blist_tab) ORDER BY 3,1,2</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param4" Caption="Первичный" Type="select2">
              <Sql>b1.prev_blist_num is null=да|b1.prev_blist_num is not null=нет|true=не важно</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="по" Type="select2">
              <Sql>b.data_begin=Дате открытия БЛ|b.date_vnes_inf=Дате внесения БЛ|v.data_vnes_inf=Дате внесения визита</Sql>
            </Parameter>
            <Parameter Name="param8" Caption="Прикреплен" Type="select2">
              <Sql>1=да|2=не учитывать</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="183" Name="Количество больничных листов по диагнозам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по больничным листам и временной нетрудоспособности\Количество больничных листов по диагнозам.xls">
          <Queries>
            <Query>
              <Sql>zapros0 SELECT 'м'::text as sex1, 0 as sddddd 
UNION 
SELECT 'ж'::text as sex1, 1 as fsdfsdfsd 
ORDEr By 2</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT SUM(b.data_end-b.data_begin) as sum1,COUNT(b.dan_id) as count1 FROm blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer=b1.prev_blist_num 
LEFT JOIN dan_Tab d ON d.dan_id = b.dan_id 
WHERE :param3_1_: &gt;= date(':param1_1_:')  AND  :param3_1_: &lt;= date(':param1_2_:' ) 
AND d.sex = ':sex1:' 
AND ((b.diag_mkb_id &gt;= trim((string_to_array(':param2_1_:','-'))[1])  AND b.diag_mkb_id &lt;= trim((string_to_array(':param2_1_:','-'))[2]) ) 
OR ':param2_1_:' = '') 
AND :param4_1_: and :param5_1_: 
AND (b.doctor_id = :param6_1_: OR :param6_1_:=-1) 
and ( (:param7_1_: = 1 and d.prikreplen = 1 ) OR :param7_1_:=2)</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT SUM(b.data_end-b.data_begin) as sum1,COUNT(b.dan_id) as count1 FROm blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer=b1.prev_blist_num 
LEFT JOIN dan_Tab d ON d.dan_id = b.dan_id 
WHERE :param3_1_: &gt;= date(':param1_1_:')  AND :param3_1_:&lt;= date(':param1_2_:' ) 
AND ((b.diag_mkb_id &gt;= trim((string_to_array(':param2_1_:','-'))[1])  
AND b.diag_mkb_id &lt;= trim((string_to_array(':param2_1_:','-'))[2]) ) 
 OR ':param2_1_:' = '') 
AND :param4_1_: and :param5_1_: 
AND (b.doctor_id = :param6_1_: OR :param6_1_:=-1) 
and ( (:param7_1_: = 1 and d.prikreplen = 1 ) OR :param7_1_:=2)</Sql>
            </Query>
            <Query>
              <Sql>zapros3(voz1,voz2) SELECT SUM(b.data_end-b.data_begin) as sum1,COUNT(b.dan_id) as count1 FROm blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer=b1.prev_blist_num 
LEFT JOIN dan_Tab d ON d.dan_id = b.dan_id 
WHERE :param3_1_: &gt;= date(':param1_1_:')  AND  :param3_1_: &lt;= date(':param1_2_:' ) 
AND d.sex = ':sex1:' 
AND ((b.diag_mkb_id &gt;= trim((string_to_array(':param2_1_:','-'))[1])  AND b.diag_mkb_id &lt;= trim((string_to_array(':param2_1_:','-'))[2]) ) 
OR ':param2_1_:' = '')  
AND get_vozrast(d.date_born) &gt;= voz1 AND get_vozrast(d.date_born) &lt;= voz2 
AND :param4_1_: and :param5_1_: 
AND (b.doctor_id = :param6_1_: OR :param6_1_:=-1) 
and ( (:param7_1_: = 1 and d.prikreplen = 1 ) OR :param7_1_:=2)</Sql>
            </Query>
            <Query>
              <Sql>zapros4(voz1,voz2) SELECT SUM(b.data_end-b.data_begin) as sum1,COUNT(b.dan_id) as count1 FROm blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer=b1.prev_blist_num 
LEFT JOIN dan_Tab d ON d.dan_id = b.dan_id 
WHERE :param3_1_: &gt;= date(':param1_1_:')  AND  :param3_1_: &lt;= date(':param1_2_:' ) 
AND ((b.diag_mkb_id &gt;= trim((string_to_array(':param2_1_:','-'))[1])  
AND b.diag_mkb_id &lt;= trim((string_to_array(':param2_1_:','-'))[2]) ) 
 OR ':param2_1_:' = '') 
AND get_vozrast(d.date_born) &gt;= voz1 AND get_vozrast(d.date_born) &lt;= voz2 
AND :param4_1_: and :param5_1_: 
AND (b.doctor_id = :param6_1_: OR :param6_1_:=-1) 
and ( (:param7_1_: = 1 and d.prikreplen = 1 ) OR :param7_1_:=2)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param4" Caption="Больничный закрыт" Type="select2">
              <Sql>b.fl_clos in (1)=да|b.fl_clos in (0)=нет|true=не важно</Sql>
            </Parameter>
            <Parameter Name="param6" Caption="Врач, выдавший больничный" Type="select">
              <Sql>SELECT -1 as  doctor_id, 'Все врачи'::text, 0  UNION  SELECT f.full_doctor_id, f.full_doctor_id||' '||f.fio||' ('||f.dolg_doctor||')',1 FROm full_doctor_tab f where full_doctor_id in (select distinct doctor_id from blist_tab) ORDER BY 3,1,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Диагнозы" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="param7" Caption="Прикреплен" Type="select2">
              <Sql>1=да|2=не важно</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Первичный" Type="select2">
              <Sql>b1.prev_blist_num is null=да|b1.prev_blist_num is not null=нет|true=не важно</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="по" Type="select2">
              <Sql>b.data_begin=Дате открытия БЛ|b.date_vnes_inf=Дате внесения БЛ</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="6003000" Name="Информация о выданных листках нетрудоспособности" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по больничным листам и временной нетрудоспособности\Информация о выданных листках нетрудоспособности.xls">
          <Queries>
            <Query>
              <Sql>z_ddolg select distinct case when ':param6_1_:' = 'true' then 'Все специальности врачей'::text else (select distinct dolg_doctor 
from full_doctor_tab doc 
where :param6_1_:) end</Sql>
            </Query>
            <Query>
              <Sql>z_doc select distinct case when :param2_1_: = -1 then 'Все врачи'::text else (select doc.full_fio 
from full_doctor_tab doc 
where doctor_id=:param2_1_:) end</Sql>
            </Query>
            <Query>
              <Sql>z_otd select distinct case when ':param4_1_:' = 'true' then 'Все отделения'::text else (select nam_otdel 
from otdel_tab doc 
where :param4_1_:) end</Sql>
            </Query>
            <Query>
              <Sql>z_uch select distinct case when :param3_1_: = -1 then 'По всему ЛПУ (все участки)'::text else (SELECT uchactok FROM uchactok_tab where uchactok_id=:param3_1_:) end</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select '$id'::text, s1.value as ogrn, s2.value as lpu,count(distinct d.dan_id) as cnt_pat, 
count(distinct b.blist_id) as cnt_blist --, sum(case when b.prev_blist_num is null then 1 else 0 end) as cnt_per 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer=b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON b.doctor_id = doc.doctor_id , 
settings_tab s1, settings_tab s2 
where (:param7_1_: BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
and s1.name = 'OGRN' and s2.name='LPU' 
and ( (:param8_1_: = 1 and d.prikreplen = 1 ) OR :param8_1_:=2) 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
group by s1.value, s2.value</Sql>
            </Query>
            <Query>
              <Sql>zapros2 select count(distinct b.blist_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer=b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON b.doctor_id = doc.doctor_id , 
settings_tab s1, settings_tab s2 
where (:param7_1_: BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
and s1.name = 'OGRN' and s2.name='LPU' 
and ( (:param8_1_: = 1 and d.prikreplen = 1 ) OR :param8_1_:=2) 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and b.data_end between date(':param1_1_:') AND date(':param1_2_:') 
and b.fl_clos=1</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select count(distinct b.blist_id) as cnt_per 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer=b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON b.doctor_id = doc.doctor_id 
where (:param7_1_: BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
and ( (:param8_1_: = 1 and d.prikreplen = 1 ) OR :param8_1_:=2) 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and b1.prev_blist_num is null</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Врач, выдавший листок нетрудоспособности" Type="select">
              <Sql>SELECT -1 as  doctor_id, 'Все врачи'::text, 0  UNION  SELECT f.full_doctor_id, f.full_doctor_id||' '||f.fio||' ('||f.dolg_doctor||')',1 FROm full_doctor_tab f where full_doctor_id in (select distinct doctor_id from blist_tab) ORDER BY 3,1,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param4" Caption="Отделение" Type="select">
              <Sql>SELECT 'true'::text, 'Все отделения'::text, 0  UNION  SELECT distinct 'doc.otdel::integer='||o.otdel::text,o.nam_otdel, 1 FROm otdel_tab o left join full_doctor_tab doc ON doc.otdel=o.otdel::text ORDER BY 3,2 </Sql>
            </Parameter>
            <Parameter Name="param8" Caption="Прикреплён" Type="select2">
              <Sql>1=да|2=не учитывать</Sql>
            </Parameter>
            <Parameter Name="param7" Caption="по" Type="select2">
              <Sql>b.data_begin=Дате открытия БЛ|b.date_vnes_inf=Дате внесения БЛ|v.data_vnes_inf=Дате внесения визита</Sql>
            </Parameter>
            <Parameter Name="param6" Caption="Специальность врача" Type="select">
              <Sql>SELECT 'true'::text, 'Все специальности'::text, 0  UNION  SELECT distinct 'doc.dolg_doctor_id='||dolg_doctor_id::text, doc.dolg_doctor, 1 FROm full_doctor_tab doc where full_doctor_id in (select distinct doctor_id from blist_tab) ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Тип документа ВН" Type="select">
              <Sql>SELECT -1 AS type_id, 'все документы ВН' AS type_name UNION SELECT type_id, type_name FROM sp_blist_type_tab WHERE (type_id &gt;= 0) ORDER BY type_id</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Участок" Type="select">
              <Sql>SELECT -1 as  uchactok_id, 'По всему ЛПУ'::text, 0  UNION  SELECT uchactok_id, uchactok, 1 FROM uchactok_tab ORDER BY 3,1;</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="6203000" Name="Отчёт по временной нетрудоспособности" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по больничным листам и временной нетрудоспособности\Отчёт по временной нетрудоспособности.xls">
          <Queries>
            <Query>
              <Sql>t2st1 select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON b.doctor_id = doc.doctor_id 
where (:param7_1_: BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
--and b.fl_clos=1 
and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>t2st2 select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON b.doctor_id = doc.doctor_id 
where (:param7_1_: BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and b.prichina_id=5 
--and b.fl_clos=1 
and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>t2st3 select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON b.doctor_id = doc.doctor_id 
--left join naprav_cons_tab n ON n.talon_id = b.talon_id 
where (:param7_1_: BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
--and n.sp_type_napr_id=1 
and b.result_id = 7 
--and b.fl_clos=1 
and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>t2st4 select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id  
left JOIN full_doctor_tab doc ON b.doctor_id = doc.doctor_id 
--left join naprav_cons_tab n ON n.talon_id = b.talon_id 
where (:param7_1_: BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
--and n.sp_type_napr_id=1 
and b.result_id = 7 
and b.prichina_id=5 
--and b.fl_clos=1 
and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>t2st5 select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON b.doctor_id = doc.doctor_id 
join inval_client_tab i ON i.dan_id =b.dan_id and i.date_change between b.data_begin and b.data_end 
where (:param7_1_: BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and i.current is not null 
--and b.fl_clos=1 
and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>t2st6 select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON b.doctor_id = doc.doctor_id 
join inval_client_tab i ON i.dan_id =b.dan_id and i.date_change between b.data_begin and b.data_end 
where (:param7_1_: BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and i.current is not null 
and b.prichina_id=5 
--and b.fl_clos=1 
and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>z_ddolg select distinct case when ':param6_1_:' = 'true' then 'Все специальности врачей'::text else (select distinct dolg_doctor 
from full_doctor_tab doc 
where :param6_1_:) end</Sql>
            </Query>
            <Query>
              <Sql>z_doc select distinct case when :param2_1_: = -1 then 'Все врачи'::text else (select doc.full_fio 
from full_doctor_tab doc 
where doctor_id=:param2_1_:) end</Sql>
            </Query>
            <Query>
              <Sql>z_otd select distinct case when ':param4_1_:' = 'true' then 'Все отделения'::text else (select nam_otdel 
from otdel_tab doc 
where :param4_1_:) end</Sql>
            </Query>
            <Query>
              <Sql>z_uch select distinct case when :param3_1_: = -1 then 'По всему ЛПУ (все участки)'::text else (SELECT uchactok FROM uchactok_tab where uchactok_id=:param3_1_:) end</Sql>
            </Query>
            <Query>
              <Sql>t2st7 select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
LEFT JOIN full_doctor_tab doc ON b.doctor_id = doc.doctor_id 
where (:param7_1_: BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and b.fl_clos=1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Врач, выдавший больничный" Type="select">
              <Sql>SELECT -1 as  doctor_id, 'Все врачи'::text, 0  UNION  SELECT f.full_doctor_id, f.full_doctor_id||' '||f.fio||' ('||f.dolg_doctor||')',1 FROm full_doctor_tab f ORDER BY 3,1,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param4" Caption="Отделение" Type="select">
              <Sql>SELECT 'true'::text, 'Все отделения'::text, 0  UNION  SELECT distinct 'doc.otdel::integer='||o.otdel::text,o.nam_otdel, 1 FROm otdel_tab o left join full_doctor_tab doc ON doc.otdel=o.otdel::text ORDER BY 3,2 </Sql>
            </Parameter>
            <Parameter Name="param7" Caption="по" Type="select2">
              <Sql>b.data_begin=Дате открытия БЛ|b.date_vnes_inf=Дате внесения БЛ|v.data_vnes_inf=Дате внесения визита</Sql>
            </Parameter>
            <Parameter Name="param6" Caption="Специальность врача" Type="select">
              <Sql>SELECT 'true'::text, 'Все специальности'::text, 0  UNION  SELECT distinct 'doc.dolg_doctor_id='||dolg_doctor_id::text, doc.dolg_doctor, 1 FROm full_doctor_tab doc ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Тип документа ВН" Type="select">
              <Sql>SELECT -1 AS type_id, 'все документы ВН' AS type_name UNION SELECT type_id, type_name FROM sp_blist_type_tab WHERE (type_id &gt;= 0) ORDER BY type_id</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Участок" Type="select">
              <Sql>SELECT -1 as  uchactok_id, 'По всему ЛПУ'::text, 0  UNION  SELECT uchactok_id, uchactok, 1 FROM uchactok_tab ORDER BY 3,1;</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="10000000" Name="Отчет по длительно болеющим и часто болеющим пациентам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по больничным листам и временной нетрудоспособности\Отчет по длительно болеющим и часто болеющим пациентам.xls">
          <Queries>
            <Query>
              <Sql>z1 select distinct 
CASE 
    WHEN d.mid IS NULL THEN ((d.fam::text || ' '::text) || substring(d.nam::text, 1, 1)) || '.'::text 
    ELSE ((((d.fam::text || ' '::text) || substring(d.nam::text, 1, 1)) || '.'::text) || 
    substring(d.mid::text, 1, 1)) || '.'::text 
    END AS fio, 
    d.date_born, d.ser_pol, num_pol, d.address 
    , q.dlit--, q.data_begin, q.data_end 
from 
(SELECT f.dan_id, 'длительноболеющие ' as dlit,f.data_begin, f.data_end, f.ndays, SUM(b.data_end-b.data_begin), COUNT(b.*) FROM 
(SELECT b.dan_id, b.data_begin, b1.data_end, age(b1.data_end, b.data_begin) as ndays  FROm blist_tab b 
LEFT JOIN blist_tab b1 On b1.dan_id = b.dan_id AND b1.data_begin &gt;= b.data_begin 
WHERE b1.diag_mkb_id = b.diag_mkb_id and b1.data_end between date(':per_1_:') and date(':per_2_:')and b1.data_begin between date(':per_1_:') and date(':per_2_:')) 
as f 
LEFT JOIN blist_tab b On b.dan_id = f.dan_id AND b.data_begin &gt;= f.data_begin AND b.data_end &lt;= f.data_end 
WHERe f.ndays &lt;= '3 month'::interval 
GROUP BY f.dan_id, f.data_begin, f.data_end, f.ndays 
HAVING SUM(b.data_end-b.data_begin) &gt; 40 
UNION 
SELECT f.dan_id, 'частоболеющие', f.data_begin, f.data_end, f.ndays, SUM(b.data_end-b.data_begin), COUNT(b.*) FROM 
(SELECT b.dan_id, b.data_begin, b1.data_end, age(b1.data_end, b.data_begin) as ndays FROm blist_tab b 
LEFT JOIN blist_tab b1 On b1.dan_id = b.dan_id AND b1.data_begin &gt;= b.data_begin 
where b1.data_end between date(':per_1_:') and date(':per_2_:')and b1.data_begin between date(':per_1_:') and date(':per_2_:')) 
as f 
LEFT JOIN blist_tab b On b.dan_id = f.dan_id AND b.data_begin &gt;= f.data_begin AND b.data_end &lt;= f.data_end 
WHERe f.ndays  &lt;= '6 month'::interval 
GROUP BY f.dan_id, f.data_begin, f.data_end, f.ndays 
HAVING SUM(b.data_end-b.data_begin) &gt; 40) q, dan_tab d 
where d.dan_id = q.dan_id</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="per" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2009303000" Name="Заболевания с ВУТ за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по больничным листам и временной нетрудоспособности\Заболевания с ВУТ за период.xls">
          <Queries>
            <Query>
              <Sql>count_blist(d_par) SELECT count(b.blist_id) 
FROM blist_tab b 
left join blist_tab b1 ON b.nomer=b1.prev_blist_num 
WHERE b.data_end BETWEEN ':date_1_:' AND ':date_2_:' 
AND b.fl_clos = 1 AND :d_par: and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>count_blist_old(d_par) SELECT count(b.blist_id) 
FROM blist_tab b 
left join blist_tab b1 ON b.nomer=b1.prev_blist_num 
left join dan_tab d on b.dan_id=d.dan_id 
WHERE b.data_end BETWEEN ':date_1_:'::date-interval '1year' AND ':date_2_:'::date-interval '1year' 
AND b.fl_clos = 1 AND :d_par: and b1.prev_blist_num is null 
and d.spolref::int8 in (select * from get_all_lpu_numbers()))</Sql>
            </Query>
            <Query>
              <Sql>count_days(d_par) SELECT sum(get_blist_duration(b.blist_id::bigint))  
FROM blist_tab b 
left join blist_tab b1 ON b.nomer=b1.prev_blist_num 
WHERE b.data_end BETWEEN ':date_1_:'::date AND ':date_2_:'::date 
AND b.fl_clos = 1 AND :d_par: and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>count_days_old(d_par) SELECT sum(get_blist_duration(b.blist_id::bigint))  
FROM blist_tab b 
left join blist_tab b1 ON b.nomer=b1.prev_blist_num 
WHERE b.data_end BETWEEN ':date_1_:'::date-interval '1year' AND ':date_2_:'::date-interval '1year' 
AND b.fl_clos = 1 AND :d_par: and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>last_year_query SELECT 'С '||to_char((':date_1_:'::date-interval'1 year'),'DD-MM-YYYY')||' по '|| 
to_char((':date_1_:'::date-interval'1 year'),'DD-MM-YYYY')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="date" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="work_count" Caption="Работающее население" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2009503000" Name="Сведения об объемах производства экспертизы временной нетрудоспособности" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по больничным листам и временной нетрудоспособности\Сведения об объемах производства экспертизы временной нетрудоспособности.xls">
          <Queries>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>t2st2(mmm,ddd) select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON v.doctor_id = doc.doctor_id 
where (v.data_vnes_inf BETWEEN date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01') AND date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01')+ interval 'ddd month' - interval '1 day') 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and b.fl_clos=1 and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>t2st3(mmm,ddd) select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON v.doctor_id = doc.doctor_id 
where (v.data_vnes_inf BETWEEN date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01') AND date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01')+ interval 'ddd month' - interval '1 day') 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and b.prichina_id=5 
and b.fl_clos=1 and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>t2st4(mmm,ddd) select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON v.doctor_id = doc.doctor_id 
where (v.data_vnes_inf BETWEEN date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01') AND date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01')+ interval 'ddd month' - interval '1 day') 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and b.fl_clos=1 and b1.prev_blist_num is null 
and get_blist_duration(b.blist_id::bigint)&gt;=30</Sql>
            </Query>
            <Query>
              <Sql>t2st5(mmm,ddd) select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON v.doctor_id = doc.doctor_id 
where (v.data_vnes_inf BETWEEN date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01') AND date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01')+ interval 'ddd month' - interval '1 day') 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and b.prichina_id=5 
and b.fl_clos=1 and b1.prev_blist_num is null 
and get_blist_duration(b.blist_id::bigint)&gt;=30</Sql>
            </Query>
            <Query>
              <Sql>t2st6(mmm,ddd) select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON v.doctor_id = doc.doctor_id 
left join naprav_cons_tab n ON n.talon_id = b.talon_id 
where (v.data_vnes_inf BETWEEN date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01') AND date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01')+ interval 'ddd month' - interval '1 day') 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and n.sp_type_napr_id=1 
and b.fl_clos=1 and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>t2st7(mmm,ddd) select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON v.doctor_id = doc.doctor_id 
left join naprav_cons_tab n ON n.talon_id = b.talon_id 
where (v.data_vnes_inf BETWEEN date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01') AND date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01')+ interval 'ddd month' - interval '1 day') 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and n.sp_type_napr_id=1 
and b.prichina_id=5 
and b.fl_clos=1 and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>t2st8(mmm,ddd) select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON v.doctor_id = doc.doctor_id 
join inval_client_tab i ON i.talon_id = b.talon_id 
where (v.data_vnes_inf BETWEEN date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01') AND date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01')+ interval 'ddd month' - interval '1 day') 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and i.current is not null 
and b.fl_clos=1 and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>t2st9(mmm,ddd) select count(distinct d.dan_id) 
from blist_tab b 
LEFT JOIN blist_tab b1 ON b.nomer = b1.prev_blist_num 
left join dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between b.data_begin and b.data_end and b.dan_id = d.dan_id 
left JOIN full_doctor_tab doc ON v.doctor_id = doc.doctor_id 
join inval_client_tab i ON i.talon_id = b.talon_id 
where (v.data_vnes_inf BETWEEN date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01') AND date(date_part('year',date(':param1_1_:'))||'-'||mmm||'-01')+ interval 'ddd month' - interval '1 day') 
  AND ((:param5_1_: &lt; 0) OR (b.type_id = :param5_1_:)) 
  AND ((:param3_1_: &lt; 0) OR (d.uchactok_id = :param3_1_:)) 
and ((:param2_1_:&lt;0) or (doc.doctor_id = :param2_1_:)) 
and :param6_1_: 
and :param4_1_: 
and i.current is not null 
and b.prichina_id=5 
and b.fl_clos=1 and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>year_1 select date_part('year',date(':param1_1_:'))</Sql>
            </Query>
            <Query>
              <Sql>z_ddolg select distinct case when ':param6_1_:' = 'true' then 'Все специальности врачей'::text else (select distinct dolg_doctor 
from full_doctor_tab doc 
where :param6_1_:) end</Sql>
            </Query>
            <Query>
              <Sql>z_doc select distinct case when :param2_1_: = -1 then 'Все врачи'::text else (select doc.full_fio 
from full_doctor_tab doc 
where doctor_id=:param2_1_:) end</Sql>
            </Query>
            <Query>
              <Sql>z_otd select distinct case when ':param4_1_:' = 'true' then 'Все отделения'::text else (select nam_otdel 
from otdel_tab doc 
where :param4_1_:) end</Sql>
            </Query>
            <Query>
              <Sql>z_uch select distinct case when :param3_1_: = -1 then 'По всему ЛПУ (все участки)'::text else (SELECT uchactok FROM uchactok_tab where uchactok_id=:param3_1_:) end</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Врач" Type="select">
              <Sql>SELECT -1 as  doctor_id, 'Все врачи'::text, 0  UNION  SELECT f.full_doctor_id, f.full_doctor_id||' '||f.fio||' ('||f.dolg_doctor||')',1 FROm full_doctor_tab f ORDER BY 3,1,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Дата" Type="date">
              <Sql />
            </Parameter>
            <Parameter Name="param4" Caption="Отделение" Type="select">
              <Sql>SELECT 'true'::text, 'Все отделения'::text, 0  UNION  SELECT distinct 'doc.otdel::integer='||o.otdel::text,o.nam_otdel, 1 FROm otdel_tab o left join full_doctor_tab doc ON doc.otdel=o.otdel::text ORDER BY 3,2 </Sql>
            </Parameter>
            <Parameter Name="param6" Caption="Специальность врача" Type="select">
              <Sql>SELECT 'true'::text, 'Все специальности'::text, 0  UNION  SELECT distinct 'doc.dolg_doctor_id='||dolg_doctor_id::text, doc.dolg_doctor, 1 FROm full_doctor_tab doc ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Тип документа ВН" Type="select">
              <Sql>SELECT -1 AS type_id, 'все документы ВН' AS type_name UNION SELECT type_id, type_name FROM sp_blist_type_tab WHERE (type_id &gt;= 0) ORDER BY type_id</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Участок" Type="select">
              <Sql>SELECT -1 as  uchactok_id, 'По всему ЛПУ'::text, 0  UNION  SELECT uchactok_id, uchactok, 1 FROM uchactok_tab ORDER BY 3,1;</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Новые отчеты по заданным выборкам">
      <Reports>
        <Report Id="10001" Name="Договора по заданной выборке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Договора по заданной выборке.xls">
          <Queries>
            <Query>
              <Sql>contr_uslugi LEFT JOIN contract_platno_usl_tab u ON u.contract_platno_id = c.contract_platno_id</Sql>
            </Query>
            <Query>
              <Sql>contr_uslugi_doctor_id LEFT JOIN full_doctor_tab fdv1 ON u.doctor_id = fdv1.full_doctor_id</Sql>
            </Query>
            <Query>
              <Sql>full_doctor_view LEFT JOIN full_doctor_view fdv ON c.operator_id = fdv.full_doctor_id</Sql>
            </Query>
            <Query>
              <Sql>uslugi LEFT JOIN sp_uslug_tab spu ON spu.uslug_kod = u.kod_uls</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT DISTINCT  :return_fields: FROM public.contract_platno_tab c :sections: :where_section: :group_by_section: :having_section:</Sql>
            </Query>
            <Query>
              <Sql>request5 </Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="" Caption="Договор" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="contract_number" Caption="№ договора" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="u_doctor_id" Caption="Врач" Type="select">
              <Sql>SELECT full_doctor_id, full_fio FROM full_doctor_tab ORDER BY 2 </Sql>
            </Parameter>
            <Parameter Name="c_date_vnes_inf" Caption="Дата внесения информации" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="c_date_contract" Caption="Дата договора" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="u_kol_vo" Caption="Количество услуг" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="c_operator_id" Caption="Оператор" Type="select">
              <Sql>SELECT full_doctor_id, fio FROM full_doctor_view ORDER BY fio</Sql>
            </Parameter>
            <Parameter Name="discount" Caption="Скидка" Type="float_period">
              <Sql />
            </Parameter>
            <Parameter Name="u_summa" Caption="Сумма" Type="float_period">
              <Sql />
            </Parameter>
            <Parameter Name="u_uslugi" Caption="Услуги" Type="select">
              <Sql>SELECT uslug_kod, substring(uslug_name FROM 1 FOR 150)  FROM sp_uslug_tab ORDER by 2</Sql>
            </Parameter>
            <Parameter Name="u_cost" Caption="Цена" Type="int_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="60001" Name="Пациенты по заданной выборке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Пациенты по заданной выборке.xls">
          <Queries>
            <Query>
              <Sql>dan_tab </Sql>
            </Query>
            <Query>
              <Sql>dan_tab_all_analisis LEFT JOIN all_analisis_view an1 ON an1.dan_id = d.dan_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_fakult_tab LEFT JOIN fakult_tab fakult1 ON fakult1.kod_fak = d.kod_fak</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_fed_lgota_tab LEFT JOIN (select * from (SELECT distinct f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null /*AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != ''*/ ) as q where lgota!='' OR lgota is null ) as fed1 ON fed1.dan_id = d.dan_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_fed_lgota2 LEFT JOIN fed_lgota_tab fed2 ON d.dan_id = fed2.dan_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_gr_risk_tab LEFT JOIN gr_risk_tab gr_risk1 ON gr_risk1.gr_risk_id = d.risk_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_kateg_lgot_tab LEFT JOIN kateg_lgot_tab kateg_lgot1 On kateg_lgot1.kateg_lgot_id = d.kateg_lgot_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_kateg_tab LEFT JOIN kateg_tab kateg1 ON kateg1.kateg_id = d.kat</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_local_lgota_tab LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_lpu_fluog LEFT JOIN lpu_tab lpu_lpu_fluog ON lpu_lpu_fluog.pricpol = d.lpu_fluog</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_lpu_spolref LEFT JOIN lpu_tab lpu_spolref ON lpu_spolref.pricpol = d.spolref</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_lpu_sstomref LEFT JOIN lpu_tab lpu_sstomref ON lpu_sstomref.pricpol = d.sstomref</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_lpu_swconref LEFT JOIN lpu_tab lpu_swconref ON lpu_swconref.pricpol = d.swconref</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_mest_work_tab LEFT JOIN mest_work_tab mest_work1 On mest_work1.mest_work_id = d.mesto_work_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_oms_tab LEFT JOIN oms_tab oms ON /*(conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid)= 
conv_to_null(oms.fam)||' '||conv_to_null(oms.nam)||' '||conv_to_null(oms.mid) and coalesce(d.date_born)=coalesce(dtborn)) OR*/ (conv_to_null(d.ser_pol)=conv_to_null(oms.ser_pol) AND conv_to_null(d.num_pol)=conv_to_null(oms.num_pol)) 
LEFT JOIN strcom_tab strcom2 ON strcom2.strcom_id = oms.strcom_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_operator LEFT JOIN users_tab operator ON operator.id = d.operator_id 
LEFT JOIN dan_tab operator1 on operator1.dan_id=operator.dan_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_sozstatus_tab LEFT JOIN sozstatus_tab soz1 On soz1.sozstatus_id = d.sozstatus_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_strcom_tab LEFT JOIN codifiers.strcom_tab strcom1 ON strcom1.id = d.strcom_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_strcom_tab_region LEFT JOIN kladr_tab kladr_str ON kladr_str.code = strcom1.region_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_uchactok_tab LEFT JOIN uchactok_tab uch1 On uch1.uchactok_id = d.uchactok_id</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_ucheb_zaved_tab LEFT JOIN ucheb_zaved_tab uch2 On uch2.kod = d.kod_vuz</Sql>
            </Query>
            <Query>
              <Sql>dan_tab_vid_doc_tab LEFT JOIN  vid_doc_tab vid_doc1 On vid_doc1. vid_doc_id = d. vid_doc_id</Sql>
            </Query>
            <Query>
              <Sql>priv_doctor1 left join stand_patient_tab st1 ON st1.priv_id = priv1.priviv_id 
left join full_doctor_tab f2 ON f2.doctor_id = st1.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>priv_preparat1 LEFT JOIN sp_priv_univ_tab sp_priv4 ON sp_priv4.sp_priv_univ_id = priv1.preparat</Sql>
            </Query>
            <Query>
              <Sql>priv_sp_infection1 LEFT JOIN codifiers.priv_infection_tab vid_inf ON vid_inf.id = priv1.infection</Sql>
            </Query>
            <Query>
              <Sql>priv_sp_vid_priviv1 LEFT JOIN codifiers.priv_vid_pr_tab sp_priv6 ON sp_priv6.id = priv1.vid_priviv</Sql>
            </Query>
            <Query>
              <Sql>priv1_ LEFT JOIN priviv_tab priv1 ON priv1.dan_id = d.dan_id</Sql>
            </Query>
            <Query>
              <Sql>priv1_full_doctor_view LEFT JOIN full_doctor_view priv_operator ON priv_operator.full_doctor_id=priv1.operator_id</Sql>
            </Query>
            <Query>
              <Sql>priv1_operat_join left join full_doctor__view priv_operator on priv_operator.full_doctor_id=priv1.operator_id</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT DISTINCT  :return_fields: FROM public.dan_tab d :sections: :where_section: :group_by_section: :having_section:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="" Caption="Анализы пациентов" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dt_analis" Caption="Дата анализа" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dt_take_analis" Caption="Дата взятия лабораторного материала" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dt_vnes_analis" Caption="Дата внесения анализа" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="analisis_name" Caption="Наименование анализа" Type="select">
              <Sql>select distinct name, name from all_analisis_view order by 1</Sql>
            </Parameter>
            <Parameter Name="num_analis" Caption="Номер анализа" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="last_analis" Caption="Последний анализ" Type="check">
              <Sql />
            </Parameter>
            <Parameter Name="has_analis" Caption="У пациента есть анализы" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="" Caption="Данные документа пациента" Type="">
              <Sql />
            </Parameter>
            <Parameter Name="d_vid_doc_id" Caption="Вид документа" Type="select">
              <Sql>SELECT vid_doc_id, name FROM vid_doc_tab ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="d_date_output" Caption="Дата выдачи документа" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_kem_output" Caption="Кем выдан" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_numdoc" Caption="Номер документа" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_serdoc" Caption="Серия документа" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="" Caption="Данные из фонда ОМС" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="is_oms" Caption="Есть в фонде ОМС" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_oms" Caption="Страховая компания по фонду" Type="select">
              <Sql>SELECT s.strcom_id, trim(k.name)||' '||trim(k.socr)||'. '||s.strcom, 0 FROm strcom_tab s LEFT JOIN kladr_tab k ON k.code = s.region_id WHERE s.region_id = '7000000000000'  AND s.strcom_id IN (SELECT DISTINCT strcom_id FROM dan_tab) UNION SELECT s.strcom_id, trim(k.name)||' '||trim(k.socr)||'. '||s.strcom, 1 FROm strcom_tab s LEFT JOIN kladr_tab k ON k.code = s.region_id WHERE s.region_id != '7000000000000' AND s.strcom_id IN (SELECT DISTINCT strcom_id FROM dan_tab) ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="" Caption="Данные по пациентам" Type="">
              <Sql />
            </Parameter>
            <Parameter Name="d_address" Caption="Адрес" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_anamnez_life" Caption="Анамнез жизни" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="vozrast" Caption="Возраст" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="part_fed_lgota_register" Caption="Выбыл из регистра ДЛО" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="d_inval_id" Caption="Группа инвалидности" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_risk_id" Caption="Группа риска по туберкулезу" Type="select">
              <Sql>SELECT  gr_risk_id, gr_risk FROM gr_risk_tab ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="d_date_vnes_inf" Caption="Дата внесения информации" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="reg_date" Caption="Дата регистрации пациента" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_date_born" Caption="Дата рождения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_date_smerti" Caption="Дата смерти" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_date_fluog" Caption="Дата флюорографии" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_life" Caption="Жив" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="d_is_local_lgota" Caption="Имеет местную льготу" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="d_has_fed_lgota" Caption="Имеет фед. льготу" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="d_kat" Caption="Категория" Type="select">
              <Sql>SELECT kateg_id, kateg FROm kateg_tab ORDER By 2</Sql>
            </Parameter>
            <Parameter Name="d_kateg_lgot_id" Caption="Категория льгот" Type="select">
              <Sql>SELECT kateg_lgot_id, kateg_lgot FROm kateg_lgot_tab ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="d_med_karta_kod" Caption="Код медицинской карты" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="pat_count" Caption="Кол-во пациентов" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_lpu_fluog" Caption="ЛПУ, в котором была пройдена флюорография" Type="select">
              <Sql>SELECT l.pricpol, l.name FROm lpu_tab l WHERe l.pricpol IN (SELECT d.lpu_fluog FROm dan_tab d) ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="d_local_lgota" Caption="Местная льгота" Type="select">
              <Sql>SELECT trim(l.lgota_id), trim(l.lgota_id)||' '||l.nam_lgota FROM lgota_tab l WHERE length(trim(l.lgota_id)) &lt; 3 ORDER BY 1 </Sql>
            </Parameter>
            <Parameter Name="d_mesto_work_id" Caption="Место работы" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_phone_mobile" Caption="Мобильный телефон" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_num_fluog" Caption="Номер флюорографии" Type="text_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_operator" Caption="Оператор" Type="select">
              <Sql>SELECT f.full_doctor_id, f.full_doctor_id::text||' '||f.fio FROM full_doctor_tab f ORDER BY f.fio</Sql>
            </Parameter>
            <Parameter Name="d_descr" Caption="Описание" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_is_fed" Caption="Отказался от фед. льготы" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="d_mest_born" Caption="Место рождения" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_sex" Caption="Пол" Type="select">
              <Sql>SELECT 'м'::text, 'м'::text UNION SELECT 'ж'::text, 'ж'::text </Sql>
            </Parameter>
            <Parameter Name="d_prikreplen" Caption="Прикреплен" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="d_swconref" Caption="Прикреплен к женской консультации" Type="select">
              <Sql>SELECT l.pricpol, l.name FROm lpu_tab l  ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="d_spolref" Caption="Прикреплен к поликлинике" Type="select">
              <Sql>SELECT l.pricpol, l.name FROm lpu_tab l  ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="d_sstomref" Caption="Прикреплен к стоматологии" Type="select">
              <Sql>SELECT l.pricpol, l.name FROm lpu_tab l  ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="d_metka_work" Caption="Работает" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="d_cityzen" Caption="Сельский" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="d_pens" Caption="СНИЛС" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_sozstatus_id" Caption="Социальный статус" Type="select">
              <Sql>SELECT sozstatus_id, sozstatus FROm sozstatus_tab ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="d_telephon" Caption="Телефон" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_uchactok_id" Caption="Участок" Type="select">
              <Sql>SELECT uchactok_id, uchactok FROM uchactok_tab  ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="d_flag_uch" Caption="Участок расставляется автоматически" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="d_fakt_adr" Caption="Фактический адрес" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_fed_lgota" Caption="Федеральная льгота" Type="select">
              <Sql>SELECT trim(l.lgota_id), trim(l.lgota_id)||' '||l.nam_lgota FROM lgota_tab l WHERE length(trim(l.lgota_id)) = 3 ORDER BY 1 </Sql>
            </Parameter>
            <Parameter Name="d_fio" Caption="ФИО" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="" Caption="Данные полиса пациента" Type="">
              <Sql />
            </Parameter>
            <Parameter Name="d_data_begin" Caption="Дата начала полиса" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_data_end" Caption="Дата окончания полиса" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="p_polis_mask" Caption="Маска полиса" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_num_pol" Caption="Номер полиса" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="p_is_polis_mask" Caption="Полис пациента соответствует маске" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="param65" Caption="Регион страховой компании" Type="select">
              <Sql>SELECT k.code, trim(k.name)||' '||trim(k.socr)||'.' FROm kladr_tab k WHERe k.code In (SELECT s.region_id FROm dan_tab d LEFT join strcom_tab s ON s.strcom_id = d.strcom_id WHERE s.region_id is not null) ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="d_ser_pol" Caption="Серия полиса" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_strcom_id" Caption="Страховая компания" Type="select">
              <Sql>SELECT s.strcom_id, trim(k.name)||' '||trim(k.socr)||'. '||s.strcom, 0 FROm strcom_tab s LEFT JOIN kladr_tab k ON k.code = s.region_id WHERE s.region_id = '7000000000000'  AND s.strcom_id IN (SELECT DISTINCT strcom_id FROM dan_tab) UNION SELECT s.strcom_id, trim(k.name)||' '||trim(k.socr)||'. '||s.strcom, 1 FROm strcom_tab s LEFT JOIN kladr_tab k ON k.code = s.region_id WHERE s.region_id != '7000000000000' AND s.strcom_id IN (SELECT DISTINCT strcom_id FROM dan_tab) ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="" Caption="Место учебы пациента" Type="">
              <Sql />
            </Parameter>
            <Parameter Name="d_god_post" Caption="Дата поступления в учебное заведение" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_num_group" Caption="Номер группы" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_kod_vuz" Caption="Учебное заведение" Type="select">
              <Sql>SELECT u.kod, u.name FROm ucheb_zaved_tab u ORDEr BY 2</Sql>
            </Parameter>
            <Parameter Name="d_kod_fak" Caption="Факультет" Type="select">
              <Sql>SELECT f.kod_fak, f.name||' ('||u.name||')' FROm fakult_tab f LEFT JOIN ucheb_zaved_tab u On u.kod = f.kod_vuz ORDER BY u.name,f.name</Sql>
            </Parameter>
            <Parameter Name="" Caption="Прививки по пациентам" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="priv_preparat1" Caption="Вакцина (препарат)" Type="select">
              <Sql>select sp_priv_univ_id, sp_priv_univ from sp_priv_univ_tab where parent=5 order by 2</Sql>
            </Parameter>
            <Parameter Name="priv_vid_priviv1" Caption="Вид прививки" Type="select">
              <Sql>select id,name from codifiers.priv_vid_pr_tab order by 2</Sql>
            </Parameter>
            <Parameter Name="priv_doctor1" Caption="Врач, проводивший вакцинацию" Type="select">
              <Sql>select distinct doctor_id, fio from full_doctor_tab</Sql>
            </Parameter>
            <Parameter Name="priv1_date_vnes_inf" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="priv_date1" Caption="Дата прививки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="priv_doza1" Caption="Доза" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="priv_infection1" Caption="Инфекция" Type="select">
              <Sql>SELECT id,name from codifiers.priv_infection_tab order by 2</Sql>
            </Parameter>
            <Parameter Name="kol_vo_priv" Caption="Кол-во прививок" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="priv1_operator_id" Caption="Оператор" Type="select">
              <Sql>select full_doctor_id,full_fio from full_doctor_view order by fam</Sql>
            </Parameter>
            <Parameter Name="priv_seria1" Caption="Серия прививки" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="70001" Name="Диспансерные больные по заданной выборке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Диспансерные больные по заданной выборке.xls">
          <Queries>
            <Query>
              <Sql>disp_doctor_id LEFT JOIN full_doctor_tab disp_doctor 
ON disp_doctor.full_doctor_id = disp.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>disp_mkb LEFT JOIN mkb_tab disp_mkb 
ON disp_mkb.kod_d = disp.diagn_id</Sql>
            </Query>
            <Query>
              <Sql>disp_onko LEFT JOIN onco_tab disp_onko On disp.dispan_uchet_id = disp_onko.dispan_uchet_id</Sql>
            </Query>
            <Query>
              <Sql>disp_onko_lpu LEFT JOIN lpu_tab disp_onko_lpu ON disp_onko_lpu.lpu_id = disp_onko.lech_uchreg_diagn_id</Sql>
            </Query>
            <Query>
              <Sql>disp_operator LEFT JOIN full_doctor_tab disp_operator 
ON disp_operator.full_doctor_id = disp.operator_id</Sql>
            </Query>
            <Query>
              <Sql>disp_prichin_sn_tab LEFT JOIN prichin_sn_tab prich1 
On prich1.prichin_sn_id = disp.prichin_sn_id</Sql>
            </Query>
            <Query>
              <Sql>disp_spec LEFT JOIN dolg_doctor_tab disp_dolg ON disp_dolg.dolg_doctor_id = disp.spec</Sql>
            </Query>
            <Query>
              <Sql>disp_stacionar LEFT JOIN kurort_tab k ON k.dan_id = disp.dan_id</Sql>
            </Query>
            <Query>
              <Sql>disp_talon LEFT JOIN talon_tab t ON t.dan_id = disp.dan_id</Sql>
            </Query>
            <Query>
              <Sql>doctor_tab LEFT JOIN doctor_tab doct ON doct.doctor_id = disp.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>otdel_tab LEFT JOIN otdel_tab otd ON otd.otdel = doct.sp_otdel_id</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT DISTINCT  :return_fields: FROM public.dispan_uchet_tab disp :sections: :where_section: :group_by_section: :having_section:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="" Caption="Диспансерный учет" Type="">
              <Sql />
            </Parameter>
            <Parameter Name="san_kur" Caption="В текущем году сан.-кур. лечение" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="stacionar" Caption="В текущем году стационарное лечение" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="disp_vn_uchet" Caption="Внешний учет" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="disp_date_vnes_inf" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="last_date_diagn_disp" Caption="Дата последнего визита (по диагнозу)" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="disp_date_last" Caption="Дата последнего визита (по цели посещения)" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="disp_date" Caption="Дата постановки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="disp_date_next" Caption="Дата следующей явки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="disp_date_sn" Caption="Дата снятия" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="disp_diagn_id" Caption="Диагноз" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="disp_doctor_id" Caption="Доктор" Type="select">
              <Sql>SELECT f.full_doctor_id, f.full_doctor_id::text||' '||f.fio FROM full_doctor_tab f WHERe f.full_doctor_id IN (SELECT disp.doctor_id FROm dispan_uchet_tab disp) ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="" Caption="Онкобольные" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="disp_onko_data_postan" Caption="Дата постановки диагноза(онко)" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="disp_onko_lpu" Caption="ЛПУ где установлен диагноз" Type="select">
              <Sql>SELECT lpu_id, trim(name) FROm lpu_tab WHERE lpu_id IN (SELECT DISTINCT lech_uchreg_diagn_id FROm onco_tab) ORDER BY 2,1 </Sql>
            </Parameter>
            <Parameter Name="disp_onko_nomer" Caption="Номер онкобольного" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="disp_onko_stadia" Caption="Стадия онкобольного" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="disp_operator_id" Caption="Оператор" Type="select">
              <Sql>SELECT f.full_doctor_id, f.full_doctor_id::text||' '||f.fio FROM full_doctor_tab f WHERe f.full_doctor_id IN (SELECT disp.operator_id FROm dispan_uchet_tab disp) ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="doct_sp_otdel_id" Caption="Отделение" Type="select">
              <Sql>SELECT otdel, nam_otdel FROM otdel_tab ORDER BY 1,2; </Sql>
            </Parameter>
            <Parameter Name="talon_pricpol" Caption="Прикреплен по талону" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="disp_prichin_sn_id" Caption="Причина снятия" Type="select">
              <Sql>SELECT p.prichin_sn_id, p.prichin_sn FROm prichin_sn_tab p ORDEr BY 1</Sql>
            </Parameter>
            <Parameter Name="disp_sost" Caption="Состоит на дисп учете" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="disp_sost_on" Caption="Состоит на:" Type="date">
              <Sql />
            </Parameter>
            <Parameter Name="disp_spec" Caption="Специальность" Type="select">
              <Sql>SELECT dolg_doctor_id , dolg_doctor FROm dolg_doctor_Tab WHERE  dolg_doctor_id IN (SELECT spec FROM dispan_uchet_tab)  ORDEr By 2 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="80001" Name="Пролеченные пациенты по заданной выборке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Пролеченные пациенты по заданной выборке.xls">
          <Queries>
            <Query>
              <Sql>diag LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id</Sql>
            </Query>
            <Query>
              <Sql>diag_doctor LEFT JOIN full_doctor_tab diag_doctor 
ON diag_doctor.full_doctor_id = diag.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>diag_mkb LEFT JOIN mkb_tab diag_mkb 
ON diag_mkb.kod_d = diag.diagn_osn</Sql>
            </Query>
            <Query>
              <Sql>diag_operator LEFT JOIN full_doctor_tab diag_operator 
ON diag_operator.full_doctor_id = diag.operat_id</Sql>
            </Query>
            <Query>
              <Sql>diag_otdel_tab LEFT JOIN otdel_tab diag_otd ON diag_doctor.otdel = diag_otd.otdel</Sql>
            </Query>
            <Query>
              <Sql>priv_ LEFT JOIN priviv_tab priv ON priv.dan_id = t.dan_id</Sql>
            </Query>
            <Query>
              <Sql>priv_doctor left join stand_patient_tab st ON st.priv_id = priv.priviv_id 
left join full_doctor_tab f1 ON f1.doctor_id = st.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>priv_preparat LEFT JOIN sp_priv_univ_tab sp_priv3 ON sp_priv3.sp_priv_univ_id = priv.preparat</Sql>
            </Query>
            <Query>
              <Sql>priv_sp_invection LEFT JOIN sp_priv_univ_tab sp_priv1 ON sp_priv1.sp_priv_univ_id = priv.infection</Sql>
            </Query>
            <Query>
              <Sql>priv_sp_vid_priviv LEFT JOIN sp_priv_univ_tab sp_priv2 ON sp_priv2.sp_priv_univ_id = priv.vid_priviv</Sql>
            </Query>
            <Query>
              <Sql>rezept_tab LEFT JOIN rezept_tab r ON r.talon_id = t.talon_id</Sql>
            </Query>
            <Query>
              <Sql>rezept_tab_doctor_id LEFT JOIN full_doctor_tab r_doc ON r_doc.full_doctor_id = r.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>rezept_tab_lgot_preparat_tab LEFT JOIN lgot_preparat_tab r_prep ON r_prep.kod = r.kod_minzd</Sql>
            </Query>
            <Query>
              <Sql>rezept_tab_operator_id LEFT JOIN full_doctor_tab r_oper ON r_oper.full_doctor_id = r.operator_id</Sql>
            </Query>
            <Query>
              <Sql>t_doctor_id LEFT JOIN full_doctor_tab t_doctor 
ON t_doctor.full_doctor_id = t.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>t_fakult_tab LEFT JOIN fakult_tab fakult2 ON fakult2.kod_fak = t.kod_fak</Sql>
            </Query>
            <Query>
              <Sql>t_first_cond LEFT JOIN codifiers.first_visit_condition_tab f_cond ON f_cond.id = t.first_visit_condition</Sql>
            </Query>
            <Query>
              <Sql>t_lpu_tab LEFT JOIN lpu_tab t_lpu ON t_lpu.pricpol = t.pricpol</Sql>
            </Query>
            <Query>
              <Sql>t_operator LEFT JOIN users_tab oper1 ON oper1.id = t.operator_id 
JOIN dan_tab oper2 ON oper2.dan_id = oper1.dan_id 
/* 
full_doctor_tab t_operator 
ON t_operator.full_doctor_id = t.operator_id*/</Sql>
            </Query>
            <Query>
              <Sql>t_otdel_tab LEFT JOIN otdel_tab t_otd ON t_doctor .otdel = t_otd.otdel</Sql>
            </Query>
            <Query>
              <Sql>t_result_tab LEFT JOIN result_tab result1 ON result1.result_id = t.result_id</Sql>
            </Query>
            <Query>
              <Sql>t_san_kur LEFT JOIN kurort_tab kur ON kur.dan_id=t.dan_id</Sql>
            </Query>
            <Query>
              <Sql>t_strcom_tab LEFT JOIN codifiers.strcom_tab strcom2 ON strcom2.id = t.strcom_id</Sql>
            </Query>
            <Query>
              <Sql>t_travma_tab LEFT JOIN travma_tab travma1 ON travma1.travma_id = t.vid_travma</Sql>
            </Query>
            <Query>
              <Sql>t_ucheb_zaved_tab LEFT JOIN ucheb_zaved_tab ucheb2 On ucheb2.kod = t.kod_vuz</Sql>
            </Query>
            <Query>
              <Sql>t_vid_oplat_tab LEFT JOIN vid_oplat_tab vid_oplat1 On t.vid_oplat_id = vid_oplat1.vid_oplat_id</Sql>
            </Query>
            <Query>
              <Sql>v LEFT JOIN visit_tab v ON v.talon_id = t.talon_id</Sql>
            </Query>
            <Query>
              <Sql>v_doctor LEFT JOIN full_doctor_tab v_doctor 
ON v_doctor.full_doctor_id = v.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>v_operator LEFT JOIN users_tab oper3 ON oper3.id = v.operat_id 
JOIN dan_tab oper4 ON oper4.dan_id = oper3.dan_id 
 
/*full_doctor_tab v_operator 
ON  v_operator.full_doctor_id = v.operat_id*/</Sql>
            </Query>
            <Query>
              <Sql>v_otdel_tab LEFT JOIN otdel_tab v_otd ON v_doctor .otdel = v_otd.otdel</Sql>
            </Query>
            <Query>
              <Sql>v_spec LEFT JOIN full_doctor_tab v_spec ON v.doctor_id = v_spec.full_doctor_id</Sql>
            </Query>
            <Query>
              <Sql>v_target_pos_tab LEFT JOIN target_pos_tab v_target_pos ON v_target_pos.target_pos_id = v.target_pos_id</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT DISTINCT  :return_fields: FROM public.talon_tab t :sections: :where_section: :group_by_section: :having_section:</Sql>
            </Query>
            <Query>
              <Sql>zblist_tab LEFT JOIN blist_tab b ON v.data_pos between b.data_begin and b.data_end and b.dan_id = t.dan_id</Sql>
            </Query>
            <Query>
              <Sql>zblist_tab_doctor_id LEFT JOIN full_doctor_tab b_doctor 
ON b_doctor.full_doctor_id = b.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>zblist_tab_operator LEFT JOIN full_doctor_tab b_operator 
ON b_operator.full_doctor_id = b.operat_id</Sql>
            </Query>
            <Query>
              <Sql>zblist_tab_prichina LEFT JOIN prichina_tab b_prichina On b_prichina.prichina_id = b.prichina_id</Sql>
            </Query>
            <Query>
              <Sql>zblist_tab_type LEFT JOIN sp_blist_type_tab b_type On b.type_id = b_type.type_id</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="" Caption="Вакцинация" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="priv_preparat" Caption="Вакцина (препарат)" Type="select">
              <Sql>select sp_priv_univ_id, sp_priv_univ from sp_priv_univ_tab where parent=5 order by 2</Sql>
            </Parameter>
            <Parameter Name="priv_vid_priviv" Caption="Вид прививки" Type="select">
              <Sql>select sp_priv_univ_id, sp_priv_univ from sp_priv_univ_tab where parent=4 order by 2</Sql>
            </Parameter>
            <Parameter Name="priv_doctor" Caption="Врач (прививка)" Type="select">
              <Sql>select distinct doctor_id, fio from full_doctor_tab </Sql>
            </Parameter>
            <Parameter Name="priv_date" Caption="Дата прививки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="priv_doza" Caption="Доза" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="priv_infection" Caption="Инфекция" Type="select">
              <Sql>select sp_priv_univ_id, sp_priv_univ from sp_priv_univ_tab where parent=3 order by 2</Sql>
            </Parameter>
            <Parameter Name="priv_seria" Caption="Серия прививки" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="" Caption="Данные визита" Type="">
              <Sql />
            </Parameter>
            <Parameter Name="v_blood_high" Caption="Верхнее давление " Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="v_data_pos" Caption="Дата визита" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="v_data_vnes_inf" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="v_doctor_id" Caption="Доктор" Type="select">
              <Sql>SELECT f.full_doctor_id, f.full_doctor_id::text||' '||f.fio FROM full_doctor_tab f ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="v_visit_id" Caption="Кол-во визитов" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="v_mesto_obs" Caption="Место обследования" Type="select2">
              <Sql>П=В поликлинике|Д=На дому|А=Из нах активно</Sql>
            </Parameter>
            <Parameter Name="v_blood_low" Caption="Нижнее давление " Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="v_operat_id" Caption="Оператор, вносивший визит" Type="select">
              <Sql>select distinct oper3.id, '('||oper3.login||') '||oper4.fio, oper4.fio from users_tab oper3  JOIN dan_tab oper4 ON oper4.dan_id = oper3.dan_id where oper3.login!='elecard' order by 3</Sql>
            </Parameter>
            <Parameter Name="v_otdel" Caption="Отделение" Type="select">
              <Sql>SELECT otdel, nam_otdel FROM otdel_tab ORDER BY 1,2; </Sql>
            </Parameter>
            <Parameter Name="v_spec" Caption="Специальность врача" Type="select">
              <Sql>SELECT DISTINCT dolg_doctor_id, dolg_doctor FROM full_doctor_tab  ORDER BY dolg_doctor </Sql>
            </Parameter>
            <Parameter Name="v_target_pos_id" Caption="Цель посещения" Type="select">
              <Sql>SELECT target_pos_id, target_pos_id||' '||target_pos FROm target_pos_tab ORDER BY 1</Sql>
            </Parameter>
            <Parameter Name="" Caption="Данные ВН" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="b_date_vnes_inf" Caption="Дата внесения (ВН)" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="b_data_end" Caption="Дата закрытия (ВН)" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="b_data_begin" Caption="Дата открытия (ВН)" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="b_diag_mkb_id" Caption="Диагноз (ВН)" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="b_doctor_id" Caption="Доктор (ВН)" Type="select">
              <Sql>SELECT f.full_doctor_id, f.full_doctor_id::text||' '||f.fio FROM full_doctor_tab f ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="b_nomer" Caption="Номер (ВН)" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="b_operat_id" Caption="Оператор (ВН)" Type="select">
              <Sql>SELECT f.full_doctor_id, f.full_doctor_id::text||' '||f.fio FROM full_doctor_tab f ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="b_prichina_id" Caption="Причина выдачи (ВН)" Type="select">
              <Sql>SELECT prichina_id, nam_prichina FROm prichina_tab ORDER By 2</Sql>
            </Parameter>
            <Parameter Name="b_ser" Caption="Серия (ВН)" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="b_type_id" Caption="Тип ВН" Type="select">
              <Sql>SELECT type_id, type_name FROm sp_blist_type_tab ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="b_day_count" Caption="Число дней ВН" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="b_count" Caption="Число листов ВН" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="" Caption="Данные диагнозов" Type="">
              <Sql />
            </Parameter>
            <Parameter Name="vdoctor_diagdoctor" Caption="Врач, поставивший диагноз, тот же, что в визите" Type="check">
              <Sql />
            </Parameter>
            <Parameter Name="diag_data_vnes_inf" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="diag_data" Caption="Дата постановки диагноза" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="diag_diagn_osn" Caption="Диагноз" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="diag_doctor_id" Caption="Доктор" Type="select">
              <Sql>SELECT f.full_doctor_id, f.full_doctor_id::text||' '||f.fio FROM full_doctor_tab f ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="diag_count" Caption="Зарегистрирован" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="diag.kolvo" Caption="Кол-во диагнозов" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="diag_operat_id" Caption="Оператор" Type="select">
              <Sql>SELECT f.full_doctor_id, f.full_doctor_id::text||' '||f.fio FROM full_doctor_tab f ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="diag_otdel" Caption="Отделение" Type="select">
              <Sql>SELECT otdel, nam_otdel FROM otdel_tab ORDER BY 1,2; </Sql>
            </Parameter>
            <Parameter Name="diag_otmet" Caption="Характер диагноза" Type="select2">
              <Sql>Х=Хронический|З=Впервые зарегистрированный|О=Острый</Sql>
            </Parameter>
            <Parameter Name="" Caption="Данные талона" Type="">
              <Sql />
            </Parameter>
            <Parameter Name="t_vid_oplat_id" Caption="Вид оплаты" Type="select">
              <Sql>SELECT vid_oplat_id, vid_oplat_id||' '||nam_oplat FROm vid_oplat_tab ORDEr BY 1</Sql>
            </Parameter>
            <Parameter Name="t_vid_travma" Caption="Вид травмы" Type="select">
              <Sql>SELECT travma_id, travma_id||' '||travma FROm travma_tab ORDEr BY 1</Sql>
            </Parameter>
            <Parameter Name="t_kod_vuz" Caption="ВУЗ" Type="select">
              <Sql>SELECT u.kod, u.name FROm ucheb_zaved_tab u ORDEr BY 2</Sql>
            </Parameter>
            <Parameter Name="t_data_vnes_inf" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="t_doctor_id" Caption="Доктор на которого выписан талон" Type="select">
              <Sql>SELECT f.full_doctor_id, f.full_doctor_id::text||' '||f.fio FROM full_doctor_tab f ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="t_inogorod" Caption="Иногородний" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="t_talon_id" Caption="Кол-во талонов" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="p_polis_mask" Caption="Маска полиса" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="t_pricpol" Caption="Место прикрепления" Type="select">
              <Sql>SELECT l.pricpol, l.name FROm lpu_tab l ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="t_num_group" Caption="Номер группы" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="t_num_pol" Caption="Номер полиса" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="t_talon_id1" Caption="Номер талона" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="t_operator_id" Caption="Оператор, вносивший талон" Type="select">
              <Sql>select distinct oper1.id,  '('||oper1.login||') '||oper2.fio, oper2.fio from users_tab oper1  JOIN dan_tab oper2 ON oper2.dan_id = oper1.dan_id where oper1.login!='elecard' order by 3</Sql>
            </Parameter>
            <Parameter Name="t_diag_osn" Caption="Основной диагноз" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="t_otdel" Caption="Отделение" Type="select">
              <Sql>SELECT otdel, nam_otdel FROM otdel_tab ORDER BY 1,2; </Sql>
            </Parameter>
            <Parameter Name="t_polis_sootv" Caption="Полис в талоне соответствует маске" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="t_result_id" Caption="Результат" Type="select">
              <Sql>SELECT result_id, result_id::text||' '||result FROm result_tab ORDER BY 1</Sql>
            </Parameter>
            <Parameter Name="t_res_zapolnen" Caption="Результат заполнен" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="" Caption="Санаторно-курортное лечение" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="t_san_kur_date" Caption="Дата сан.-кур. лечения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="san_nazn" Caption="Назначено (есть справка для получения путевки)" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="t_san_proshel" Caption="Пройдено (есть санаторно-курортная карта)" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="t_ser_pol" Caption="Серия полиса" Type="select">
              <Sql />
            </Parameter>
            <Parameter Name="t_result_end" Caption="Случай закончен" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="first_cond" Caption="Состояние при обращении" Type="select">
              <Sql>select id,name from codifiers.first_visit_condition_tab</Sql>
            </Parameter>
            <Parameter Name="t_strcom_id" Caption="Страховая компания" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="t_kod_fak" Caption="Факультет" Type="select">
              <Sql>SELECT f.kod_fak, f.name||' ('||u.name||')' FROm fakult_tab f LEFT JOIN ucheb_zaved_tab u On u.kod = f.kod_vuz ORDER BY u.name,f.name</Sql>
            </Parameter>
            <Parameter Name="" Caption="Льготные рецепты (выписанные)" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="r_doctor_id" Caption="Врач" Type="select">
              <Sql>SELECT full_doctor_id, full_fio FROM full_doctor_tab WHERE full_fio is not null ORDER BY 1</Sql>
            </Parameter>
            <Parameter Name="r_date_vipiski" Caption="Дата выписки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="r_diagn_id" Caption="Диагноз (в рецепте)" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="r_kol" Caption="Кол-во препаратов" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="r_rezept_kolvo" Caption="Кол-во рецептов" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="r_kod_lgot" Caption="Льгота (в рецепте)" Type="select">
              <Sql>SELECT lgota_id, trim(lgota_id)||' '||nam_lgota FROm lgota_Tab ORDER BY 1,2</Sql>
            </Parameter>
            <Parameter Name="r_rezept_num" Caption="Номер рецепта" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="r_operator_id" Caption="Оператор" Type="select">
              <Sql>SELECT full_doctor_id, full_fio FROM full_doctor_tab WHERE full_fio is not null ORDER BY 1</Sql>
            </Parameter>
            <Parameter Name="r_kod_minzd" Caption="Препарат" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="r_rezept_ser" Caption="Серия рецепта" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="r_is_fed" Caption="Федеральная льгота (в рецепте)" Type="boolean">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="90001" Name="Очередь к врачам по заданной выборке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Очередь к врачам по заданной выборке.xls">
          <Queries>
            <Query>
              <Sql>t_cabinet LEFT JOIN codifiers.cabinet_tab cab1 ON cab1.id = t.cabinet_id</Sql>
            </Query>
            <Query>
              <Sql>t_doctor LEFT JOIN full_doctor_tab t_doctor ON t_doctor.full_doctor_id = t.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>t_operator LEFT JOIN full_doctor_tab t_operator ON t_operator.full_doctor_id = t.operator_id</Sql>
            </Query>
            <Query>
              <Sql>t_visit LEFT JOIN talon_tab t_talon ON t_talon.dan_id = t.dan_id 
LEFT JOIN visit_tab t_visit ON t_visit.talon_id = t_talon.talon_id AND 
	t_visit.data_pos = t.date_nazn AND t.doctor_id = t_visit.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT DISTINCT  :return_fields: FROM public.talon_doctor_tab t :sections: :where_section: :group_by_section: :having_section:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="" Caption="Данные очереди" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="v_is_visit" Caption="Визит занесен" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="t_time_nazn" Caption="Время назначения" Type="time_period">
              <Sql />
            </Parameter>
            <Parameter Name="t_date_nazn" Caption="Дата назначения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="t_doctor_id" Caption="К кому направляется" Type="select">
              <Sql>SELECT full_doctor_id, full_fio FROM full_doctor_view where expiration_date&gt;=now() ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="par_kabinet" Caption="Кабинет" Type="select">
              <Sql>select distinct cabinet_nam, cabinet_nam from talon_doctor_tab order by 1</Sql>
            </Parameter>
            <Parameter Name="par_kab" Caption="Кабинет (из справочника)" Type="select">
              <Sql>select id, name from codifiers.cabinet_tab</Sql>
            </Parameter>
            <Parameter Name="t_tal_count" Caption="Кол-во талонов" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="t_operator_id" Caption="Кто назначил" Type="select">
              <Sql>SELECT full_doctor_id, full_fio FROM full_doctor_tab ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="t_prog_name" Caption="Название программы, из которой был распечатан статталон" Type="select">
              <Sql>select distinct case when programm_name is null then 'неизвестно' else  programm_name end, case when programm_name is null then 'неизвестно' else  programm_name end  from talon_doctor_tab order by 2</Sql>
            </Parameter>
            <Parameter Name="t_talon_id" Caption="Номер талона" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="t_mark_programm_name" Caption="Название программы из которой был выписан талон на предварительную запись" Type="select">
              <Sql>select distinct case when programm_name is null then 'неизвестно' else  programm_name end, case when programm_name is null then 'неизвестно' else  programm_name end  from talon_doctor_tab order by 2</Sql>
            </Parameter>
            <Parameter Name="t_dolg_doctor" Caption="Специалист" Type="select">
              <Sql>select distinct dolg_doctor_id, dolg_doctor from full_doctor_tab join talon_doctor_tab ON full_doctor_tab.doctor_id = talon_doctor_tab .doctor_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="90010" Name="Услуги по заданной выборке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Услуги по заданной выборке.xls">
          <Queries>
            <Query>
              <Sql>priviv_tab LEFT JOIN priviv_tab p ON p.priviv_id = s.priv_id</Sql>
            </Query>
            <Query>
              <Sql>sp_uslug_tab LEFT JOIN sp_uslug_tab sp ON sp.uslug_kod= s.kod_usl</Sql>
            </Query>
            <Query>
              <Sql>sp_uslug_tab_parent LEFT JOIN sp_uslug_tab spp ON spp.uslug_kod= sp.parent_id</Sql>
            </Query>
            <Query>
              <Sql>strcom_tab LEFT JOIN strcom_tab strcom ON  strcom.strcom_id = d.strcom_id</Sql>
            </Query>
            <Query>
              <Sql>talon_tab LEFT JOIN talon_tab t ON t.talon_id = s.talon_id</Sql>
            </Query>
            <Query>
              <Sql>uchactok_tab LEFT JOIN uchactok_tab uch ON uch.uchactok_id = d.uchactok_id</Sql>
            </Query>
            <Query>
              <Sql>vid_pr LEFT JOIN sp_priv_univ_tab vpr ON vpr.parent = 4 AND vpr.sp_priv_univ_id = p.vid_priviv</Sql>
            </Query>
            <Query>
              <Sql>vuz LEFT JOIN ucheb_zaved_tab u ON u.kod = d.kod_vuz</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT DISTINCT  :return_fields: FROM public.stand_patient_tab s :sections: :where_section: :group_by_section: :having_section:</Sql>
            </Query>
            <Query>
              <Sql>request9 </Sql>
            </Query>
            <Query>
              <Sql>request10 </Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="" Caption="Прививки" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="p_vid_priviv" Caption="Вид прививки" Type="select">
              <Sql>SELECT sp_priv_univ_id, sp_priv_univ FROM sp_priv_univ_tab WHERE parent = 4 ORDER BY 1;</Sql>
            </Parameter>
            <Parameter Name="p_seria" Caption="Серия препарата" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="" Caption="Талон" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="t_doctor_id" Caption="Доктор, на которого выписан талон" Type="select">
              <Sql>SELECT full_doctor_id,full_doctor_id::text||' '||fio FROM full_doctor_view ORDER BY 2;</Sql>
            </Parameter>
            <Parameter Name="s_talon_id" Caption="Номер талона" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="" Caption="Услуги" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="s_date_usl" Caption="Дата оказания услуги" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="talon_id" Caption="Номер талона" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="program" Caption="Программа" Type="select">
              <Sql>SELECT s.uslug_kod, s.uslug_name FROm sp_uslug_tab s WHERE s.parent_id IS NULL AND s.uslug_kod between '39' and '60'</Sql>
            </Parameter>
            <Parameter Name="kod_usl" Caption="Услуга" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="250011" Name="Платные услуги по заданной выборке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Платные услуги по заданной выборке.xls">
          <Queries>
            <Query>
              <Sql>p_operator LEFT JOIN full_doctor_tab p_op1 
ON p_op1.full_doctor_id = p.operator_id</Sql>
            </Query>
            <Query>
              <Sql>p1 LEFT JOIN naprav_platno_usl_tab p1 ON p1.naprav_platno_id = p.naprav_platno_id</Sql>
            </Query>
            <Query>
              <Sql>p1_usl LEFT JOIN sp_uslug_tab p1_usl 
ON p1_usl.uslug_kod = p1.kod_usl</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT DISTINCT  :return_fields: FROM public.naprav_platno_tab p :sections: :where_section: :group_by_section: :having_section:</Sql>
            </Query>
            <Query>
              <Sql>request4 </Sql>
            </Query>
            <Query>
              <Sql>request5 </Sql>
            </Query>
            <Query>
              <Sql>request6 </Sql>
            </Query>
            <Query>
              <Sql>request7 </Sql>
            </Query>
            <Query>
              <Sql>request8 </Sql>
            </Query>
            <Query>
              <Sql>request9 </Sql>
            </Query>
            <Query>
              <Sql>request10 </Sql>
            </Query>
            <Query>
              <Sql>request11 </Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="" Caption="Платные услуги" Type="">
              <Sql />
            </Parameter>
            <Parameter Name="p_date_vnes_inf" Caption="Дата внесения информации" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="p_date_naprav" Caption="Дата направления" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="p1_kod_usl" Caption="Код услуги" Type="text_period">
              <Sql />
            </Parameter>
            <Parameter Name="p1_kolvo_usl" Caption="Кол-во услуг" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="p_check_number" Caption="Номер чека" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="p_operator_id" Caption="Оператор" Type="select">
              <Sql>SELECT f.full_doctor_id, f.full_fio  FROM full_doctor_view f  where expiration_date&gt;=now() ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="p1_discount" Caption="Скидка" Type="float_period">
              <Sql />
            </Parameter>
            <Parameter Name="p1_cost" Caption="Стоимость" Type="float_period">
              <Sql />
            </Parameter>
            <Parameter Name="param56" Caption="Сумма" Type="float_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="540010" Name="Заболеваемость по заданным выборкам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Заболеваемость по заданным выборкам.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT f.a,f.mkb,replace(f.diag1,':mkb:','diag.diagn_osn') as diag1,replace(f.diag1,':mkb:','disp.diagn_id') as diag2,f.d, 
(SELECT MAX(diag.data_vnes_inf) as date_sn1 
FROM 
(SELECT date_sn FROM dispan_uchet_tab) as diag(data_vnes_inf) 
WHERE :param2_1_: 
) as date_sn1 , 
(SELECT MAX(diag.data_vnes_inf) as date1 
FROM 
(SELECT date FROM dispan_uchet_tab) as diag(data_vnes_inf) 
WHERE :param2_1_: 
) as date1 
 FROM 
(:param1_2_:) as f(mkb,a,diag1,d) 
ORDER BY f.d</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT COUNT(DISTINCT diag.oid), COUNT(DISTINCT v.visit_id) as visit_count FROM diagn_tab diag 
LEFT JOIN dan_tab d On d.dan_id = diag.dan_id 
LEFT JOIN visit_tab v On v.talon_id = diag.talon_id 
LEFT JOIN full_doctor_tab f1 ON f1.full_doctor_id = diag.doctor_id 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id 
 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) as fed1 ON fed1.dan_id = d.dan_id 
 
WHERE diag.count = '1' AND :param2_1_: AND (:diag1:) 
AND :uch_param_1_: AND :sex_param_1_: AND :date_born_param_1_: AND :vozrast_param_1_: AND :local_lgot_param_1_: 
AND :d_god_post_1_: AND :d_num_group_1_: AND :d_kod_vuz_1_: AND :d_kod_fak_1_:  AND :vrach_param_1_: 
 AND :vrach_otdel_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT COUNT(DISTINCT diag.oid) FROM diagn_tab diag 
 LEFT JOIN dan_tab d On d.dan_id = diag.dan_id 
 LEFT JOIN full_doctor_tab f1 ON f1.full_doctor_id = diag.doctor_id 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id 
 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) as fed1 ON fed1.dan_id = d.dan_id 
 
WHERE diag.count = '1' AND diag.otmet  in ('З', 'О') AND :param2_1_: AND (:diag1:) 
AND :uch_param_1_: AND :sex_param_1_: AND :date_born_param_1_: AND :vozrast_param_1_: AND :local_lgot_param_1_: 
AND :d_god_post_1_: AND :d_num_group_1_: AND :d_kod_vuz_1_: AND :d_kod_fak_1_:   AND :vrach_param_1_: 
 AND :vrach_otdel_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECt COUNT(DISTINCT disp.dan_id::text||disp.diagn_id) FROM dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
 LEFT JOIN full_doctor_tab f1 ON f1.full_doctor_id = disp.doctor_id 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id 
 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) as fed1 ON fed1.dan_id = d.dan_id 
 
WHERe (disp.date_sn is null OR disp.date_sn &gt; 
get_default(':date_sn1:','2050-01-01')::date  ) AND disp.date &lt;= get_default(':date1:','2050-01-01')::date 
AND (:diag2:) 
AND :uch_param_1_: AND :sex_param_1_: AND :date_born_param_1_: AND :vozrast_param_1_: AND :local_lgot_param_1_: 
AND :d_god_post_1_: AND :d_num_group_1_: AND :d_kod_vuz_1_: AND :d_kod_fak_1_:   AND :vrach_param_1_: 
 AND :vrach_otdel_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="vrach_param" Caption="Врач" Type="select">
              <Sql>SELECT full_doctor_id,full_fio FROM full_doctor_view where expiration_date&gt;=now() ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Диагнозы" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="vrach_otdel" Caption="Отдел" Type="select">
              <Sql>SELECT otdel,nam_otdel FROM otdel_tab ORDER BY nam_otdel</Sql>
            </Parameter>
            <Parameter Name="" Caption="Пациент" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="vozrast_param" Caption="Возраст" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="date_born_param" Caption="Дата рождения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="local_lgot_param" Caption="Местная льгота" Type="select">
              <Sql>SELECT trim(l.lgota_id), trim(l.lgota_id)||' '||l.nam_lgota FROM lgota_tab l WHERE length(trim(l.lgota_id)) &lt; 3 ORDER BY 1 </Sql>
            </Parameter>
            <Parameter Name="" Caption="Место учебы пациента" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_god_post" Caption="Дата поступления в учебное заведение" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_num_group" Caption="Номер группы" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_kod_vuz" Caption="Учебное заведение" Type="select">
              <Sql>SELECT u.kod, u.name FROm ucheb_zaved_tab u ORDEr BY 2</Sql>
            </Parameter>
            <Parameter Name="d_kod_fak" Caption="Факультет" Type="select">
              <Sql>SELECT f.kod_fak, f.name||' ('||u.name||')' FROm fakult_tab f LEFT JOIN ucheb_zaved_tab u On u.kod = f.kod_vuz ORDER BY u.name,f.name</Sql>
            </Parameter>
            <Parameter Name="sex_param" Caption="Пол" Type="select2">
              <Sql>м=м|ж=ж</Sql>
            </Parameter>
            <Parameter Name="uch_param" Caption="Участок" Type="select">
              <Sql>SELECT uchactok_id, uchactok FROM uchactok_tab ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="fed_lgota_param" Caption="Федеральная льгота" Type="select">
              <Sql>SELECT trim(l.lgota_id), trim(l.lgota_id)||' '||l.nam_lgota FROM lgota_tab l WHERE length(trim(l.lgota_id)) = 3 ORDER BY 1 </Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="13600000" Name="Диспансеризация по нозологиям" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Диспансеризация по нозологиям.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT f.mkb,f.a as nozol,replace(f.diag1,':mkb:','diag.diagn_osn') as diag1,replace(f.diag1,':mkb:','disp.diagn_id') as diag2,f.d, 
(SELECT MAX(diag.data_vnes_inf) as date_sn1 
FROM 
(SELECT date_sn FROM dispan_uchet_tab) as diag(data_vnes_inf) 
WHERE :param2_1_: 
) as date_sn1 , 
(SELECT MIN(diag.data_vnes_inf) as date1 
FROM 
(SELECT date FROM dispan_uchet_tab) as diag(data_vnes_inf) 
WHERE :param2_1_: 
) as date1 , 
(SELECT MAX(diag.data_vnes_inf) as date1 
FROM 
(SELECT date FROM dispan_uchet_tab) as diag(data_vnes_inf) 
WHERE :param2_1_: 
) as date2 
 FROM 
(:param1_2_:) as f(mkb,a,diag1,d) 
ORDER BY f.d</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECt COUNT(DISTINCT disp.dan_id::text||disp.diagn_id) FROM dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
 LEFT JOIN full_doctor_tab f1 ON f1.full_doctor_id = disp.doctor_id 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id 
 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) as fed1 ON fed1.dan_id = d.dan_id 
 
WHERe (disp.date_sn is null OR disp.date_sn &gt; 
get_default(':date1:','1900-01-01')::date  ) AND disp.date &lt; get_default(':date1:','2050-01-01')::date 
AND :diag2: 
AND :uch_param_1_: AND :sex_param_1_: AND :date_born_param_1_: AND :vozrast_param_1_: AND :local_lgot_param_1_: 
AND :d_god_post_1_: AND :d_num_group_1_: AND :d_kod_vuz_1_: AND :d_kod_fak_1_:   AND :vrach_param_1_: 
 AND :vrach_otdel_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECt COUNT(DISTINCT disp.dan_id::text||disp.diagn_id) FROM dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
 LEFT JOIN full_doctor_tab f1 ON f1.full_doctor_id = disp.doctor_id 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id 
 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) as fed1 ON fed1.dan_id = d.dan_id 
 
WHERe disp.date &gt;= get_default(':date1:','1900-01-01')::date 
AND :diag2: 
AND :uch_param_1_: AND :sex_param_1_: AND :date_born_param_1_: AND :vozrast_param_1_: AND :local_lgot_param_1_: 
AND :d_god_post_1_: AND :d_num_group_1_: AND :d_kod_vuz_1_: AND :d_kod_fak_1_:   AND :vrach_param_1_: 
 AND :vrach_otdel_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECt COUNT(DISTINCT disp.dan_id::text||disp.diagn_id) FROM dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
 LEFT JOIN full_doctor_tab f1 ON f1.full_doctor_id = disp.doctor_id 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id 
 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) as fed1 ON fed1.dan_id = d.dan_id 
 
WHERe disp.date &gt;= get_default(':date1:','1900-01-01')::date AND disp.vn_uchet IS NULL 
AND :diag2: 
AND :uch_param_1_: AND :sex_param_1_: AND :date_born_param_1_: AND :vozrast_param_1_: AND :local_lgot_param_1_: 
AND :d_god_post_1_: AND :d_num_group_1_: AND :d_kod_vuz_1_: AND :d_kod_fak_1_:   AND :vrach_param_1_: 
 AND :vrach_otdel_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros5 SELECt COUNT(DISTINCT disp.dan_id::text||disp.diagn_id) FROM dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
 LEFT JOIN full_doctor_tab f1 ON f1.full_doctor_id = disp.doctor_id 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id 
 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) as fed1 ON fed1.dan_id = d.dan_id 
 
WHERe disp.date_sn &gt;= 
get_default(':date1:','2050-01-01')::date  AND disp.date_sn &lt; 
get_default(':date_sn1:','2050-01-01')::date  
AND :diag2: 
AND :uch_param_1_: AND :sex_param_1_: AND :date_born_param_1_: AND :vozrast_param_1_: AND :local_lgot_param_1_: 
AND :d_god_post_1_: AND :d_num_group_1_: AND :d_kod_vuz_1_: AND :d_kod_fak_1_:   AND :vrach_param_1_: 
 AND :vrach_otdel_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros6(pr_sn) SELECt COUNT(DISTINCT disp.dan_id::text||disp.diagn_id) FROM dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
 LEFT JOIN full_doctor_tab f1 ON f1.full_doctor_id = disp.doctor_id 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id 
 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) as fed1 ON fed1.dan_id = d.dan_id 
 
WHERe disp.date_sn &gt;= 
get_default(':date1:','2050-01-01')::date  AND disp.date_sn &lt; 
get_default(':date_sn1:','2050-01-01')::date    AND disp.prichin_sn_id = pr_sn 
AND :diag2: 
AND :uch_param_1_: AND :sex_param_1_: AND :date_born_param_1_: AND :vozrast_param_1_: AND :local_lgot_param_1_: 
AND :d_god_post_1_: AND :d_num_group_1_: AND :d_kod_vuz_1_: AND :d_kod_fak_1_:   AND :vrach_param_1_: 
 AND :vrach_otdel_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros7 SELECt COUNT(DISTINCT disp.dan_id::text||disp.diagn_id) FROM dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
 LEFT JOIN full_doctor_tab f1 ON f1.full_doctor_id = disp.doctor_id 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id 
 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) as fed1 ON fed1.dan_id = d.dan_id 
 
WHERe (disp.date_sn is null OR disp.date_sn &gt; 
get_default(':date_sn1:','2050-01-01')::date  ) AND disp.date &lt;= get_default(':date2:','2050-01-01')::date 
AND :diag2: 
AND :uch_param_1_: AND :sex_param_1_: AND :date_born_param_1_: AND :vozrast_param_1_: AND :local_lgot_param_1_: 
AND :d_god_post_1_: AND :d_num_group_1_: AND :d_kod_vuz_1_: AND :d_kod_fak_1_:   AND :vrach_param_1_: 
 AND :vrach_otdel_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros8(gr_i) SELECt COUNT(DISTINCT disp.dan_id::text||disp.diagn_id) FROM dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
 LEFT JOIN full_doctor_tab f1 ON f1.full_doctor_id = disp.doctor_id 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id 
 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) as fed1 ON fed1.dan_id = d.dan_id 
 
WHERe (disp.date_sn is null OR disp.date_sn &gt; 
get_default(':date_sn1:','2050-01-01')::date  ) AND disp.date &lt;= get_default(':date2:','2050-01-01')::date 
AND d.inval_id = gr_i 
AND :diag2: 
AND :uch_param_1_: AND :sex_param_1_: AND :date_born_param_1_: AND :vozrast_param_1_: AND :local_lgot_param_1_: 
AND :d_god_post_1_: AND :d_num_group_1_: AND :d_kod_vuz_1_: AND :d_kod_fak_1_:   AND :vrach_param_1_: 
 AND :vrach_otdel_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="vrach_param" Caption="Врач" Type="select">
              <Sql>SELECT full_doctor_id,full_fio FROM full_doctor_view where expiration_date&gt;=now() ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Диагнозы" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="vrach_otdel" Caption="Отдел" Type="select">
              <Sql>SELECT otdel,nam_otdel FROM otdel_tab ORDER BY nam_otdel</Sql>
            </Parameter>
            <Parameter Name="" Caption="Пациент" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="vozrast_param" Caption="Возраст" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="date_born_param" Caption="Дата рождения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="local_lgot_param" Caption="Местная льгота" Type="select">
              <Sql>SELECT trim(l.lgota_id), trim(l.lgota_id)||' '||l.nam_lgota FROM lgota_tab l WHERE length(trim(l.lgota_id)) &lt; 3 ORDER BY 1 </Sql>
            </Parameter>
            <Parameter Name="" Caption="Место учебы пациента" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_god_post" Caption="Дата поступления в учебное заведение" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_num_group" Caption="Номер группы" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_kod_vuz" Caption="Учебное заведение" Type="select">
              <Sql>SELECT u.kod, u.name FROm ucheb_zaved_tab u ORDEr BY 2</Sql>
            </Parameter>
            <Parameter Name="d_kod_fak" Caption="Факультет" Type="select">
              <Sql>SELECT f.kod_fak, f.name||' ('||u.name||')' FROm fakult_tab f LEFT JOIN ucheb_zaved_tab u On u.kod = f.kod_vuz ORDER BY u.name,f.name</Sql>
            </Parameter>
            <Parameter Name="sex_param" Caption="Пол" Type="select2">
              <Sql>м=м|ж=ж</Sql>
            </Parameter>
            <Parameter Name="uch_param" Caption="Участок" Type="select">
              <Sql>SELECT uchactok_id, uchactok FROM uchactok_tab ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="fed_lgota_param" Caption="Федеральная льгота" Type="select">
              <Sql>SELECT trim(l.lgota_id), trim(l.lgota_id)||' '||l.nam_lgota FROM lgota_tab l WHERE length(trim(l.lgota_id)) = 3 ORDER BY 1 </Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="13800000" Name="Временная нетрудоспособность по нозологиям" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Временная нетрудоспособность по нозологиям.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT f.mkb,f.a as nozol,replace(f.diag1,':mkb:','diag.diag_mkb_id') as diag1,replace(f.diag1,':mkb:','disp.diagn_id') as diag2,f.d 
 FROM 
(:param1_2_:) as f(mkb,a,diag1,d) 
ORDER BY f.d</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT COUNT(blist_id),SUM(data_end - data_begin) as ndays, 
avg(data_end - data_begin) as agvdays from ( 
select distinct diag.blist_id , 
diag.data_end , diag.data_begin 
 
FROM blist_tab diag 
LEFT JOIN dan_tab d On d.dan_id = diag.dan_id 
LEFT JOIN visit_tab v ON v.data_pos between diag.data_begin and diag.data_end and diag.dan_id = d.dan_id 
LEFT JOIN full_doctor_tab f1 ON f1.full_doctor_id = v.doctor_id 
LEFT JOIN full_doctor_tab doc ON diag.doctor_id = doc.doctor_id 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.lgota), ',', t.a) as lgota FROm lgot_client_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.lgota), ',', t.a) is not null  AND split_part(trim(f.lgota), ',', t.a) != '') as local1 
ON local1.dan_id = d.dan_id 
 
LEFT JOIN (SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,5) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) as fed1 ON fed1.dan_id = d.dan_id 
 
WHERE :param2_1_: AND (:diag1:) 
AND :uch_param_1_: AND :sex_param_1_: AND :date_born_param_1_: AND :vozrast_param_1_: AND :local_lgot_param_1_: 
AND :d_god_post_1_: AND :d_num_group_1_: AND :d_kod_vuz_1_: AND :d_kod_fak_1_:  AND :vrach_param_1_: 
AND :vrach_otdel_1_: AND :diag_data_begin_1_: AND :diag_data_end_1_: 
and :spec_param_1_: 
AND :type_doc_1_: ) q</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="vrach_param" Caption="Врач" Type="select">
              <Sql>SELECT full_doctor_id,full_fio FROM full_doctor_view where expiration_date&gt;=now() ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="diag_data_begin" Caption="Дата начала случая" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="diag_data_end" Caption="Дата окончания случая" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Диагнозы" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="vrach_otdel" Caption="Отдел" Type="select">
              <Sql>SELECT otdel,nam_otdel FROM otdel_tab ORDER BY nam_otdel</Sql>
            </Parameter>
            <Parameter Name="" Caption="Пациент" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="vozrast_param" Caption="Возраст" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="date_born_param" Caption="Дата рождения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="local_lgot_param" Caption="Местная льгота" Type="select">
              <Sql>SELECT trim(l.lgota_id), trim(l.lgota_id)||' '||l.nam_lgota FROM lgota_tab l WHERE length(trim(l.lgota_id)) &lt; 3 ORDER BY 1 </Sql>
            </Parameter>
            <Parameter Name="" Caption="Место учебы пациента" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_god_post" Caption="Дата поступления в учебное заведение" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="d_num_group" Caption="Номер группы" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="d_kod_vuz" Caption="Учебное заведение" Type="select">
              <Sql>SELECT u.kod, u.name FROm ucheb_zaved_tab u ORDEr BY 2</Sql>
            </Parameter>
            <Parameter Name="d_kod_fak" Caption="Факультет" Type="select">
              <Sql>SELECT f.kod_fak, f.name||' ('||u.name||')' FROm fakult_tab f LEFT JOIN ucheb_zaved_tab u On u.kod = f.kod_vuz ORDER BY u.name,f.name</Sql>
            </Parameter>
            <Parameter Name="sex_param" Caption="Пол" Type="select2">
              <Sql>м=м|ж=ж</Sql>
            </Parameter>
            <Parameter Name="uch_param" Caption="Участок" Type="select">
              <Sql>SELECT uchactok_id, uchactok FROM uchactok_tab ORDER BY 2</Sql>
            </Parameter>
            <Parameter Name="fed_lgota_param" Caption="Федеральная льгота" Type="select">
              <Sql>SELECT trim(l.lgota_id), trim(l.lgota_id)||' '||l.nam_lgota FROM lgota_tab l WHERE length(trim(l.lgota_id)) = 3 ORDER BY 1 </Sql>
            </Parameter>
            <Parameter Name="spec_param" Caption="Специальность врача" Type="select">
              <Sql>SELECT 'true'::text, 'Все специальности'::text, 0  UNION  SELECT distinct dolg_doctor_id::text, doc.dolg_doctor, 1 FROm full_doctor_tab doc ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="type_doc" Caption="Тип документа ВН" Type="select">
              <Sql>SELECT type_id, type_name FROM sp_blist_type_tab WHERE (type_id &gt;= 0) ORDER BY type_id </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="14400000" Name="Услуги по заданной выборке (новый)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Услуги по заданной выборке (новый).xls">
          <Queries>
            <Query>
              <Sql>request12 </Sql>
            </Query>
            <Query>
              <Sql>s_cabinet LEFT JOIN codifiers.cabinet_tab cab ON cab.id = s.cabinet_id</Sql>
            </Query>
            <Query>
              <Sql>s_doctor LEFT JOIN full_doctor_tab doc ON doc.full_doctor_id = s.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>s_for_lpu LEFT JOIN lpu_tab lpu2 ON lpu2.lpu_id = s.sp_lpu_for_id</Sql>
            </Query>
            <Query>
              <Sql>s_lpu_okaz LEFT JOIN lpu_tab lpu1 ON lpu1.lpu_id = s.sp_lpu_id</Sql>
            </Query>
            <Query>
              <Sql>s_naprav LEFT JOIN naprav_tab n ON n.id = s.naprav_id</Sql>
            </Query>
            <Query>
              <Sql>s_naprav_doctor LEFT JOIN full_doctor_tab n_doc1 ON n_doc1.full_doctor_id = n.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>s_naprav_type LEFT JOIN sp_type_napr_tab n_type1 ON n_type1.sp_type_napr_id = n.sp_type_napr_id</Sql>
            </Query>
            <Query>
              <Sql>s_operator LEFT JOIN users_tab oper1 ON oper1.id = s.operator_id 
JOIN dan_tab oper2 ON oper2.dan_id = oper1.dan_id</Sql>
            </Query>
            <Query>
              <Sql>s_sp_kind_paid LEFT JOIN sp_kind_paid_tab kpaid1 ON kpaid1.id = s.sp_kind_paid_id</Sql>
            </Query>
            <Query>
              <Sql>s_vid_usl LEFT JOIN codifiers.sp_uslug_tab sp_usl ON sp_usl.id=s.sp_uslug_id</Sql>
            </Query>
            <Query>
              <Sql>sn_contract LEFT JOIN contracts_tab contract1 ON contract1.id = n.contract_id</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT DISTINCT  :return_fields: FROM public.okaz_uslug_tab  s 
:sections: :where_section: :group_by_section: :having_section:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="" Caption="Услуги" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="s_sp_kind_paid" Caption="Вид оплаты" Type="select">
              <Sql>select id, name from sp_kind_paid_tab order by 1</Sql>
            </Parameter>
            <Parameter Name="s_doctor" Caption="Врач, оказавший услугу" Type="select">
              <Sql>select full_doctor_id, full_fio from full_doctor_tab order by 2</Sql>
            </Parameter>
            <Parameter Name="s_time_okaz" Caption="Время оказания услуги" Type="datetime_period">
              <Sql />
            </Parameter>
            <Parameter Name="s_date_okaz" Caption="Дата оказания услуги" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="s_kol_vo" Caption="Кол-во оказаний услуги" Type="int_period">
              <Sql />
            </Parameter>
            <Parameter Name="s_lpu_for" Caption="ЛПУ, для которого оказывается услуга" Type="select">
              <Sql>select lpu_id, name from lpu_tab order by 2</Sql>
            </Parameter>
            <Parameter Name="lpu_okaz" Caption="ЛПУ, оказавшее услугу" Type="select">
              <Sql>select lpu_id, name from lpu_tab order by 2</Sql>
            </Parameter>
            <Parameter Name="s_usluga" Caption="Наименование услуги" Type="select">
              <Sql>select id, code||' '||substr(name,0,100) from sp_uslug_tab order by 1</Sql>
            </Parameter>
            <Parameter Name="s_operator" Caption="Оператор, вносивший услугу" Type="select">
              <Sql>select distinct s.operator_id, oper2.fio from services_tab s JOIN users_tab oper1 ON oper1.id = s.operator_id JOIN dan_tab oper2 ON oper2.dan_id = oper1.dan_id where oper1.login!='elecard' order by 2</Sql>
            </Parameter>
            <Parameter Name="s_inference_diagnosis" Caption="Диагноз" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="s_cost" Caption="Цена услуги" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2026703000" Name="Диспансеризация (2014) по заданной выборке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Диспансеризация (2014) по заданной выборке.xls">
          <Queries>
            <Query>
              <Sql>dop_disp_diagn_join left join dop_disp_diagns_tab diag on diag.dop_disp_main_id = dd.id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_diagn_join_stage LEFT JOIN public.sp_stadiya_diagn_tab main_diag_stage ON main_diag_stage.sp_stadiya_diagn_id = diag.diagn_stage_id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_diagn_tip_join left join codifiers.sp_disease_vid_tab sd on sd.id=diag.sp_disease_vid_id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_incompletion_reason_join left join codifiers.dop_disp_incompletion_reason_tab di on di.id=dd.incompletion_reason_id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_measure_tab left join dop_disp_measures_tab dm on dm.dop_disp_main_id=dd.id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_measure_tab_doctor_join left join full_doctor_tab f1 on f1.full_doctor_id=dm.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_measure_tab_medsister_join left join full_doctor_tab f10 on f10.full_doctor_id=dm.medsister_id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_measure_tab_operator_join left join full_doctor_tab f2 on f2.full_doctor_id=dm.operator_id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_measure_visit_tab left join visit_tab vis on vis.data_pos=dm.measure_date and vis.dan_id=dd.dan_id and vis.doctor_id=dm.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_measures_join left join codifiers.dop_disp_measures_tab ddm on ddm.id=dm.dop_disp_measure_id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_open_doc_join left join full_doctor_tab fo on fo.full_doctor_id=dd.doctor_id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_oslozh_diagn_join left join dop_disp_diagns_tab diag4 on diag4.dop_disp_main_id = dd.id and diag4.sp_disease_vid_id=300000</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_result_join left join codifiers.dop_disp_result_tab dr on dr.id=dd.result_id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_result1_join left join dop_disp_results_tab ddr on ddr.dop_disp_main_id=dd.id</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_type_join left join codifiers.dop_disp_type_tab dt on dt.id=dd.dop_disp_type_id</Sql>
            </Query>
            <Query>
              <Sql>full_doctor_join left join full_doctor_tab f on f.full_doctor_id=dd.operator_id</Sql>
            </Query>
            <Query>
              <Sql>med_help_result_stage1_join left join codifiers.med_help_result_tab mh1 on mh1.id=dd.result_stage_1</Sql>
            </Query>
            <Query>
              <Sql>med_help_result_stage2_join left join codifiers.med_help_result_tab mh2 on mh2.id=dd.result_stage_2</Sql>
            </Query>
            <Query>
              <Sql>okaz_uslug_join join okaz_uslug_tab ok on ok.table_link_id=dd.id and ok.table_link_name='dop_disp_main_tab' and case when 
ddm.dd_stage=2 then ok.bur_dd_magic_number in (dm.id,2) else ok.bur_dd_magic_number in (1, 2) end</Sql>
            </Query>
            <Query>
              <Sql>okaz_uslug_join_date join okaz_uslug_tab ok on ok.table_link_id=dd.id</Sql>
            </Query>
            <Query>
              <Sql>sp_health_group_join left join sp_health_group_tab sh on sh.sp_health_group_id=dd.sp_health_group_id</Sql>
            </Query>
            <Query>
              <Sql>sp_uslug_join join sp_uslug_tab su on su.id=ok.sp_uslug_id</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT DISTINCT  :return_fields: FROM public.dop_disp_main_tab dd :sections: :where_section: :group_by_section: :having_section:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="" Caption="Диспансеризация" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dd_gr_obsl_id" Caption="Группа Д-учета" Type="select">
              <Sql>SELECT a,a FROM generate_series(1,5) AS a;</Sql>
            </Parameter>
            <Parameter Name="dd_sp_health_group_id" Caption="Группа здоровья" Type="select">
              <Sql>select sp_health_group_id, sp_health_group from sp_health_group_tab where sp_health_group_id in (0,1,2,3) order by 2;</Sql>
            </Parameter>
            <Parameter Name="dd_date_vnes_inf" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dd_date_begin" Caption="Дата начала диспансеризации" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dd_date_end" Caption="Дата окончания диспансеризации" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="ok_accept_date" Caption="Дата оплаты" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dd_accept_date_first_stage" Caption="Дата оплаты 1-го этапа ТТФОМС" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dd_accept_date_second_stage" Caption="Дата оплаты 2-го этапа ТТФОМС" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dd_date_reestr_first_stage" Caption="Дата реестра (1 этап)" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dd_date_reestr_second_stage" Caption="Дата реестра (2 этап)" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dd_doctor_id" Caption="Доктор, открывший карту" Type="select">
              <Sql>select full_doctor_id, full_fio from full_doctor_tab order by 1;</Sql>
            </Parameter>
            <Parameter Name="diag_diagn_osn" Caption="Заболевание" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="sp_uslug" Caption="Код услуги" Type="select">
              <Sql />
            </Parameter>
            <Parameter Name="" Caption="Мероприятия" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dm_date_vnes_inf" Caption="Дата внесения мероприятия" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dm_measure_date" Caption="Дата мероприятия" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dm_doctor_id" Caption="Доктор (мероприятие)" Type="select">
              <Sql>select full_doctor_id, full_fio from full_doctor_tab order by 2;</Sql>
            </Parameter>
            <Parameter Name="dm_medsister_id" Caption="Медсестра (мероприятие)" Type="select">
              <Sql>select full_doctor_id, full_fio from full_doctor_tab order by 2;</Sql>
            </Parameter>
            <Parameter Name="dm_dop_disp_measure_id" Caption="Мероприятие" Type="select">
              <Sql>select id, substr(name,1,150) from codifiers.dop_disp_measures_tab order by 2;</Sql>
            </Parameter>
            <Parameter Name="dm_operator_id" Caption="Оператор (мероприятие)" Type="select">
              <Sql>select full_doctor_id, full_fio from full_doctor_tab order by 2;</Sql>
            </Parameter>
            <Parameter Name="oplachena_burusl" Caption="Оплачена услуга Бур" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dm_refusal_flag" Caption="Отказ" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="no_visit" Caption="Нет визита" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_operator_id" Caption="Оператор" Type="select">
              <Sql>select full_doctor_id, full_fio from full_doctor_tab order by 2;</Sql>
            </Parameter>
            <Parameter Name="oplachen_1" Caption="Оплачен 1-ый этап" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="oplachen_2" Caption="Оплачен 2-ой этап" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="diag1_diagn_osn" Caption="Осложнения осн.заболевания" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="dd_sent_to_disp" Caption="Поставлен на Д-учет" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_incompletion_reason_id" Caption="Причина неполноты данных" Type="select">
              <Sql>select id, name from codifiers.dop_disp_incompletion_reason_tab order by 2;</Sql>
            </Parameter>
            <Parameter Name="dd_maked_proc" Caption="Процент выполнения этапа" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="dd_result_stage_1" Caption="Результат 1-го этапа" Type="select">
              <Sql>select id, name from codifiers.med_help_result_tab where id in (316,317,318,360,361) order by 2;</Sql>
            </Parameter>
            <Parameter Name="dd_result_stage_1" Caption="Результат 2-го этапа" Type="select">
              <Sql>select id, name from codifiers.med_help_result_tab where id in (316,317,318,319) order by 2;</Sql>
            </Parameter>
            <Parameter Name="dd_result_id" Caption="Рекомендации по результатам ДД" Type="select">
              <Sql>select id, name from codifiers.dop_disp_result_tab order by 2;</Sql>
            </Parameter>
            <Parameter Name="main_diagn_stage_id" Caption="Стадия заболевания" Type="select">
              <Sql>SELECT s.sp_stadiya_diagn_id, s.name_stadiya FROM sp_stadiya_diagn_tab s ORDER BY 1</Sql>
            </Parameter>
            <Parameter Name="dd_conv_price" Caption="Сумма по законченному случаю" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="dd_dop_disp_type_id" Caption="Тип ДД" Type="select">
              <Sql>select id, name from codifiers.dop_disp_type_tab order by 2;</Sql>
            </Parameter>
            <Parameter Name="diag_sp_disease_vid_id" Caption="Тип диагноза" Type="select">
              <Sql>select id, name from codifiers.sp_disease_vid_tab order by 2;</Sql>
            </Parameter>
            <Parameter Name="dd_hyperglycemia" Caption="Факторы риска: Гиперкликемия" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_hypercholesterinemia" Caption="Факторы риска: Гиперхолистеринемия" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_narcotics" Caption="Факторы риска: Зависимость от наркотиков" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_weight_excess" Caption="Факторы риска: Избыточная масса тела" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_smoker" Caption="Факторы риска: Курение" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_sent_to_narkolog" Caption="Факторы риска: Направлен к психиатру/наркологу" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_insuff_phys_activity" Caption="Факторы риска: Недостаточная физ активность" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_irrational_nutrition" Caption="Факторы риска: Нерациональное питание" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_obesity" Caption="Факторы риска: Ожирение" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_alcohol" Caption="Факторы риска: Пагубное потребление алкоголя" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_high_a_p" Caption="Факторы риска: Повышенное АД" Type="boolean">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2031703000" Name="Диспансеризация (2013) по заданной выборке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Новые отчеты по заданным выборкам\Диспансеризация (2013) по заданной выборке.xls">
          <Queries>
            <Query>
              <Sql>diagn_join left join diagn_tab diag on diag.dan_id=dd.dan_id 
and diag.talon_id in (SELECT DISTINCT talon_id FROM visit_tab v 
WHERE v.data_pos BETWEEN dd.date_creation::date-'1 month'::interval AND dd.date_creation::date+'1 month'::interval 
AND v.target_pos_id IN (10,11,12,13,14,15,16))</Sql>
            </Query>
            <Query>
              <Sql>diagn_stad_join left join sp_stadiya_diagn_tab stad on stad.sp_stadiya_diagn_id=diag.stage_of_disease</Sql>
            </Query>
            <Query>
              <Sql>doctor_join left join full_doctor_tab f on f.full_doctor_id=dd.operator_id</Sql>
            </Query>
            <Query>
              <Sql>health_group left join sp_health_group_tab sh on sh.sp_health_group_id = dd.health_group</Sql>
            </Query>
            <Query>
              <Sql>result left join codifiers.dop_disp_result_tab res on res.id=dd.result_id</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT DISTINCT  :return_fields: FROM public.dop_disp_bur_tab dd 
:sections: :where_section: :group_by_section: :having_section:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="" Caption="Данные по ДД" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dd_alcohol" Caption="Алкоголь" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_operator_id" Caption="Врач" Type="select">
              <Sql>select full_doctor_id,full_fio from full_doctor_tab order by 2</Sql>
            </Parameter>
            <Parameter Name="dd_high_risk_grade" Caption="Высокий риск по шкале SCORE" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_hypergikemia" Caption="Гипергликемия" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_hypercholesterinemia" Caption="Гиперхолестеринемия" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_hypodynamia" Caption="Гиподинамия" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_health_group" Caption="Группа здоровья" Type="select">
              <Sql>select sp_health_group_id, sp_health_group  from sp_health_group_tab  order by 2</Sql>
            </Parameter>
            <Parameter Name="dd_date_creation" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="dd_diagn_osn" Caption="Диагноз" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="dd_weight_excess" Caption="Избыток массы тела" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_smoking" Caption="Курение" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_narcotics" Caption="Наркотики" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_irrational_diet" Caption="Нерациональное питание" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_obesity" Caption="Ожирение" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_high_pressure" Caption="Повышенное АД" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="dd_result_id" Caption="Результат" Type="select">
              <Sql>select id, name from codifiers.dop_disp_result_tab order by 2</Sql>
            </Parameter>
            <Parameter Name="dd_dd_stage " Caption="Стадия" Type="select">
              <Sql>select 1,'1' union select 2,'2' union  select null,'Не заполнено' order by 1</Sql>
            </Parameter>
            <Parameter Name="diag_stage_of_disease" Caption="Стадия диагноза" Type="select">
              <Sql>select sp_stadiya_diagn_id, name_stadiya from sp_stadiya_diagn_tab order by 1;</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Отчеты по заявке">
      <Reports>
        <Report Id="250010" Name="Персональное обоснование" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по заявке\Персональное обоснование.xls">
          <Queries>
            <Query>
              <Sql>fake_zapros SELECT  f.b 
 FROM 
( 
SELECT DISTINCT 'cp.claim_id = '||cp.claim_id||' AND cp.sklad_id = '||cp.sklad_id, 
c.name||' '||to_char(c.date_kvartal,'mm.yyyy')||' '||s.sklad::text FROM claim_pers_tab cp 
LEFT JOIN claim_tab c ON c.id = cp.claim_id 
LEFT JOIN sklad_tab s ON s.sklad_id::int4 = cp.sklad_id 
UNION 
SELECT 'cp.claim_id = '||c.id, c.name||' '||to_char(c.date_kvartal,'mm.yyyy')||' îáùàÿ'::text FROm claim_tab c 
 
) as f(a,b) 
WHERE f.a = ':param1_1_:' 
 
LIMIT 1</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT cp.snils||' '||conv_to_null(f.fam)||' '||conv_to_null(f.nam)||' '||conv_to_null(f.mid), cp.diagn_id, 
SUM(cp.ko_1) as ko_1, SUM(cp.ko_2) as ko_2, SUM(cp.ko_3) as ko_3, cs.pr_1, cs.pr_2, cs.pr_3, cs.name_med, 
SUM(cp.ko_1*cs.pr_1 + cp.ko_2*cs.pr_2 + cp.ko_3*cs.pr_3 ) as summ1 
 FROM claim_pers_tab cp 
LEFT JOIN claim_tab c On c.id = cp.claim_id 
LEFT JOIN fed_lgota_tab f On f.pens = cp.snils 
LEFT JOIN claim_shablon_tab cs ON cs.date_kvartal = c.date_kvartal AND cs.nomk_ls = cp.nomk_ls 
 
WHERE :param1_1_: AND (cs.name_med ilike '%:param2_1_:%' OR get_default(':param2_1_:','')='') 
 
GROUP BY cp.snils, f.fam, f.nam, f.mid, cp.diagn_id, 
cs.pr_1, cs.pr_2, cs.pr_3, cs.name_med</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT SUM(cp.ko_1) as ko_1, SUM(cp.ko_2) as ko_2, SUM(cp.ko_3) as ko_3, SUM(cp.ko_1*cs.pr_1 + cp.ko_2*cs.pr_2 + cp.ko_3*cs.pr_3 ) as summ1 
 FROM claim_pers_tab cp 
LEFT JOIN claim_tab c On c.id = cp.claim_id 
LEFT JOIN fed_lgota_tab f On f.pens = cp.snils 
LEFT JOIN claim_shablon_tab cs ON cs.date_kvartal = c.date_kvartal AND cs.nomk_ls = cp.nomk_ls 
 
WHERE :param1_1_: AND (cs.name_med ilike '%:param2_1_:%' OR get_default(':param2_1_:','')='')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Заявка" Type="select">
              <Sql>SELECT DISTINCT 'cp.claim_id = '||cp.claim_id||' AND cp.sklad_id = '||cp.sklad_id, c.name||' '||to_char(c.date_kvartal,'mm.yyyy')||' '||s.sklad::text FROM claim_pers_tab cp LEFT JOIN claim_tab c ON c.id = cp.claim_id LEFT JOIN sklad_tab s ON s.sklad_id::int4 = cp.sklad_id UNION SELECT 'cp.claim_id = '||c.id, c.name||' '||to_char(c.date_kvartal,'mm.yyyy')||' Общая'::text FROm claim_tab c ORDER BY 2,1 </Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Препарат" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Отчеты по Гриппу и ОРЗ">
      <Reports>
        <Report Id="520010" Name="Количество больных Гриппом и ОРВИ(привитые)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по Гриппу и ОРЗ\Количество больных Гриппом и ОРВИ(привитые).xls">
          <Queries>
            <Query>
              <Sql>zapros1(from_age) SELECT COUNT(*) FROM ( 
	SELECT DISTINCT diagn_tab.dan_id,diagn_osn,diagn_tab.data FROM diagn_tab 
	LEFT JOIN dan_tab ON diagn_tab.dan_id = dan_tab.dan_id 
	LEFT JOIN priviv_tab ON diagn_tab.dan_id = priviv_tab.dan_id 
	WHERE data_vnes_inf BETWEEN ':period_1_:' AND ':period_2_:' 
	AND (diagn_osn LIKE ANY ( string_to_array('%'||replace( (SELECT value FROM settings_tab WHERE name='STAT_GRIPP'),',','%,%')||'%',','))) AND diagn_tab.count='1' 
	AND DATE_PART('year',AGE(data, date_born)) &gt;=from_age 
	AND preparat=704) AS f</Sql>
            </Query>
            <Query>
              <Sql>zapros2(from_age) SELECT COUNT(*) FROM ( 
	SELECT DISTINCT diagn_tab.dan_id,diagn_osn,diagn_tab.data FROM diagn_tab 
	LEFT JOIN dan_tab ON diagn_tab.dan_id = dan_tab.dan_id 
	LEFT JOIN priviv_tab ON diagn_tab.dan_id = priviv_tab.dan_id 
	WHERE data_vnes_inf BETWEEN ':period_1_:' AND ':period_2_:' 
	AND (diagn_osn LIKE ANY ( string_to_array('%'||replace( (SELECT value FROM settings_tab WHERE name='STAT_ORZ'),',','%,%')||'%',','))) AND diagn_tab.count='1' 
	AND DATE_PART('year',AGE(data, date_born)) &gt;=from_age 
	AND preparat=704)  AS f</Sql>
            </Query>
            <Query>
              <Sql>zapros3(from_age) SELECT COUNT(*) FROM ( 
	SELECT DISTINCT diagn_tab.dan_id,diagn_osn,diagn_tab.data FROM diagn_tab 
	LEFT JOIN dan_tab ON diagn_tab.dan_id = dan_tab.dan_id 
	WHERE data_vnes_inf BETWEEN ':period_1_:' AND ':period_2_:' 
	AND (diagn_osn LIKE ANY ( string_to_array('%'||replace( (SELECT value FROM settings_tab WHERE name='STAT_GRIPP'),',','%,%')||'%',','))) 
	AND diagn_tab.count='1' 
	AND DATE_PART('year',AGE(data,date_born)) &gt;=from_age )  AS f</Sql>
            </Query>
            <Query>
              <Sql>zapros4(from_age) SELECT COUNT(*) FROM ( 
	SELECT DISTINCT diagn_tab.dan_id,diagn_osn,diagn_tab.data FROM diagn_tab 
	LEFT JOIN dan_tab ON diagn_tab.dan_id = dan_tab.dan_id 
	WHERE data_vnes_inf BETWEEN ':period_1_:' AND ':period_2_:' 
	AND (diagn_osn LIKE ANY ( string_to_array('%'||replace( (SELECT value FROM settings_tab WHERE name='STAT_ORZ'),',','%,%')||'%',','))) 
	AND diagn_tab.count='1' 
	AND DATE_PART('year',AGE(data,date_born)) &gt;=from_age )  AS f</Sql>
            </Query>
            <Query>
              <Sql>zapros5(from_age) SELECT COUNT(*) FROM ( 
	SELECT DISTINCT diagn_tab.dan_id,diagn_osn,diagn_tab.data FROM diagn_tab 
	LEFT JOIN dan_tab ON diagn_tab.dan_id = dan_tab.dan_id 
	WHERE data_vnes_inf BETWEEN ':period_1_:' AND ':period_2_:' 
	AND ((diagn_osn LIKE ANY ( string_to_array('%'||replace( (SELECT value FROM settings_tab WHERE name='STAT_ORZ'),',','%,%')||'%',',')))OR 
	 (diagn_osn LIKE ANY ( string_to_array('%'||replace( (SELECT value FROM settings_tab WHERE name='STAT_GRIPP'),',','%,%')||'%',',')))) 
	AND diagn_tab.count='1' 
	AND DATE_PART('year',AGE(data,date_born)) &gt;=from_age )  AS f</Sql>
            </Query>
            <Query>
              <Sql>zapros6(from_age) SELECT COUNT(*) FROM ( 
	SELECT DISTINCT diagn_tab.dan_id,diagn_osn,diagn_tab.data FROM diagn_tab 
	LEFT JOIN dan_tab ON diagn_tab.dan_id = dan_tab.dan_id 
	LEFT JOIN priviv_tab ON diagn_tab.dan_id = priviv_tab.dan_id 
	WHERE data_vnes_inf BETWEEN ':period_1_:' AND ':period_2_:' 
	AND ((diagn_osn LIKE ANY ( string_to_array('%'||replace( (SELECT value FROM settings_tab WHERE name='STAT_ORZ'),',','%,%')||'%',','))) OR 
	(diagn_osn LIKE ANY ( string_to_array('%'||replace( (SELECT value FROM settings_tab WHERE name='STAT_ORZ'),',','%,%')||'%',',')))) AND diagn_tab.count='1' 
	AND DATE_PART('year',AGE(data, date_born)) &gt;=from_age 
	AND preparat=704)  AS f</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период:" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="550010" Name="Сводный отчет по заболеваемости Гриппом и ОРЗ" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по Гриппу и ОРЗ\Сводный отчет по заболеваемости Гриппом и ОРЗ.xls">
          <Queries>
            <Query>
              <Sql>zapros1(name_diag,from_age,for_age) SELECT COUNT(*) FROM ( 
	SELECT DISTINCT diagn_tab.dan_id,diagn_osn,diagn_tab.data FROM diagn_tab 
	LEFT JOIN dan_tab ON diagn_tab.dan_id = dan_tab.dan_id 
	WHERE data_vnes_inf BETWEEN ':param1_1_:' AND ':param1_2_:' 
	AND (diagn_osn LIKE ANY ( string_to_array('%'||replace( (SELECT value FROM settings_tab WHERE name='name_diag'),',','%,%')||'%',','))) 
	AND diagn_tab.count='1' 
	AND get_vozrast(date_born,data) BETWEEN from_age AND for_age )  AS f</Sql>
            </Query>
            <Query>
              <Sql>zapros2(name_diag,from_age,sex1) SELECT COUNT(*) FROM ( 
	SELECT DISTINCT diagn_tab.dan_id,diagn_osn,diagn_tab.data FROM diagn_tab 
	LEFT JOIN dan_tab ON diagn_tab.dan_id = dan_tab.dan_id 
	WHERE data_vnes_inf BETWEEN ':param1_1_:' AND ':param1_2_:' 
	AND (diagn_osn LIKE ANY ( string_to_array('%'||replace( (SELECT value FROM settings_tab WHERE name='name_diag'),',','%,%')||'%',','))) 
	AND diagn_tab.count='1' 
	AND get_vozrast(date_born,data)  &gt;=from_age AND sex = 'sex1')  AS f</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2011703000" Name="Мониторинг по гриппу (приложение к приказу 994-ОД)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по Гриппу и ОРЗ\Мониторинг по гриппу (приложение к приказу 994-ОД).xls">
          <Queries>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros1_h1n1(age1,age2,mw) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and diag.is_ah1n1::int4 =1 
and (d.metka_work='mw' OR 'mw'='0') 
and t.date_visit between '2009-11-03' and ':param1_2_:'</Sql>
            </Query>
            <Query>
              <Sql>zapros1_h1n1lab(age1,age2,mw) zapros1_h1n1(:age1:,:age2:,:mw:) 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
            <Query>
              <Sql>zapros1_orvi(age1,age2,mw) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.date_visit between '2009-11-03' and ':param1_2_:' 
and t.diag_osn IN ('J06.9','J11.1')</Sql>
            </Query>
            <Query>
              <Sql>zapros1_orvilab(age1,age2,mw) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.date_visit between '2009-11-03' and ':param1_2_:' 
and t.diag_osn IN ('J06.9','J11.1') 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
            <Query>
              <Sql>zapros1_pnevm(age1,age2,mw) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.date_visit between '2009-11-03' and ':param1_2_:' 
and t.diag_osn BETWEEN 'J12' and 'J12.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros1_pnevmlab(age1,age2,mw) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.date_visit between '2009-11-03' and ':param1_2_:' 
and t.diag_osn BETWEEN 'J12' and 'J12.9' 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
            <Query>
              <Sql>zapros2_h1n1(age1,age2,par_st,mw) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where (t.first_visit_condition =par_st OR par_st=-1) 
and DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and diag.is_ah1n1::int4 =1 
and t.date_visit between ':param1_1_:' and ':param1_2_:' 
and (d.metka_work='mw' OR 'mw'='0')</Sql>
            </Query>
            <Query>
              <Sql>zapros2_h1n1lab(age1,age2,par_st,mw) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where (t.first_visit_condition =par_st OR par_st=-1) 
and DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and diag.is_ah1n1::int4 =1 
and t.date_visit between ':param1_1_:' and ':param1_2_:' 
and (d.metka_work='mw' OR 'mw'='0') 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
            <Query>
              <Sql>zapros2_orvi(age1,age2,par_st,mw) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where (t.first_visit_condition =par_st OR par_st=-1) 
and DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and t.date_visit between ':param1_1_:' and ':param1_2_:' 
and (d.metka_work='mw' OR 'mw'='0') 
and t.diag_osn IN ('J06.9','J11.1')</Sql>
            </Query>
            <Query>
              <Sql>zapros2_orvilab(age1,age2,par_st,mw) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where (t.first_visit_condition =par_st OR par_st=-1) 
and DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and t.date_visit between ':param1_1_:' and ':param1_2_:' 
and (d.metka_work='mw' OR 'mw'='0') 
and t.diag_osn IN ('J06.9','J11.1') 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
            <Query>
              <Sql>zapros2_pnevm(age1,age2,par_st,mw) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where (t.first_visit_condition =par_st OR par_st=-1) 
and DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and t.date_visit between ':param1_1_:' and ':param1_2_:' 
and (d.metka_work='mw' OR 'mw'='0') 
and t.diag_osn BETWEEN 'J12' and 'J12.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros2_pnevmlab(age1,age2,par_st,mw) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where (t.first_visit_condition =par_st OR par_st=-1) 
and DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and t.date_visit between ':param1_1_:' and ':param1_2_:' 
and (d.metka_work='mw' OR 'mw'='0') 
and t.diag_osn BETWEEN 'J12' and 'J12.9' 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
            <Query>
              <Sql>zapros3_h1n1(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and diag.is_ah1n1::int4 =1 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between '2009-11-03' and ':param1_2_:' 
and t.result_id=:tres:</Sql>
            </Query>
            <Query>
              <Sql>zapros3_h1n1lab(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and diag.is_ah1n1::int4 =1 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between '2009-11-03' and ':param1_2_:' 
and t.result_id=:tres: 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
            <Query>
              <Sql>zapros3_orvi(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between '2009-11-03' and ':param1_2_:' 
and t.result_id=:tres: 
and t.diag_osn IN ('J06.9','J11.1')</Sql>
            </Query>
            <Query>
              <Sql>zapros3_orvilab(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between '2009-11-03' and ':param1_2_:' 
and t.result_id=:tres: 
and t.diag_osn IN ('J06.9','J11.1') 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
            <Query>
              <Sql>zapros3_pnevm(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between '2009-11-03' and ':param1_2_:' 
and t.result_id=:tres: 
and t.diag_osn BETWEEN 'J12' and 'J12.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros3_pnevmlab(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between '2009-11-03' and ':param1_2_:' 
and t.result_id=:tres: 
and t.diag_osn BETWEEN 'J12' and 'J12.9' 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
            <Query>
              <Sql>zapros4_h1n1(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and diag.is_ah1n1::int4 =1 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between  ':param1_1_:' and ':param1_2_:' 
and t.result_id=:tres:</Sql>
            </Query>
            <Query>
              <Sql>zapros4_h1n1lab(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and diag.is_ah1n1::int4 =1 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between  ':param1_1_:' and ':param1_2_:' 
and t.result_id=:tres: 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
            <Query>
              <Sql>zapros4_orvi(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between  ':param1_1_:' and ':param1_2_:' 
and t.result_id=:tres: 
and t.diag_osn IN ('J06.9','J11.1')</Sql>
            </Query>
            <Query>
              <Sql>zapros4_orvilab(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between  ':param1_1_:' and ':param1_2_:' 
and t.result_id=:tres: 
and t.diag_osn IN ('J06.9','J11.1') 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
            <Query>
              <Sql>zapros4_pnevm(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between  ':param1_1_:' and ':param1_2_:' 
and t.result_id=:tres: 
and t.diag_osn BETWEEN 'J12' and 'J12.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros4_pnevmlab(age1,age2,mw,tres) select count(distinct d.dan_id) from 
talon_tab t 
join dan_tab d ON d.dan_id = t.dan_id 
join diagn_tab diag ON diag.talon_id = t.talon_id 
where DATE_PART('year',AGE(':param1_2_:', date_born)) BETWEEN age1 and age2 
and (diag.is_ah1n1::int4 =0 or diag.is_ah1n1 is null) 
and (d.metka_work='mw' OR 'mw'='0') 
and t.data_end between  ':param1_1_:' and ':param1_2_:' 
and t.result_id=:tres: 
and t.diag_osn BETWEEN 'J12' and 'J12.9' 
and diag.lab_confirmation::int4=1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Старые отчеты">
      <Reports>
        <Report Id="63" Name="Движение заболеваний Д-учета (по дате последнего посещения)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Движение заболеваний Д-учета (по дате последнего посещения).xls">
          <Queries>
            <Query>
              <Sql>diagns_list (select (ARRAY['I10', 
	'I11', 'I11.0', 'I11.9', 
	'I12', 'I12.0', 'I12.9', 
	'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
	'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_ from generate_series(1,18) as s(a)) as foo;
</Sql>
            </Query>
            <Query>
              <Sql>zapros_1 select (select case when char_length(param_2_)=3 
	then (select diagn_kod_mkb from diagn_kod_mkb_tab where kodname=param_2_)
	else (select mkb from mkb_tab where kod_d=param_2_)
	end), * from (select
(ARRAY['I10', 
'I11.0-I11.9', 'I11.0', 'I11.9', 
'I12.0-I12.9', 'I12.0', 'I12.9', 
'I13.0-I13.9', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15.0-I15.9', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_,
(ARRAY['I10', 
'I11', 'I11.0', 'I11.9', 
'I12', 'I12.0', 'I12.9', 
'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_2_ from generate_series(1,18) as s(a)) as foo;
</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_:</Sql>
            </Query>
            <Query>
              <Sql>sostoit1(period) select count(dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date ('period')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date ('period'))))
	and diagn_id like ':param_2_:%'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)</Sql>
            </Query>
            <Query>
              <Sql>zapros3 sostoit1(:period_1_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros4 sostoit1(:period_1_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros5 select count(dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and diagn_id like ':param_2_:%'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
            </Query>
            <Query>
              <Sql>zapros6 select count(dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and diagn_id like ':param_2_:%'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
            </Query>
            <Query>
              <Sql>snat1(prichina) select count(dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and dispan_uchet_tab.prichin_sn_id in (prichina)
	and diagn_id like ':param_2_:%'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
            </Query>
            <Query>
              <Sql>zapros7 snat1(1)</Sql>
            </Query>
            <Query>
              <Sql>zapros8 snat1("4,2")</Sql>
            </Query>
            <Query>
              <Sql>zapros9 snat1(3)</Sql>
            </Query>
            <Query>
              <Sql>zapros10 snat1(5)</Sql>
            </Query>
            <Query>
              <Sql>zapros11 sostoit1(:period_1_2_:)</Sql>
            </Query>
            <Query>
              <Sql>sostoit2(period) select count(dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date ('period')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date ('period'))))
	and diagn_id between 'I10' and 'I15.9'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
            </Query>
            <Query>
              <Sql>zapros__3 sostoit2(:period_1_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros__4 sostoit2(:period_1_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros__5 select count(dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and diagn_id between 'I10' and 'I15.9'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
            </Query>
            <Query>
              <Sql>zapros__6 select count(dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and diagn_id between 'I10' and 'I15.9'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
            </Query>
            <Query>
              <Sql>snat2(prichina) select count(dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and dispan_uchet_tab.prichin_sn_id in (prichina)
	and diagn_id between 'I10' and 'I15.9'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
            </Query>
            <Query>
              <Sql>zapros__7 snat2(1)</Sql>
            </Query>
            <Query>
              <Sql>zapros__8 snat2("4,2")</Sql>
            </Query>
            <Query>
              <Sql>zapros__9 snat2(3)</Sql>
            </Query>
            <Query>
              <Sql>zapros__10 snat2(5)</Sql>
            </Query>
            <Query>
              <Sql>zapros__11 sostoit2(:period_1_2_:)</Sql>
            </Query>
          </Queries>
          <Parameters />
        </Report>
        <Report Id="78" Name="Приложение 3(Форма № 12-Д-1)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Приложение 3(Форма № 12-Д-1).xls">
          <Queries>
            <Query>
              <Sql>zapros1_(p1) select count(*) from dan_tab where okvd like 'p1%'</Sql>
            </Query>
            <Query>
              <Sql>zapros2_(p1,p2) select count(*) from dan_tab where okvd between 'p1' and 'p2'</Sql>
            </Query>
            <Query>
              <Sql>zapros21_(p1) select count(distinct dan_tab.dan_id) from kart_dd_tab
 left join dan_tab on kart_dd_tab.dan_id=dan_tab.dan_id 
 left join dop_dispan_tab on kart_dd_tab.kart_dd_id=dop_dispan_tab.kart_dd_id
 where dan_tab.okvd like 'p1%'
 and date_osmotr between date(':period_1_1_:') and date(':period_1_2_:')
 and sp_kart_dd_type_id=:period_2_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros22_(p1,p2) 
select count(distinct dan_tab.dan_id) from kart_dd_tab
 left join dan_tab on kart_dd_tab.dan_id=dan_tab.dan_id 
 left join dop_dispan_tab on kart_dd_tab.kart_dd_id=dop_dispan_tab.kart_dd_id
 where dan_tab.okvd between 'p1' and 'p2'
 and date_osmotr between date(':period_1_1_:') and date(':period_1_2_:')
 and sp_kart_dd_type_id=:period_2_1_:
</Sql>
            </Query>
            <Query>
              <Sql>zapros31_(p1,p3) select count(*) from (
	select dan_tab.dan_id, max(result_dop_disp_tab.num_group) as num_group1 from kart_dd_tab
	left join dan_tab on kart_dd_tab.dan_id=dan_tab.dan_id 
	left join dop_dispan_tab on kart_dd_tab.kart_dd_id=dop_dispan_tab.kart_dd_id
	left join result_dop_disp_tab on result_dop_disp_tab.result_dop_disp_id=dop_dispan_tab.result_dop_disp_id
	where dan_tab.okvd like 'p1%'
	and date_osmotr between date(':period_1_1_:') and date(':period_1_2_:')
	and sp_kart_dd_type_id=:period_2_1_:
	group by dan_tab.dan_id
 ) as foo
 where num_group1=p3</Sql>
            </Query>
            <Query>
              <Sql>zapros32_(p1,p2,p3) select count(*) from (
	select dan_tab.dan_id, max(result_dop_disp_tab.num_group) as num_group1 from kart_dd_tab
	left join dan_tab on kart_dd_tab.dan_id=dan_tab.dan_id 
	left join dop_dispan_tab on kart_dd_tab.kart_dd_id=dop_dispan_tab.kart_dd_id
	left join result_dop_disp_tab on result_dop_disp_tab.result_dop_disp_id=dop_dispan_tab.result_dop_disp_id
	where dan_tab.okvd between 'p1' and 'p2'
	and date_osmotr between date(':period_1_1_:') and date(':period_1_2_:')
	and sp_kart_dd_type_id=:period_2_1_:
	group by dan_tab.dan_id
 ) as foo
 where num_group1=p3</Sql>
            </Query>
            <Query>
              <Sql>zapros41_(p1) 0</Sql>
            </Query>
            <Query>
              <Sql>zapros42_(p1,p2) 0</Sql>
            </Query>
            <Query>
              <Sql>zapros51_(p1) 0</Sql>
            </Query>
            <Query>
              <Sql>zapros52_(p1,p2) 0</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period" />
            <Parameter Name="period_2" Caption="Тип" Type="select">
              <Sql>select sp_kart_dd_type_id, sp_kart_dd_type from sp_kart_dd_type_tab order by sp_kart_dd_type_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="79" Name="Приложение 4(Форма № 12-Д-2)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Приложение 4(Форма № 12-Д-2).xls">
          <Queries>
            <Query>
              <Sql>zapros1(p1,p2) select count(distinct dan_tab.dan_id) from kart_dd_tab
 left join dan_tab on kart_dd_tab.dan_id=dan_tab.dan_id 
 left join dop_dispan_tab on kart_dd_tab.kart_dd_id=dop_dispan_tab.kart_dd_id
 where date_osmotr between date(':period_1_1_:') and date(':period_1_2_:')
 and dop_dispan_tab.diagn_osn between 'p1' and 'p2'
</Sql>
            </Query>
            <Query>
              <Sql>zapros2(p1,p2) select count(distinct dan_tab.dan_id) from kart_dd_tab
 left join dan_tab on kart_dd_tab.dan_id=dan_tab.dan_id 
 left join dop_dispan_tab on kart_dd_tab.kart_dd_id=dop_dispan_tab.kart_dd_id
 where date_osmotr between date(':period_1_1_:') and date(':period_1_2_:')
 and dop_dispan_tab.diagn_osn between 'p1' and 'p2'
</Sql>
            </Query>
            <Query>
              <Sql>zapros3(p1,p2) 0</Sql>
            </Query>
            <Query>
              <Sql>zapros4(p1,p2) 0</Sql>
            </Query>
            <Query>
              <Sql>zapros5(p1,p2) select count(distinct dan_tab.dan_id) from kart_dd_tab
 left join dan_tab on kart_dd_tab.dan_id=dan_tab.dan_id 
 left join dop_dispan_tab on kart_dd_tab.kart_dd_id=dop_dispan_tab.kart_dd_id
 where date_osmotr between date(':period_1_1_:') and date(':period_1_2_:')
 and kart_dd_tab.diagn_osn between 'p1' and 'p2'
</Sql>
            </Query>
            <Query>
              <Sql>zapros6(p1,p2) select count(distinct dan_tab.dan_id) from kart_dd_tab
 left join dan_tab on kart_dd_tab.dan_id=dan_tab.dan_id 
 left join dop_dispan_tab on kart_dd_tab.kart_dd_id=dop_dispan_tab.kart_dd_id
 where date_osmotr between date(':period_1_1_:') and date(':period_1_2_:')
 and kart_dd_tab.diagn_half_year between 'p1' and 'p2'
</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period" />
            <Parameter Name="period_2" Caption="Тип" Type="select">
              <Sql>select sp_kart_dd_type_id, sp_kart_dd_type from sp_kart_dd_type_tab order by sp_kart_dd_type_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="83" Name="Список лиц с заболеванием Рассеяный склероз, получивших лекарственные препараты" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Список лиц с заболеванием Рассеяный склероз, получивших лекарственные препараты.xls">
          <Queries>
            <Query>
              <Sql>zapros0 select distinct '$id', 
	dan_tab.fam as param_1_1_, dan_tab.nam as param_1_2_, dan_tab.mid as param_1_3_, 
	dan_tab.date_born as param_1_4_, address as param_1_6_, case when inval_id&gt;0 then inval_id else NULL end  as param_1_5_, mnn_rus  as param_1_7_
	from rezept_tab
	left join lgot_preparat_tab on lgot_preparat_tab.kod=kod_minzd
	left join dan_tab on rezept_tab.dan_id = dan_tab.dan_id 
	where not bad and date_vipiski between date(':period_1_1_:') and date(':period_1_2_:') and
	trim(kod_minzd) in ('1000014', '93907', '1200553')
 
</Sql>
            </Query>
          </Queries>
          <Parameters />
        </Report>
        <Report Id="30010" Name="Список пациентов, которым поставлен диагноз" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Список пациентов, которым поставлен диагноз.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT dt.fam||' '||dt.nam||' '||dt.mid as name,dt.date_born AS p1, dt.address as p2,d.diagn_osn as p3, d.data as p4, du.date as p5 FROM diagn_tab d 
LEFT JOIN dan_tab dt ON d.dan_id = dt.dan_id 
LEFT JOIN fed_lgota_tab f ON f.dan_id = d.dan_id 
LEFT JOIN lgot_client_tab l ON l.dan_id = d.dan_id 
LEFT JOIN dispan_uchet_tab du ON du.dan_id = d.dan_id AND trim(d.diagn_osn) = trim(du.diagn_id) AND du.date_sn IS NULL 
WHERE d.data BETWEEN ':period_1_:' AND ':period_2_:' 
AND :diagn_1_: AND :char_1_: AND :lgot_1_: AND :uch_1_: AND get_vozrast(dt.date_born) BETWEEN :from_age_1_: AND :for_age_1_: AND d.count = '1' ORDER BY name;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период:" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="diagn" Caption="Диагноз:" Type="select">
              <Sql>SELECT 'd.diagn_osn LIKE '''||trim(m.kod_d)||'%'''as nam, trim(m.kod_d) as nam1 FROM mkb_tab m  UNION SELECT 'true'as nam,' Не учитывать'as nam1 ORDER BY nam1;</Sql>
            </Parameter>
            <Parameter Name="char" Caption="Характер:  " Type="select2">
              <Sql>true=Не учитывать|d.otmet LIKE 'Х' =Хронический| d.otmet LIKE 'О'=Острый|d.otmet LIKE  'З'=Хронический впервые</Sql>
            </Parameter>
            <Parameter Name="lgot" Caption="Льгота:        " Type="select">
              <Sql>SELECT 'true', ' Не учитывать' AS p1 UNION SELECT CASE WHEN char_length(trim(l.lgota_id)) = 3 THEN 'f.pens NOT LIKE  ''%ОТКАЗ%'' AND f.floga LIKE ''%'||trim(l.lgota_id)||'%''' WHEN char_length(trim(l.lgota_id)) = 2 THEN 'l.lgota LIKE "'||trim(l.lgota_id)||'''' END, l.lgota_id::text||' '||l.nam_lgota AS p1 FROM lgota_tab l ORDER BY p1;</Sql>
            </Parameter>
            <Parameter Name="uch" Caption="Участок:      " Type="select">
              <Sql>SELECT 'dt.uchactok_id = '||uchactok_id::text, uchactok,uchactok_id FROM uchactok_tab UNION SELECT 'true','Не учитывать',-1 AS uchactok_id ORDER BY uchactok_id</Sql>
            </Parameter>
            <Parameter Name="from_age" Caption="С возраста: " Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="for_age" Caption="По возраст: " Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="8600000" Name="12-ДД-3М" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\12-ДД-3М.xls">
          <Queries>
            <Query>
              <Sql>lpu_okato select value from settings_tab where name='TER'</Sql>
            </Query>
            <Query>
              <Sql>lpu_okogu select value from settings_tab where name='MIN'</Sql>
            </Query>
            <Query>
              <Sql>lpu_okpo select value from settings_tab where name='ORG'</Sql>
            </Query>
            <Query>
              <Sql>lpuaddress select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpuname select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>table_2000(hgr) select count(*) 
from kart_dd_tab k 
join dop_dispan_tab dop on k.kart_dd_id = dop.kart_dd_id 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
where (k.sp_kart_dd_type_id = :kart_dd_type_id_1_:)  and 
k.date_vnes_inf between date(':period_1_:') AND date(':period_2_:') 
and (dop.health_group = :hgr: or :hgr:&lt;0) 
AND :osnovnoe_param_1_: 
AND (:work_region_condition_1_:)</Sql>
            </Query>
            <Query>
              <Sql>table_2000_nzk select count(*) from 
( 
select kart_dd_tab.kart_dd_id 
from kart_dd_tab 
where kart_dd_tab.date_vnes_inf between date(':period_1_:') AND date(':period_2_:') 
and kart_dd_id not in ( 
select kart_dd_tab.kart_dd_id 
from kart_dd_tab 
join dop_dispan_tab dop on kart_dd_tab.kart_dd_id = dop.kart_dd_id 
where kart_dd_tab.date_vnes_inf between date(':period_1_:') AND date(':period_2_:')) 
) q 
join kart_dd_tab k on k.kart_dd_id = q.kart_dd_id 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
where (k.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
AND k.date_vnes_inf between date(':period_1_:') AND date(':period_2_:') 
AND (:work_region_condition_1_:)</Sql>
            </Query>
            <Query>
              <Sql>table_3000_people_count(_diagnosis_1_,_diagnosis_2_) SELECT COUNT(DISTINCT d.dan_id) 
FROM kart_dd_tab k 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (k.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (k.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (dop.diagn_osn BETWEEN '_diagnosis_1_' AND '_diagnosis_2_') 
 AND :osnovnoe_param_1_: 
 AND (:work_region_condition_1_:)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="work_region_condition" Caption="Регион места работы" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0 UNION SELECT 'm.region_id = ' || k.code, k.name, 1 FROM kladr_tab k WHERE k.code IN (SELECT DISTINCT region_id FROM mest_work_tab) ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="osnovnoe_param" Caption="Считать по" Type="select2">
              <Sql>(dop.osnovnoe) = Основному | true = Всем</Sql>
            </Parameter>
            <Parameter Name="kart_dd_type_id" Caption="Тип" Type="select">
              <Sql>SELECT sp_kart_dd_type_id, sp_kart_dd_type FROM sp_kart_dd_type_tab ORDER BY sp_kart_dd_type_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="10800000" Name="ДД 12-д-1-08" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\ДД 12-д-1-08.xls">
          <Queries>
            <Query>
              <Sql>health_group_count(_work_kind_code_,_health_group_) SELECT COUNT(DISTINCT kdd.kart_dd_id) 
FROM kart_dd_tab kdd 
LEFT JOIN dop_dispan_tab dop ON (dop.kart_dd_id = kdd.kart_dd_id) AND (dop.osnovnoe) 
LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (dop.diagn_osn IS NOT NULL) 
 AND (dop.health_group = _health_group_) 
 AND ((_work_kind_code_ &lt; 0) OR (m.sp_activity_kind_id = _work_kind_code_)) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>health_group_count2(_work_kind_code_,_health_group_,_diagnosis_stage_) SELECT COUNT(DISTINCT kdd.kart_dd_id) 
FROM kart_dd_tab kdd 
LEFT JOIN dop_dispan_tab dop ON (dop.kart_dd_id = kdd.kart_dd_id) AND (dop.osnovnoe) 
LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (dop.diagn_osn IS NOT NULL) 
 AND (dop.health_group = _health_group_) 
 AND ((_diagnosis_stage_ &lt; 0) OR (dop.sp_stadiya_diagn_id = _diagnosis_stage_)) 
 AND ((_work_kind_code_ &lt; 0) OR (m.sp_activity_kind_id = _work_kind_code_)) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>lpu_okato select value from settings_tab where name='TER'</Sql>
            </Query>
            <Query>
              <Sql>lpu_okogu select value from settings_tab where name='MIN'</Sql>
            </Query>
            <Query>
              <Sql>lpu_okpo select value from settings_tab where name='ORG'</Sql>
            </Query>
            <Query>
              <Sql>lpuaddress select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpuname select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>people_count(_work_kind_code_) SELECT ( 
 SELECT COUNT(DISTINCT kdd.kart_dd_id) 
 FROM kart_dd_tab kdd 
 LEFT JOIN dop_dispan_tab dop ON (dop.kart_dd_id = kdd.kart_dd_id) AND (dop.osnovnoe) 
 LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
 LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
 WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
  AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
  AND (dop.diagn_osn IS NOT NULL) 
  AND ((_work_kind_code_ &lt; 0) OR (m.sp_activity_kind_id = _work_kind_code_)) 
  AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
  AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
)::text || '/' || ( 
 SELECT COUNT(DISTINCT kdd.kart_dd_id) 
 FROM kart_dd_tab kdd 
 LEFT JOIN dop_dispan_tab dop ON (dop.kart_dd_id = kdd.kart_dd_id) AND (dop.osnovnoe) 
 LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
 LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
 WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
  AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
  AND (dop.diagn_osn IS NOT NULL) 
  AND (kdd.dan_id NOT IN ( 
   SELECT kdd2.dan_id 
   FROM kart_dd_tab kdd2 
   LEFT JOIN dop_dispan_tab dop2 ON (dop2.kart_dd_id = kdd2.kart_dd_id) AND (dop2.osnovnoe) 
   WHERE (dop2.health_group &lt;= 3) 
    AND (kdd2.date_vnes_inf &lt; date((date_part('year',now()) || '-01-01'))) 
  )) 
  AND ((_work_kind_code_ &lt; 0) OR (m.sp_activity_kind_id = _work_kind_code_)) 
  AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
  AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
)::text</Sql>
            </Query>
            <Query>
              <Sql>resort_count(_work_kind_code_) SELECT COUNT(DISTINCT kdd.kart_dd_id) 
FROM kart_dd_tab kdd 
LEFT JOIN dop_dispan_tab dop ON (dop.kart_dd_id = kdd.kart_dd_id) AND (dop.osnovnoe) 
LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (dop.diagn_osn IS NOT NULL) 
 AND (dop.is_need_san_kur) 
 AND ((_work_kind_code_ &lt; 0) OR (m.sp_activity_kind_id = _work_kind_code_)) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>work_kind_list SELECT sp_activity_kind, sp_activity_kind_id AS work_kind_code 
FROM sp_activity_kind_tab 
ORDER BY sp_activity_kind_id</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="kart_dd_type_id" Caption="Вид" Type="select">
              <Sql>SELECT sp_kart_dd_type_id, sp_kart_dd_type FROM sp_kart_dd_type_tab ORDER BY sp_kart_dd_type_id</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="region" Caption="Регион места работы" Type="select">
              <Sql>SELECT '' AS code, 'Все' AS name, 0 UNION SELECT k.code, k.name, 1 FROM kladr_tab k WHERE (k.code != '')  AND (k.code IN (SELECT DISTINCT region_id FROM mest_work_tab)) ORDER BY 3, 2</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="11000000" Name="Анализы" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Анализы.xls">
          <Queries>
            <Query>
              <Sql>biohim_date select to_char(bio_him_analiz_tab.data,'dd.mm.yyyy') from bio_him_analiz_tab join kart_dd_tab k on k.dan_id = bio_him_analiz_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by bio_him_analiz_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>biohim_doctor select doc.fam||' '||substr(doc.nam,1,1)||'. '||substr(doc.mid,1,1)||'.' 
from bio_him_analiz_tab join kart_dd_tab k on k.dan_id = bio_him_analiz_tab.dan_id 
left join full_doctor_tab doc on doc.doctor_id = bio_him_analiz_tab.doctor_id 
where k.kart_dd_id =  ':param1_1_:'::integer 
order by bio_him_analiz_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>biohim_gluk select bio_him_analiz_tab.glukoza from bio_him_analiz_tab join kart_dd_tab k on k.dan_id = bio_him_analiz_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by bio_him_analiz_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>biohim_holesterin select bio_him_analiz_tab.holesterin from bio_him_analiz_tab join kart_dd_tab k on k.dan_id = bio_him_analiz_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by bio_him_analiz_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>biohim_lpnp select lpnp from bio_him_analiz_tab join kart_dd_tab k on k.dan_id = bio_him_analiz_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by bio_him_analiz_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>biohim_lpvp select lpvp from bio_him_analiz_tab join kart_dd_tab k on k.dan_id = bio_him_analiz_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by bio_him_analiz_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>biohim_triglicerid select '' from bio_him_analiz_tab join kart_dd_tab k on k.dan_id = bio_him_analiz_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by bio_him_analiz_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>biohim1 select bio_him_analiz_tab.bio_him_analiz_id from bio_him_analiz_tab join kart_dd_tab k on k.dan_id = bio_him_analiz_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by bio_him_analiz_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_bazof_kaplya select analizkrovi_tab.bazof from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_bazofily select analizkrovi_tab.bazofily from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_cp select analizkrovi_tab.cp from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_date select to_char(analizkrovi_tab.data,'dd.mm.yyyy') from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_doctor select doc.fam||' '||substr(doc.nam,1,1)||'. '||substr(doc.mid,1,1)||'.' 
from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
left join full_doctor_tab doc on doc.doctor_id = analizkrovi_tab.doctor_id 
where k.kart_dd_id =  ':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_eozinofily select analizkrovi_tab.eozinofily from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_eritrocity select analizkrovi_tab.eritrozity from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_gemoglobin select analizkrovi_tab.gemoglobin from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_leykocity select analizkrovi_tab.leykocity from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_lymfocity select analizkrovi_tab.limfocity from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_mielocity select analizkrovi_tab.mielon from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_monocity select analizkrovi_tab.monocity from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_palochk select analizkrovi_tab.palot from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_polihr select analizkrovi_tab.polihrom from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_retikulocity select analizkrovi_tab.retikylozity from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_segment select analizkrovi_tab.segment from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_soe select analizkrovi_tab.roe from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_trombocity select analizkrovi_tab.trombocity from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood_young select analizkrovi_tab.young from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>blood1 select analizkrovi_tab.analizkrovi_id from analizkrovi_tab join kart_dd_tab k on k.dan_id = analizkrovi_tab.dan_id 
where k.kart_dd_id =':param1_1_:'::integer 
order by analizkrovi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>date_born1 select to_char(d.date_born,'dd.mm.yyyy') 
from dan_tab d join kart_dd_tab k on k.dan_id = d.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer</Sql>
            </Query>
            <Query>
              <Sql>fio select d.fam||' '||d.nam||' '||d.mid from dan_tab d join kart_dd_tab k on k.dan_id = d.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer</Sql>
            </Query>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>mocha_bakter select analiz_mochi_tab.bakter from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_belok select analiz_mochi_tab.belok from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_bilirub select analiz_mochi_tab.bilirubin from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_cvet select analiz_mochi_tab.color from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_date select to_char(analiz_mochi_tab.data,'dd.mm.yyyy') from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_doctor select doc.fam||' '||substr(doc.nam,1,1)||'. '||substr(doc.mid,1,1)||'.' 
from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
left join full_doctor_tab doc on doc.doctor_id = analiz_mochi_tab.doctor_id 
where k.kart_dd_id =  ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_epit select analiz_mochi_tab.epit_pl from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_eritr select analiz_mochi_tab.eritrocity_n::text||' '||eritrocity from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_gluk select analiz_mochi_tab.gljukoza from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_keton select analiz_mochi_tab.ket_tela from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_leykoc select analiz_mochi_tab.leykocity from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_ph select analiz_mochi_tab.reak from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_prozr select analiz_mochi_tab.proz from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_sliz select analiz_mochi_tab.sliz from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_soli select analiz_mochi_tab.soli from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_udves select analiz_mochi_tab.otn_plot from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha_urobil select analiz_mochi_tab.urobilipoud from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>mocha1 select analiz_mochi_tab.analiz_mochi_id from analiz_mochi_tab join kart_dd_tab k on k.dan_id = analiz_mochi_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by analiz_mochi_tab.data desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>onco_ca125 select researches.tood_immune_enzime_res_tab.ca125 from researches.tood_immune_enzime_res_tab  
join kart_dd_tab k on k.dan_id = researches.tood_immune_enzime_res_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by researches.tood_immune_enzime_res_tab.date_analisis desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>onco_date select to_char(researches.tood_immune_enzime_res_tab.date_analisis, 'dd.mm.yyyy') 
from researches.tood_immune_enzime_res_tab  
join kart_dd_tab k on k.dan_id = researches.tood_immune_enzime_res_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by researches.tood_immune_enzime_res_tab.date_analisis desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>onco_pca select researches.tood_immune_enzime_res_tab.pca from researches.tood_immune_enzime_res_tab  
join kart_dd_tab k on k.dan_id = researches.tood_immune_enzime_res_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by researches.tood_immune_enzime_res_tab.date_analisis desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>onco1 select researches.tood_immune_enzime_res_tab.id from researches.tood_immune_enzime_res_tab  
join kart_dd_tab k on k.dan_id = researches.tood_immune_enzime_res_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by researches.tood_immune_enzime_res_tab.date_analisis desc 
limit 1</Sql>
            </Query>
            <Query>
              <Sql>biohim_lpnp_lpvp select lpnp_lpvp from bio_him_analiz_tab join kart_dd_tab k on k.dan_id = bio_him_analiz_tab.dan_id 
where k.kart_dd_id = ':param1_1_:'::integer 
order by bio_him_analiz_tab.data desc 
limit 1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Номер карты дополнительной диспансеризации" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="14000000" Name="Дополнительная диспансеризация по заданной выборке" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Дополнительная диспансеризация по заданной выборке.xls">
          <Queries>
            <Query>
              <Sql>k_dop_disp_state LEFT JOIN sp_dop_disp_state_tab dst ON dst.sp_dop_disp_state_id=k_prichin_sn_id</Sql>
            </Query>
            <Query>
              <Sql>k_health_group LEFT JOIN sp_health_group_tab hgr ON hgr.sp_health_group_id = k.health_group</Sql>
            </Query>
            <Query>
              <Sql>k_kard_type LEFT JOIN sp_kart_dd_type_tab ktype ON ktype.sp_kart_dd_type_id = k.sp_kart_dd_type_id</Sql>
            </Query>
            <Query>
              <Sql>k_lpu LEFT JOIN codifiers.lpu_tab lpu ON lpu.code = k.pricpol</Sql>
            </Query>
            <Query>
              <Sql>k_talon LEFT JOIN talon_tab t ON t.talon_id = k.talon_id</Sql>
            </Query>
            <Query>
              <Sql>t_result LEFT JOIN codifiers.visit_result_common_tab tres ON t.result_id=tres.id</Sql>
            </Query>
            <Query>
              <Sql>t_travma_tab LEFT JOIN travma_tab travma1 ON travma1.travma_id = t.vid_travma</Sql>
            </Query>
            <Query>
              <Sql>t_vid_opl LEFT JOIN vid_oplat_tab vid_oplat1 On t.vid_oplat_id = vid_oplat1.vid_oplat_id</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT DISTINCT  :return_fields: FROM public.kart_dd_tab k :sections: :where_section: :group_by_section: :having_section:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="" Caption="Данные талона пациента" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="t_vid_oplat_id" Caption="Вид оплаты" Type="select">
              <Sql>SELECT vid_oplat_id, vid_oplat_id||' '||nam_oplat FROm vid_oplat_tab ORDEr BY 1</Sql>
            </Parameter>
            <Parameter Name="t_vid_travma" Caption="Вид травмы" Type="select">
              <Sql>SELECT travma_id, travma_id||' '||travma FROm travma_tab ORDEr BY 1</Sql>
            </Parameter>
            <Parameter Name="t_data_vnes_inf" Caption="Дата внесения талона" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="t_date_visit" Caption="Дата обращения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="t_inogorod" Caption="Иногородний" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="k_talon_id" Caption="Номер талона" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="t_result_id" Caption="Результат обращения" Type="select">
              <Sql>select id, name from codifiers.visit_result_common_tab </Sql>
            </Parameter>
            <Parameter Name="" Caption="Дополнительная диспансеризация" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_health_group" Caption="Группа здоровья" Type="select">
              <Sql>select sp_health_group_id, sp_health_group from sp_health_group_tab</Sql>
            </Parameter>
            <Parameter Name="k_date_vnes_inf" Caption="Дата внесения информации" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_extra_analysis" Caption="Дата дополнительных исследований" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_blood_serum_cholesterol" Caption="Дата исследования ЛПНП сыворотки крови" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_blood_sugar" Caption="Дата исследования уровня сахара крови" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_blood_serum_triglyceride" Caption="Дата исследования уровня триглицеридов" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_blood_cholesterol" Caption="Дата исследования уровня холестерина крови" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_analysis_blood" Caption="Дата клинического анализа крови" Type="">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_analysis_urine" Caption="Дата клинического анализа мочи" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_uzi" Caption="Дата маммографии / УЗИ" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_delivery_disp" Caption="Дата постановки на учёт" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_oncomarker" Caption="Дата проведения: онкомаркер специфический СА-125/PSI" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_flur" Caption="Дата флюорографии" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_date_ekg" Caption="Дата ЭКГ" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="k_diagn_osn" Caption="Диагноз постановки на ДД" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="k_prichin_of_death" Caption="Диагноз снятия с диспансерного учета" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="k_diagn_half_year" Caption="Диагноз через 6 месяцев" Type="diagn">
              <Sql />
            </Parameter>
            <Parameter Name="k_is_local" Caption="Карта создана в данной поликлинике" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="kart_num" Caption="Номер карты ДД" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="k_is_need_san_kur" Caption="Нуждается в сан.-кур. лечении" Type="boolean">
              <Sql />
            </Parameter>
            <Parameter Name="k_pricpol" Caption="Поликлиника, в которой создана карта" Type="select">
              <Sql>select (select value from settings_tab where name='LPU_ID') as code, (select value from settings_tab where name='LPU') as name union all (select code, name from codifiers.lpu_tab order by 2)</Sql>
            </Parameter>
            <Parameter Name="k_prichin_sn_id" Caption="Состояние диспансерного учета" Type="select">
              <Sql>select sp_dop_disp_state_id, sp_dop_disp_state_name from sp_dop_disp_state_tab</Sql>
            </Parameter>
            <Parameter Name="k_sp_kart_dd_type_id" Caption="Тип карты ДД" Type="select">
              <Sql>select sp_kart_dd_type_id, sp_kart_dd_type from sp_kart_dd_type_tab</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2007121801" Name="Форма 12" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Форма 12.xls">
          <Queries>
            <Query>
              <Sql>dispans_all(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) 
 AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m3(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>dispans2_all(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>dispans2_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (otmet IN ('З', 'О')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (otmet IN ('З', 'О')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first3(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (otmet IN ('З', 'О')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m3(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all3(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek2_all(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek2_all_first(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek2_all_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek2_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (count = '1') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Считать только по прикрепленному населению" Type="select2">
              <Sql>true=да| false=нет|</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2007121807" Name="Форма 12 (приложение 10)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Форма 12 (приложение 10).xls">
          <Queries>
            <Query>
              <Sql>dispans_all(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) 
 AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>z_year select date_part('year',date(':param1_1_:'))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Считать только по прикрепленному населению" Type="select2">
              <Sql>true=да| false=нет|</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008030401" Name="Список пролеченных пациентов за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Список пролеченных пациентов за период.xls">
          <Queries>
            <Query>
              <Sql>patient_list SELECT d.fam || ' ' || d.nam || ' ' || d.mid AS fio, 
 d.date_born AS date_born, 
 d.address AS address_string, 
 u.uchactok AS district_name, 
 d.ser_pol AS policy_series, 
 d.num_pol AS policy_number, 
 COUNT(DISTINCT v.visit_id) AS visit_count, 
 COUNT(DISTINCT t.talon_id) AS talon_count 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
WHERE (v.data_vnes_inf BETWEEN ':period_1_:' AND ':period_2_:') 
 AND ((':sex_1_:' = '') OR (d.sex = ':sex_1_:')) 
 AND (d.life &lt;&gt; 1) 
 AND (d.prikreplen = 1) 
 AND (get_vozrast(d.date_born) BETWEEN :age_begin_1_: AND :age_end_1_:) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
GROUP BY fio, date_born, address_string, district_name, policy_series, policy_number 
ORDER BY fio</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата визита" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="sex" Caption="Пол" Type="select">
              <Sql>SELECT '' AS sex, '' AS sex_name UNION SELECT DISTINCT sex, sex AS sex_name FROM dan_tab WHERE (sex IS NOT NULL)</Sql>
            </Parameter>
            <Parameter Name="age_begin" Caption="Возраст  с" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="age_end" Caption="Возраст по" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008050601" Name="Реестр счетов (бумажный)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Реестр счетов (бумажный).xls">
          <Queries>
            <Query>
              <Sql>get_inspection_date(_kart_dd_id_,_spec_doctor_id_) SELECT to_char(date_osmotr, 'dd.MM.yy') 
FROM dop_dispan_tab ddt 
LEFT JOIN doctor_tab dt ON dt.id = ddt.doctor_id 
WHERE (dt.sp_spec_doctor_id IN (_spec_doctor_id_)) 
 AND (ddt.kart_dd_id = _kart_dd_id_) 
LIMIT 1</Sql>
            </Query>
            <Query>
              <Sql>get_lpu_name select CAST(NULL AS varchar), value AS lpu_name from settings_tab where name = 'LPU'</Sql>
            </Query>
            <Query>
              <Sql>people_list SELECT '$id', conv_to_null(d.fam) || ' ' || conv_to_null(d.nam) || ' ' || conv_to_null(d.mid) AS full_name, d.sex, 
 to_char(d.date_born, 'dd.MM.yy') AS date_born, 
 d.address, d.ser_pol || ' № ' || d.num_pol || ', ' || d.strcom_id::text AS policy_and_company, d.pens, 
 kdd.kart_dd_id, 
 to_char(kdd.date_analysis_blood, 'dd.MM.yy') AS date_analysis_blood, 
 to_char(kdd.date_analysis_urine, 'dd.MM.yy') AS date_analysis_urine, 
 to_char(kdd.date_blood_cholesterol, 'dd.MM.yy') AS date_blood_cholesterol, 
 to_char(kdd.date_blood_sugar, 'dd.MM.yy') AS date_blood_sugar, 
 to_char(kdd.date_blood_serum_cholesterol, 'dd.MM.yy') AS date_blood_serum_cholesterol, 
 to_char(kdd.date_blood_serum_triglyceride, 'dd.MM.yy') AS date_blood_serum_triglyceride, 
 CASE WHEN (d.sex = 'ж') THEN to_char(kdd.date_oncomarker, 'dd.MM.yy') ELSE NULL END AS date_oncomarker_woman, 
 CASE WHEN (d.sex = 'м') THEN to_char(kdd.date_oncomarker, 'dd.MM.yy') ELSE NULL END AS date_oncomarker_man, 
 to_char(kdd.date_ekg, 'dd.MM.yy') AS date_ekg, 
 to_char(kdd.date_flur, 'dd.MM.yy') AS date_flur, 
 to_char(kdd.date_uzi, 'dd.MM.yy') AS date_uzi, 
 CASE WHEN (date_part('year', date(':period_2_:')) = 2007) THEN 540 
  WHEN (date_part('year', date(':period_2_:')) = 2008) THEN 974 
  WHEN (date_part('year', date(':period_2_:')) = 2009) THEN 1042 ELSE 0 END AS price_per_man 
FROM kart_dd_tab kdd 
LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (EXISTS( 
  SELECT ddt.kart_dd_id 
  FROM dop_dispan_tab ddt 
  WHERE (ddt.kart_dd_id = kdd.kart_dd_id) 
 )) 
 AND (:work_region_condition_1_:) 
order by 2</Sql>
            </Query>
            <Query>
              <Sql>result_inspection(_kart_dd_id_) SELECT CASE WHEN osnovnoe THEN diagn_osn ELSE '' END AS _diagnosis_id_, 
 CASE WHEN osnovnoe THEN health_group ELSE 0 END AS _health_group_, 
 CASE WHEN osnovnoe THEN sp_stadiya_diagn_id ELSE 1 END AS _stadiya_diagn_id_ 
FROM dop_dispan_tab 
WHERE (dop_dispan_id = ( 
 SELECT CASE WHEN (EXISTS( 
  SELECT dop_dispan_id 
  FROM dop_dispan_tab 
  WHERE (kart_dd_id = _kart_dd_id_) 
   AND (osnovnoe) 
 )) THEN ( 
  SELECT dop_dispan_id 
  FROM dop_dispan_tab 
  WHERE (kart_dd_id = _kart_dd_id_) 
   AND (osnovnoe) 
  LIMIT 1 
 ) ELSE ( 
  SELECT dop_dispan_id 
  FROM dop_dispan_tab 
  WHERE (kart_dd_id = _kart_dd_id_) 
   AND (health_group = ( 
    SELECT MAX(health_group) 
    FROM dop_dispan_tab 
    WHERE (kart_dd_id = _kart_dd_id_) 
    LIMIT 1 
   )) limit 1 
 ) END)) 
ORDER BY oid 
LIMIT 1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="work_region_condition" Caption="Регион места работы" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0 UNION SELECT 'm.region_id = ' || k.code, k.name, 1 FROM kladr_tab k WHERE k.code IN (SELECT DISTINCT region_id FROM mest_work_tab) ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="kart_dd_type_id" Caption="Тип" Type="select">
              <Sql>SELECT sp_kart_dd_type_id, sp_kart_dd_type FROM sp_kart_dd_type_tab ORDER BY sp_kart_dd_type_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008050602" Name="Реестр счетов (электронный)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Реестр счетов (электронный).xls">
          <Queries>
            <Query>
              <Sql>analisys_date(_kart_dd_id_) SELECT kdd.date_flur, 
 kdd.date_uzi, 
 kdd.date_ekg, 
 kdd.date_analysis_blood, 
 kdd.date_analysis_urine, 
 kdd.date_blood_cholesterol, 
 kdd.date_blood_sugar, 
 kdd.date_blood_serum_cholesterol, 
 kdd.date_blood_serum_triglyceride, 
 CASE WHEN (d.sex = 'ж') THEN kdd.date_oncomarker ELSE NULL END AS date_oncomarker_woman, 
 CASE WHEN (d.sex = 'м') THEN kdd.date_oncomarker ELSE NULL END AS date_oncomarker_man 
FROM kart_dd_tab kdd 
LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
WHERE (kdd.kart_dd_id = _kart_dd_id_)</Sql>
            </Query>
            <Query>
              <Sql>detail_diagnosis(_kart_dd_id_,_offset_) SELECT x.diagn_osn 
FROM ( 
 SELECT d.diagn_osn 
 FROM dop_dispan_tab d 
 LEFT JOIN full_doctor_tab f ON f.full_doctor_id = d.doctor_id 
 WHERE (d.kart_dd_id  =  _kart_dd_id_) 
  AND (d.diagn_osn NOT LIKE 'Z%') 
  AND (d.diagn_osn NOT LIKE 'R%') 
  AND (NOT d.osnovnoe) 
 ORDER BY d.oid 
) AS x 
OFFSET _offset_ 
LIMIT 1</Sql>
            </Query>
            <Query>
              <Sql>host_hospital_code SELECT value 
FROM settings_tab 
WHERE (name = 'LPU_NUMBER')</Sql>
            </Query>
            <Query>
              <Sql>inspection_date(_kart_dd_id_,_spec_doctor_id_) SELECT date_osmotr 
FROM dop_dispan_tab ddt 
LEFT JOIN doctor_tab dt ON dt.id = ddt.doctor_id 
WHERE (dt.sp_spec_doctor_id IN (_spec_doctor_id_)) 
 AND (ddt.kart_dd_id = _kart_dd_id_) 
LIMIT 1</Sql>
            </Query>
            <Query>
              <Sql>main_list SELECT kdd.min_date_osmotr AS date_begin,  kdd.max_date_osmotr AS date_end, kdd.dan_id, kdd.kart_dd_id 
FROM kart_dd_tab kdd 
--LEFT JOIN dop_dispan_tab ddt ON ddt.kart_dd_id = kdd.kart_dd_id 
LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (EXISTS( 
  SELECT ddt2.kart_dd_id 
  FROM dop_dispan_tab ddt2 
  WHERE (ddt2.kart_dd_id = kdd.kart_dd_id) 
 )) 
 AND (:work_region_condition_1_:) 
--GROUP BY kdd.dan_id, kdd.kart_dd_id</Sql>
            </Query>
            <Query>
              <Sql>man_detail(_dan_id_) SELECT conv_to_null(d.fam) AS name1, conv_to_null(d.nam) AS name2, conv_to_null(d.mid) AS name3, 
 d.sex, d.date_born, d.pens, substr(d.address,1,60) AS address, k.kod_oms AS region_code, 
 d.dom, substr(d.korp,1,1) AS korp, d.kv, '0003' AS city_code, s.kod_oms AS street_code, 
 d.ser_pol, d.num_pol, d.strcom_id, d.spolref, m.inn, m.kpp, m.mest_work 
FROM dan_tab d 
LEFT JOIN kladr_tab k ON k.code = d.region_id 
LEFT JOIN st_tab s ON s.code = d.street_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (d.dan_id = _dan_id_)</Sql>
            </Query>
            <Query>
              <Sql>result_inspection(_kart_dd_id_) SELECT CASE WHEN osnovnoe THEN diagn_osn ELSE '' END AS diagnosis_id, 
 CASE WHEN osnovnoe THEN health_group ELSE 0 END AS health_group, 
 CASE WHEN osnovnoe THEN sp_stadiya_diagn_id ELSE 1 END AS stadiya_diagn_id 
FROM dop_dispan_tab 
WHERE (dop_dispan_id = ( 
 SELECT CASE WHEN (EXISTS( 
  SELECT dop_dispan_id 
  FROM dop_dispan_tab 
  WHERE (kart_dd_id = _kart_dd_id_) 
   AND (osnovnoe) 
 )) THEN ( 
  SELECT dop_dispan_id 
  FROM dop_dispan_tab 
  WHERE (kart_dd_id = _kart_dd_id_) 
   AND (osnovnoe) 
  LIMIT 1 
 ) ELSE ( 
  SELECT dop_dispan_id 
  FROM dop_dispan_tab 
  WHERE (kart_dd_id = _kart_dd_id_) 
   AND (health_group = ( 
    SELECT MAX(health_group) 
    FROM dop_dispan_tab 
    WHERE (kart_dd_id = _kart_dd_id_) 
    LIMIT 1 
   )) limit 1 
 ) END)) 
ORDER BY oid 
LIMIT 1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="work_region_condition" Caption="Регион места работы" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0 UNION SELECT 'm.region_id = ' || k.code, k.name, 1 FROM kladr_tab k WHERE k.code IN (SELECT DISTINCT region_id FROM mest_work_tab) ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="kart_dd_type_id" Caption="Тип" Type="select">
              <Sql>SELECT sp_kart_dd_type_id, sp_kart_dd_type FROM sp_kart_dd_type_tab ORDER BY sp_kart_dd_type_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008050603" Name="Сведения о ходе проведения дополнительной диспансеризации работающих граждан" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Сведения о ходе проведения дополнительной диспансеризации работающих граждан.xls">
          <Queries>
            <Query>
              <Sql>table_2000_people_count(_health_group_) SELECT COUNT(DISTINCT d.dan_id) 
FROM kart_dd_tab k 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (k.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (k.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND ((_health_group_ &lt; 0) OR (dop.health_group = _health_group_)) 
 AND (dop.osnovnoe) 
 AND (:work_region_condition_1_:)</Sql>
            </Query>
            <Query>
              <Sql>table_3000_people_count(_diagnosis_1_,_diagnosis_2_) SELECT COUNT(DISTINCT d.dan_id) 
FROM kart_dd_tab k 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (k.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (k.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (dop.diagn_osn BETWEEN '_diagnosis_1_' AND '_diagnosis_2_') 
 AND :osnovnoe_param_1_: 
 AND (:work_region_condition_1_:) 
/*исключаем социально значимые заболевания */ 
AND NOT  (dop.diagn_osn BETWEEN 'С00' AND 'С97.9') 
AND NOT  (dop.diagn_osn BETWEEN 'А15' AND 'А19.9') 
AND NOT  (dop.diagn_osn BETWEEN 'Е10' AND 'E14.9') 
AND NOT  (dop.diagn_osn BETWEEN 'С00' AND 'С97.9') 
AND NOT  (dop.diagn_osn like 'B16%') 
AND NOT  (dop.diagn_osn = 'B17.1') 
AND NOT  (dop.diagn_osn BETWEEN 'B18.0' AND 'B18.2')</Sql>
            </Query>
            <Query>
              <Sql>table_4000_people_count(_diagnosis_1_,_diagnosis_2_,_stadiya_diagn_id_) SELECT COUNT(DISTINCT d.dan_id) 
FROM kart_dd_tab k 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (k.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (k.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (dop.diagn_osn BETWEEN '_diagnosis_1_' AND '_diagnosis_2_') 
 AND :osnovnoe_param_1_: 
 AND ((_stadiya_diagn_id_ &lt; 0) OR (dop.sp_stadiya_diagn_id = _stadiya_diagn_id_)) 
 AND (:work_region_condition_1_:)</Sql>
            </Query>
            <Query>
              <Sql>table_4000_people_count3(_diagnosis_1_,_diagnosis_2_,_diagnosis_3_,_diagnosis_4_,_diagnosis_5_,_diagnosis_6_,_stadiya_diagn_id_) SELECT COUNT(DISTINCT d.dan_id) 
FROM kart_dd_tab k 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (k.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (k.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND ((dop.diagn_osn BETWEEN '_diagnosis_1_' AND '_diagnosis_2_') 
  OR (dop.diagn_osn BETWEEN '_diagnosis_3_' AND '_diagnosis_4_') 
  OR (dop.diagn_osn BETWEEN '_diagnosis_5_' AND '_diagnosis_6_')) 
 AND :osnovnoe_param_1_: 
 AND ((_stadiya_diagn_id_ &lt; 0) OR (dop.sp_stadiya_diagn_id = _stadiya_diagn_id_)) 
 AND (:work_region_condition_1_:)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="osnovnoe_param" Caption="В 3000 и 4000 считать по " Type="select2">
              <Sql>(dop.osnovnoe) = Основному | true = Всем</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="work_region_condition" Caption="Регион места работы" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0 UNION SELECT 'm.region_id = ' || k.code, k.name, 1 FROM kladr_tab k WHERE k.code IN (SELECT DISTINCT region_id FROM mest_work_tab) ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="kart_dd_type_id" Caption="Тип" Type="select">
              <Sql>SELECT sp_kart_dd_type_id, sp_kart_dd_type FROM sp_kart_dd_type_tab ORDER BY sp_kart_dd_type_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008050604" Name="Нагрузка врачей по дополнительной диспансеризации" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Нагрузка врачей по дополнительной диспансеризации.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT f.fio, f.dolg_doctor, count(DISTINCT d.kart_dd_id) as nkart,  count(distinct k.dan_id) as npeople FROM kart_dd_tab k 
LEFT JOIN dop_dispan_tab d On d.kart_dd_id = k.kart_dd_id 
LEFT JOIN full_doctor_tab f On f.full_doctor_id = d.doctor_id 
WHERe d.diagn_osn is not null AND :period_3_1_:  
AND k.sp_kart_dd_type_id = :period_2_1_: 
AND k.date_vnes_inf &gt;= date(':period_1_1_:') AND k.date_vnes_inf &lt;= date(':period_1_2_:')  
GROUP BY f.fio, f.dolg_doctor</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_3" Caption="Специальность" Type="select">
              <Sql>SELECT 'true', 'Все'::text, 0  UNION   SELECT ' f.dolg_doctor_id = '||dolg_doctor_id::text, dolg_doctor, 1 FROm dolg_doctor_tab dolg    WHERE dolg.dolg_doctor_id IN (SELECT distinct f.dolg_doctor_id FROm   dop_dispan_tab d    LEFT JOIN full_doctor_tab f On full_doctor_id = d.doctor_id)    ORDEr BY 3,2   </Sql>
            </Parameter>
            <Parameter Name="period_2" Caption="Тип" Type="select">
              <Sql>select sp_kart_dd_type_id, sp_kart_dd_type from sp_kart_dd_type_tab order by sp_kart_dd_type_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008050605" Name="Прошедшие диспансеризацию и не имеющие места работы" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Прошедшие диспансеризацию и не имеющие места работы.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT DISTINCT '$id',d.fam, d.nam,d.mid, d.date_born, m.mest_work,  k.date_vnes_inf as date1 
 FROM kart_dd_tab k 
LEFT JOIN dan_Tab d ON d.dan_id = k.dan_id  
LEFT JOIN mest_work_tab m On m.mest_work_id = d.mesto_work_id 
WHERe (m.kpp IS NULL OR trim(m.kpp)  = '') AND kart_dd_id IN (SELECT  kart_dd_id FROm dop_dispan_tab)  
ORDEr BY k.date_vnes_inf DESC</Sql>
            </Query>
          </Queries>
          <Parameters />
        </Report>
        <Report Id="2008050606" Name="12-ДД-1" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\12-ДД-1.xls">
          <Queries>
            <Query>
              <Sql>health_group_count(_work_kind_code_,_health_group_) SELECT COUNT(DISTINCT kdd.kart_dd_id) 
FROM kart_dd_tab kdd 
LEFT JOIN dop_dispan_tab dop ON (dop.kart_dd_id = kdd.kart_dd_id) AND (dop.osnovnoe) 
LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (dop.diagn_osn IS NOT NULL) 
 AND (dop.health_group = _health_group_) 
 AND ((_work_kind_code_ &lt; 0) OR (m.sp_activity_kind_id = _work_kind_code_)) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>health_group_count2(_work_kind_code_,_health_group_,_diagnosis_stage_) SELECT COUNT(DISTINCT kdd.kart_dd_id) 
FROM kart_dd_tab kdd 
LEFT JOIN dop_dispan_tab dop ON (dop.kart_dd_id = kdd.kart_dd_id) AND (dop.osnovnoe) 
LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (dop.diagn_osn IS NOT NULL) 
 AND (dop.health_group = _health_group_) 
 AND ((_diagnosis_stage_ &lt; 0) OR (dop.sp_stadiya_diagn_id = _diagnosis_stage_)) 
 AND ((_work_kind_code_ &lt; 0) OR (m.sp_activity_kind_id = _work_kind_code_)) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>people_count(_work_kind_code_) SELECT ( 
 SELECT COUNT(DISTINCT kdd.kart_dd_id) 
 FROM kart_dd_tab kdd 
 LEFT JOIN dop_dispan_tab dop ON (dop.kart_dd_id = kdd.kart_dd_id) AND (dop.osnovnoe) 
 LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
 LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
 WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
  AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
  AND (dop.diagn_osn IS NOT NULL) 
  AND ((_work_kind_code_ &lt; 0) OR (m.sp_activity_kind_id = _work_kind_code_)) 
  AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
  AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
)::text || '/' || ( 
 SELECT COUNT(DISTINCT kdd.kart_dd_id) 
 FROM kart_dd_tab kdd 
 LEFT JOIN dop_dispan_tab dop ON (dop.kart_dd_id = kdd.kart_dd_id) AND (dop.osnovnoe) 
 LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
 LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
 WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
  AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
  AND (dop.diagn_osn IS NOT NULL) 
  AND (kdd.dan_id NOT IN ( 
   SELECT kdd2.dan_id 
   FROM kart_dd_tab kdd2 
   LEFT JOIN dop_dispan_tab dop2 ON (dop2.kart_dd_id = kdd2.kart_dd_id) AND (dop2.osnovnoe) 
   WHERE (dop2.health_group &lt;= 3) 
    AND (kdd2.date_vnes_inf &lt; date((date_part('year',now()) || '-01-01'))) 
  )) 
  AND ((_work_kind_code_ &lt; 0) OR (m.sp_activity_kind_id = _work_kind_code_)) 
  AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
  AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
)::text</Sql>
            </Query>
            <Query>
              <Sql>resort_count(_work_kind_code_) SELECT COUNT(DISTINCT kdd.kart_dd_id) 
FROM kart_dd_tab kdd 
LEFT JOIN dop_dispan_tab dop ON (dop.kart_dd_id = kdd.kart_dd_id) AND (dop.osnovnoe) 
LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (dop.diagn_osn IS NOT NULL) 
 AND (dop.is_need_san_kur) 
 AND ((_work_kind_code_ &lt; 0) OR (m.sp_activity_kind_id = _work_kind_code_)) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>work_kind_list SELECT sp_activity_kind, sp_activity_kind_id AS work_kind_code 
FROM sp_activity_kind_tab 
ORDER BY sp_activity_kind_id</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="kart_dd_type_id" Caption="Вид" Type="select">
              <Sql>SELECT sp_kart_dd_type_id, sp_kart_dd_type FROM sp_kart_dd_type_tab ORDER BY sp_kart_dd_type_id</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="region" Caption="Регион места работы" Type="select">
              <Sql>SELECT '' AS code, 'Все' AS name, 0 UNION SELECT k.code, k.name, 1 FROM kladr_tab k WHERE (k.code != '')  AND (k.code IN (SELECT DISTINCT region_id FROM mest_work_tab)) ORDER BY 3, 2</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008050607" Name="12-ДД-2" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\12-ДД-2.xls">
          <Queries>
            <Query>
              <Sql>zapros1(diag1,diag2) SELECT COUNT(DISTINCT diag.oid) 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE ((t.vid_oplat_id = 3) OR (v.target_pos_id IN (10,11,12))) 
 AND (t.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (diag.diagn_osn BETWEEN 'diag1' AND 'diag2') 
 AND (diag.count != '1') 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND ((NOT :only_belong_patients_1_:) OR (d.prikreplen = 1))</Sql>
            </Query>
            <Query>
              <Sql>zapros2(diag1,diag2) SELECT COUNT(DISTINCT diag.oid) 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE ((t.vid_oplat_id = 3) OR (v.target_pos_id IN (10,11,12))) 
 AND (t.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (diag.diagn_osn BETWEEN 'diag1' AND 'diag2') 
 AND ((diag.count = '1') OR (diag.stage_of_disease = 3)) 
 AND ((diag.stage_of_disease IS NULL) OR (diag.stage_of_disease != 2)) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND ((NOT :only_belong_patients_1_:) OR (d.prikreplen = 1))</Sql>
            </Query>
            <Query>
              <Sql>zapros3(diag1,diag2) SELECT COUNT(DISTINCT diag.oid) 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE ((t.vid_oplat_id = 3) OR (v.target_pos_id IN (10,11,12))) 
 AND (t.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (diag.diagn_osn BETWEEN 'diag1' AND 'diag2') 
 AND (diag.stage_of_disease = 2) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND ((NOT :only_belong_patients_1_:) OR (d.prikreplen = 1))</Sql>
            </Query>
            <Query>
              <Sql>zapros4(diag1,diag2) SELECT COUNT(DISTINCT d.dan_id) 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE ((t.vid_oplat_id = 3) OR (v.target_pos_id IN (10,11,12))) 
 AND (t.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (diag.diagn_osn BETWEEN 'diag1' AND 'diag2') 
 AND (t.result_id IN (7,33)) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND ((NOT :only_belong_patients_1_:) OR (d.prikreplen = 1))</Sql>
            </Query>
            <Query>
              <Sql>zapros5(diag1,diag2) SELECT COUNT(DISTINCT d.dan_id) 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
LEFT JOIN dispan_uchet_tab disp ON (disp.dan_id = d.dan_id) AND (disp.date &gt;= v.data_pos) 
WHERE ((t.vid_oplat_id = 3) OR (v.target_pos_id IN (10,11,12))) 
 AND (t.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (disp.diagn_id BETWEEN 'diag1' AND 'diag2') 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND ((NOT :only_belong_patients_1_:) OR (d.prikreplen = 1))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="region" Caption="Регион места работы" Type="select">
              <Sql>SELECT '' AS code, 'Все' AS name, 0 UNION SELECT k.code, k.name, 1 FROM kladr_tab k WHERE (k.code != '')  AND (k.code IN (SELECT DISTINCT region_id FROM mest_work_tab)) ORDER BY 3, 2</Sql>
            </Parameter>
            <Parameter Name="only_belong_patients" Caption="Считать только по прикрепленному населению" Type="select2">
              <Sql>false=нет| true=да|</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008050608" Name="Кол-во человек, прошедщих ДД (по полу)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Кол-во человек, прошедщих ДД (по полу).xls">
          <Queries>
            <Query>
              <Sql>people_count SELECT ( 
SELECT COUNT(*) 
FROM kart_dd_tab kdd 
LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (EXISTS( 
  SELECT ddt.kart_dd_id 
  FROM dop_dispan_tab ddt 
  WHERE (ddt.kart_dd_id = kdd.kart_dd_id) 
 )) 
 AND (:work_region_condition_1_:) 
 AND (d.sex = 'м') 
)  AS man_count, ( 
SELECT COUNT(*) 
FROM kart_dd_tab kdd 
LEFT JOIN dan_tab d ON d.dan_id = kdd.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE (kdd.sp_kart_dd_type_id = :kart_dd_type_id_1_:) 
 AND (kdd.date_vnes_inf BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (EXISTS( 
  SELECT ddt.kart_dd_id 
  FROM dop_dispan_tab ddt 
  WHERE (ddt.kart_dd_id = kdd.kart_dd_id) 
 )) 
 AND (:work_region_condition_1_:) 
 AND (d.sex = 'ж') 
)  AS woman_count</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="work_region_condition" Caption="Регион места работы" Type="select">
              <Sql>SELECT 'true'::text, 'Все'::text, 0 UNION SELECT 'm.region_id = ' || k.code, k.name, 1 FROM kladr_tab k WHERE k.code IN (SELECT DISTINCT region_id FROM mest_work_tab) ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="kart_dd_type_id" Caption="Тип" Type="select">
              <Sql>SELECT sp_kart_dd_type_id, sp_kart_dd_type FROM sp_kart_dd_type_tab ORDER BY sp_kart_dd_type_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2011503000" Name="Форма 12 (2009 год)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Форма 12 (2009 год).xls">
          <Queries>
            <Query>
              <Sql>dispans_all(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
/*LEFT JOIN talon_tab ON talon_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.talon_id=talon_tab.talon_id AND 
visit_tab.data_pos 
	BETWEEN dispan_uchet_tab.date AND 
		CASE WHEN dispan_uchet_tab.date_sn IS NULL THEN ':param1_2_:'::date 
ELSE dispan_uchet_tab.date_sn END 
	AND visit_tab.data_pos BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
 */ 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) 
 AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt;date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (dispan_uchet_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
/*LEFT JOIN talon_tab ON talon_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.talon_id=talon_tab.talon_id AND 
visit_tab.data_pos 
	BETWEEN dispan_uchet_tab.date AND 
		CASE WHEN dispan_uchet_tab.date_sn IS NULL THEN ':param1_2_:'::date 
ELSE dispan_uchet_tab.date_sn END 
	AND visit_tab.data_pos BETWEEN date(':param1_1_:') AND date(':param1_2_:') */ 
 
/*SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.visit_id=dispan_uchet_tab.visit_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id */ 
 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (dispan_uchet_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
/*LEFT JOIN talon_tab ON talon_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.talon_id=talon_tab.talon_id AND 
visit_tab.data_pos 
	BETWEEN dispan_uchet_tab.date AND 
		CASE WHEN dispan_uchet_tab.date_sn IS NULL THEN ':param1_2_:'::date 
ELSE dispan_uchet_tab.date_sn END 
	AND visit_tab.data_pos BETWEEN date(':param1_1_:') AND date(':param1_2_:') */ 
 
/*SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.visit_id=dispan_uchet_tab.visit_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id */ 
 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (dispan_uchet_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m3(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
/*LEFT JOIN talon_tab ON talon_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.talon_id=talon_tab.talon_id AND 
visit_tab.data_pos 
	BETWEEN dispan_uchet_tab.date AND 
		CASE WHEN dispan_uchet_tab.date_sn IS NULL THEN ':param1_2_:'::date 
ELSE dispan_uchet_tab.date_sn END 
	AND visit_tab.data_pos BETWEEN date(':param1_1_:') AND date(':param1_2_:') */ 
 
/*SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.visit_id=dispan_uchet_tab.visit_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id */ 
 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (dispan_uchet_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
/*LEFT JOIN talon_tab ON talon_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.talon_id=talon_tab.talon_id AND 
visit_tab.data_pos 
	BETWEEN dispan_uchet_tab.date AND 
		CASE WHEN dispan_uchet_tab.date_sn IS NULL THEN ':param1_2_:'::date 
ELSE dispan_uchet_tab.date_sn END 
	AND visit_tab.data_pos BETWEEN date(':param1_1_:') AND date(':param1_2_:') */ 
 
/*SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.visit_id=dispan_uchet_tab.visit_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id */ 
 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (dispan_uchet_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
/*LEFT JOIN talon_tab ON talon_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.talon_id=talon_tab.talon_id AND 
visit_tab.data_pos 
	BETWEEN dispan_uchet_tab.date AND 
		CASE WHEN dispan_uchet_tab.date_sn IS NULL THEN ':param1_2_:'::date 
ELSE dispan_uchet_tab.date_sn END 
	AND visit_tab.data_pos BETWEEN date(':param1_1_:') AND date(':param1_2_:') */ 
 
/*SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.visit_id=dispan_uchet_tab.visit_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id */ 
 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (dispan_uchet_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
/*LEFT JOIN talon_tab ON talon_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.talon_id=talon_tab.talon_id AND 
visit_tab.data_pos 
	BETWEEN dispan_uchet_tab.date AND 
		CASE WHEN dispan_uchet_tab.date_sn IS NULL THEN ':param1_2_:'::date 
ELSE dispan_uchet_tab.date_sn END 
	AND visit_tab.data_pos BETWEEN date(':param1_1_:') AND date(':param1_2_:') */ 
 
/*SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.visit_id=dispan_uchet_tab.visit_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id */ 
 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (dispan_uchet_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
/*LEFT JOIN talon_tab ON talon_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.talon_id=talon_tab.talon_id AND 
visit_tab.data_pos 
	BETWEEN dispan_uchet_tab.date AND 
		CASE WHEN dispan_uchet_tab.date_sn IS NULL THEN ':param1_2_:'::date 
ELSE dispan_uchet_tab.date_sn END 
	AND visit_tab.data_pos BETWEEN date(':param1_1_:') AND date(':param1_2_:') */ 
 
/*SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.visit_id=dispan_uchet_tab.visit_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id */ 
 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (dispan_uchet_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>dispans2_all(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
/*LEFT JOIN talon_tab ON talon_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.talon_id=talon_tab.talon_id AND 
visit_tab.data_pos 
	BETWEEN dispan_uchet_tab.date AND 
		CASE WHEN dispan_uchet_tab.date_sn IS NULL THEN ':param1_2_:'::date 
ELSE dispan_uchet_tab.date_sn END 
	AND visit_tab.data_pos BETWEEN date(':param1_1_:') AND date(':param1_2_:') */ 
 
/*SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.visit_id=dispan_uchet_tab.visit_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id */ 
 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (dispan_uchet_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>dispans2_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
/*LEFT JOIN talon_tab ON talon_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.talon_id=talon_tab.talon_id AND 
visit_tab.data_pos 
	BETWEEN dispan_uchet_tab.date AND 
		CASE WHEN dispan_uchet_tab.date_sn IS NULL THEN ':param1_2_:'::date 
ELSE dispan_uchet_tab.date_sn END 
	AND visit_tab.data_pos BETWEEN date(':param1_1_:') AND date(':param1_2_:') */ 
 
/*SELECT COUNT(*) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN visit_tab ON visit_tab.visit_id=dispan_uchet_tab.visit_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id */ 
 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (DATE_PART('year',AGE(date(':param1_2_:'), date_born)) BETWEEN age1 AND age2) 
 AND (date &lt; date(':param1_2_:')) AND ((date_sn IS NULL) OR ((date_sn IS NOT NULL) AND (date_sn &gt; date(':param1_2_:')))) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (dispan_uchet_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>dop_dd_dispans SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN kart_dd_tab k ON dispan_uchet_tab.dan_id = k.dan_id 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
WHERE (date BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
AND k.date_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
and dop.sp_stadiya_diagn_id  =2 
 AND (dispan_uchet_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>dop_dd_first select count(*) 
from diagn_tab diag 
LEFT JOIN kart_dd_tab k ON k.talon_id = diag.talon_id 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
LEFT JOIN talon_tab t ON t.talon_id = k.talon_id 
LEFT JOIN dan_tab On dan_tab.dan_id = k.dan_id 
where k.date_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
and dop.sp_stadiya_diagn_id =2 
 AND ((NOT :param2_1_:) OR (t.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diag.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>seek(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first3(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m3(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (sex = 'м') 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all3(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek_all4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek2_all(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek2_all_first(age1,age2,mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek2_all_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>seek2_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = diagn_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (DATE_PART('year',AGE(data, date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (/*dan_tab.prikreplen = 1)*/talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 and (diagn_tab.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param4" Caption="Врач" Type="select">
              <Sql>select -1, 'Все врачи' union SELECT f.full_doctor_id, f.full_doctor_id||' '||f.fio||' ('||f.dolg_doctor||')' FROm full_doctor_tab f where f.dolg_doctor_id !=900 ORDER BY 1,2</Sql>
            </Parameter>
            <Parameter Name="otd" Caption="Отделение" Type="select">
              <Sql>select 'true'::text, 'Все',0 union select 'dan_tab.spolref='''||lpu_tab.pricpol||'''',lpu_tab.name,1 from lpu_tab  order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Считать только по прикрепленному населению" Type="select2">
              <Sql>true=да| false=нет|</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2012103001" Name="Реестр иногородних(печатная форма)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Реестр иногородних(печатная форма).xls">
          <Queries>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT  d.fio, 
strcom.name AS strcom, 
CASE WHEN length(num_pol)=16 THEN COALESCE(d.ser_pol,'') ELSE COALESCE(d.ser_pol,'') END||COALESCE(d.num_pol,'') AS sn_pol, 
to_char(d.date_born,'dd/MM/yyyy') as date_born,  
d.address, 
replace(join_str(to_char(sub.d_u,'dd/MM/yyyy')),',','\n') AS usl_dates, 
'''||replace(join_str(sub.cod::varchar),',','\n') AS usl_codes, 
replace(join_str(sub.cena::varchar),',','\n') AS prices, 
sum(sub.cena) AS total_price, 
replace(join_str(sub.kol_vo_usl::varchar),',','         \n') AS total_q, 
replace(join_str(sub.ds),',','\n') AS diagnoses 
 
FROM (  
SELECT d.id as dan_id,  
t.diag_osn as ds, 
v.data_pos d_u, 
v.conv_usl_code as cod, 
1 as kol_vo_usl, 
v.visit_id as visit_id, NULL AS hosp_id, 
v.conv_price as cena 
 
FROM visit_tab v 
LEFT JOIN talon_tab t 			ON t.talon_id = v.talon_id 
LEFT JOIN dan_tab d 			ON d.dan_id = t.dan_id 
LEFT JOIN stand_patient_tab sdt 	ON sdt.talon_id = t.talon_id  
LEFT JOIN spec_doctor_tab doc_sp 	ON doc_sp.kod_doctor = v.doctor_id 
LEFT JOIN otdel_tab o			ON o.otdel::text = doc_sp.otdel 
LEFT JOIN doctor_tab doc 		ON doc.id=v.doctor_id 
LEFT JOIN dan_tab d2 		ON d2.dan_id=doc.dan_id 
LEFT JOIN codifiers.doctor_spec_tab ds ON doc.sp_spec_doctor_id=ds.id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.code=ds.reestr_uslug_code 
left join full_doctor_tab f on f.full_doctor_id=v.doctor_id 
LEFT JOIN codifiers.reestr_mkb_tab r on r.mkb=t.diag_osn   
WHERE v.data_pos BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id !='0300000000000'  
and (t.vid_oplat_id in (0,3,6,7)) 
and f.dolg_doctor_id not in (167,13,152,159,900,403,603001) 
and (f.otdel!='2001' or f.otdel != '203001' or f.otdel is null) 
and :otdel_param_1_: and v.conv_usl_code IS NOT NULL 
and t.diag_osn is not null AND d.num_pol IS NOT NULL  and r.oms!=1 
 
 UNION 
--госпитализация 
 SELECT d.id as dan_id, 
h.diagn as ds, 
h.date_end d_u, 
usl.code as cod, 
h.duration as kol_vo_usl, 
NULL  as visit_id, h.id AS hosp_id, 
e.cost as cena 
 
FROM hosp_tab h 
LEFT JOIN dan_tab d 			ON d.dan_id =h.dan_id 
left join full_doctor_tab f on f.full_doctor_id=h.operator_id 
LEFT JOIN doctor_tab doc 		ON doc.id=h.operator_id 
LEFT JOIN dan_tab d2 		ON d2.dan_id=doc.dan_id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.code=(case when (DATE_PART('year',AGE(h.date_begin, d.date_born)) between 0 and 17) then 
	case when h.stacionar_type=4 then  '198304' 
		else '198305' end 
	else case when h.stacionar_type=4 then  '097040' 
		else '097002' end end) 
LEFT JOIN eq_uslug_cost_tab e ON e.sp_uslug_id = usl.id AND e.sp_kind_paid_id = 0 AND h.date_end BETWEEN e.date_begin AND e.date_end 
LEFT JOIN spec_doctor_tab doc_sp 	ON doc_sp.kod_doctor = h.operator_id 
LEFT JOIN otdel_tab o			ON o.otdel::text = doc_sp.otdel 
LEFT JOIN codifiers.reestr_mkb_tab r on r.mkb=h.diagn  
 
WHERE h.date_end BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id !='0300000000000'  
and :otdel_param_1_: 
and f.dolg_doctor_id not in (167,403,603001) 
and (f.otdel!='2001' or f.otdel != '203001' or f.otdel is null)  
and h.diagn is not null  AND d.num_pol IS NOT NULL  and r.oms!=1) AS sub 
 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN codifiers.strcom_tab strcom ON strcom.id = d.strcom_id 
GROUP BY 1,2,3,4,5</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT  
sum(sub.kol_vo_usl) AS total_q 
 
FROM (  
SELECT d.id as dan_id,  
t.diag_osn as ds, 
v.data_pos d_u, 
v.conv_usl_code as cod, 
1 as kol_vo_usl, 
v.visit_id as visit_id, NULL AS hosp_id, 
v.conv_price as cena 
 
FROM visit_tab v 
LEFT JOIN talon_tab t 			ON t.talon_id = v.talon_id 
LEFT JOIN dan_tab d 			ON d.dan_id = t.dan_id 
LEFT JOIN stand_patient_tab sdt 	ON sdt.talon_id = t.talon_id  
LEFT JOIN spec_doctor_tab doc_sp 	ON doc_sp.kod_doctor = v.doctor_id 
LEFT JOIN otdel_tab o			ON o.otdel::text = doc_sp.otdel 
LEFT JOIN doctor_tab doc 		ON doc.id=v.doctor_id 
LEFT JOIN dan_tab d2 		ON d2.dan_id=doc.dan_id 
LEFT JOIN codifiers.doctor_spec_tab ds ON doc.sp_spec_doctor_id=ds.id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.code=ds.reestr_uslug_code 
left join full_doctor_tab f on f.full_doctor_id=v.doctor_id 
 
WHERE v.data_pos BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and t.strcom_region_id !='0300000000000'  
and (t.vid_oplat_id in (0,3,6,7)) 
and f.dolg_doctor_id not in (167,13,152,159,900) 
and :otdel_param_1_: and v.conv_usl_code IS NOT NULL 
and t.diag_osn is not null 
 
 UNION 
--госпитализация 
 SELECT d.id as dan_id, 
h.diagn as ds, 
h.date_end d_u, 
usl.code as cod, 
h.duration as kol_vo_usl, 
NULL  as visit_id, h.id AS hosp_id, 
e.cost as cena 
 
FROM hosp_tab h 
LEFT JOIN dan_tab d 			ON d.dan_id =h.dan_id 
left join full_doctor_tab f on f.full_doctor_id=h.operator_id 
LEFT JOIN doctor_tab doc 		ON doc.id=h.operator_id 
LEFT JOIN dan_tab d2 		ON d2.dan_id=doc.dan_id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.code=(case when (DATE_PART('year',AGE(h.date_begin, d.date_born)) between 0 and 17) then 
	case when h.stacionar_type=4 then  '198304' 
		else '198305' end 
	else case when h.stacionar_type=4 then  '098304' 
		else '098305' end end) 
LEFT JOIN eq_uslug_cost_tab e ON e.sp_uslug_id = usl.id AND e.sp_kind_paid_id = 0 AND h.date_end BETWEEN e.date_begin AND e.date_end 
LEFT JOIN spec_doctor_tab doc_sp 	ON doc_sp.kod_doctor = h.operator_id 
LEFT JOIN otdel_tab o			ON o.otdel::text = doc_sp.otdel 
 
 
WHERE h.date_end BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id !='0300000000000'  
and :otdel_param_1_: 
and f.dolg_doctor_id not in (167) and (f.otdel!='2001' or f.otdel is null) 
and h.diagn is not null ) AS sub 
 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN codifiers.strcom_tab strcom ON strcom.id = d.strcom_id</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select 'f.otdel='||'''9004''','Амбулатория Сокол',1 union select 'f.otdel!='||'''9004''','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая" Type="select">
              <Sql>SELECT ' true ', 'Все' UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2012303001" Name="Участки кодификатор" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Участки кодификатор.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT  u.code AS p1, u.name AS p2, fu.full_name AS p3, o.name AS p4 
FROM codifiers.uchactok_tab u 
LEFT JOIN full_doctor_view fu ON fu.full_doctor_id = u.doctor_id 
LEFT JOIN codifiers.otdel_tab o ON o.id = u.otdel_id</Sql>
            </Query>
          </Queries>
          <Parameters />
        </Report>
        <Report Id="2013503001" Name="!ОМС Услуги" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\!ОМС Услуги.xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'S'||get_lpu_number()::text</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT DISTINCT 
'$id'::text, 
d.dan_id,  
CASE WHEN length(d.num_pol) = 16 THEN d.num_pol ELSE COALESCE(d.ser_pol||' ','')||COALESCE(d.num_pol,'') end as ser_num_pol, 
d.pens, 
CASE WHEN (sub.sp_otdel_id='9004' or sub.sp_otdel_id='401') THEN '2308011' ELSE 
(SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1) END AS spolref, 
0 as god, 
0 as mm, 
NULL AS srz_mcod, 
sub.diagn_id AS ds, 
sub.date_okaz AS d_u, 
cu.code AS cod, 
sub.sp_uslug_id, 
sub.kol_vo AS kol_vo_usl, 
o.code AS otdel, 
NULL AS tds,  --TODO: сейчас пустое, нужно ли вообще? 
'' AS ds2, -- TODO: Пока будет пустое 
sub.result_code AS be, 
sub.doctor_id::VARCHAR AS tn1, 
dd.pens AS vrss, 
sub.sp_spec_doctor_id AS post, 
sub.cost AS cena , 
sub.prvs as prvs, 
sub.profil as profil   
FROM 
 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, doc.dan_id AS doc_dan_id, 
inference_diagnosis AS diagn_id, doc.sp_otdel_id, ok.result_code, kol_vo, 
doc.sp_spec_doctor_id AS prvs, 
 ds.xprofil as profil  
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
LEFT JOIN codifiers.doctor_spec_tab ds ON doc.sp_spec_doctor_id=ds.id 
WHERE (ok.date_okaz BETWEEN ':period_1_:' AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id = get_our_region_code() 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN dan_tab dd ON dd.dan_id = sub.doc_dan_id 
LEFT JOIN codifiers.otdel_tab o ON o.id  = sub.sp_otdel_id 
LEFT JOIN codifiers.sp_uslug_tab cu ON cu.id = sub.sp_uslug_id</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select '(doc.sp_otdel_id='||'9004)','Амбулатория Сокол',1 union select '(doc.sp_otdel_id!='||'9004)','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все' UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2013703001" Name="!Иногородние Пациенты" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\!Иногородние Пациенты.xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'I'||get_lpu_number()::text</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT substr(d.strcom_region_id,1,2) AS regs, 
d.dan_id, 
conv_to_null(str.socr||' ')||str.name  as ulname, 
a.sp_street_code AS strcode, 
'' as nullstr, 
CASE WHEN length(d.num_pol) = 16 THEN d.num_pol ELSE COALESCE(d.ser_pol||' ','')||COALESCE(d.num_pol,'') end as ser_num_pol, 
d.pens, 
d.fam, 
d.nam, 
d.mid, 
d.date_born, 
CASE WHEN d.sex = 'м' THEN 1 ELSE 2 END as sex, 
s.code as strcom,  
substr(d.street_id,14,4) as str_code, 
a.sp_street_code as street_id, 
a.house_number, 
a.building, 
a.flat_number as flat, 
a.text_address, 
d.kateg_lgot_id, 
d.sozstatus_id, 
m.name as mest_work, 
m.inn, 
m.kpp, 
d.dogovor_number, 
d.okvd, 
d.policy_type,  
CASE WHEN (sub.sp_otdel_id=9004 OR sub.sp_otdel_id=401) THEN '2308011' 
ELSE (SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1) END AS spolref, 
date_part('month',':period_1_:'::date) as nums, 
(date_trunc('month',':period_1_:'::date) + '2 months'::interval  - '1 day'::interval)::date as data_s, 
CASE WHEN get_vozrast(d.date_born)&lt;1 THEN true ELSE false END AS novor, 
CASE WHEN d.vid_doc_id=1 THEN 14  
	WHEN d.vid_doc_id=5 THEN 2 ELSE 3 END AS c_doc, 
(SELECT value FROM settings_tab WHERE name='OGRN' LIMIT 1) AS q_ogrn, 
d.strcom_id AS q_vcode, 
a.raions_id AS rn, 
a.sp_street_code as np,  
s.name AS q_name, 
k.name AS nnp, 
conv_to_null(d.serdoc)||' '||conv_to_null(d.numdoc) as sn_pasp, 
d.sozstatus_id AS sp, '' AS nullstr, 
sum(sub.cost) AS cena 
 
FROM 
 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, doc.dan_id AS doc_dan_id, 
inference_diagnosis AS diagn_id, doc.sp_otdel_id, ok.result_code, kol_vo 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
WHERE (ok.date_okaz BETWEEN ':period_1_:' AND ':period_2_:' ) 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id != get_our_region_code() --- Иногородний 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub 
 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN address_tab a ON a.dan_id = sub.dan_id AND sp_addr_type_id = 1 
LEFT JOIN codifiers.strcom_tab s ON s.id = d.strcom_id 
LEFT JOIN codifiers.mest_work_tab m ON m.id = d.mesto_work_id 
LEFT JOIN codifiers.sp_street_tab str ON str.code = a.sp_street_code 
LEFT JOIN codifiers.sp_kladr_tab k ON rpad(substring(a.sp_street_code for 8),13,'0') = k.code 
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select 'doc.sp_otdel_id='||'9004','Амбулатория Сокол',1 union select 'doc.sp_otdel_id!='||'9004','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все' UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2013903001" Name="!Иногородние печатная форма" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\!Иногородние печатная форма.xls">
          <Queries>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT sub1.fio, sub1.strcom, sub1.sn_pol, sub1.date_born, sub1.strcom, sub1.address, 
''''||array_to_string(array_agg(sub1.code),E'&amp;#10;','*') AS usl_codes, 
array_to_string(array_agg(sub1.str_date),E'&amp;#10;','*') AS usl_dates, 
array_to_string(array_agg(sub1.str_cost),E'&amp;#10;','0.00') AS prices, 
sum(sub1.cost) AS total_price, 
array_to_string(array_agg(sub1.str_kol),'&amp;#10;','*') AS total_q, 
array_to_string(array_agg(sub1.diagn_id),'&amp;#10;','*') AS diagnoses, 
count(sub1.*) AS total_count FROM 
(SELECT  d.fio, d.dan_id, 
s.name AS strcom, 
CASE WHEN length(num_pol)=16 THEN d.num_pol ELSE COALESCE(d.ser_pol||' ','')||COALESCE(d.num_pol,'') END AS sn_pol, 
to_char(d.date_born,'dd/MM/yyyy') as date_born,  
d.address, 
u.code, to_char(sub.date_okaz,'dd/MM/yyyy') AS str_date, LTRIM(TO_CHAR(sub.cost,'99999999.99')) AS str_cost, 
sub.kol_vo::varchar AS str_kol, sub.cost, 
sub.diagn_id 
FROM 
 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, doc.dan_id AS doc_dan_id, 
inference_diagnosis AS diagn_id, doc.sp_otdel_id, ok.result_code, kol_vo 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
WHERE (ok.date_okaz BETWEEN ':period_1_:' AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id != get_our_region_code() 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub 
 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN sp_uslug_tab u ON u.id = sub.sp_uslug_id 
LEFT JOIN codifiers.strcom_tab s ON s.id = d.strcom_id 
ORDER BY fio,sub.date_okaz ) AS sub1 
GROUP BY 1,2,3,4,5,6 
ORDER BY 1,2</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT sum(sub.kol_vo), sum(sub.cost)  AS total_cost 
FROM 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, doc.dan_id AS doc_dan_id, 
inference_diagnosis AS diagn_id, doc.sp_otdel_id, ok.result_code, kol_vo 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
WHERE (ok.date_okaz BETWEEN ':period_1_:' AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id != get_our_region_code() 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select 'doc.sp_otdel_id='||'9004','Амбулатория Сокол',1 union select 'doc.sp_otdel_id!='||'9004','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все' UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2014103001" Name="!Иногородние Услуги" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\!Иногородние Услуги.xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'C'||get_lpu_number()::text</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT DISTINCT 
'$id'::text, 
d.dan_id,  
CASE WHEN length(d.num_pol) = 16 THEN d.num_pol ELSE COALESCE(d.ser_pol||' ','')||COALESCE(d.num_pol,'') end as ser_num_pol, 
d.pens, 
CASE WHEN (sub.sp_otdel_id='9004' or sub.sp_otdel_id='401') THEN '2308011' ELSE 
(SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1) END AS spolref, 
0 as god, 
0 as mm, 
NULL AS srz_mcod, 
sub.diagn_id AS ds, 
sub.date_okaz AS d_u, 
cu.code AS cod, 
sub.sp_uslug_id, 
sub.kol_vo AS kol_vo_usl, 
o.code AS otdel, 
NULL AS tds,  --TODO: сейчас пустое, нужно ли вообще? 
'' AS ds2, -- TODO: Пока будет пустое 
sub.result_code AS be, 
sub.doctor_id AS tn1, 
dd.pens AS vrss, 
sub.sp_spec_doctor_id AS post, 
sub.cost AS cena, 
sub.prvs as prvs, 
  sub.profil as profil  
FROM 
 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, doc.dan_id AS doc_dan_id, 
inference_diagnosis AS diagn_id, doc.sp_otdel_id, ok.result_code, kol_vo, doc.sp_spec_doctor_id AS prvs, 
 ds.xprofil as profil 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
LEFT JOIN codifiers.doctor_spec_tab ds ON doc.sp_spec_doctor_id=ds.id 
WHERE (ok.date_okaz BETWEEN ':period_1_:' AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id != get_our_region_code() 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN dan_tab dd ON dd.dan_id = sub.doc_dan_id 
LEFT JOIN codifiers.otdel_tab o ON o.id  = sub.sp_otdel_id 
LEFT JOIN codifiers.sp_uslug_tab cu ON cu.id = sub.sp_uslug_id</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select '(doc.sp_otdel_id='||'9004)','Амбулатория Сокол',1 union select '(doc.sp_otdel_id!='||'9004)','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все' UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2014303001" Name="!ОМС Пациенты" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\!ОМС Пациенты.xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'P'||get_lpu_number()::text</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT d.dan_id AS dan_id, 
conv_to_null(str.socr||' ')||str.name  as ulname, 
a.sp_street_code AS strcode, '' as nullstr, 
CASE WHEN length(d.num_pol) = 16 THEN d.num_pol ELSE COALESCE(d.ser_pol||' ','')||COALESCE(d.num_pol,'') end as ser_num_pol, 
d.pens, 
d.fam, d.nam, d.mid, 
d.date_born, 
CASE WHEN d.sex = 'м' THEN 1 ELSE 2 END as sex, 
s.code as strcom,  
substr(d.street_id,14,4) as str_code, 
a.sp_street_code as street_id, 
a.house_number, 
a.building, 
a.flat_number as flat, 
a.text_address, 
d.kateg_lgot_id, 
d.sozstatus_id, 
m.name as mest_work, 
m.inn, 
m.kpp, 
d.dogovor_number, 
d.okvd, 
d.policy_type, 
substr(d.strcom_region_id,1,2) AS regs, 
CASE WHEN (sub.sp_otdel_id=9004 OR sub.sp_otdel_id=401) THEN '2308011' 
ELSE (SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1) END AS spolref, 
sum(sub.cost) AS cena 
FROM 
 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, doc.dan_id AS doc_dan_id, 
inference_diagnosis AS diagn_id, doc.sp_otdel_id, ok.result_code, kol_vo 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
WHERE (ok.date_okaz BETWEEN ':period_1_:' AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id = get_our_region_code() --- Иногородний 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub 
 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN address_tab a ON a.dan_id = sub.dan_id AND sp_addr_type_id = 1 
LEFT JOIN codifiers.strcom_tab s ON s.id = d.strcom_id 
LEFT JOIN codifiers.mest_work_tab m ON m.id = d.mesto_work_id 
LEFT JOIN codifiers.sp_street_tab str ON str.code = a.sp_street_code 
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select 'doc.sp_otdel_id='||'9004','Амбулатория Сокол',1 union select 'doc.sp_otdel_id!='||'9004','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все' UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2015503000" Name="12-ДД-2-09" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\12-ДД-2-09.xls">
          <Queries>
            <Query>
              <Sql>lpu_okato select value from settings_tab where name='TER'</Sql>
            </Query>
            <Query>
              <Sql>lpu_okogu select value from settings_tab where name='MIN'</Sql>
            </Query>
            <Query>
              <Sql>lpu_okpo select value from settings_tab where name='ORG'</Sql>
            </Query>
            <Query>
              <Sql>lpuaddress select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpuname select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros1(diag1,diag2) SELECT COUNT(DISTINCT diag.oid) 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE ((t.vid_oplat_id = 3) OR (v.target_pos_id IN (10,11,12))) 
 AND (t.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (diag.diagn_osn BETWEEN 'diag1' AND 'diag2') 
 AND (diag.count != '1') 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND ((NOT :only_belong_patients_1_:) OR  --(d.prikreplen = 1) ) 
(t.pricpol::int8 in (select * from get_all_lpu_numbers())))</Sql>
            </Query>
            <Query>
              <Sql>zapros2(diag1,diag2) SELECT COUNT(DISTINCT diag.oid) 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE ((t.vid_oplat_id = 3) OR (v.target_pos_id IN (10,11,12))) 
 AND (t.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (diag.diagn_osn BETWEEN 'diag1' AND 'diag2') 
 AND ((diag.count = '1') OR (diag.stage_of_disease = 3)) 
 AND ((diag.stage_of_disease IS NULL) OR (diag.stage_of_disease != 2)) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND ((NOT :only_belong_patients_1_:) OR   --(d.prikreplen = 1) ) 
(t.pricpol::int8 in (select * from get_all_lpu_numbers())))</Sql>
            </Query>
            <Query>
              <Sql>zapros3(diag1,diag2) SELECT COUNT(DISTINCT diag.oid) 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE ((t.vid_oplat_id = 3) OR (v.target_pos_id IN (10,11,12))) 
 AND (t.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (diag.diagn_osn BETWEEN 'diag1' AND 'diag2') 
 AND (diag.stage_of_disease = 2) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND ((NOT :only_belong_patients_1_:) OR   --(d.prikreplen = 1) ) 
(t.pricpol::int8 in (select * from get_all_lpu_numbers())))</Sql>
            </Query>
            <Query>
              <Sql>zapros4(diag1,diag2) SELECT COUNT(DISTINCT d.dan_id) 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
WHERE ((t.vid_oplat_id = 3) OR (v.target_pos_id IN (10,11,12))) 
 AND (t.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (diag.diagn_osn BETWEEN 'diag1' AND 'diag2') 
 AND (t.result_id IN (7,33)) 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND ((NOT :only_belong_patients_1_:) OR  --(d.prikreplen = 1) ) 
(t.pricpol::int8 in (select * from get_all_lpu_numbers())))</Sql>
            </Query>
            <Query>
              <Sql>zapros5(diag1,diag2) SELECT COUNT(DISTINCT d.dan_id) 
FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
LEFT JOIN diagn_tab diag ON diag.talon_id = t.talon_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN mest_work_tab m ON m.mest_work_id = d.mesto_work_id 
LEFT JOIN dispan_uchet_tab disp ON (disp.dan_id = d.dan_id) AND (disp.date &gt;= v.data_pos) 
WHERE ((t.vid_oplat_id = 3) OR (v.target_pos_id IN (10,11,12))) 
 AND (t.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (disp.diagn_id BETWEEN 'diag1' AND 'diag2') 
 AND ((':region_1_:' = '') OR (m.region_id = ':region_1_:')) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND ((NOT :only_belong_patients_1_:) OR  --(d.prikreplen = 1) ) 
(t.pricpol::int8 in (select * from get_all_lpu_numbers())))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="region" Caption="Регион места работы" Type="select">
              <Sql>SELECT '' AS code, 'Все' AS name, 0 UNION SELECT k.code, k.name, 1 FROM kladr_tab k WHERE (k.code != '')  AND (k.code IN (SELECT DISTINCT region_id FROM mest_work_tab)) ORDER BY 3, 2</Sql>
            </Parameter>
            <Parameter Name="only_belong_patients" Caption="Считать только по прикрепленному населению" Type="select2">
              <Sql>false=нет| true=да|</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2015703000" Name="Ежемесячный мониторинг по ДД" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Ежемесячный мониторинг по ДД.xls">
          <Queries>
            <Query>
              <Sql>lpuname select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select count(*) from 
kart_dd_tab k 
join dop_dispan_tab dop on k.kart_dd_id = dop.kart_dd_id 
where k.date_vnes_inf between date('01-'||date_part('month', ':param1_1_:'::date)||'-'||date_part('year',':param1_1_:'::date)) and date(':param1_1_:') 
and (k.sp_kart_dd_type_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros2 select count(*) from 
kart_dd_tab k 
join dop_dispan_tab dop on k.kart_dd_id = dop.kart_dd_id 
where k.date_vnes_inf between date('01-01-'||date_part('year',':param1_1_:'::date)) and date(':param1_1_:') 
and (k.sp_kart_dd_type_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select count(*) from 
kart_dd_tab k 
join dop_dispan_tab dop on k.kart_dd_id = dop.kart_dd_id 
join dan_tab d ON k.dan_id = d.dan_id 
where k.date_vnes_inf between date('01-'||date_part('month', ':param1_1_:'::date)||'-'||date_part('year',':param1_1_:'::date)) and date(':param1_1_:') 
and (k.sp_kart_dd_type_id = :param2_1_:) 
and DATE_PART('year',AGE(:param1_1_:, date_born)) BETWEEN 40 and 200</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Отчетная дата" Type="date">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Тип" Type="select">
              <Sql>SELECT sp_kart_dd_type_id, sp_kart_dd_type FROM sp_kart_dd_type_tab WHERE sp_kart_dd_type_id &lt;10 ORDER BY sp_kart_dd_type_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2066207001" Name="Карта проф.прививок" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Карта проф.прививок.xls">
          <Queries>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>z1 seLECT d.fio as fio, d.dan_id 
 
FROM dan_tab d 
WHERE d.dan_id = :param1_1_:</Sql>
            </Query>
            <Query>
              <Sql>z10 seLECT  case when get_vozrast(d.date_born,p.date_priviv)=0 then '' else get_vozrast(d.date_born,p.date_priviv)::text end, 
   p.date_priviv, 
   case when p.doza=0 then '' else p.doza::text end as doza, 
   p.seria, 
   case when p.reaction=false then 'Отрицательная' else 'Положительная' end as result 
	FROM dan_tab d 
	left join priviv_tab p on p.dan_id=d.dan_id 
    WHERE d.dan_id = :param1_1_: 
    and p.preparat in (726) 
    and p.vid_priviv between 9 and 12 
    order by  p.date_priviv DESC 
   ;</Sql>
            </Query>
            <Query>
              <Sql>z11 seLECT  case when get_vozrast(d.date_born,p.date_priviv)=0 then '' else get_vozrast(d.date_born,p.date_priviv)::text end , 
   p.date_priviv, 
   case when p.doza=0 then '' else p.doza::text end as doza, 
   p.seria, 
   case when p.reaction=false then 'Отрицательная' else 'Положительная' end as result 
	FROM dan_tab d 
	left join priviv_tab p on p.dan_id=d.dan_id 
    WHERE d.dan_id = :param1_1_: 
    and p.preparat in (726) 
    and p.vid_priviv between 13 and 20 
    order by  p.date_priviv DESC 
   ;</Sql>
            </Query>
            <Query>
              <Sql>z12 seLECT  'Возраст '||case when get_vozrast(d.date_born,p.date_priviv)=0 then '' else get_vozrast(d.date_born,p.date_priviv)::text end  
   ||' Дата прививки '||p.date_priviv||' '||s.sp_priv_univ||' '||s1.sp_priv_univ||' Доза '||case when p.doza=0 then '' else p.doza::text end||' Серия '||p.seria  
	FROM dan_tab d 
	left join priviv_tab p on p.dan_id=d.dan_id 
	left join sp_priv_univ_tab s on s.sp_priv_univ_id=p.preparat 
	left join sp_priv_univ_tab s1 on s1.sp_priv_univ_id=p.vid_priviv  
    WHERE d.dan_id = :param1_1_: 
    and p.preparat not in (704,701,732,721,775,755,723,733,702,726) 
    order by  p.date_priviv DESC ;</Sql>
            </Query>
            <Query>
              <Sql>z13 seLECT  case when get_vozrast(d.date_born,p.date_priviv)=0 then '' else get_vozrast(d.date_born,p.date_priviv)::text end, 
   p.date_priviv, 
   case when p.doza=0 then '' else p.doza::text end as doza, 
   p.seria, 
   case when p.reaction=false then 'Отрицательная' else 'Положительная' end as result 
	FROM dan_tab d 
	left join priviv_tab p on p.dan_id=d.dan_id 
    WHERE d.dan_id = :param1_1_: 
    and p.preparat in (733,702) 
    and p.vid_priviv between 9 and 12 
    order by  p.date_priviv DESC 
    ;</Sql>
            </Query>
            <Query>
              <Sql>z14 seLECT  case when get_vozrast(d.date_born,p.date_priviv)=0 then '' else get_vozrast(d.date_born,p.date_priviv)::text end, 
   p.date_priviv, 
   case when p.doza=0 then '' else p.doza::text end as doza, 
   p.seria, 
   case when p.reaction=false then 'Отрицательная' else 'Положительная' end as result 
	FROM dan_tab d 
	left join priviv_tab p on p.dan_id=d.dan_id 
    WHERE d.dan_id = :param1_1_: 
    and p.preparat in (733,702) 
    and p.vid_priviv between 13 and 20 
    order by  p.date_priviv DESC 
   ;</Sql>
            </Query>
            <Query>
              <Sql>z2 seLECT 
date_part('year',d.date_born) as year, 
date_part('month',d.date_born) as month, 
date_part('day',d.date_born) as day 
	FROM dan_tab d 
	WHERE d.dan_id = :param1_1_:</Sql>
            </Query>
            <Query>
              <Sql>z3 seLECT 
COALESCE(k3.name,'') as nas_punkt, 
COALESCE(s.name,'') as nam_ul 
	FROM dan_tab d 
	LEFT JOIN address_tab a ON a.dan_id = d.dan_id and sp_addr_type_id=1 
	LEFT JOIN codifiers.sp_kladr_tab k3 ON rpad(substring(a.street_id for 8),13,'0') = k3.code 
	LEFT JOIN codifiers.sp_street_tab s ON s.code = a.sp_street_code 
    	WHERE d.dan_id = :param1_1_:</Sql>
            </Query>
            <Query>
              <Sql>z4 seLECT 
COALESCE(a.house_number::varchar,'') as dom, 
COALESCE(a.building,'') as korpus, 
COALESCE(a.flat_number::varchar,'')||COALESCE(a.flat_litera,'') as kv 
	FROM dan_tab d 
	LEFT JOIN address_tab a ON a.dan_id = d.dan_id and sp_addr_type_id=1 
	LEFT JOIN codifiers.sp_kladr_tab k3 ON rpad(substring(a.street_id for 8),13,'0') = k3.code 
	LEFT JOIN codifiers.sp_street_tab s ON s.code = a.sp_street_code 
   	WHERE d.dan_id = :param1_1_:</Sql>
            </Query>
            <Query>
              <Sql>z5 seLECT  
   p.date_priviv, 
   case when p.doza=0 then '' else p.doza::text end as doza, 
   p.seria 
	FROM dan_tab d 
	left join priviv_tab p on p.dan_id=d.dan_id 
    WHERE d.dan_id = :param1_1_: 
    and p.preparat=704 
    order by  p.date_priviv DESC 
   ;</Sql>
            </Query>
            <Query>
              <Sql>z6 seLECT  case when get_vozrast(d.date_born,p.date_priviv)=0 then '' else get_vozrast(d.date_born,p.date_priviv)::text end, 
   p.date_priviv, 
   case when p.doza=0 then '' else p.doza::text end as doza, 
   p.seria 
	FROM dan_tab d 
	left join priviv_tab p on p.dan_id=d.dan_id 
    WHERE d.dan_id = :param1_1_: 
    and p.preparat in (701,732) 
    and p.vid_priviv between 9 and 12 
    order by  p.date_priviv DESC 
   ;</Sql>
            </Query>
            <Query>
              <Sql>z7 seLECT  case when get_vozrast(d.date_born,p.date_priviv)=0 then '' else get_vozrast(d.date_born,p.date_priviv)::text end, 
   p.date_priviv, 
   case when p.doza=0 then '' else p.doza::text end as doza, 
   p.seria 
	FROM dan_tab d 
	left join priviv_tab p on p.dan_id=d.dan_id 
    WHERE d.dan_id = :param1_1_: 
    and p.preparat in (701,732) 
    and p.vid_priviv between 13 and 20 
    order by  p.date_priviv DESC 
    ;</Sql>
            </Query>
            <Query>
              <Sql>z8 seLECT  case when get_vozrast(d.date_born,p.date_priviv)=0 then '' else get_vozrast(d.date_born,p.date_priviv)::text end, 
   p.date_priviv, 
   case when p.doza=0 then '' else p.doza::text end as doza, 
   p.seria, 
   case when p.reaction=false then 'Отрицательная' else 'Положительная' end as result 
	FROM dan_tab d 
	left join priviv_tab p on p.dan_id=d.dan_id 
    WHERE d.dan_id = :param1_1_: 
    and p.preparat in (721,775,723,755) 
    and p.vid_priviv between 9 and 12 
    order by  p.date_priviv DESC 
    ;</Sql>
            </Query>
            <Query>
              <Sql>z9 seLECT  case when get_vozrast(d.date_born,p.date_priviv)=0 then '' else get_vozrast(d.date_born,p.date_priviv)::text end, 
   p.date_priviv, 
   case when p.doza=0 then '' else p.doza::text end as doza, 
   p.seria, 
   case when p.reaction=false then 'Отрицательная' else 'Положительная' end as result 
	FROM dan_tab d 
	left join priviv_tab p on p.dan_id=d.dan_id 
    WHERE d.dan_id = :param1_1_: 
    and p.preparat in (721,775,723,755) 
    and p.vid_priviv between 13 and 20 
    order by  p.date_priviv DESC 
   ;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="id" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders>
        <Folder Name="Сводная таблица исходов лечения">
          <Reports />
          <Folders />
        </Folder>
        <Folder Name="Отчеты по стойкой потере трудоспособности (Инвалиды)">
          <Reports />
          <Folders />
        </Folder>
        <Folder Name="Отчет о заболеваемости по заданным критериям">
          <Reports />
          <Folders />
        </Folder>
        <Folder Name="Списки зарегистрированных диагнозов">
          <Reports />
          <Folders />
        </Folder>
        <Folder Name="Дополнительная диспансеризация">
          <Reports>
            <Report Id="91" Name="Характеристика объема оказанной дополнительной диспансеризации" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Дополнительная диспансеризация\Характеристика объема оказанной дополнительной диспансеризации.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select full_doctor_tab.full_doctor_id, full_doctor_tab.fio as param_1_1, count(*) as param_1_2 from dop_dispan_tab
	left join full_doctor_tab on  dop_dispan_tab.doctor_id=full_doctor_tab.full_doctor_id
	left join kart_dd_tab on kart_dd_tab.kart_dd_id=dop_dispan_tab.kart_dd_id	
	where dop_dispan_tab.date_vnes_inf between date('01.01.2006') and  date('01.01.2007')
	and sp_kart_dd_type_id=:period_2_1_:
	group by full_doctor_tab.full_doctor_id, full_doctor_tab.fio
	UNION
	select NULL,'Итого',count(*) from dop_dispan_tab
	left join kart_dd_tab on kart_dd_tab.kart_dd_id=dop_dispan_tab.kart_dd_id
	where dop_dispan_tab.date_vnes_inf between date('01.01.2006') and  date('01.01.2007')
	and sp_kart_dd_type_id=:period_2_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 :param_1_1:</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 :param_1_2:</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period_1" Caption="Дата" Type="date_period" />
                <Parameter Name="period_2" Caption="Тип" Type="select">
                  <Sql>select sp_kart_dd_type_id, sp_kart_dd_type from sp_kart_dd_type_tab order by sp_kart_dd_type_id</Sql>
                </Parameter>
              </Parameters>
            </Report>
          </Reports>
          <Folders />
        </Folder>
        <Folder Name="Отчетность по беременным женщинам">
          <Reports>
            <Report Id="112" Name="Стандартная карта динамического наблюдения №2" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Отчетность по беременным женщинам\Стандартная карта динамического наблюдения №2.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select dan_tab.fam||' '||dan_tab.nam||' '||dan_tab.mid as param_1_2_, dan_tab.date_born as param_1_3_,
 (select diagn_osn from diagn_tab where talon_id=visit_tab.talon_id and (diagn_osn like 'Z3%' or diagn_osn like 'O%') limit 1)  as param_1_4_, 
 visit_tab.data_pos as param_1_5_, full_doctor_tab.fio as param_1_6_,
 pregnant_period as param_1_7_, state_oslozh as param_1_8_, group_risk as param_1_9_, itog_state as param_1_10_, lpu_tab.name as param_1_11_ 
 from pregnant_visit_tab
 left join visit_tab on visit_tab.visit_id=pregnant_visit_tab.visit_id
 left join talon_tab on talon_tab.talon_id=visit_tab.talon_id
 left join dan_tab on dan_tab.dan_id=talon_tab.dan_id
 left join lpu_tab on cast(cast(lpu_tab.pricpol as text) as int)=cast(cast(pregnant_visit_tab.pricpol as text) as int)
 left join full_doctor_tab on full_doctor_tab.full_doctor_id=visit_tab.doctor_id
 where visit_tab.:period_2_1_: between date(':period_1_1_:') and date(':period_1_2_:')
</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period_1" Caption="Дата" Type="date_period" />
                <Parameter Name="period_2" Caption="Тип выборки" Type="select2">
                  <Sql>data_vnes_inf=по дате внесения|data_pos=по дате посещения</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="113" Name="Стандартная карта динамического наблюдения №2 (продолжение)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Отчетность по беременным женщинам\Стандартная карта динамического наблюдения №2 (продолжение).xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select conv_to_null(dan_tab.fam)||' '||conv_to_null(dan_tab.nam)||' '||conv_to_null(dan_tab.mid)||', '||conv_to_null(sp_family_status_id), dan_tab.date_born as param_1_1_, 
 visit_tab.data_pos as param_1_2_,
 conv_to_null(kol_rodov_4_7)||'-'||conv_to_null(kol_rodov_8)||'-'||conv_to_null(abort_before)||'-'||conv_to_null(abort_before_2)||'-'||conv_to_null(abort_before_3)||'-'||conv_to_null(abort_after_3)  as param_1_3_,  
 pregnant_period as param_1_4_, (risk_soc_bio_fak+akush_ginek_fact) as param_1_5_,
 replace(extra_genital_diag, ',', ', ') as param_1_6_, sum_ocenka_extra_gen as param_1_7_, state_oslozh as param_1_8_, group_risk as param_1_9_, itog_state as param_1_10_
 from pregnant_visit_tab
 left join visit_tab on visit_tab.visit_id=pregnant_visit_tab.visit_id
 left join talon_tab on talon_tab.talon_id=visit_tab.talon_id
 left join dan_tab on dan_tab.dan_id=talon_tab.dan_id
 left join full_doctor_tab on full_doctor_tab.full_doctor_id=visit_tab.doctor_id
 left join pregnant_karta_tab on visit_tab.data_pos&gt;=pregnant_karta_tab.date_begin_preg and (visit_tab.data_pos&lt;=pregnant_karta_tab.date_end_preg or pregnant_karta_tab.date_end_preg is null)
 and pregnant_karta_tab.dan_id=talon_tab.dan_id
 where visit_tab.:period_2_1_: between date(':period_1_1_:') and date(':period_1_2_:')
</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period_1" Caption="Дата" Type="date_period" />
                <Parameter Name="period_2" Caption="Тип выборки" Type="select2">
                  <Sql>data_vnes_inf=по дате внесения|data_pos=по дате посещения</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="114" Name="Общие сведения о новорожденном" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Отчетность по беременным женщинам\Общие сведения о новорожденном.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select dan_tab.fam||' '||dan_tab.nam||' '||dan_tab.mid, dan_tab.date_born as param_1_1_, sp_srok_id as param_1_2_, 
 (case when pregnant_child_tab.sex='м' then '1' else '0' end)||'; '||pregnant_child_tab.height||'см '||pregnant_child_tab.weight||'гр' as param_1_3_,
 okruzh_head||'; '||okruzh_chest as param_1_4_, apgar as param_1_5_, 
 krik_srazu||'-'||mer_ozhiv||'-'||skrining||'-'||porok_razvit||'-'||rod_travma as param_1_6_, bszh||'-'||gepatit as param_1_7_,
 replace(diagnoses, ',', ', ') as param_1_8_, lpu_tab.name as param_1_9_ from pregnant_child_tab 
 left join pregnant_karta_tab on pregnant_karta_tab.pregnant_karta_id=pregnant_child_tab.pregnant_karta_id
 left join dan_tab on dan_tab.dan_id=pregnant_karta_tab.dan_id
 left join lpu_tab on lpu_tab.pricpol=pregnant_child_tab.dr_lpu
 where pregnant_karta_tab.date_end_preg between date(':period_1_1_:') and date(':period_1_2_:')
</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="115" Name="Обследования беременных, консультации специалистов" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Отчетность по беременным женщинам\Обследования беременных, консультации специалистов.xls">
              <Queries />
              <Parameters />
            </Report>
            <Report Id="116" Name="Исходы беременности" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Отчетность по беременным женщинам\Исходы беременности.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select dan_tab.fam, dan_tab.nam as param_1_1_, dan_tab.mid as param_1_2_, dan_tab.date_born as param_1_3_, 
 date_end_preg as param_1_4_,sp_result_preg_tab.sp_result_preg as param_1_5_,kol_vo_new_born as param_1_6_
 from pregnant_karta_tab 
 left join dan_tab on dan_tab.dan_id=pregnant_karta_tab.dan_id
 left join sp_result_preg_tab on sp_result_preg_tab.sp_result_preg_id=pregnant_karta_tab.sp_result_preg_id
 where pregnant_karta_tab.date_end_preg between date(':period_1_1_:') and date(':period_1_2_:')
</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
          </Reports>
          <Folders>
            <Folder Name="Реестр Беременных женщин">
              <Reports />
              <Folders />
            </Folder>
          </Folders>
        </Folder>
        <Folder Name="РЕЕСТР на оплату (ОМС) НОВЫЙ">
          <Reports />
          <Folders />
        </Folder>
        <Folder Name="Уровень качества лечения">
          <Reports />
          <Folders />
        </Folder>
        <Folder Name="Объем поликлинической помощи">
          <Reports />
          <Folders />
        </Folder>
        <Folder Name="Реестры пролеченых пациентов и отпущенных рецептов">
          <Reports />
          <Folders />
        </Folder>
        <Folder Name="Артериальная гипертония">
          <Reports>
            <Report Id="62" Name="Распределение больных с вредными привычками" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Распределение больных с вредными привычками.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select count(dan_id) from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id)</Sql>
                </Query>
                <Query>
                  <Sql>zapros2(code) select count(dan_id) from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and kurenie=code</Sql>
                </Query>
                <Query>
                  <Sql>zapros3(code) select count(dan_id) from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and alcogol_frequency=code</Sql>
                </Query>
                <Query>
                  <Sql>zapros4(code) select count(dan_id) from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and phisical_activ=code</Sql>
                </Query>
                <Query>
                  <Sql>zapros5(code) select count(dan_id) from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and level_stress=code</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="64" Name="Список больных, которые не явились на следующий осмотр" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Список больных, которые не явились на следующий осмотр.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select distinct dan_tab.fam as param_0_, dan_tab.nam as param_1_, dan_tab.mid as param_2_, dan_tab.date_born as param_3_, 
	dispan_uchet_tab.diagn_id as param_4_, 
	(case when dan_tab.metka_work='+' then 
		(case when dan_tab.mesto_work_id is not null then mest_work_tab.mest_work else dan_tab.mest_work end) 
		else '' 
	end) as param_5_, date as param_6_, date_next as param_7_ from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id 
	LEFT JOIN diagn_tab On diagn_tab.diagn_osn between 'I10' and 'I15.9' AND data &gt; date_next AND diagn_tab.dan_id=dispan_uchet_tab.dan_id
	left join mest_work_tab on mest_work_tab.mest_work_id=dan_tab.mesto_work_id
	where date_next is not null and date_next&lt;CURRENT_DATE and
	
	dispan_uchet_tab.diagn_id between 'I10' and 'I15.9'
	and date_sn is null 
	AND diagn_tab.talon_id is null
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
	order by dan_tab.fam, dan_tab.nam, dan_tab.mid
</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 :param_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 :param_2_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 :param_3_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 :param_4_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros6 :param_5_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros7 :param_6_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros8 :param_7_:</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="65" Name="Сведения о заболеваемости гипертонией (по дате взятия на Д-учет)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Сведения о заболеваемости гипертонией (по дате взятия на Д-учет).xls">
              <Queries>
                <Query>
                  <Sql>diagns_list (select (ARRAY['I10', 
	'I11', 'I11.0', 'I11.9', 
	'I12', 'I12.0', 'I12.9', 
	'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
	'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_ from generate_series(1,18) as s(a)) as foo;
</Sql>
                </Query>
                <Query>
                  <Sql>zapros_1 select (select case when char_length(param_2_)=3 
	then (select diagn_kod_mkb from diagn_kod_mkb_tab where kodname=param_2_)
	else (select mkb from mkb_tab where kod_d=param_2_)
	end), * from (select
(ARRAY['I10', 
'I11.0-I11.9', 'I11.0', 'I11.9', 
'I12.0-I12.9', 'I12.0', 'I12.9', 
'I13.0-I13.9', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15.0-I15.9', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_,
(ARRAY['I10', 
'I11', 'I11.0', 'I11.9', 
'I12', 'I12.0', 'I12.9', 
'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_2_ from generate_series(1,18) as s(a)) as foo;
</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 :param_1_:</Sql>
                </Query>
                <Query>
                  <Sql>sostoit1 select count(distinct dan_tab.dan_id), count(distinct dan_tab.dan_id) as param_3_ from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id like ':param_2_:%'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>sostoit2(_val_) select count(distinct dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id like ':param_2_:%' and sex='_val_'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>sostoit3(age1, age2) select count(distinct dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id like ':param_2_:%'
	and DATE_PART('year',AGE(date(':period_1_1_:'), date_born)) between age1 and age2
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>sostoit4(_val_) select case when :param_3_:&gt;0 then round((count(distinct dan_tab.dan_id)*100.0/:param_3_:), 2) else 0 end from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id like ':param_2_:%' and sex='_val_'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>sostoit5(age1, age2) select case when :param_3_:&gt;0 then round((count(distinct dan_tab.dan_id)*100.0/:param_3_:), 2) else 0 end from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id like ':param_2_:%'
	and DATE_PART('year',AGE(date(':period_1_1_:'), date_born)) between age1 and age2
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 sostoit1</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 sostoit2(м)</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 sostoit2(ж)</Sql>
                </Query>
                <Query>
                  <Sql>zapros6 sostoit3(0, 14)</Sql>
                </Query>
                <Query>
                  <Sql>zapros7 sostoit3(15, 17)</Sql>
                </Query>
                <Query>
                  <Sql>zapros8 sostoit3(18, 200)</Sql>
                </Query>
                <Query>
                  <Sql>zapros9 sostoit4(м)</Sql>
                </Query>
                <Query>
                  <Sql>zapros10 sostoit4(ж)</Sql>
                </Query>
                <Query>
                  <Sql>zapros11 sostoit5(0, 14)</Sql>
                </Query>
                <Query>
                  <Sql>zapros12 sostoit5(15, 17)</Sql>
                </Query>
                <Query>
                  <Sql>zapros13 sostoit5(18, 200)</Sql>
                </Query>
                <Query>
                  <Sql>sostoit_1 select count(distinct dan_tab.dan_id), count(distinct dan_tab.dan_id) as param_3_ from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id between 'I10' and 'I15.9'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>sostoit_2(_val_) select count(distinct dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id between 'I10' and 'I15.9' and sex='_val_'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>sostoit_3(age1, age2) select count(distinct dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id between 'I10' and 'I15.9'
	and DATE_PART('year',AGE(date(':period_1_1_:'), date_born)) between age1 and age2
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>sostoit_4(_val_) select case when :param_3_:&gt;0 then round((count(distinct dan_tab.dan_id)*100.0/:param_3_:), 2) else 0 end from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id between 'I10' and 'I15.9' and sex='_val_'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>sostoit_5(age1, age2) select case when :param_3_:&gt;0 then round((count(distinct dan_tab.dan_id)*100.0/:param_3_:), 2) else 0 end from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
	and diagn_id between 'I10' and 'I15.9'
	and DATE_PART('year',AGE(date(':period_1_1_:'), date_born)) between age1 and age2
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>zapros__3 sostoit_1</Sql>
                </Query>
                <Query>
                  <Sql>zapros__4 sostoit_2(м)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__5 sostoit_2(ж)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__6 sostoit_3(0, 14)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__7 sostoit_3(15, 17)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__8 sostoit_3(18, 200)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__9 sostoit_4(м)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__10 sostoit_4(ж)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__11 sostoit_5(0, 14)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__12 sostoit_5(15, 17)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__13 sostoit_5(18, 200)</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="67" Name="Прием лекарственных средств (по дате рождения пациента)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Прием лекарственных средств (по дате рождения пациента).xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select distinct dan_tab.fam, dan_tab.nam as param_1_, dan_tab.mid as param_2_, dan_tab.date_born as param_3_, 
	(select diagn_id from dispan_uchet_tab where dispan_uchet_tab.dan_id=ag_vipis_preparat_tab.dan_id 
	and diagn_id between 'I10' and 'I15.9' limit 1) as param_4_, 
	lgot_preparat_tab.mnn_rus||' '||lgot_preparat_tab.doza as param_5_,
	ag_vipis_preparat_tab.date_begin as param_6_, ag_vipis_preparat_tab.date_end as param_7_ from ag_vipis_preparat_tab
	left join dan_tab on dan_tab.dan_id=ag_vipis_preparat_tab.dan_id 
	left join lgot_preparat_tab on lgot_preparat_tab.kod=ag_vipis_preparat_tab.kod_minzd 
	where dan_tab.date_born between date(':period_1_1_:') and date(':period_1_2_:')
	order by dan_tab.fam, dan_tab.nam, dan_tab.mid
</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 :param_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 :param_2_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 :param_3_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 :param_4_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros6 :param_5_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros7 :param_6_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros8 :param_7_:</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="68" Name="Список больных, на которых не заполнена карта диспансерного наблюдения (т.е. не проставлены физические характеристики)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Список больных, на которых не заполнена карта диспансерного наблюдения (т.е. не проставлены физические характеристики).xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select distinct dan_tab.fam, 
	dan_tab.nam as param_1_, dan_tab.mid as param_2_, dan_tab.date_born as param_3_,
	talon_tab.diag_osn as param_4_, visit_tab.data_pos as param_5_ from visit_tab
	left join talon_tab on visit_tab.talon_id=talon_tab.talon_id
	left join dan_tab on dan_tab.dan_id=talon_tab.dan_id 
	where visit_tab.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
	and talon_tab.diag_osn between 'I10' and 'I15.9'
	and talon_tab.dan_id not in (select distinct dan_id from ag_visit_data_tab)
	and talon_tab.dan_id not in (select dan_id from dispan_uchet_tab 
		where (dispan_uchet_tab.date&lt;=date (':period_1_1_:')) and 
		((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_1_:'))))
		and diagn_id between 'I10' and 'I15.9')
	and dan_tab.uchactok_id=:period_2_1_:
	order by dan_tab.fam, dan_tab.nam, dan_tab.mid
</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 :param_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 :param_2_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 :param_3_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 :param_4_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros6 :param_5_:</Sql>
                </Query>
                <Query>
                  <Sql>str_uchastok select uchactok from uchactok_tab where uchactok_id=:period_2_1_:</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period_1" Caption="Дата" Type="date_period" />
                <Parameter Name="period_2" Caption="Участок" Type="select">
                  <Sql>select uchactok_id, uchactok from uchactok_tab order by uchactok_id</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="69" Name="Сведения о больных артериальной гипертонией, обученных в Школе гипертоников" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Сведения о больных артериальной гипертонией, обученных в Школе гипертоников.xls">
              <Queries>
                <Query>
                  <Sql>diagns_list (select (ARRAY['I10', 
	'I11', 'I11.0', 'I11.9', 
	'I12', 'I12.0', 'I12.9', 
	'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
	'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_ from generate_series(1,18) as s(a)) as foo;
</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 select (select case when char_length(param_2_)=3 
	then (select diagn_kod_mkb from diagn_kod_mkb_tab where kodname=param_2_)
	else (select mkb from mkb_tab where kod_d=param_2_)
	end), * from (select
(ARRAY['I10', 
'I11.0-I11.9', 'I11.0', 'I11.9', 
'I12.0-I12.9', 'I12.0', 'I12.9', 
'I13.0-I13.9', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15.0-I15.9', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_,
(ARRAY['I10', 
'I11', 'I11.0', 'I11.9', 
'I12', 'I12.0', 'I12.9', 
'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_2_ from generate_series(1,18) as s(a)) as foo;
</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 :param_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 select count(distinct dan_id) from ag_visit_data_tab
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
				and school_health=1 and diagn like ':param_2_:%'
</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 select count(distinct dan_tab.dan_id) from ag_visit_data_tab
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
				and school_health=1 and diagn like ':param_2_:%' and sex='м'</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 select count(distinct dan_tab.dan_id) from ag_visit_data_tab
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
				and school_health=1 and diagn like ':param_2_:%' and sex='ж'</Sql>
                </Query>
                <Query>
                  <Sql>zapros_6(age1,age2) select count(distinct dan_tab.dan_id) from ag_visit_data_tab
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
				and school_health=1 and diagn like ':param_2_:%' and DATE_PART('year',AGE(date(':period_1_2_:'), date_born)) between age1 and age2</Sql>
                </Query>
                <Query>
                  <Sql>zapros6 zapros_6(0,14)</Sql>
                </Query>
                <Query>
                  <Sql>zapros7 zapros_6(15,17)</Sql>
                </Query>
                <Query>
                  <Sql>zapros8 zapros_6(18,200)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__3 select count(distinct dan_id) from ag_visit_data_tab
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
				and school_health=1 and diagn between 'I10' and 'I15.9'
</Sql>
                </Query>
                <Query>
                  <Sql>zapros__4 select count(distinct dan_tab.dan_id) from ag_visit_data_tab
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
				and school_health=1 and diagn between 'I10' and 'I15.9' and sex='м'</Sql>
                </Query>
                <Query>
                  <Sql>zapros__5 select count(distinct dan_tab.dan_id) from ag_visit_data_tab
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
				and school_health=1 and diagn between 'I10' and 'I15.9' and sex='ж'</Sql>
                </Query>
                <Query>
                  <Sql>zapros___6(age1,age2) select count(distinct dan_tab.dan_id) from ag_visit_data_tab
				left join visit_tab on visit_tab.visit_id=ag_visit_data_tab.visit_id
				left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
				where data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
				and school_health=1 and diagn between 'I10' and 'I15.9' and DATE_PART('year',AGE(date(':period_1_2_:'), date_born)) between age1 and age2</Sql>
                </Query>
                <Query>
                  <Sql>zapros__6 zapros___6(0,14)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__7 zapros___6(15,17)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__8 zapros___6(18,200)</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="70" Name="Поражение органов - &quot;мишеней&quot;" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Поражение органов - _мишеней_.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select count(*), count(dan_id) as param_1_ from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id)</Sql>
                </Query>
                <Query>
                  <Sql>viborka1(code) select count(dan_id) from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and code=1</Sql>
                </Query>
                <Query>
                  <Sql>viborka2(code) select round((count(dan_id)*100.0/:param_1_:), 2) from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and code=1</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 viborka1(atero_scleroz_kr_sosud)</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 viborka1(proterinurya)</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 viborka1(suzhenie_sos_setchat)</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 viborka1(gipertrof_left_zhelud)</Sql>
                </Query>
                <Query>
                  <Sql>zapros6 viborka2(atero_scleroz_kr_sosud)</Sql>
                </Query>
                <Query>
                  <Sql>zapros7 viborka2(proterinurya)</Sql>
                </Query>
                <Query>
                  <Sql>zapros8 viborka2(suzhenie_sos_setchat)</Sql>
                </Query>
                <Query>
                  <Sql>zapros9 viborka2(gipertrof_left_zhelud)</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="71" Name="Количество карт диспансерного наблюдения за период" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Количество карт диспансерного наблюдения за период.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select dolg_doctor_tab.dolg_doctor, spec_doctor_tab.dolg_doctor_id as param_1_1_, count(distinct ag_visit_data_tab.dan_id) as param_1_2_ from ag_visit_data_tab 
	left join spec_doctor_tab on ag_visit_data_tab.kod_doctor = spec_doctor_tab.kod_doctor
	left join dolg_doctor_tab on dolg_doctor_tab.dolg_doctor_id=spec_doctor_tab.dolg_doctor_id
	where dolg_doctor_tab.dolg_doctor is not null
	group by dolg_doctor_tab.dolg_doctor, spec_doctor_tab.dolg_doctor_id
</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 :param_1_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 :param_1_2_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 select count(distinct ag_visit_data_tab.dan_id) from ag_visit_data_tab 
	left join spec_doctor_tab on ag_visit_data_tab.kod_doctor = spec_doctor_tab.kod_doctor
	left join dan_tab on dan_tab.dan_id=ag_visit_data_tab.dan_id
	where spec_doctor_tab.dolg_doctor_id=:param_1_1_: and dan_tab.sex='ж'
</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="72" Name="Структура снятия с учета" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Структура снятия с учета.xls">
              <Queries>
                <Query>
                  <Sql>diagns_list (select (ARRAY['I10', 
	'I11', 'I11.0', 'I11.9', 
	'I12', 'I12.0', 'I12.9', 
	'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
	'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_ from generate_series(1,18) as s(a)) as foo;
</Sql>
                </Query>
                <Query>
                  <Sql>zapros_1 select (select case when char_length(param_2_)=3 
	then (select diagn_kod_mkb from diagn_kod_mkb_tab where kodname=param_2_)
	else (select mkb from mkb_tab where kod_d=param_2_)
	end), * from (select
(ARRAY['I10', 
'I11.0-I11.9', 'I11.0', 'I11.9', 
'I12.0-I12.9', 'I12.0', 'I12.9', 
'I13.0-I13.9', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15.0-I15.9', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_,
(ARRAY['I10', 
'I11', 'I11.0', 'I11.9', 
'I12', 'I12.0', 'I12.9', 
'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_2_ from generate_series(1,18) as s(a)) as foo;
</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 :param_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros6 select count(dan_tab.dan_id), count(dan_tab.dan_id) as param_6_1_ from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and diagn_id like ':param_2_:%'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>snat1(prichina) select count(dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and dispan_uchet_tab.prichin_sn_id in (prichina)
	and diagn_id like ':param_2_:%'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>zapros7 snat1(1)</Sql>
                </Query>
                <Query>
                  <Sql>zapros8 snat1("4,2")</Sql>
                </Query>
                <Query>
                  <Sql>zapros9 snat1(3)</Sql>
                </Query>
                <Query>
                  <Sql>zapros10 snat1(5)</Sql>
                </Query>
                <Query>
                  <Sql>snat2(prichina) select case when :param_6_1_:&gt;0 then round((count(dan_tab.dan_id)*100.0/:param_6_1_:), 2) else 0 end from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and dispan_uchet_tab.prichin_sn_id in (prichina)
	and diagn_id like ':param_2_:%'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>zapros11 snat2(1)</Sql>
                </Query>
                <Query>
                  <Sql>zapros12 snat2("4,2")</Sql>
                </Query>
                <Query>
                  <Sql>zapros13 snat2(3)</Sql>
                </Query>
                <Query>
                  <Sql>zapros14 snat2(5)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__6 select count(dan_tab.dan_id), count(dan_tab.dan_id) as param_6_2_ from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and diagn_id between 'I10' and 'I15.9'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>snat3(prichina) select count(dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and dispan_uchet_tab.prichin_sn_id in (prichina)
	and diagn_id between 'I10' and 'I15.9'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>zapros__7 snat3(1)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__8 snat3("4,2")</Sql>
                </Query>
                <Query>
                  <Sql>zapros__9 snat3(3)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__10 snat3(5)</Sql>
                </Query>
                <Query>
                  <Sql>snat4(prichina) select case when :param_6_2_:&gt;0 then round((count(dan_tab.dan_id)*100.0/:param_6_2_:), 2) else 0 end from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:'))
	and dispan_uchet_tab.prichin_sn_id in (prichina)
	and diagn_id between 'I10' and 'I15.9'
	and dispan_uchet_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>zapros__11 snat4(1)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__12 snat4("4,2")</Sql>
                </Query>
                <Query>
                  <Sql>zapros__13 snat4(3)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__14 snat4(5)</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="73" Name="Сопутствующие заболевания" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Сопутствующие заболевания.xls">
              <Queries>
                <Query>
                  <Sql>diagns_list (select (ARRAY['I10', 
	'I11', 'I11.0', 'I11.9', 
	'I12', 'I12.0', 'I12.9', 
	'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
	'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_ from generate_series(1,18) as s(a)) as foo;
</Sql>
                </Query>
                <Query>
                  <Sql>zapros_1 select (select case when char_length(param_2_)=3 
	then (select diagn_kod_mkb from diagn_kod_mkb_tab where kodname=param_2_)
	else (select mkb from mkb_tab where kod_d=param_2_)
	end), * from (select
(ARRAY['I10', 
'I11.0-I11.9', 'I11.0', 'I11.9', 
'I12.0-I12.9', 'I12.0', 'I12.9', 
'I13.0-I13.9', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15.0-I15.9', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_1_,
(ARRAY['I10', 
'I11', 'I11.0', 'I11.9', 
'I12', 'I12.0', 'I12.9', 
'I13', 'I13.0', 'I13.1', 'I13.2', 'I13.9',
'I15', 'I15.0', 'I15.1', 'I15.2', 'I15.8', 'I15.9'])[s.a] as param_2_ from generate_series(1,18) as s(a)) as foo;
</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 :param_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 select count(*), count(dan_id) as param_3_0_ from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab where diagn like ':param_2_:%' group by dan_id)</Sql>
                </Query>
                <Query>
                  <Sql>viborka1(code) select count(dan_id) from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab where diagn like ':param_2_:%' group by dan_id) and code=1</Sql>
                </Query>
                <Query>
                  <Sql>viborka2(code) select case when :param_3_0_:&gt;0 then round((count(dan_id)*100.0/:param_3_0_:), 2) else 0 end from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab where diagn like ':param_2_:%' group by dan_id) and code=1</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 viborka1(cereb_vascul_zabol)</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 viborka1(zabolev_heart)</Sql>
                </Query>
                <Query>
                  <Sql>zapros6 viborka1(zabolev_pochek)</Sql>
                </Query>
                <Query>
                  <Sql>zapros7 viborka1(zabolev_sosud)</Sql>
                </Query>
                <Query>
                  <Sql>zapros8 viborka2(cereb_vascul_zabol)</Sql>
                </Query>
                <Query>
                  <Sql>zapros9 viborka2(zabolev_heart)</Sql>
                </Query>
                <Query>
                  <Sql>zapros10 viborka2(zabolev_pochek)</Sql>
                </Query>
                <Query>
                  <Sql>zapros11 viborka2(zabolev_sosud)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__3 select count(*), count(dan_id) as param_3_0_ from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id)</Sql>
                </Query>
                <Query>
                  <Sql>viborka3(code) select count(dan_id) from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and code=1</Sql>
                </Query>
                <Query>
                  <Sql>viborka4(code) select case when :param_3_0_:&gt;0 then round((count(dan_id)*100.0/:param_3_0_:), 2) else 0 end from ag_visit_data_tab where visit_id in
	     (select max(visit_id) from ag_visit_data_tab group by dan_id) and code=1</Sql>
                </Query>
                <Query>
                  <Sql>zapros__4 viborka3(cereb_vascul_zabol)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__5 viborka3(zabolev_heart)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__6 viborka1(zabolev_pochek)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__7 viborka3(zabolev_sosud)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__8 viborka4(cereb_vascul_zabol)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__9 viborka4(zabolev_heart)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__10 viborka4(zabolev_pochek)</Sql>
                </Query>
                <Query>
                  <Sql>zapros__11 viborka4(zabolev_sosud)</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="74" Name="Сведения о больных гипертонией" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Сведения о больных гипертонией.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select value from settings_tab where name='LPU'</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 select value from settings_tab where name='LPU_NUMBER'</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 select count(dan_tab.dan_id) from dispan_uchet_tab 
	left join dan_tab on dan_tab.dan_id=dispan_uchet_tab.dan_id
	where (dispan_uchet_tab.date&lt;=date (':period_1_2_:')) and 
	((dispan_uchet_tab.date_sn is NULL) or ((dispan_uchet_tab.date_sn is not NULL) and (dispan_uchet_tab.date_sn&gt;date (':period_1_2_:'))))
	and diagn_id between 'I10' and 'I15.9'</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 select count(*) from visit_tab
	left join talon_tab on visit_tab.talon_id=talon_tab.talon_id 
	where talon_tab.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
	and talon_tab.dan_id in (select distinct dan_id from ag_visit_data_tab)
</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 select count(distinct dan_id) from ag_visit_data_tab 
</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="88" Name="Список пациентов на которых не заполнена карта гипертоника либо они не поставлены на Д-учет" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Список пациентов на которых не заполнена карта гипертоника либо они не поставлены на Д-учет.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select * from (select fam||' '||nam||' '||mid, date_born as param_1_, address as param_2_, uchactok as param_3_, d_id, 
	case when (select count(ag_visit_data_tab.dan_id) from ag_visit_data_tab where ag_visit_data_tab.dan_id=d_id)=0 then 'Нет' else 'Есть' end as param_4_, 
	case when (select count(dispan_uchet_tab.dan_id) from dispan_uchet_tab where dispan_uchet_tab.dan_id=d_id
	and diagn_id between 'I10' and 'I15.9' and date_sn is null)=0 then 'Нет' else 'Есть' end as param_5_
	from
		(select distinct diagn_tab.dan_id  as d_id from diagn_tab 
		left join talon_tab on talon_tab.talon_id=diagn_tab.talon_id
		where diagn_tab.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
		and diagn_osn between 'I10' and 'I15.9' and count=1
	) as foo 
	left join dan_tab on dan_tab.dan_id=d_id
	left join uchactok_tab on uchactok_tab.uchactok_id=dan_tab.uchactok_id
	order by dan_tab.uchactok_id, fam, nam, mid
	) as foo2
	where (param_4_='Есть' and param_5_='Нет') or (param_4_='Нет' and param_5_='Есть')
</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 :param_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 :param_2_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 :param_3_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros5 :param_4_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros6 :param_5_:</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
            <Report Id="89" Name="Список пациентов имеющих зарегистрированный гипертонический диагноз, но не занесенный на Д-учет и регистр по гипертонии" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Старые отчеты\Артериальная гипертония\Список пациентов имеющих зарегистрированный гипертонический диагноз, но не занесенный на Д-учет и регистр по гипертонии.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select * from (select fam||' '||nam||' '||mid, date_born as param_1_, address as param_2_, uchactok as param_3_, d_id, 
	case when (select count(ag_visit_data_tab.dan_id) from ag_visit_data_tab where ag_visit_data_tab.dan_id=d_id)=0 then 'Нет' else 'Есть' end as param_4_, 
	case when (select count(dispan_uchet_tab.dan_id) from dispan_uchet_tab where dispan_uchet_tab.dan_id=d_id
	and diagn_id between 'I10' and 'I15.9' and date_sn is null)=0 then 'Нет' else 'Есть' end as param_5_
	from
		(select distinct diagn_tab.dan_id  as d_id from diagn_tab 
		left join talon_tab on talon_tab.talon_id=diagn_tab.talon_id
		where diagn_tab.data_vnes_inf between date(':period_1_1_:') and date(':period_1_2_:')
		and diagn_osn between 'I10' and 'I15.9' and count=1
	) as foo 
	left join dan_tab on dan_tab.dan_id=d_id
	left join uchactok_tab on uchactok_tab.uchactok_id=dan_tab.uchactok_id
	order by dan_tab.uchactok_id, fam, nam, mid
	) as foo2
	where (param_4_='Нет' and param_5_='Нет')
</Sql>
                </Query>
                <Query>
                  <Sql>zapros2 :param_1_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros3 :param_2_:</Sql>
                </Query>
                <Query>
                  <Sql>zapros4 :param_3_:</Sql>
                </Query>
              </Queries>
              <Parameters />
            </Report>
          </Reports>
          <Folders />
        </Folder>
      </Folders>
    </Folder>
    <Folder Name="Отчеты для онкодиспансера">
      <Reports>
        <Report Id="5900000" Name="Реестр выполненных работ по дополнительной диспансеризации" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты для онкодиспансера\Реестр выполненных работ по дополнительной диспансеризации.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT d.fam||' '||d.nam||' '||d.mid as name, 
d.date_born, d.sex, d.address, d.mest_work, 
v.data_pos, t.diag_osn, f.fio  FROM 
talon_tab t 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
WHERE v.data_pos between date(':per_1_:') and date(':per_2_:') and t.vid_oplat_id = :opl_1_: AND  :pol_1_: 
order by 6</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="opl" Caption="Вид оплаты:" Type="select">
              <Sql>select id, name from sp_kind_paid_tab</Sql>
            </Parameter>
            <Parameter Name="per" Caption="За период:" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="pol" Caption="Поликлиника" Type="select">
              <Sql>SELECT ' true ','Все',0 UNION SELECT 't.pricpol = '||''''||pricpol||'''', name,1 FROM lpu_tab ORDER BY 3,2;</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="6500000" Name="Реестр выполненных работ по доп. диспасеризации 2" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты для онкодиспансера\Реестр выполненных работ по доп. диспасеризации 2.xls">
          <Queries>
            <Query>
              <Sql>zapros SELECT p1,p2,p3,p4,p5,p6,p7,join_str(s1) AS sum1,join_str(s2) AS sum2,join_str(s3) AS  sum3, 
join_str(s4) AS sum4,join_str(s5) AS sum5,join_str(s6) AS sum6, join_str(s7) AS sum7 FROM 
(SELECT d.fam||' '||d.nam||' '||d.mid as p1, 
d.date_born AS p2, d.sex AS p3, d.address AS p4, d.mest_work AS p5, 
v.data_pos AS p6, t.diag_osn AS p7, (sum(o.kol)*u1.cost)::text AS s1, 
(sum(o.kol)*u2.cost)::text  AS s2, (sum(o.kol)*u3.cost)::text  AS s3, 
(sum(o.kol)*u4.cost)::text AS s4, (sum(o.kol)*u5.cost)::text AS s5, 
(sum(o.kol)*u6.cost)::text AS s6, (sum(o.kol)*u7.cost)::text AS s7  FROM 
talon_tab t 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN operman_tab o ON o.visit_id = v.visit_id 
LEFT JOIN sp_uslug_tab u1 ON o.man_id::text = u1.uslug_kod AND u1.uslug_kod = '22' 
LEFT JOIN sp_uslug_tab u2 ON o.man_id::text = u2.uslug_kod AND u2.uslug_kod = '21' 
LEFT JOIN sp_uslug_tab u3 ON o.man_id::text = u3.uslug_kod AND u3.uslug_kod = '24' 
LEFT JOIN sp_uslug_tab u4 ON o.man_id::text = u4.uslug_kod AND u4.uslug_kod = '26' 
LEFT JOIN sp_uslug_tab u5 ON o.man_id::text = u5.uslug_kod AND u5.uslug_kod = '27' 
LEFT JOIN sp_uslug_tab u6 ON o.man_id::text = u6.uslug_kod AND u6.uslug_kod = '25' 
LEFT JOIN sp_uslug_tab u7 ON o.man_id::text = u7.uslug_kod AND u7.uslug_kod = '23' 
WHERE v.data_pos between date(':per_1_:') and date(':per_2_:') and t.vid_oplat_id = :opl_1_: AND  :pol_1_: 
GROUP BY 1,2,3,4,5,6,7, u1.cost, u2.cost, u3.cost, u4.cost, u5.cost, u6.cost, u7.cost) AS subq 
GROUP BY 1,2,3,4,5,6,7 ORDER BY 1,2,3</Sql>
            </Query>
            <Query>
              <Sql>zapros_total SELECT sum(s1) AS s1, sum(s2) AS s2,sum(s3) AS s3,sum(s4) AS s4,sum(s5) AS s5,sum(s6) AS s6, sum(s7) AS s7 FROM 
(SELECT d.fam||' '||d.nam||' '||d.mid as p1, 
d.date_born AS p2, d.sex AS p3, d.address AS p4, d.mest_work AS p5, 
v.data_pos AS p6, t.diag_osn AS p7, (sum(o.kol)*u1.cost) AS s1, 
(sum(o.kol)*u2.cost) AS s2, (sum(o.kol)*u3.cost) AS s3, 
(sum(o.kol)*u4.cost) AS s4, (sum(o.kol)*u5.cost) AS s5, 
(sum(o.kol)*u6.cost) AS s6, (sum(o.kol)*u7.cost) AS s7  FROM 
talon_tab t 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = v.doctor_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
LEFT JOIN operman_tab o ON o.visit_id = v.visit_id 
LEFT JOIN sp_uslug_tab u1 ON o.man_id::text = u1.uslug_kod AND u1.uslug_kod = '22' 
LEFT JOIN sp_uslug_tab u2 ON o.man_id::text = u2.uslug_kod AND u2.uslug_kod = '21' 
LEFT JOIN sp_uslug_tab u3 ON o.man_id::text = u3.uslug_kod AND u3.uslug_kod = '24' 
LEFT JOIN sp_uslug_tab u4 ON o.man_id::text = u4.uslug_kod AND u4.uslug_kod = '26' 
LEFT JOIN sp_uslug_tab u5 ON o.man_id::text = u5.uslug_kod AND u5.uslug_kod = '27' 
LEFT JOIN sp_uslug_tab u6 ON o.man_id::text = u6.uslug_kod AND u6.uslug_kod = '25' 
LEFT JOIN sp_uslug_tab u7 ON o.man_id::text = u7.uslug_kod AND u7.uslug_kod = '23' 
WHERE v.data_pos between date(':per_1_:') and date(':per_2_:') and t.vid_oplat_id = :opl_1_: AND  :pol_1_: 
GROUP BY 1,2,3,4,5,6,7, u1.cost, u2.cost, u3.cost, u4.cost, u5.cost, u6.cost,u7.cost)  AS subq</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="opl" Caption="Вид оплаты" Type="select">
              <Sql>select id, name from sp_kind_paid_tab</Sql>
            </Parameter>
            <Parameter Name="per" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="pol" Caption="Поликлиника" Type="select">
              <Sql>SELECT ' true ','Все',0 UNION SELECT 't.pricpol = '||''''||pricpol||'''', name,1 FROM lpu_tab ORDER BY 3,2;</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="8800000" Name="СВОДНАЯ ВЕДОМОСТЬ учета врачебных посещений в амбулаторно-поликлинических учреждениях, на дому (Форма 39/у-02)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты для онкодиспансера\СВОДНАЯ ВЕДОМОСТЬ учета врачебных посещений в амбулаторно-поликлинических учреждениях, на дому (Форма 39_у-02).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT distinct /*full_doctor_id::text||' '||*/fio||' - '||dolg_doctor as fd_fio, full_doctor_id as fd_id FROM full_doctor_tab f 
LEFT JOIN visit_tab v on v.doctor_id = f.full_doctor_id 
where v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') and v.target_pos_id &gt;99999 
and v.target_pos_id &lt;&gt;400000</Sql>
            </Query>
            <Query>
              <Sql>zapros10(from_age,for_age) SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id =t.dan_id 
WHERE v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL AND v.mesto_obs IN ('Д', 'А')  
AND v.target_pos_id &gt;99999 AND v.doctor_id=:fd_id: and v.target_pos_id &lt;&gt;400000 
AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 
from_age AND for_age;</Sql>
            </Query>
            <Query>
              <Sql>zapros11 SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
WHERE  v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL AND t.vid_oplat_id in (0, 3) 
AND v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
AND v.doctor_id=:fd_id:</Sql>
            </Query>
            <Query>
              <Sql>zapros12(param) SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
WHERE  v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL AND t.vid_oplat_id =  param 
AND v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
AND v.doctor_id=:fd_id:</Sql>
            </Query>
            <Query>
              <Sql>zapros13 select 'Отчёт за '||date_to_char(':period_1_:'::date,'rusMonth') as dd</Sql>
            </Query>
            <Query>
              <Sql>zapros14 select sum(c1) as c1, sum(c2) as c2, sum(c3) as c3, sum(c4) as c4, sum(c5) as c5, sum(c6) as c6, 
sum(c7) as c7, sum(c8) as c8, sum(c9) as c9, sum(c10) as c10, sum(c11) as c11, sum(c12) as c12, 
sum(c13) as c13, sum(c14) as c14, sum(c15) as c15, sum(c16) as c16, sum(c17) as c17 
from ( 
select 
case when v.mesto_obs = 'П' then 1 else 0 end as c1, 
case when v.mesto_obs = 'П' AND d.cityzen=0 then 1 else 0 end as c2, 
case when v.mesto_obs = 'П' AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c3, 
case when v.mesto_obs = 'П' AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c4, 
case when v.mesto_obs = 'П' AND v.target_pos_id IN (100000,200000,300000) then 1 else 0 end as c5, 
case when v.mesto_obs = 'П' AND v.target_pos_id IN (100000,200000,300000) 
    AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c6, 
case when v.mesto_obs = 'П' AND v.target_pos_id IN (100000,200000,300000) 
    AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c7, 
case when DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 35 AND 54 then 1 else 0 end as c8, 
case when v.mesto_obs = 'П' AND v.target_pos_id in (200000) then 1 else 0 end as c9, 
case when v.mesto_obs = 'П' AND v.target_pos_id in (100000) then 1 else 0 end as c10, 
case when mesto_obs IN ('Д', 'А') then 1 else 0 end as c11, 
case when mesto_obs IN ('Д', 'А') AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c12, 
case when mesto_obs IN ('Д', 'А') AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c13, 
case when t.vid_oplat_id in (0, 3) then 1 else 0 end as c14, 
case when t.vid_oplat_id = 1 then 1 else 0 end as c15, 
case when t.vid_oplat_id = 2 then 1 else 0 end as c16, 
case when t.vid_oplat_id = 5 then 1 else 0 end as c17 
 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
where v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL AND v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
) q</Sql>
            </Query>
            <Query>
              <Sql>zapros15 select sum(c1) as c1, sum(c2) as c2, sum(c3) as c3, sum(c4) as c4, sum(c5) as c5, sum(c6) as c6, 
sum(c7) as c7, sum(c8) as c8, sum(c9) as c9, sum(c10) as c10, sum(c11) as c11, sum(c12) as c12, 
sum(c13) as c13, sum(c14) as c14, sum(c15) as c15 
from ( 
select 
case when v.mesto_obs = 'П' then 1 else 0 end as c1, 
case when v.mesto_obs = 'П' AND d.cityzen=0 then 1 else 0 end as c2, 
case when v.mesto_obs = 'П' AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c3, 
case when v.mesto_obs = 'П' AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c4, 
case when v.mesto_obs = 'П' AND t.diag_osn&lt;&gt;'Z71.8' then 1 else 0 end as c5, 
case when v.mesto_obs = 'П' AND t.diag_osn&lt;&gt;'Z71.8' 
    AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c6, 
case when v.mesto_obs = 'П' AND t.diag_osn&lt;&gt;'Z71.8' 
    AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c7, 
case when DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 35 AND 54 then 1 else 0 end as c8, 
 
case when mesto_obs IN ('Д', 'А') then 1 else 0 end as c9, 
case when mesto_obs IN ('Д', 'А') AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c10, 
case when mesto_obs IN ('Д', 'А') AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c11, 
case when t.vid_oplat_id in (0, 3) then 1 else 0 end as c12, 
case when t.vid_oplat_id = 1 then 1 else 0 end as c13, 
case when t.vid_oplat_id = 2 then 1 else 0 end as c14, 
case when t.vid_oplat_id = 5 then 1 else 0 end as c15 
 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
where v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL AND v.target_pos_id =400000 
) q</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
WHERE v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL AND v.mesto_obs = 'П' and v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
and v.doctor_id = :fd_id:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
WHERE v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL AND v.mesto_obs = 'П'  and v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
AND d.cityzen=0 AND v.doctor_id=:fd_id:</Sql>
            </Query>
            <Query>
              <Sql>zapros4(from_age,for_age) SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
WHERE v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL AND v.mesto_obs = 'П' 
AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 
from_age AND for_age and v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
AND v.doctor_id=:fd_id:</Sql>
            </Query>
            <Query>
              <Sql>zapros5 SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
WHERE v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL AND v.mesto_obs = 'П' 
AND v.target_pos_id IN (100000,200000,300000) 
AND v.doctor_id=:fd_id:</Sql>
            </Query>
            <Query>
              <Sql>zapros6(from_age,for_age) SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
WHERE v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL AND v.mesto_obs = 'П' 
AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 
from_age AND for_age  AND v.target_pos_id in (100000,200000,300000) 
AND v.doctor_id=:fd_id:</Sql>
            </Query>
            <Query>
              <Sql>zapros7(parametr) SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
WHERE v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND v.mesto_obs = 'П' AND v.target_pos_id in (parametr) AND 
v.doctor_id=:fd_id:</Sql>
            </Query>
            <Query>
              <Sql>zapros8 SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
WHERE v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL and v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
AND mesto_obs IN ('Д', 'А')  AND 
v.doctor_id=:fd_id:</Sql>
            </Query>
            <Query>
              <Sql>zapros9 SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
WHERE v.data_pos between date(':period_1_:') and (':period_1_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL and v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
and v.doctor_id = :fd_id: 
AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 
35 AND 54</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период c:" Type="date">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="9000000" Name="ВЕДОМОСТЬ учета врачебных посещений в амбулаторно-поликлинических учреждениях, на дому (Форма 39/у-02)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты для онкодиспансера\ВЕДОМОСТЬ учета врачебных посещений в амбулаторно-поликлинических учреждениях, на дому (Форма 39_у-02).xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT ':period_1_:'::date + f.a AS p1 FROM generate_series(0,31) as f(a) 
WHERE ':period_1_:'::date + f.a &lt; ':period_1_:'::date+interval '1 month';</Sql>
            </Query>
            <Query>
              <Sql>zapros10(from_age,for_age) SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id =t.dan_id 
WHERE v.data_pos=date(':p1:')  
AND t.result_id IS NOT NULL AND v.mesto_obs IN ('Д', 'А')  
AND v.target_pos_id &gt;99999  and v.target_pos_id &lt;&gt;400000 
AND v.doctor_id=:doctor_1_: 
AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN from_age AND for_age;</Sql>
            </Query>
            <Query>
              <Sql>zapros12 SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
WHERE  v.data_pos=date(':p1:') 
AND t.result_id IS NOT NULL AND t.vid_oplat_id in (0, 3) AND v.doctor_id=:doctor_1_: 
AND v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000;</Sql>
            </Query>
            <Query>
              <Sql>zapros13(param) SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
WHERE  v.data_pos=date(':p1:') 
AND t.result_id IS NOT NULL AND t.vid_oplat_id =  param AND v.doctor_id=:doctor_1_: 
AND v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000;</Sql>
            </Query>
            <Query>
              <Sql>zapros14 SELECT full_doctor_id::text||' '||fio||' - '||dolg_doctor FROM full_doctor_tab WHERE full_doctor_id=:doctor_1_:;</Sql>
            </Query>
            <Query>
              <Sql>zapros15 select date_to_char(':period_1_:'::date,'rusMonth')||' г.' as dd;</Sql>
            </Query>
            <Query>
              <Sql>zapros16 select sum(c1) as c1, sum(c2) as c2, sum(c3) as c3, sum(c4) as c4, sum(c5) as c5, sum(c6) as c6, 
sum(c7) as c7, sum(c8) as c8, sum(c9) as c9, sum(c10) as c10, sum(c11) as c11, sum(c12) as c12, 
sum(c13) as c13, sum(c14) as c14, sum(c15) as c15, sum(c16) as c16, sum(c17) as c17 
from ( 
select 
case when v.mesto_obs = 'П' then 1 else 0 end as c1, 
case when v.mesto_obs = 'П' AND d.cityzen=0 then 1 else 0 end as c2, 
case when v.mesto_obs = 'П' AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c3, 
case when v.mesto_obs = 'П' AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c4, 
case when v.mesto_obs = 'П' AND v.target_pos_id IN (100000,200000,300000) then 1 else 0 end as c5, 
case when v.mesto_obs = 'П' AND v.target_pos_id IN (100000,200000,300000) 
    AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c6, 
case when v.mesto_obs = 'П' AND v.target_pos_id IN (100000,200000,300000) 
    AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c7, 
case when DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 35 AND 54 then 1 else 0 end as c8, 
case when v.mesto_obs = 'П' AND v.target_pos_id in (200000) then 1 else 0 end as c9, 
case when v.mesto_obs = 'П' AND v.target_pos_id in (100000) then 1 else 0 end as c10, 
case when mesto_obs IN ('Д', 'А') then 1 else 0 end as c11, 
case when mesto_obs IN ('Д', 'А') AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c12, 
case when mesto_obs IN ('Д', 'А') AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c13, 
case when t.vid_oplat_id in (0, 3) then 1 else 0 end as c14, 
case when t.vid_oplat_id = 1 then 1 else 0 end as c15, 
case when t.vid_oplat_id = 2 then 1 else 0 end as c16, 
case when t.vid_oplat_id = 5 then 1 else 0 end as c17 
 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
where t.result_id IS NOT NULL AND v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
and v.doctor_id=:doctor_1_: 
) q;</Sql>
            </Query>
            <Query>
              <Sql>zapros17 select sum(c1) as c1, sum(c2) as c2, sum(c3) as c3, sum(c4) as c4, sum(c5) as c5, sum(c6) as c6, 
sum(c7) as c7, sum(c8) as c8, sum(c9) as c9, sum(c10) as c10, sum(c11) as c11, sum(c12) as c12, 
sum(c13) as c13, sum(c14) as c14, sum(c15) as c15 
from ( 
select 
case when v.mesto_obs = 'П' then 1 else 0 end as c1, 
case when v.mesto_obs = 'П' AND d.cityzen=0 then 1 else 0 end as c2, 
case when v.mesto_obs = 'П' AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c3, 
case when v.mesto_obs = 'П' AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c4, 
case when v.mesto_obs = 'П' AND t.diag_osn&lt;&gt;'Z71.8' then 1 else 0 end as c5, 
case when v.mesto_obs = 'П' AND t.diag_osn&lt;&gt;'Z71.8' 
    AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c6, 
case when v.mesto_obs = 'П' AND t.diag_osn&lt;&gt;'Z71.8' 
    AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c7, 
case when DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 35 AND 54 then 1 else 0 end as c8, 
 
case when mesto_obs IN ('Д', 'А') then 1 else 0 end as c9, 
case when mesto_obs IN ('Д', 'А') AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 0 AND 17 then 1 else 0 end as c10, 
case when mesto_obs IN ('Д', 'А') AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 60 AND 1000 then 1 else 0 end as c11, 
case when t.vid_oplat_id in (0, 3) then 1 else 0 end as c12, 
case when t.vid_oplat_id = 1 then 1 else 0 end as c13, 
case when t.vid_oplat_id = 2 then 1 else 0 end as c14, 
case when t.vid_oplat_id = 5 then 1 else 0 end as c15 
 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
where t.result_id IS NOT NULL AND v.target_pos_id =400000 
and v.doctor_id=:doctor_1_: 
) q;</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
WHERE v.data_pos=date(':p1:')	AND 
t.result_id IS NOT NULL AND v.mesto_obs = 'П' 
AND v.doctor_id=:doctor_1_: 
and v.target_pos_id &gt;99999 
and v.target_pos_id &lt;&gt;400000;</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
WHERE v.data_pos=date(':p1:')	 
AND t.result_id IS NOT NULL AND v.mesto_obs = 'П' 
AND d.cityzen=0 AND v.doctor_id=:doctor_1_: 
and v.target_pos_id &gt;99999 
and v.target_pos_id &lt;&gt;400000;</Sql>
            </Query>
            <Query>
              <Sql>zapros4(from_age,for_age) SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
WHERE v.data_pos=date(':p1:') 
AND t.result_id IS NOT NULL AND v.mesto_obs = 'П' 
AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 
from_age AND for_age 
AND v.doctor_id=:doctor_1_: 
and v.target_pos_id &gt;99999 
and v.target_pos_id &lt;&gt;400000;</Sql>
            </Query>
            <Query>
              <Sql>zapros5 SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
WHERE v.data_pos=date(':p1:') 
AND t.result_id IS NOT NULL AND v.mesto_obs = 'П' 
AND v.target_pos_id IN (100000,200000,300000) 
and v.doctor_id=:doctor_1_:;</Sql>
            </Query>
            <Query>
              <Sql>zapros6(from_age,for_age) SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
WHERE v.data_pos=date(':p1:') 
AND t.result_id IS NOT NULL AND v.mesto_obs = 'П' 
AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 
from_age AND for_age AND v.target_pos_id IN (100000,200000,300000)  AND 
v.doctor_id=:doctor_1_:;</Sql>
            </Query>
            <Query>
              <Sql>zapros7(parametr) SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
WHERE v.data_pos=date(':p1:') AND t.result_id IS NOT NULL 
AND v.mesto_obs = 'П' AND v.target_pos_id in (parametr) AND 
v.doctor_id=:doctor_1_:;</Sql>
            </Query>
            <Query>
              <Sql>zapros8 SELECT CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END FROM visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
WHERE v.data_pos=date(':p1:') AND t.result_id IS NOT NULL 
AND mesto_obs IN ('Д', 'А')  AND 
v.doctor_id=:doctor_1_: 
and v.target_pos_id &gt;99999 
and v.target_pos_id &lt;&gt;400000;</Sql>
            </Query>
            <Query>
              <Sql>zapros9 SELECT  CASE WHEN count(*)&gt;0 THEN count(*)::text ELSE '' END  FROM visit_tab v 
LEFT JOIN  talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
WHERE v.data_pos=date(':p1:') 
AND t.result_id IS NOT NULL and v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
and v.doctor_id =:doctor_1_: 
AND DATE_PART('year',AGE(data_pos, date_born)) BETWEEN 
35 AND 54;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="doctor" Caption="Врач:" Type="select">
              <Sql>SELECT full_doctor_id, full_doctor_id::text||' '||fio||' - '||dolg_doctor FROM full_doctor_tab ORDER BY full_doctor_id;</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период c:" Type="date">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="9200000" Name="Распределение посещений по районам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты для онкодиспансера\Распределение посещений по районам.xls">
          <Queries>
            <Query>
              <Sql>zapros0 select name as p1, trim(socr) as p2, substr(code,1,3)||'%' as p3, substr(code,1,8)||'%' as p4 
from kladr_tab where (trim(socr)='р-н' or trim(socr)='г') and code like '700%' 
order by socr desc,name asc</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT full_doctor_id::text||' '||fio||' - '||dolg_doctor FROM full_doctor_tab WHERE full_doctor_id=:doctor_1_:;</Sql>
            </Query>
            <Query>
              <Sql>zapros2 select 'Отчёт за '||date_to_char(':per_1_:'::date,'rusMonth')||' г.' as dd;</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select 
count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
where t.result_id IS NOT NULL AND v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
and v.doctor_id=:doctor_1_: 
and (d.street_id like ':p4:' or d.region_id like ':p4:' or d.town_id like ':p4:' or d.street_id like ':p4:')</Sql>
            </Query>
            <Query>
              <Sql>zapros4 select 
count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
where t.result_id IS NOT NULL AND v.target_pos_id =400000 
and v.doctor_id=:doctor_1_: 
and (d.street_id like ':p4:' or d.region_id like ':p4:' or d.town_id like ':p4:' or d.street_id like ':p4:')</Sql>
            </Query>
            <Query>
              <Sql>zapros5 select 
count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
where t.result_id IS NOT NULL AND v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
and v.doctor_id=:doctor_1_: 
and not (d.street_id like '700%' or d.region_id like '700%' or d.town_id like '700%' or d.street_id like '700%') 
---and not (d.street_id like ':p3:' or d.region_id like ':p3:' or d.town_id like ':p3:' or d.street_id like ':p3:')</Sql>
            </Query>
            <Query>
              <Sql>zapros6 select 
count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
where t.result_id IS NOT NULL AND v.target_pos_id=400000 
and v.doctor_id=:doctor_1_: 
and not (d.street_id like '700%' or d.region_id like '700%' or d.town_id like '700%' or d.street_id like '700%')</Sql>
            </Query>
            <Query>
              <Sql>zapros7 select 
count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
where t.result_id IS NOT NULL AND v.target_pos_id &gt;99999 and v.target_pos_id &lt;&gt;400000 
and v.doctor_id=:doctor_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros8 select 
count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
where t.result_id IS NOT NULL AND v.target_pos_id=400000 
and v.doctor_id=:doctor_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="per" Caption="Начало периода" Type="date">
              <Sql />
            </Parameter>
            <Parameter Name="doctor" Caption="Врач" Type="select">
              <Sql>SELECT full_doctor_id, full_doctor_id::text||' '||fio||' - '||dolg_doctor FROM full_doctor_tab ORDER BY full_doctor_id;</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="13200000" Name="Реестр региональных льготников (файл 1) (онко)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты для онкодиспансера\Реестр региональных льготников (файл 1) (онко).xls">
          <Queries>
            <Query>
              <Sql>filename select 'p'||value||'_01'|| 
(case when date_part('month',date(':param1_1_:'))::integer&lt;10 then '0'||date_part('month',date(':param1_1_:'))::text else 
date_part('month',date(':param1_1_:'))::text end)|| 
date_part('year',date(':param1_1_:'))  from settings_tab where name = 'LPU_ID'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT DISTINCT CASE WHEN (length(trim(d.pens)) != 14 OR d.pens IS NULL OR d.pens ilike '%X%') THEN 
substr(lpad(d.dan_id::text, 11,'0'),1,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),4,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),7,3)||' '||substr(lpad(d.dan_id::text, 11,'0'),10,2) 
ELSE d.pens end as ss, 
CASE WHEN (length(trim(d.pens)) != 14 OR d.pens IS NULL OR d.pens ilike '%X%') THEN 0 
ELSE 1 end as ss_ist, 
d.ser_pol||' '||d.num_pol as SN_POL, d.fam as FAM, d.nam as IM, d.mid as ot , MYUPPER(d.sex) as W, 
d.date_born as DR, 
d.serdoc||' '||d.numdoc as SN_DOC, d.vid_doc_id as С_DOC, 
d.address as ADRES, 
COALESCE(k1.kod_region,k2.kod_region,k3.kod_region,k4.kod_region) as OKATO_REG, 
1 as S_EDV , d.dan_id as patient_id 
  FROM dan_tab d 
 LEFT JOIN kladr_tab k1 ON k1.code = d.punkt_id 
 LEFT JOIN kladr_tab k2 ON k2.code = d.town_id 
 LEFT JOIN kladr_tab k3 ON k3.code = d.raion_id 
 LEFT JOIN kladr_tab k4 ON k4.code = d.region_id 
LEFT JOIN fed_lgota_tab f ON f.dan_id = d.dan_id    AND f.pens &lt;&gt; 'XXX-XXX-XXX XX'  
WHERE d.dan_id IN 
( 
SELECT disp.dan_id FROM dispan_uchet_tab disp 
WHERe disp.lgota_id is not null AND (disp.date_sn IS NULL OR disp.date_sn &gt; ':param1_1_:') 
)  AND f.dan_id is null and d.town_id != '7000000300000'</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT disp.date as DB_EDV, 
/*CASE WHEN disp.date_sn IS NULL THEN date('01.01.2999') ELSE */ 
disp.date_sn /*END*/ as DE_EDV, 
disp.date  as DATE_RSB 
 
FROm dispan_uchet_tab disp 
WHERE disp.dan_id = :patient_id: 
AND disp.lgota_id is not null AND (disp.date_sn IS NULL OR disp.date_sn &gt; ':param1_1_:') 
ORDER BY disp.date_sn DESC, disp.date DESC 
LIMIT 1 OFFSET 0</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT value::char(4) FROM settings_tab WHERE name = 'LPU_ID'</Sql>
            </Query>
            <Query>
              <Sql>zapros4 SELECT value::char(13) FROM settings_tab WHERE name = 'OGRN'</Sql>
            </Query>
            <Query>
              <Sql>zapros5 select 
case when sost=0 or sost is null then 2 else 
   case when min_disp&lt;date(':param1_1_:')-interval '40 days' and min_dan&lt;date(':param1_1_:')-interval '40 days' 
   and max_disp&lt;date(':param1_1_:')-interval '40 days' and max_dan&lt;date(':param1_1_:')-interval '40 days' 
   then 0 
        when min_disp&gt;date(':param1_1_:')-interval '40 days' and min_dan&gt;date(':param1_1_:')-interval '40 days' 
   and max_disp&gt;date(':param1_1_:')-interval '40 days' and max_dan&gt;date(':param1_1_:')-interval '40 days' 
   then 1 
   else 3 end end as u_type, '000' as D_TYPE 
from ( 
 SELECT min(disp.date_vnes_inf) as  min_disp,min(d.date_vnes_inf) as min_dan, 
 max(disp.date_vnes_inf) as max_disp,max(d.date_vnes_inf) as max_dan, 
 SUM(CASE WHEN disp.leave_date IS NULL OR disp.leave_date &gt; ':param1_1_:' THEN 1 ELSE 0 END) as sost 
 
FROm dispensary_registration_tab disp 
LEFT jOIN dan_tab d On d.dan_id = disp.dan_id 
LEFT JOIN fed_lgota_tab f ON f.dan_id = d.dan_id    AND f.pens &lt;&gt; 'XXX-XXX-XXX XX'  
WHERE disp.dan_id = :patient_id: AND f.dan_id is null 
AND disp.lgota_id is not null and d.town_id != '7000000300000' ) as f</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="13400000" Name="Реестр региональных льготников (файл 2) (онко)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты для онкодиспансера\Реестр региональных льготников (файл 2) (онко).xls">
          <Queries>
            <Query>
              <Sql>filename select 'l'||value||'_01'|| 
(case when date_part('month',date(':param1_1_:'))::integer&lt;10 then '0'||date_part('month',date(':param1_1_:'))::text else 
date_part('month',date(':param1_1_:'))::text end)|| 
date_part('year',date(':param1_1_:'))  from settings_tab where name = 'LPU_ID'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT DISTINCT CASE WHEN (length(trim(d.pens)) != 14 OR d.pens IS NULL OR d.pens ilike '%X%')  THEN 
substr(get_lpu_number(),2,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),4,3)||'-'||substr(lpad(d.dan_id::text, 11,'0'),7,3)||' '||substr(lpad(d.dan_id::text, 11,'0'),10,2) 
ELSE d.pens end as ss, 
'9'||(disp.lgota_id) as C_KAT, 
s.sp_lgot_doc_type as name_dl, 
disp.ser_lgot_doc||' '||disp.num_lgot_doc as SN_DL, 
disp.date as DATE_BL , 
/*CASE WHEN disp.date_sn IS NULL THEN date('01.01.2999') ELSE */ 
disp.date_sn /*END*/ as DATE_EL 
FROm dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
LEFT JOIN sp_lgot_doc_type_tab s ON s.sp_lgot_doc_type_id = disp.sp_lgot_doc_type_id 
LEFT JOIN fed_lgota_tab f ON f.dan_id = d.dan_id AND f.pens &lt;&gt; 'XXX-XXX-XXX XX'  
WHERE disp.lgota_id is not null AND d.dan_id is not null 
AND (disp.date_sn IS NULL OR disp.date_sn &lt; now()) 
AND f.dan_id is null and d.town_id != '7000000300000' 
ORDER BY 1,2,3,4</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT value::char(4) FROM settings_tab WHERE name = 'LPU_ID'</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Реестры для Областного бюро мед. статистики">
      <Reports>
        <Report Id="7100000" Name="Гипертония" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры для Областного бюро мед. статистики\Гипертония.xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'ag'||value::Text FROM settings_tab 
WHERE name = 'LPU_NUMBER' LIMIT 1;</Sql>
            </Query>
            <Query>
              <Sql>zapros_const select dan_id, obrazovanie, professia, rost, parents_im, parents_mi, perehod_epicriz, date(now()::text) as date_input,'' as "NULL" from con_param_ag_tab</Sql>
            </Query>
            <Query>
              <Sql>zapros_dan select 
dan_id, substr(s.value,length(s.value)-2,3)||lpad(dan_id::text,6,'0') as kod_pt,col0, pens, fam, nam, mid, date_born, 
sex, q1.name, serdoc, numdoc,reg,kod_oms,uchactok_id,street,dom, kv,locale, num_pol,strcom_id, 
kod_oms2, col1, col2, col3, col4, korp, col5, lpu, col6,col7, col8, prik, ser_pol, sstomref, sspolref, 
col9, col10, col11, three, col12, address, one, col13, col14, col15, col16, col17, col18, col19, col20, col21, col22, 
col23, col24, mkb_inv,  '' as "NULL", date(now()::text) as date_input, 
col25, maxpreg, fio, telephon, date_prik 
from 
(select distinct 
dan_tab.dan_id, 
'' AS col0, 
replace(dan_tab.pens, ' ', '-') as pens, 
dan_tab.fam, dan_tab.nam, dan_tab.mid, dan_tab.date_born, 
case when dan_tab.sex='м' then 'Мужской' else 'Женский' end as sex, 
vid_doc_tab.name, serdoc, numdoc, 
    case when reg3.kod_region is not null then reg3.kod_region else reg2.kod_region end as reg, 
    reg2.kod_oms, 
    dan_tab.uchactok_id, 
    /*(select st.kod_oms from st_tab st where st.code=dan_tab.street_id limit 1)*/ st.kod_oms as street, 
    dan_tab.dom, dan_tab.kv, 
    case when cityzen=1 then 'Городская' else 'Сельская' end as locale, 
    dan_tab.num_pol,dan_tab.strcom_id, soz.kod_oms2, dan_tab.kodlg as col1, dan_tab.inval_id+3 as col2, 
    '' as col3, '' as col4, dan_tab.korp, dan_tab.mesto_work_id as col5, '$LPU_ID' as lpu, dan_tab.data_end as col6, 
    dan_tab.date_fluog as col7, dan_tab.risk_id as col8, 
    case when prikreplen is not null and prikreplen!=0 then current_date else NULL end as prik, 
    dan_tab.ser_pol, 
    trim(leading '0' from dan_tab.sstomref) as sstomref, 
    trim(leading '0' from dan_tab.swconref) as sspolref, 
    fakult_tab.name as col9, dan_tab.num_group as col10, '' as col11, '1' as three, 
    case when dan_tab.life=1 then 1 else 0 end as col12, dan_tab.address, 
    '1' as one, '' as col13,'' as col14,'' as col15,'' as col16,'' as col17,'' as col18,'' as col19,'' as col20, q2.ddt as col21,'' as col22, 
    '' as col23, 
    fed_lgota_tab.pens as col24, 
    0 as col25, 
    /*(select max(date_begin_preg) from pregnant_karta_tab where dan_id=dan_tab.dan_id)*/ '' as maxpreg, 
    CASE 
    WHEN dan_tab.mid IS NULL THEN ((dan_tab.fam::text || ' '::text) || substring(dan_tab.nam::text, 1, 1)) || '.'::text 
    ELSE ((((dan_tab.fam::text || ' '::text) || substring(dan_tab.nam::text, 1, 1)) || '.'::text) || 
    substring(dan_tab.mid::text, 1, 1)) || '.'::text 
    END AS fio , q2.kod_mkb as mkb_inv,dan_tab.telephon, prik_zayav_tab.date_prik 
from dan_tab 
--    left join codifiers.eq_region_kod_oms_tab reg on reg.code=dan_tab.region_id 
    left join kladr_tab reg3 on reg3.code=dan_tab.raion_id 
    left join kladr_tab /*codifiers.eq_region_kod_oms_tab*/ reg2 on reg2.code=dan_tab.town_id 
    left join codifiers.eq_street_kod_oms_tab /*st_tab*/ st on st.code=dan_tab.street_id 
    left join vid_doc_tab on vid_doc_tab.vid_doc_id=dan_tab.vid_doc_id 
    left join sozstatus_tab soz on soz.sozstatus_id=dan_tab.sozstatus_id 
    left join fakult_tab on fakult_tab.kod_fak=dan_tab.kod_fak	 
    left join fed_lgota_tab on fed_lgota_tab.dan_id = dan_tab.dan_id and fed_lgota_tab.pens  ilike '%ОТКАЗ ОТ ДЛО%' 
    left join prik_zayav_tab on prik_zayav_tab.dan_id = dan_tab.dan_id 
    left join talon_tab on talon_tab.dan_id = dan_tab.dan_id and dan_tab.inval_id is not null 
    left join 
    (select qq.dan_id, qq.ddt, inval_client_tab.talon_id, inval_client_tab.kod_mkb 
    from inval_client_tab join talon_tab on talon_tab.talon_id = inval_client_tab.talon_id 
    left join dan_tab on talon_tab.dan_id = dan_tab.dan_id , 
    (select dan_tab.dan_id, max(date_change) as ddt from inval_client_tab join talon_tab on talon_tab.talon_id = inval_client_tab.talon_id 
    left join dan_tab on talon_tab.dan_id = dan_tab.dan_id where dan_tab.dan_id = 26467 group by dan_tab.dan_id 
    ) qq 
    where inval_client_tab.date_change = qq.ddt and dan_tab.dan_id = qq.dan_id 
    ) as q2 ON q2.dan_id = dan_tab.dan_id 
    where dan_tab.dan_id in (SELECT dan_id FROM dispan_uchet_tab WHERE diagn_id between 'I10' and 'I15.9' and 
(date_sn&gt;':param1_2_:' or date_sn is null)) 
 
) as q1, settings_tab s 
where s.name = 'LPU_ID'</Sql>
            </Query>
            <Query>
              <Sql>zapros_diagn select diagn_tab.oid, min(visit_tab.visit_id) as minvisit, diagn_tab.diagn_osn, 
case when diagn_tab.diagn_osn like 'Z%' then 2 when diagn_tab.otmet='Х' then 1 else 0 end as "CASE_KOD", '1' as "DISP_TYPE", '4' as "DISP_END_REASON" 
,  '' as "NULL", date(now()::text) as date_input, 
'', '', '0' as "ZERO", dispan_uchet_tab.date_next, '', 
'', '1' as one, '0', '0', diagn_tab.DAN_ID from diagn_tab 
left join visit_tab on visit_tab.talon_id=diagn_tab.talon_id 
left join dispan_uchet_tab on diagn_tab.DAN_ID=dispan_uchet_tab.DAN_ID AND dispan_uchet_tab.diagn_id=diagn_tab.diagn_osn AND DATE_SN Is NULL 
where diagn_tab.dan_id in (SELECT dan_id FROM dispan_uchet_tab WHERE diagn_id between 'I10' and 'I15.9' and 
(date_sn&gt;':param1_2_:' or date_sn is null)) and diagn_tab.talon_id=visit_tab.talon_id 
and visit_tab.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:') 
   group by visit_tab.visit_id, diagn_tab.oid, diagn_tab.diagn_osn, dispan_uchet_tab.date_next, diagn_tab.otmet, diagn_tab.dan_id</Sql>
            </Query>
            <Query>
              <Sql>zapros_disp select dispan_uchet_tab.oid, dispan_uchet_tab.dan_id, dispan_uchet_tab.doctor_id, spec, diagn_id, MAX(VISIT_TAB.DATA_POS) as max_vis, date(now()::text) as date_input, 
dispan_uchet_tab.date_next, date, date_sn, case when prichin_sn_id&gt;0 then (prichin_sn_id-1) else -1 end AS C, '' as "NULL" , local_lgota_tab.lgota 
               from dispan_uchet_tab 
                LEFT JOIN TALON_TAB ON dispan_uchet_tab.DAN_ID=TALON_TAB.DAN_ID 
                LEFT JOIN VISIT_TAB ON VISIT_TAB.TALON_ID=TALON_TAB.TALON_ID 
                LEFT JOIN DIAGN_TAB ON DIAGN_TAB.TALON_ID=TALON_TAB.TALON_ID 
                LEFT JOIN LOCAL_LGOTA_TAB ON LOCAL_LGOTA_TAB.DAN_ID = DISPAN_UCHET_TAB.DAN_ID 
	      	    where diagn_id between 'I10' and 'I15.9' and (date_sn&gt;':param1_2_:' or date_sn is null) 
	      	    
                group by dispan_uchet_tab.oid, dispan_uchet_tab.dan_id, dispan_uchet_tab.doctor_id, spec, diagn_id, C, dispan_uchet_tab.date_next, date, date_sn,local_lgota_tab.lgota</Sql>
            </Query>
            <Query>
              <Sql>zapros_drug select oid, dan_id, kod_minzd, signa, '1' as drug_from_doctor, date_begin, date_end, snizhenie_ad,  date(now()::text) as date_input,'' as "NULL" from ag_vipis_preparat_tab 
where ag_vipis_preparat_tab.dan_id in (SELECT dan_id FROM dispan_uchet_tab WHERE diagn_id between 'I10' and 'I15.9' and 
(date_sn&gt;':param1_2_:' or date_sn is null))</Sql>
            </Query>
            <Query>
              <Sql>zapros_hosp SELECT ag_hosp_id, amount, dan_id,diagn_osn,date_hosp,date(now()::text) as date_input,  '' as "NULL" FROM  ag_hosp_tab 
where ag_hosp_tab.dan_id in (SELECT dan_id FROM dispan_uchet_tab WHERE diagn_id between 'I10' and 'I15.9' and 
(date_sn&gt;':param1_2_:' or date_sn is null))</Sql>
            </Query>
            <Query>
              <Sql>zapros_inval SELECT distinct inval_client_tab.talon_id, talon_tab.dan_id,inval_client_tab.date_change,inval_client_tab.kod_mkb, 
case 
when inval_client_tab."current" =4 then 'дети-инвалиды' 
when inval_client_tab."current"=0 then '' 
else inval_client_tab."current"::text||'-ая группа' 
end as invalid_gr, date(now()::text) as date_input, '' as "NULL" 
 
from inval_client_tab join talon_tab on inval_client_tab.talon_id = talon_tab.talon_id 
where talon_tab.dan_id in (SELECT dan_id FROM dispan_uchet_tab WHERE diagn_id between 'I10' and 'I15.9' and 
(date_sn&gt;':param1_2_:' or date_sn is null))</Sql>
            </Query>
            <Query>
              <Sql>zapros_visit select visit_tab.visit_id, 
talon_tab.dan_id, 
data_pos, 
target_pos_id, 
'1' as col0, 
(talon_tab.vid_oplat_id+1) as col1, 
visit_tab.doctor_id, 
'0' as col2, 
talon_tab.result_id, 
'' as col3, 
'' as col4, 
'-1' as col5, 
'-1' as col6, 
'0' as col7, 
'' as col8, 
'' as col9, 
talon_tab.num_pol, 
talon_tab.strcom_id, 
'' as col10, 
'999999' as col11, 
'0' as col12, 
'1' as col13, 
visit_tab.data_vnes_inf, 
talon_tab.ser_pol, 
visit_tab.blood_high, 
visit_tab.blood_low,  '' as "NULL", 
case when ag_visit_data_tab.visit_id is null then 0 else 1 end  as col14, 
'' as col15, 
dolg_doctor||' ('||spec_doctor_tab.dolg_doctor_id||') '||dan_tab.fam||' '||dan_tab.nam||' '||dan_tab.mid as col16, 
spec_doctor_tab.dolg_doctor_id, 
'' as col17/*, 
'' as col18, 
case when pregnant_visit_tab.visit_id is null then 0 else 1 end as col19, 
blist_tab.ser, 
blist_tab.nomer */ 
from visit_tab 
	left join talon_tab on talon_tab.talon_id=visit_tab.talon_id 
	left join ag_visit_data_tab on ag_visit_data_tab.visit_id=visit_tab.visit_id 
	left join pregnant_visit_tab on pregnant_visit_tab.visit_id=visit_tab.visit_id 
	left join spec_doctor_tab on spec_doctor_tab.kod_doctor=visit_tab.doctor_id 
	left join dolg_doctor_tab on spec_doctor_tab.dolg_doctor_id=dolg_doctor_tab.dolg_doctor_id 
    left join doctor_tab on spec_doctor_tab.doctor_id=doctor_tab.doctor_id 
    left join dan_tab on dan_tab.dan_id=doctor_tab.dan_id 
    left join blist_tab on blist_tab.talon_id=talon_tab.talon_id 
where talon_tab.dan_id in (SELECT dan_id FROM dispan_uchet_tab WHERE diagn_id between 'I10' and 'I15.9' and 
(date_sn&gt;':param1_2_:' or date_sn is null)) 
    and visit_tab.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros_visit_ag select 
 visit_tab.visit_id,  '' as "NULL", 
 ag_visit_data_tab.dan_id, 
 visit_tab.data_pos, 
 kod_doctor, 
 f.floga as col0, 
 diagn, 
 '' as col1, 
 '' as col2, 
 '' as col3, 
 '' as col4, 
 '' as col5, 
 weight, 
 weight_index, 
 dream_for_day, 
 head_ache, 
 golovokruzh, 
 mushki_in_eyes, 
 stenocardia, 
 serdcebien, 
 odishka, 
 oteci_in_legs, 
 boli_in_legs, 
 other, 
 kurenie, 
 alcogol_frequency, 
 drink_beer, 
 quantity_beer, 
 drink_wine_dry, 
 quantity_wine_dry, 
 drink_wine_fortified, 
 quantity_wine_fortified, 
 drink_vodka, 
 quantity_vodka, 
 phisical_activ, 
 level_stress, 
 holesterin1, 
 holestirin2, 
 diabet, 
 atero_scleroz_kr_sosud, 
 proterinurya, 
 suzhenie_sos_setchat, 
 gipertrof_left_zhelud, 
 cereb_vascul_zabol, 
 zabolev_heart, 
 zabolev_sosud, 
 zabolev_pochek, 
 retinopatiya, 
 stepen_risk, 
 sanator_this_year, 
 skl_po_giperton, 
 school_health, date(now()::text) as date_input, 
 not_enough_blood, 
 '' as col6 
 from ag_visit_data_tab 
 	left join visit_tab on ag_visit_data_tab.visit_id=visit_tab.visit_id 
	left join fed_lgota_tab f on ag_visit_data_tab.dan_id = f.dan_id 
    where visit_tab.data_vnes_inf 
    between date(':param1_1_:') and date (':param1_2_:') 
and ag_visit_data_tab .dan_id in (SELECT dan_id FROM dispan_uchet_tab WHERE diagn_id between 'I10' and 'I15.9' and 
(date_sn&gt;':param1_2_:' or date_sn is null))</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select oid, dan_id, date_oslozh, diagn, call_med_help, date(now()::text) as date_input, '' as "NULL" from ag_oslozh_tab 
where ag_oslozh_tab.dan_id in (SELECT dan_id FROM dispan_uchet_tab WHERE diagn_id between 'I10' and 'I15.9' and 
(date_sn&gt;':param1_2_:' or date_sn is null))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="10200000" Name="Мозговой инсульт" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры для Областного бюро мед. статистики\Мозговой инсульт.xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'mi'||value::Text FROM settings_tab 
WHERE name = 'LPU_NUMBER' LIMIT 1;</Sql>
            </Query>
            <Query>
              <Sql>zapros_const select q.dan_id, education as obrazovanie, profession as professia, height as rost, 
nasl_im as parents_im, nasl_mi as parents_mi, 
epikriz as perehod_epicriz, date(now()::text) as date_input,'' as "NULL" from 
const_params_tab c, 
(select distinct d.dan_id from visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=3 --мозговой инсульт 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date(':param1_2_:')) q 
where q.dan_id = c.dan_id</Sql>
            </Query>
            <Query>
              <Sql>zapros_dan select 
dan_id, substr(s.value,length(s.value)-2,3)||lpad(dan_id::text,6,'0') as kod_pt,col0, pens, fam, nam, mid, date_born, 
sex, q1.name, serdoc, numdoc,reg,kod_oms,uchactok_id,street,dom, kv,locale, num_pol,strcom_id, 
kod_oms2, col1, col2, col3, col4, korp, col5, lpu, col6,col7, col8, prik, ser_pol, sstomref, sspolref, 
col9, col10, col11, three, col12, address, one, col13, col14, col15, col16, col17, col18, col19, col20, col21, col22, 
col23, col24, mkb_inv,  '' as "NULL", date(now()::text) as date_input, 
col25, maxpreg, fio, telephon, date_prik 
from 
( 
select distinct 
q.dan_id, 
'' AS col0, 
replace(q.pens, ' ', '-') as pens, 
q.fam, q.nam, q.mid, q.date_born, 
case when q.sex='м' then 'Мужской' else 'Женский' end as sex, 
vid_doc_tab.name, serdoc, numdoc, 
    case when reg3.kod_region is not null then reg3.kod_region else reg2.kod_region end as reg, 
    reg2.kod_oms, 
    q.uchactok_id, 
    /*(select st.kod_oms from st_tab st where st.code=q.street_id limit 1)*/ st.kod_oms as street, 
    q.dom, q.kv, 
    case when cityzen=1 then 'Городская' else 'Сельская' end as locale, 
    q.num_pol,q.strcom_id, soz.kod_oms2, q.kodlg as col1, q.inval_id+3 as col2, 
    '' as col3, '' as col4, q.korp, q.mesto_work_id as col5, '$LPU_ID' as lpu, q.data_end as col6, 
    q.date_fluog as col7, q.risk_id as col8, 
    case when prikreplen is not null and prikreplen!=0 then current_date else NULL end as prik, 
    q.ser_pol, 
    trim(leading '0' from q.sstomref) as sstomref, 
    trim(leading '0' from q.swconref) as sspolref, 
    fakult_tab.name as col9, q.num_group as col10, '' as col11, '1' as three, 
    case when q.life=1 then 1 else 0 end as col12, q.address, 
    '1' as one, '' as col13,'' as col14,'' as col15,'' as col16,'' as col17,'' as col18,'' as col19,'' as col20, inval_client_tab.date_change as col21,'' as col22, 
    '' as col23, 
    fed_lgota_tab.pens as col24, 
    0 as col25, 
    '' as maxpreg, 
    CASE 
    WHEN q.mid IS NULL THEN ((q.fam::text || ' '::text) || substring(q.nam::text, 1, 1)) || '.'::text 
    ELSE ((((q.fam::text || ' '::text) || substring(q.nam::text, 1, 1)) || '.'::text) || 
    substring(q.mid::text, 1, 1)) || '.'::text 
    END AS fio , inval_client_tab.kod_mkb as mkb_inv,q.telephon, prik_zayav_tab.date_prik 
from 
(select 
d.dan_id, v.visit_id, blood_high, blood_low, result_id, d.ser_pol, d.num_pol, d.strcom_id,d.life,d.data_end,d.data_begin, 
v.data_vnes_inf, d.kod_fak, d.num_group, d.kod_vuz, t.pricpol, d.raion_id,d.town_id, d.punkt_id, d.vid_doc_id, 
d.street_id, d.dom, d.korp, d.kv, d.address, d.date_born, d.sex, d.telephon, d.metka_work,d.risk_id,d.pens, 
d.mest_work, d.mesto_work_id, d.fam, d.nam, d.mid, d.region_id, d.serdoc, d.numdoc, d.kodlg, d.katlg, 
d.cityzen, d.inval_id, d.prikreplen, d.date_fluog, d.swconref, d.sstomref,d.sozstatus_id, 
d.lpu_fluog, d.num_fluog, d.mse_num, d.mse_date_issue, d.mse_date_end, d.uchactok_id 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=3 --мозговой инсульт 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date(':param1_2_:')) q 
  --  left join kladr_tab reg on reg.code=q.region_id 
    left join kladr_tab reg3 on reg3.code=q.raion_id 
    left join kladr_tab reg2 on reg2.code=q.town_id 
    left join codifiers.eq_street_kod_oms_tab /*st_tab*/ st on st.code=q.street_id 
    left join vid_doc_tab on vid_doc_tab.vid_doc_id=q.vid_doc_id 
    left join sozstatus_tab soz on soz.sozstatus_id=q.sozstatus_id 
    left join fakult_tab on fakult_tab.kod_fak=q.kod_fak	 
    left join fed_lgota_tab on fed_lgota_tab.dan_id = q.dan_id and fed_lgota_tab.pens  ilike '%ОТКАЗ ОТ ДЛО%' 
    left join prik_zayav_tab on prik_zayav_tab.dan_id = q.dan_id 
    left join talon_tab on talon_tab.dan_id = q.dan_id and q.inval_id is not null 
    left join inval_client_tab on talon_tab.talon_id = inval_client_tab.talon_id 
 
) as q1, settings_tab s 
where s.name = 'LPU_ID'</Sql>
            </Query>
            <Query>
              <Sql>zapros_diagn select diagn_tab.oid, min(visit_tab.visit_id) as minvisit, diagn_tab.diagn_osn, diagn_tab.dan_id , 
case when diagn_tab.diagn_osn like 'Z%' then 2 when diagn_tab.otmet='Х' then 1 else 0 end as "CASE_KOD", '1' as "DISP_TYPE", '4' as "DISP_END_REASON" 
,  date(now()::text) as date_input,'' as "NULL", 
'', '', '0' as "ZERO", dispan_uchet_tab.date_next, '', 
'', '1' as one, '0', '0' from diagn_tab 
left join visit_tab on visit_tab.talon_id=diagn_tab.talon_id 
left join dispan_uchet_tab on diagn_tab.DAN_ID=dispan_uchet_tab.DAN_ID AND dispan_uchet_tab.diagn_id=diagn_tab.diagn_osn AND DATE_SN Is NULL 
where diagn_tab.dan_id in ( 
 select d.dan_id from visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=3 --мозговой инсульт 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:') ) 
 
and diagn_tab.talon_id=visit_tab.talon_id 
and visit_tab.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:') 
   group by visit_tab.visit_id, diagn_tab.oid, diagn_tab.diagn_osn, dispan_uchet_tab.date_next, diagn_tab.dan_id ,diagn_tab.otmet</Sql>
            </Query>
            <Query>
              <Sql>zapros_disp select dispan_uchet_tab.oid, dispan_uchet_tab.dan_id, 
dispan_uchet_tab.doctor_id, spec, diagn_id, MAX(VISIT_TAB.DATA_POS) as max_vis, 
dispan_uchet_tab.date_next, date, date_sn, case when prichin_sn_id&gt;0 then (prichin_sn_id-1) else -1 end AS C, 
date(now()::text) as date_input,'' as "NULL" , local_lgota_tab.lgota 
               from dispan_uchet_tab 
                LEFT JOIN TALON_TAB ON dispan_uchet_tab.DAN_ID=TALON_TAB.DAN_ID 
                LEFT JOIN VISIT_TAB ON VISIT_TAB.TALON_ID=TALON_TAB.TALON_ID 
                LEFT JOIN DIAGN_TAB ON DIAGN_TAB.TALON_ID=TALON_TAB.TALON_ID 
	  LEFT JOIN LOCAL_LGOTA_TAB ON LOCAL_LGOTA_TAB.DAN_ID = DISPAN_UCHET_TAB.DAN_ID 
	      	    where dispan_uchet_tab.dan_id in ( 
	      	    select d.dan_id from visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=3 --мозговой инсульт 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) 
                group by dispan_uchet_tab.oid, dispan_uchet_tab.dan_id, 
                dispan_uchet_tab.doctor_id, spec, diagn_id, C, dispan_uchet_tab.date_next, date, date_sn, lgota</Sql>
            </Query>
            <Query>
              <Sql>zapros_drug select 
l.id, q.dan_id, kod_minzd, dose as signa, '1' as drug_from_doctor, date_begin, date_end, pressure_reduction as snizhenie_ad, 
date_vnes_inf as date_input, '' as "NULL" 
from 
(select 
d.dan_id, v.visit_id, t.diag_osn as kod_mkb 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=3 --мозговой инсульт 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) q 
join lech_preparat_tab l on l.dan_id = q.dan_id</Sql>
            </Query>
            <Query>
              <Sql>zapros_hosp SELECT 
h.id, q.dan_id, h.date_begin as date_hosp, h.diagn as mkb_kod, h.duration as day_amount, '' as "NULL", '' as user_id, 
date(h.date_vnes_inf::text) as date_input, h.date_end, 
h.analiz_blood_general::integer as blood_anal, 
h.analiz_urine_general::integer as urine_anal, h.analiz_kal::integer as glist_anal, 
h.analiz_blood_bio::integer as biohim, h.analiz_citolog::integer as cito_anal, h.analiz_histolog::integer as histol_anal, 
h.analiz_aids::integer as vich_anal, h.analiz_virus::integer as virus_anal, 
h.analiz_uzi::integer as uzi, h.analiz_rentgen::integer as rentgen, h.analiz_ekg::integer as ekg, 
h.syph_rpga, h.syph_micro, h.syph_titr_1, h.syph_rif, h.syph_tr_p, h.syph_jg_m, h.syph_jg_g, h.syph_jg_total, 
h.spec_terapevt::integer as terapevt, h.spec_otolar::integer as lor, h.spec_oftalmolog::integer as okul, 
h.spec_nevrolog::integer as nevrolog, h.spec_surgeon::integer as hirurg, h.spec_onco::integer as onco, 
h.spec_dermatolog::integer as dermatolog, h.spec_other::integer as inoi 
from 
(select 
d.dan_id, v.visit_id, t.diag_osn as kod_mkb 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=3 --мозговой инсульт 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) q 
left join hosp_tab h on h.dan_id = q.dan_id</Sql>
            </Query>
            <Query>
              <Sql>zapros_inval SELECT distinct inval_client_tab.talon_id, talon_tab.dan_id,inval_client_tab.date_change,inval_client_tab.kod_mkb, 
case 
when inval_client_tab."current" =4 then 'дети-инвалиды' 
when inval_client_tab."current"=0 then '' 
else inval_client_tab."current"::text||'-ая группа' 
end as invalid_gr, date(now()::text) as date_input, '' as "NULL" 
 
from inval_client_tab join talon_tab on inval_client_tab.talon_id = talon_tab.talon_id 
where talon_tab.dan_id in (select d.dan_id from visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=3 --мозговой инсульт 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:'))</Sql>
            </Query>
            <Query>
              <Sql>zapros_reab select '$id' as id, q.dan_id, date(now()::text) as date_input,'' as "NULL" 
from 
(select 
d.dan_id, v.visit_id, t.diag_osn as kod_mkb 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=3 --мозговой инсульт 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) q</Sql>
            </Query>
            <Query>
              <Sql>zapros_visit select visit_tab.visit_id, 
talon_tab.dan_id, 
data_pos, 
target_pos_id, 
'1' as col0, 
(talon_tab.vid_oplat_id+1) as col1, 
visit_tab.doctor_id, date(now()::text) as date_input,'' as "NULL", 
'0' as col2, 
talon_tab.result_id, 
'' as col3, 
'' as col4, 
'-1' as col5, 
'-1' as col6, 
'' as col7, 
'' as col8, 
'' as col9, 
talon_tab.num_pol, 
talon_tab.strcom_id, 
'' as col10, 
'999999' as col11, 
'0' as col12, 
'1' as col13, 
visit_tab.data_vnes_inf, 
talon_tab.ser_pol, 
visit_tab.blood_high, 
visit_tab.blood_low, 
case when ag_visit_data_tab.visit_id is null then 0 else 1 end  as col14, 
'' as col15, 
dolg_doctor||' ('||spec_doctor_tab.dolg_doctor_id||') '||dan_tab.fam||' '||dan_tab.nam||' '||dan_tab.mid as col16, 
spec_doctor_tab.dolg_doctor_id, 
'' as col17/*, 
'' as col18, 
case when pregnant_visit_tab.visit_id is null then 0 else 1 end as col19, 
blist_tab.ser, 
blist_tab.nomer */ 
from visit_tab 
	left join talon_tab on talon_tab.talon_id=visit_tab.talon_id 
	left join ag_visit_data_tab on ag_visit_data_tab.visit_id=visit_tab.visit_id 
	left join pregnant_visit_tab on pregnant_visit_tab.visit_id=visit_tab.visit_id 
	left join spec_doctor_tab on spec_doctor_tab.kod_doctor=visit_tab.doctor_id 
	left join dolg_doctor_tab on spec_doctor_tab.dolg_doctor_id=dolg_doctor_tab.dolg_doctor_id 
    left join doctor_tab on spec_doctor_tab.doctor_id=doctor_tab.doctor_id 
    left join dan_tab on dan_tab.dan_id=doctor_tab.dan_id 
    left join blist_tab on blist_tab.talon_id=talon_tab.talon_id 
where talon_tab.dan_id in ( 
    select d.dan_id from visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=3 --мозговой инсульт 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:') ) 
    and visit_tab.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros_visit_mi select 
q.visit_id, q.dan_id, q.kod_mkb, q.data_pos, q.doctor_id as kod_doctor, f.floga as col0, 
 '' as col1, 
 '' as col2, 
 '' as col3, 
 '' as col4, 
 '' as col5, '' as "NULL", c.weight, c.weight_index, c.sleep_per_day as dream_for_day, 
 vc.headache as head_ache, vc.dizzy as golovokruzh, vc.flies as mushki_in_eyes, 
vc.ear_noise, vc.vision_sharpness_decr, vc.hemiparesis, vc.tongue_numbness, vc.extremity_numbness, 
vs.smoking as kurenie, vs.alcohol_frequency as alcogol_frequency, 
vs.beer_drink::integer as drink_beer, vs.beer_quantity as quantity_beer, 
vs.dry_wine_drink::integer as drink_wine_dry, vs.dry_wine_quantity as quantity_wine_dry, 
vs.fort_wine_drink::integer as drink_wine_fortified, vs.fort_wine_quantity as quantity_wine_fortified, 
vs.vodka_drink::integer as drink_vodka, vs.vodka_quantity as quantity_vodka, 
vs.physical_activity as phisical_activ, vs.stress_level as level_stress, vs.cholesterin1 as holesterin1, 
vs.cholesterin2 as holestirin2, vs.diabet, vs.disease_cer_vasc as cereb_vascul_zabol, 
vs.disease_heart as zabolev_heart, vs.disease_kidneys as zabolev_sosud, vs.disease_vessel as zabolev_pochek, 
vs.disease_retinopathia as retinopatiya, '' as skl_po_giperton, 
c.health_school as school_health, c.san_kur_lech as sanator_this_year, 
'' as user_id, date(vs.date_vnes_inf::text) as date_input 
from 
(select 
d.dan_id, v.visit_id, t.diag_osn as kod_mkb, v.data_pos, v.doctor_id 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=3 --мозговой инсульт 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) q 
left join visit_obj_status_tab vs on vs.visit_id = q.visit_id 
left join const_params_tab c on c.dan_id = q.dan_id 
left join fed_lgota_tab f on q.dan_id = f.dan_id 
left join visit_complaint_tab vc on vc.visit_id = q.visit_id</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT 
id as oid, q.dan_id, compl_date as date_oslozh, diagn, call_smp::integer as call_med_help, date_vnes_inf as date_input, 
'' as "NULL" 
from 
(select 
d.dan_id 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=3 --мозговой инсульт 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) q 
join complication_tab on complication_tab.dan_id = q.dan_id</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="10400000" Name="Заболевания кожи и подкожной клетчатки" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Реестры для Областного бюро мед. статистики\Заболевания кожи и подкожной клетчатки.xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'rkz'||value::Text FROM settings_tab 
WHERE name = 'LPU_NUMBER' LIMIT 1;</Sql>
            </Query>
            <Query>
              <Sql>zapros_const select q.dan_id, education as obrazovanie, profession as professia, height as rost, 
nasl_im as parents_im, nasl_mi as parents_mi, 
epikriz as perehod_epicriz, date(now()::text) as date_input,'' as "NULL" from 
const_params_tab c, 
(select distinct d.dan_id from visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=2 --заболевания кожи 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date(':param1_2_:')) q 
where q.dan_id = c.dan_id</Sql>
            </Query>
            <Query>
              <Sql>zapros_dan select 
dan_id, substr(s.value,length(s.value)-2,3)||lpad(dan_id::text,6,'0') as kod_pt,col0, pens, fam, nam, mid, date_born, 
sex, q1.name, serdoc, numdoc,reg,kod_oms,uchactok_id,street,dom, kv,locale, num_pol,strcom_id, 
kod_oms2, col1, col2, col3, col4, korp, col5, lpu, col6,col7, col8, prik, ser_pol, sstomref, sspolref, 
col9, col10, col11, three, col12, address, one, col13, col14, col15, col16, col17, col18, col19, col20, col21, col22, 
col23, col24, mkb_inv,  '' as "NULL", date(now()::text) as date_input, 
col25, maxpreg, fio, telephon, date_prik 
from 
( 
select distinct 
q.dan_id, 
'' AS col0, 
replace(q.pens, ' ', '-') as pens, 
q.fam, q.nam, q.mid, q.date_born, 
case when q.sex='м' then 'Мужской' else 'Женский' end as sex, 
vid_doc_tab.name, serdoc, numdoc, 
    case when reg3.kod_region is not null then reg3.kod_region else reg2.kod_region end as reg, 
    reg2.kod_oms, 
    q.uchactok_id, 
    /*(select st.kod_oms from st_tab st where st.code=q.street_id limit 1)*/ st.kod_oms as street, 
    q.dom, q.kv, 
    case when cityzen=1 then 'Городская' else 'Сельская' end as locale, 
    q.num_pol,q.strcom_id, soz.kod_oms2, q.kodlg as col1, q.inval_id+3 as col2, 
    '' as col3, '' as col4, q.korp, q.mesto_work_id as col5, '$LPU_ID' as lpu, q.data_end as col6, 
    q.date_fluog as col7, q.risk_id as col8, 
    case when prikreplen is not null and prikreplen!=0 then current_date else NULL end as prik, 
    q.ser_pol, 
    trim(leading '0' from q.sstomref) as sstomref, 
    trim(leading '0' from q.swconref) as sspolref, 
    fakult_tab.name as col9, q.num_group as col10, '' as col11, '1' as three, 
    case when q.life=1 then 1 else 0 end as col12, q.address, 
    '1' as one, '' as col13,'' as col14,'' as col15,'' as col16,'' as col17,'' as col18,'' as col19,'' as col20, inval_client_tab.date_change as col21,'' as col22, 
    '' as col23, 
    fed_lgota_tab.pens as col24, 
    0 as col25, 
    '' as maxpreg, 
    CASE 
    WHEN q.mid IS NULL THEN ((q.fam::text || ' '::text) || substring(q.nam::text, 1, 1)) || '.'::text 
    ELSE ((((q.fam::text || ' '::text) || substring(q.nam::text, 1, 1)) || '.'::text) || 
    substring(q.mid::text, 1, 1)) || '.'::text 
    END AS fio , inval_client_tab.kod_mkb as mkb_inv,q.telephon, prik_zayav_tab.date_prik 
from 
(select 
d.dan_id, v.visit_id, blood_high, blood_low, result_id, d.ser_pol, d.num_pol, d.strcom_id,d.life,d.data_end,d.data_begin, 
v.data_vnes_inf, d.kod_fak, d.num_group, d.kod_vuz, t.pricpol, d.raion_id,d.town_id, d.punkt_id, d.vid_doc_id, 
d.street_id, d.dom, d.korp, d.kv, d.address, d.date_born, d.sex, d.telephon, d.metka_work,d.risk_id,d.pens, 
d.mest_work, d.mesto_work_id, d.fam, d.nam, d.mid, d.region_id, d.serdoc, d.numdoc, d.kodlg, d.katlg, 
d.cityzen, d.inval_id, d.prikreplen, d.date_fluog, d.swconref, d.sstomref,d.sozstatus_id, 
d.lpu_fluog, d.num_fluog, d.mse_num, d.mse_date_issue, d.mse_date_end, d.uchactok_id 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=2 --заболевания кожи 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date(':param1_2_:')) q 
   -- left join kladr_tab /*codifiers.eq_region_kod_oms_tab*/ reg on reg.code=q.region_id 
    left join kladr_tab /*codifiers.eq_region_kod_oms_tab*/ reg3 on reg3.code=q.raion_id 
    left join kladr_tab /*codifiers.eq_region_kod_oms_tab*/ reg2 on reg2.code=q.town_id 
    left join codifiers.eq_street_kod_oms_tab /*st_tab*/ st on st.code=q.street_id 
    left join vid_doc_tab on vid_doc_tab.vid_doc_id=q.vid_doc_id 
    left join sozstatus_tab soz on soz.sozstatus_id=q.sozstatus_id 
    left join fakult_tab on fakult_tab.kod_fak=q.kod_fak	 
    left join fed_lgota_tab on fed_lgota_tab.dan_id = q.dan_id and fed_lgota_tab.pens  ilike '%ОТКАЗ ОТ ДЛО%' 
    left join prik_zayav_tab on prik_zayav_tab.dan_id = q.dan_id 
    left join talon_tab on talon_tab.dan_id = q.dan_id and q.inval_id is not null 
    left join inval_client_tab on talon_tab.talon_id = inval_client_tab.talon_id 
 
) as q1, settings_tab s 
where s.name = 'LPU_ID'</Sql>
            </Query>
            <Query>
              <Sql>zapros_diagn select diagn_tab.oid, min(visit_tab.visit_id) as minvisit, diagn_tab.diagn_osn, diagn_tab.dan_id , 
case when diagn_tab.diagn_osn like 'Z%' then 2 when diagn_tab.otmet='Х' then 1 else 0 end as "CASE_KOD", '1' as "DISP_TYPE", '4' as "DISP_END_REASON" 
,  date(now()::text) as date_input,'' as "NULL", 
'', '', '0' as "ZERO", dispan_uchet_tab.date_next, '', 
'', '1' as one, '0', '0' from diagn_tab 
left join visit_tab on visit_tab.talon_id=diagn_tab.talon_id 
left join dispan_uchet_tab on diagn_tab.DAN_ID=dispan_uchet_tab.DAN_ID AND dispan_uchet_tab.diagn_id=diagn_tab.diagn_osn AND DATE_SN Is NULL 
where diagn_tab.dan_id in ( 
 select d.dan_id from visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=2 --заболевания кожи 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:') ) 
 
and diagn_tab.talon_id=visit_tab.talon_id 
and visit_tab.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:') 
   group by visit_tab.visit_id, diagn_tab.oid, diagn_tab.diagn_osn, dispan_uchet_tab.date_next, diagn_tab.dan_id ,diagn_tab.otmet</Sql>
            </Query>
            <Query>
              <Sql>zapros_disp select dispan_uchet_tab.oid, dispan_uchet_tab.dan_id, 
dispan_uchet_tab.doctor_id, spec, diagn_id, MAX(VISIT_TAB.DATA_POS) as max_vis, 
dispan_uchet_tab.date_next, date, date_sn, case when prichin_sn_id&gt;0 then (prichin_sn_id-1) else -1 end AS C, 
date(now()::text) as date_input,'' as "NULL" , local_lgota_tab.lgota 
               from dispan_uchet_tab 
                LEFT JOIN TALON_TAB ON dispan_uchet_tab.DAN_ID=TALON_TAB.DAN_ID 
                LEFT JOIN VISIT_TAB ON VISIT_TAB.TALON_ID=TALON_TAB.TALON_ID 
                LEFT JOIN DIAGN_TAB ON DIAGN_TAB.TALON_ID=TALON_TAB.TALON_ID 
	  LEFT JOIN LOCAL_LGOTA_TAB ON LOCAL_LGOTA_TAB.DAN_ID = DISPAN_UCHET_TAB.DAN_ID 
	      	    where dispan_uchet_tab.dan_id in ( 
	      	    select d.dan_id from visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=2 --заболевания кожи 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) 
                group by dispan_uchet_tab.oid, dispan_uchet_tab.dan_id, 
                dispan_uchet_tab.doctor_id, spec, diagn_id, C, dispan_uchet_tab.date_next, date, date_sn, lgota</Sql>
            </Query>
            <Query>
              <Sql>zapros_drug select 
l.id, q.dan_id, kod_minzd, dose as signa, '1' as drug_from_doctor, date_begin, date_end, pressure_reduction as snizhenie_ad, 
date_vnes_inf as date_input, '' as "NULL" 
from 
(select 
d.dan_id, v.visit_id, t.diag_osn as kod_mkb 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=2 --заболевания кожи 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) q 
join lech_preparat_tab l on l.dan_id = q.dan_id</Sql>
            </Query>
            <Query>
              <Sql>zapros_hosp SELECT 
h.id, q.dan_id, h.date_begin as date_hosp, h.diagn as mkb_kod, h.duration as day_amount, '' as "NULL", '' as user_id, 
date(h.date_vnes_inf::text) as date_input, h.date_end, 
h.analiz_blood_general::integer as blood_anal, 
h.analiz_urine_general::integer as urine_anal, h.analiz_kal::integer as glist_anal, 
h.analiz_blood_bio::integer as biohim, h.analiz_citolog::integer as cito_anal, h.analiz_histolog::integer as histol_anal, 
h.analiz_aids::integer as vich_anal, h.analiz_virus::integer as virus_anal, 
h.analiz_uzi::integer as uzi, h.analiz_rentgen::integer as rentgen, h.analiz_ekg::integer as ekg, 
h.syph_rpga, h.syph_micro, h.syph_titr_1, h.syph_rif, h.syph_tr_p, h.syph_jg_m, h.syph_jg_g, h.syph_jg_total, 
h.spec_terapevt::integer as terapevt, h.spec_otolar::integer as lor, h.spec_oftalmolog::integer as okul, 
h.spec_nevrolog::integer as nevrolog, h.spec_surgeon::integer as hirurg, h.spec_onco::integer as onco, 
h.spec_dermatolog::integer as dermatolog, h.spec_other::integer as inoi 
from 
(select 
d.dan_id, v.visit_id, t.diag_osn as kod_mkb 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=2 --заболевания кожи 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) q 
left join hosp_tab h on h.dan_id = q.dan_id</Sql>
            </Query>
            <Query>
              <Sql>zapros_inval SELECT distinct inval_client_tab.talon_id, talon_tab.dan_id,inval_client_tab.date_change,inval_client_tab.kod_mkb, 
case 
when inval_client_tab."current" =4 then 'дети-инвалиды' 
when inval_client_tab."current"=0 then '' 
else inval_client_tab."current"::text||'-ая группа' 
end as invalid_gr, date(now()::text) as date_input, '' as "NULL" 
 
from inval_client_tab join talon_tab on inval_client_tab.talon_id = talon_tab.talon_id 
where talon_tab.dan_id in (select d.dan_id from visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=2 --заболевания кожи 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:'))</Sql>
            </Query>
            <Query>
              <Sql>zapros_reab select '$id' as id, q.dan_id, date(now()::text) as date_input,'' as "NULL" 
from 
(select 
d.dan_id, v.visit_id, t.diag_osn as kod_mkb 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=2 --заболевания кожи 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) q</Sql>
            </Query>
            <Query>
              <Sql>zapros_visit select visit_tab.visit_id, 
talon_tab.dan_id, 
data_pos, 
target_pos_id, 
'1' as col0, 
(talon_tab.vid_oplat_id+1) as col1, 
visit_tab.doctor_id, date(now()::text) as date_input,'' as "NULL", 
'0' as col2, 
talon_tab.result_id, 
'' as col3, 
'' as col4, 
'-1' as col5, 
'-1' as col6, 
'' as col7, 
'' as col8, 
'' as col9, 
talon_tab.num_pol, 
talon_tab.strcom_id, 
'' as col10, 
'999999' as col11, 
'0' as col12, 
'1' as col13, 
visit_tab.data_vnes_inf, 
talon_tab.ser_pol, 
visit_tab.blood_high, 
visit_tab.blood_low, 
case when ag_visit_data_tab.visit_id is null then 0 else 1 end  as col14, 
'' as col15, 
dolg_doctor||' ('||spec_doctor_tab.dolg_doctor_id||') '||dan_tab.fam||' '||dan_tab.nam||' '||dan_tab.mid as col16, 
spec_doctor_tab.dolg_doctor_id, 
'' as col17/*, 
'' as col18, 
case when pregnant_visit_tab.visit_id is null then 0 else 1 end as col19, 
blist_tab.ser, 
blist_tab.nomer */ 
from visit_tab 
	left join talon_tab on talon_tab.talon_id=visit_tab.talon_id 
	left join ag_visit_data_tab on ag_visit_data_tab.visit_id=visit_tab.visit_id 
	left join pregnant_visit_tab on pregnant_visit_tab.visit_id=visit_tab.visit_id 
	left join spec_doctor_tab on spec_doctor_tab.kod_doctor=visit_tab.doctor_id 
	left join dolg_doctor_tab on spec_doctor_tab.dolg_doctor_id=dolg_doctor_tab.dolg_doctor_id 
    left join doctor_tab on spec_doctor_tab.doctor_id=doctor_tab.doctor_id 
    left join dan_tab on dan_tab.dan_id=doctor_tab.dan_id 
    left join blist_tab on blist_tab.talon_id=talon_tab.talon_id 
where talon_tab.dan_id in ( 
    select d.dan_id from visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=2 --заболевания кожи 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:') ) 
    and visit_tab.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')</Sql>
            </Query>
            <Query>
              <Sql>zapros_visit_rkv select 
q.visit_id, q.dan_id, q.kod_mkb, 
vs.analiz_blood_general::integer as blood_anal, 
vs.analiz_urine_general::integer as urine_anal, vs.analiz_kal::integer as glist_anal, 
vs.analiz_blood_bio::integer as biohim, vs.analiz_citolog::integer as cito_anal, vs.analiz_histolog::integer as histol_anal, 
vs.analiz_aids::integer as vich_anal, vs.analiz_virus::integer as virus_anal, 
vs.analiz_uzi::integer as uzi, vs.analiz_rentgen::integer as rentgen, vs.analiz_ekg::integer as ekg, 
vs.syph_rpga, vs.syph_micro, vs.syph_titr_1, vs.syph_rif, vs.syph_tr_p, vs.syph_jg_m, vs.syph_jg_g, vs.syph_jg_total, 
vs.spec_terapevt::integer as terapevt, vs.spec_otolar::integer as lor, vs.spec_oftalmolog::integer as okul, 
c.health_school, c.san_kur_lech as "treat", 0 as is_Preg, 
'' as preg_week_amount, '' as user_id, date(vs.date_vnes_inf::text) as date_input, 
vs.spec_nevrolog::integer as nevrolog, vs.spec_surgeon::integer as hirurg, vs.spec_onco::integer as onco, 
vs.spec_dermatolog::integer as dermatolog, vs.spec_other::integer as inoi 
from 
(select 
d.dan_id, v.visit_id, t.diag_osn as kod_mkb 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=2 --заболевания кожи 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) q 
left join visit_obj_status_tab vs on vs.visit_id = q.visit_id 
left join const_params_tab c on c.dan_id = q.dan_id</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT 
id as oid, q.dan_id, compl_date as date_oslozh, diagn, call_smp::integer as call_med_help, date_vnes_inf as date_input, 
'' as "NULL" 
from 
(select 
d.dan_id 
from 
visit_tab v 
join talon_tab t on v.talon_id = t.talon_id and v.diagn_forms_type_id=2 --заболевания кожи 
join dan_tab d on t.dan_id = d.dan_id 
where v.data_vnes_inf between date(':param1_1_:') and date (':param1_2_:')) q 
join complication_tab on complication_tab.dan_id = q.dan_id</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Годовые отчеты">
      <Reports>
        <Report Id="4203000" Name="Форма  2" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма  2.xls">
          <Queries>
            <Query>
              <Sql>z0(d1,d2) select count(talon_id) as cnt, sum(age17) as cnt17, sum(age14) as cnt14, sum(age1) as cnt1, sum(age1_2) as cnt1_2, 
sum(age3_6) as cnt3_6, '' as cnt3_6s, sum(age15_17) as cnt15_17, sum(selsk_all) as selsk_all, 
sum(selsk_do17) as selsk_do17, sum(death_all) as dead, sum(death17) as d_17 
from ( 
select ds.diagn_osn, ds.talon_id, 
d.date_born, 
case 
   when date_part('year', age(':per_2_:',d.date_born))&lt;18 then 1 
   else 0 
   end as age17, 
case 
   when date_part('year', age(':per_2_:',d.date_born))&lt;15 then 1 
   else 0 
   end as age14, 
case 
   when date_part('year', age(':per_2_:',d.date_born))&lt;1 then 1 
   else 0 
   end as age1, 
case 
   when date_part('year',age(':per_2_:',d.date_born)) between 1 and 2 then 1 
   else 0	 
   end as age1_2, 
case 
   when date_part('year', age(':per_2_:',d.date_born)) between 3 and 6 then 1 
   else 0 
   end as age3_6, 
case 
   when date_part('year', age(':per_2_:',d.date_born)) between 15 and 17 then 1 
   else 0 
   end as age15_17, 
case 
   when d.cityzen = 0 then 1 
   else 0 
   end as selsk_all, 
case 
   when d.cityzen = 0 and date_part('year', age(':per_2_:',d.date_born))&lt;18 then 1 
   else 0 
   end as selsk_do17, 
case 
   when t.result_id = 9 then 1 
   else 0 
   end as death_all, 
case 
   when t.result_id = 9 and date_part('year', age(':per_2_:',d.date_born))&lt;18 then 1 
   else 0 
   end as death17 
      
 
from diagn_tab ds 
LEFT JOIN talon_tab t on t.talon_id = ds.talon_id 
LEFT JOIN dan_tab d on d.dan_id = ds.dan_id 
where ds.count_diagn_tab = 1 and ds.diagn_osn between 'd1' and 'd2' 
and ds.data_vnes_inf between date(':per_1_:') and date(':per_2_:') 
) q</Sql>
            </Query>
            <Query>
              <Sql>z1(d1) select count(talon_id) as cnt, sum(age17) as cnt17, sum(age14) as cnt14, sum(age1) as cnt1, sum(age1_2) as cnt1_2, 
sum(age3_6) as cnt3_6, '' as cnt3_6s, sum(age15_17) as cnt15_17, sum(selsk_all) as selsk_all, 
sum(selsk_do17) as selsk_do17, sum(death_all) as dead, sum(death17) as d_17 
from ( 
select ds.diagn_osn, ds.talon_id, 
d.date_born, 
case 
   when date_part('year', age(':per_2_:',d.date_born))&lt;18 then 1 
   else 0 
   end as age17, 
case 
   when date_part('year', age(':per_2_:',d.date_born))&lt;15 then 1 
   else 0 
   end as age14, 
case 
   when date_part('year', age(':per_2_:',d.date_born))&lt;1 then 1 
   else 0 
   end as age1, 
case 
   when date_part('year',age(':per_2_:',d.date_born)) between 1 and 2 then 1 
   else 0	 
   end as age1_2, 
case 
   when date_part('year', age(':per_2_:',d.date_born)) between 3 and 6 then 1 
   else 0 
   end as age3_6, 
case 
   when date_part('year', age(':per_2_:',d.date_born)) between 15 and 17 then 1 
   else 0 
   end as age15_17, 
case 
   when d.cityzen = 0 then 1 
   else 0 
   end as selsk_all, 
case 
   when d.cityzen = 0 and date_part('year', age(':per_2_:',d.date_born))&lt;18 then 1 
   else 0 
   end as selsk_do17, 
case 
   when t.result_id = 9 then 1 
   else 0 
   end as death_all, 
case 
   when t.result_id = 9 and date_part('year', age(':per_2_:',d.date_born))&lt;18 then 1 
   else 0 
   end as death17 
      
 
from diagn_tab ds 
LEFT JOIN talon_tab t on t.talon_id = ds.talon_id 
LEFT JOIN dan_tab d on d.dan_id = ds.dan_id 
where ds.count_diagn_tab = 1 and ds.diagn_osn in (d1) 
and ds.data_vnes_inf between date(':per_1_:') and date(':per_2_:') 
) q</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="per" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="4403000" Name="Форма  5" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма  5.xls">
          <Queries>
            <Query>
              <Sql>zapros1(vdpr,vv1,vv2) select count(*) 
from priviv_tab pr join dan_tab d ON d.dan_id = pr.dan_id 
where pr.date_priviv between ':param1_1_:' and ':param1_2_:' and preparat in (vdpr) 
--infection=vdpr 
and vid_priviv between vv1 and vv2 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros2(vdpr,vv1,vv2) select count(*) 
from priviv_tab pr 
left join dan_tab d ON d.dan_id = pr.dan_id 
where pr.date_priviv between ':param1_1_:' and ':param1_2_:' and preparat in (vdpr) 
--infection=vdpr 
and vid_priviv between vv1 and vv2 
and DATE_PART('year',AGE(pr.date_priviv, d.date_born)) between 0 and 17 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros3(vdpr1,vdpr2) select count(*) 
from priviv_tab pr join dan_tab d ON d.dan_id = pr.dan_id 
where pr.date_priviv between ':param1_1_:' and ':param1_2_:' and preparat in (vdpr1,vdpr2) 
--infection in (vdpr1,vdpr2) 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros4(vdpr1,vdpr2) select count(*) 
from priviv_tab pr 
left join dan_tab d ON d.dan_id = pr.dan_id 
where pr.date_priviv between ':param1_1_:' and ':param1_2_:' and preparat in (vdpr1,vdpr2) 
--infection in (vdpr1,vdpr2) 
and DATE_PART('year',AGE(pr.date_priviv, d.date_born)) between 0 and 17 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros5(vdpr,vv1,vv2) select count(*) 
from priviv_tab pr join dan_tab d ON d.dan_id = pr.dan_id 
where pr.date_priviv between ':param1_1_:' and ':param1_2_:' and preparat in (vdpr) 
--infection in (vdpr1,vdpr2) 
and vid_priviv between vv1 and vv2 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros6(vdpr,vv1,vv2) select count(*) 
from priviv_tab pr 
left join dan_tab d ON d.dan_id = pr.dan_id 
where pr.date_priviv between ':param1_1_:' and ':param1_2_:' and preparat in (vdpr) 
--infection in (vdpr1,vdpr2) 
and vid_priviv between vv1 and vv2 
and DATE_PART('year',AGE(pr.date_priviv, d.date_born)) between 0 and 17 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros7 select count(*) 
from priviv_tab pr 
left join dan_tab d ON d.dan_id = pr.dan_id 
where pr.date_priviv between ':param1_1_:' and ':param1_2_:' and preparat in (730,731) 
--infection in (14) 
and DATE_PART('year',AGE(pr.date_priviv, d.date_born)) between 0 and 1 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros8(vdpr,vv1,vv2) select count(*) 
from priviv_tab pr join dan_tab d ON d.dan_id = pr.dan_id 
where pr.date_priviv between ':param1_1_:' and ':param1_2_:' and infection=vdpr 
and vid_priviv between vv1 and vv2 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="4603000" Name="Форма  6" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма  6.xls">
          <Queries>
            <Query>
              <Sql>z0(par1,par2,par3,par4) select count(*) from ( 
select pr.dan_id, pr.infection, pr.date_priviv, pr.vid_priviv  
from priviv_tab pr 
LEFT JOIN dan_tab d on d.dan_id = pr.dan_id 
where pr.date_priviv between date(':per_1_:') and date(':per_2_:') 
and date_part('year', age(pr.date_priviv,d.date_born)) = par1 
and  (pr.vid_Priviv between par2 and par3) and preparat in (par4) 
--pr.infection in (par4,par5,par6) 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
---Количество привитых (вакцинация и ревакцинация) по возрастам. par2, par3 - диапазон id для определения ----вакцинация/ревакцинация, par4 - вакцина. Все значения из таблицы sp_priv_univ_tab. par1 - число лет.</Sql>
            </Query>
            <Query>
              <Sql>z1(par4) select count(*) from ( 
select pr.dan_id, pr.infection, pr.date_priviv, pr.vid_priviv  
from priviv_tab pr 
LEFT JOIN dan_tab d on d.dan_id = pr.dan_id 
where pr.date_priviv between date(':per_1_:') and date(':per_2_:') 
and date_part('year', age(pr.date_priviv,d.date_born)) = 0 and date_part('month', age(':per_2_:',d.date_born)) between 0 and 6 
and  (pr.vid_Priviv between 9 and 12) and  preparat in (par4) 
-- pr.infection in (par4,par5,par6) 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
----количество привитых (вакцинация) в возрасте 0-6 мес. par4 - вид вакцины</Sql>
            </Query>
            <Query>
              <Sql>z11(par4) select count(*) from ( 
select pr.dan_id, pr.infection, pr.date_priviv, pr.vid_priviv  
from priviv_tab pr 
LEFT JOIN dan_tab d on d.dan_id = pr.dan_id 
where pr.date_priviv between date(':per_1_:') and date(':per_2_:') 
and date_part('year', age(pr.date_priviv,d.date_born)) = 0 and date_part('month', age(':per_2_:',d.date_born)) between 0 and 6 
and  (pr.vid_Priviv between 13 and 20) and  preparat in (par4) 
--pr.infection in (par4,par5,par6) 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
----количество привитых (ревакцинация) в возрасте 0-6 мес. par4 - вакцина</Sql>
            </Query>
            <Query>
              <Sql>z2(par11,par12,par2) select count(*), COALESCE(sum(priv),0) as priv from ( 
select t.dan_id, d.date_born, t.diag_osn, t.data_vnes_inf, pr.date_priviv, 
case when pr.date_Priviv is null then 0 else 1 end as priv 
from talon_tab t /*diagn_tab ds */ 
LEFT JOIN dan_tab d on d.dan_id = t.dan_id 
LEFT JOIN priviv_tab pr on pr.dan_id = t.dan_id 
where t.diag_osn between par11 and par12 
and t.data_vnes_inf between date(':per_1_:') and date(':per_2_:') 
and  date_part('year', age(pr.date_priviv,d.date_born)) = par2 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
----Переболевшие корью, эпидпаротитом, краснухой. Параметры: par11, par12 - диапазон диагнозов, 
----par2 - количество лет пациента (страница 4 отчёта)</Sql>
            </Query>
            <Query>
              <Sql>z3(par1,par2) select count(*), COALESCE(sum(priv),0) as priv from ( 
select t.dan_id, d.date_born, t.diag_osn, t.data_vnes_inf, pr.date_priviv, 
case when pr.date_Priviv is null then 0 else 1 end as priv 
from talon_tab t /*diagn_tab ds */ 
LEFT JOIN dan_tab d on d.dan_id = t.dan_id 
LEFT JOIN priviv_tab pr on pr.dan_id = t.dan_id 
where t.diag_osn between par1 and par2 
and t.data_vnes_inf between date(':per_1_:') and date(':per_2_:') 
and  date_part('year', age(pr.date_priviv,d.date_born)) = 0 and date_part('month', age(pr.date_priviv,d.date_born)) between 0 and 6 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
---- переболевшие корью, эпидпаротитом и краснухой в возрасте 0-6 мес (страница 4 отчёта). 
----Параметры - диапазон диагнозов</Sql>
            </Query>
            <Query>
              <Sql>z4(par1,par2,par3,age1,age2) select count(*) from ( 
select pr.dan_id, pr.infection, pr.date_priviv, pr.vid_priviv  
from priviv_tab pr 
LEFT JOIN dan_tab d on d.dan_id = pr.dan_id 
where pr.date_priviv between date(':per_1_:') and date(':per_2_:') 
and date_part('year', age(pr.date_priviv,d.date_born)) between age1 and age2 
and  (pr.vid_Priviv between par1 and par2) and preparat in (par3) 
--pr.infection in (par3,par4,par5) 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
----привитые старше 60 лет (вакцинация и ревакцинация). par1, par2 - диапазон id для определения вакцинация/ревакцинация, 
----par3 - вакцина. Все значения из таблицы sp_priv_univ_tab</Sql>
            </Query>
            <Query>
              <Sql>z5 select count(*), COALESCE(sum(priv),0) as priv from ( 
select t.dan_id, d.date_born, t.diag_osn, t.data_vnes_inf, pr.date_priviv, 
case when pr.date_Priviv is null then 0 else 1 end as priv 
from talon_tab t /*diagn_tab ds */ 
LEFT JOIN dan_tab d on d.dan_id = t.dan_id 
LEFT JOIN priviv_tab pr on pr.dan_id = t.dan_id 
where t.diag_osn between 'B05' and 'B05.9' 
and t.data_vnes_inf between date(':per_1_:') and date(':per_2_:') 
and  date_part('year', age(pr.date_priviv,d.date_born)) &gt;=60 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
--- переболевшие корью старше 60 лет</Sql>
            </Query>
            <Query>
              <Sql>z6(par1) select count(*) from dan_tab 
where date_part('year', age(':per_2_:',date_born)) = par1 
and prikreplen=1 
and (:param2_1_:=-1 OR uchactok_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>z7(age1,age2) select count(*) from dan_tab 
where date_part('year', age(':per_2_:',date_born)) between age1 and age2 
and prikreplen=1 
and (:param2_1_:=-1 OR uchactok_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>z8(par11,par12,age1,age2) select count(*), COALESCE(sum(priv),0) as priv from ( 
select ds.dan_id, d.date_born, ds.diagn_osn, ds.data_vnes_inf, pr.date_priviv, 
case when pr.date_Priviv is null then 0 else 1 end as priv 
from diagn_tab ds 
LEFT JOIN dan_tab d on d.dan_id = ds.dan_id 
LEFT JOIN priviv_tab pr on pr.dan_id = ds.dan_id 
where diagn_osn between par11 and par12 
and ds.data_vnes_inf between date(':per_1_:') and date(':per_2_:') 
and  date_part('year', age(pr.date_priviv,d.date_born)) between age1 and age2 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q</Sql>
            </Query>
            <Query>
              <Sql>z9 select count(*) from dan_tab 
where date_part('year', age(':per_2_:',date_born)) = 0 and date_part('month', age(':per_2_:',date_born)) between 0 and 6 
and prikreplen=1 
and (:param2_1_:=-1 OR uchactok_id = :param2_1_:)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="per" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="4803000" Name="Форма  1 (ВОП)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма  1 (ВОП).xls">
          <Queries>
            <Query>
              <Sql>prik(age1,age2,mw) select count(*) from  dan_tab d 
left join codifiers.uchactok_tab uch ON d.uchactok_id = uch.id 
left join full_doctor_tab doc ON doc.doctor_id =uch.doctor_id 
where d.prikreplen =1 and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN age1 AND age2) 
and (mw) 
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and doc.dolg_doctor_id = :ddolg_1_:</Sql>
            </Query>
            <Query>
              <Sql>prik2(age1,age2,mw,sex1) select count(*) from  dan_tab d 
left join codifiers.uchactok_tab uch ON d.uchactok_id = uch.id 
left join full_doctor_tab doc ON doc.doctor_id =uch.doctor_id 
where d.prikreplen =1 and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN age1 AND age2) 
and (mw) and d.sex='sex1' 
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and doc.dolg_doctor_id = :ddolg_1_:</Sql>
            </Query>
            <Query>
              <Sql>profilaktika 4,5</Sql>
            </Query>
            <Query>
              <Sql>z1(age1,age2,targetpos,mkb1,mkb2) select count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN full_doctor_tab f ON v.doctor_id = f.doctor_id and f.dolg_doctor_id = :ddolg_1_: 
WHERE v.data_pos between date(':period_1_:') and (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN age1 AND age2)  
AND v.target_pos_id in (targetpos) 
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:))  and f.dolg_doctor_id = :ddolg_1_: 
and t.diag_osn between 'mkb1' and 'mkb2'</Sql>
            </Query>
            <Query>
              <Sql>z2(targetpos,mkb1,mkb2) select sum(mr+fr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 1 else 0 end as mr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 1 else 0 end as fr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN full_doctor_tab f ON v.doctor_id = f.doctor_id and f.dolg_doctor_id = :ddolg_1_: 
WHERE v.data_pos between date(':period_1_:') and (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59)  
AND v.target_pos_id in (targetpos)  
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and f.dolg_doctor_id = :ddolg_1_: 
and t.diag_osn between 'mkb1' and 'mkb2' 
) q</Sql>
            </Query>
            <Query>
              <Sql>z3(targetpos,mkb1,mkb2) select sum(mr+fr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 1 else 0 end as mr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 1 else 0 end as fr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN full_doctor_tab f ON v.doctor_id = f.doctor_id and f.dolg_doctor_id = :ddolg_1_: 
WHERE v.data_pos between date(':period_1_:') and (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59)  
AND v.target_pos_id in (targetpos)  AND v.mesto_obs = 'Д' 
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and f.dolg_doctor_id = :ddolg_1_: 
and t.diag_osn between 'mkb1' and 'mkb2' 
) q</Sql>
            </Query>
            <Query>
              <Sql>z4(targetpos,mkb1,mkb2) select sum(mnr+fnr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 0 else 1 end as mnr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 0 else 1 end as fnr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN full_doctor_tab f ON v.doctor_id = f.doctor_id and f.dolg_doctor_id = :ddolg_1_: 
WHERE v.data_pos between date(':period_1_:') and (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 54 AND 200)  
AND v.target_pos_id in (targetpos)  
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and f.dolg_doctor_id = :ddolg_1_: 
and t.diag_osn between 'mkb1' and 'mkb2' 
) q</Sql>
            </Query>
            <Query>
              <Sql>z5(targetpos,mkb1,mkb2) select sum(mnr+fnr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 0 else 1 end as mnr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 0 else 1 end as fnr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN full_doctor_tab f ON v.doctor_id = f.doctor_id and f.dolg_doctor_id = :ddolg_1_: 
WHERE v.data_pos between date(':period_1_:') and (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 54 AND 200)  
AND v.target_pos_id in (targetpos)  AND v.mesto_obs = 'Д' 
AND ((:district_1_: &lt; 0) OR (d.uchactok_id =:district_1_:)) and f.dolg_doctor_id = :ddolg_1_: 
and t.diag_osn between 'mkb1' and 'mkb2' 
) q</Sql>
            </Query>
            <Query>
              <Sql>zabolevania 1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="ddolg" Caption="Должность врача:" Type="select">
              <Sql>select distinct dolg_doctor_id, dolg_doctor, CASE WHEN dolg_doctor ilike '%общей прак%' THEN 1 ELSE 0 END from full_doctor_tab ORDER BY 3 DESC,2 </Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период:" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="district" Caption="Участок:" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="5003000" Name="Форма  9" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма  9.xls">
          <Queries>
            <Query>
              <Sql>b861 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id between 'B86' and 'B86.9' 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>m5 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id between 'B35.1' and 'B35.3' 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>m6 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id='B35.1' 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>z0(par1,par2,par3) select count(*), sum(c1) as c1, sum(c2) as c2, sum(c3) as c3, sum(c4) as c4, sum(c5) as c5, sum(c6) as c6, 
sum(s) as s, sum(s1) as s1, sum(s2) as s2 
from ( 
select u.dan_id, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born))&lt;=14 then 1 else 0 end as c1, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 15 and 17 then 1 else 0 end as c2, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 18 and 19 then 1 else 0 end as c3, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 20 and 29 then 1 else 0 end as c4, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 30 and 39 then 1 else 0 end as c5, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born))&gt;=40 then 1 else 0 end as c6, 
case when d.cityzen=0 then 1 else 0 end as s, 
case when d.cityzen=0 and date_part('year', age(':per_2_:',d.date_born))&lt;=14 then 1 else 0 end as s1, 
case when d.cityzen=0 and date_part('year', age(':per_2_:',d.date_born)) between 15 and 17 then 1 else 0 end as s2 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id between 'par1' and 'par2' 
and u.date&lt;=date(':per_2_:') and (u.date_sn&gt;=date(':per_1_:') or u.date_sn is null) 
and d.sex ='par3' 
) q 
 
/*Параметры: par1, par2 - диапазон диагнозов по МКБ, 
par3 - пол (м, ж) 
*/</Sql>
            </Query>
            <Query>
              <Sql>z1 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id='A50.0' 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>z10 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id='A50.0' 
and u.date between date(':per_1_:') and date(':per_2_:') 
and date_part('year', age(':per_2_:',d.date_born))=0</Sql>
            </Query>
            <Query>
              <Sql>z2 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id in ('A50.1','A50.2') 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>z3 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id between 'A50.3' and 'A50.7' 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>z4 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id='A52.0' 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>z5 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id in ('A52.1','A52.2','A52.3') 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>z6 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id='A52.7' 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>z7 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id='A52.8' 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>z8 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id='A53.0' 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>z9 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id='A54.3' 
and u.date between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>b862 select count(*) 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id between 'B86' and 'B86.9' 
and u.date between date(':per_1_:') and date(':per_2_:') and date_part('year', age(':per_2_:',d.date_born))&lt;=14</Sql>
            </Query>
            <Query>
              <Sql>zf(param) select count(*), sum(c1) as c1, sum(c2) as c2, sum(c3) as c3, sum(c4) as c4, sum(c5) as c5, sum(c6) as c6, 
sum(s) as s, sum(s1) as s1, sum(s2) as s2 
from ( 
select u.dan_id, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born))&lt;=14 then 1 else 0 end as c1, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 15 and 17 then 1 else 0 end as c2, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 18 and 19 then 1 else 0 end as c3, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 20 and 29 then 1 else 0 end as c4, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 30 and 39 then 1 else 0 end as c5, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born))&gt;=40 then 1 else 0 end as c6, 
case when d.cityzen=0 then 1 else 0 end as s, 
case when d.cityzen=0 and date_part('year', age(':per_2_:',d.date_born))&lt;=14 then 1 else 0 end as s1, 
case when d.cityzen=0 and date_part('year', age(':per_2_:',d.date_born)) between 15 and 17 then 1 else 0 end as s2 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id in (param) 
and u.date&lt;=date(':per_2_:') and (u.date_sn&gt;=date(':per_1_:') or u.date_sn is null) 
and d.sex ='ж' 
) q 
 
----по списку диагнозов, женщины</Sql>
            </Query>
            <Query>
              <Sql>zm(param) select count(*), sum(c1) as c1, sum(c2) as c2, sum(c3) as c3, sum(c4) as c4, sum(c5) as c5, sum(c6) as c6, 
sum(s) as s, sum(s1) as s1, sum(s2) as s2 
from ( 
select u.dan_id, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born))&lt;=14 then 1 else 0 end as c1, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 15 and 17 then 1 else 0 end as c2, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 18 and 19 then 1 else 0 end as c3, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 20 and 29 then 1 else 0 end as c4, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born)) between 30 and 39 then 1 else 0 end as c5, 
case when u.date&gt;=date(':per_1_:') and date_part('year', age(':per_2_:',d.date_born))&gt;=40 then 1 else 0 end as c6, 
case when d.cityzen=0 then 1 else 0 end as s, 
case when d.cityzen=0 and date_part('year', age(':per_2_:',d.date_born))&lt;=14 then 1 else 0 end as s1, 
case when d.cityzen=0 and date_part('year', age(':per_2_:',d.date_born)) between 15 and 17 then 1 else 0 end as s2 
from dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where diagn_id in (param) 
and u.date&lt;=date(':per_2_:') and (u.date_sn&gt;=date(':per_1_:') or u.date_sn is null) 
and d.sex ='м' 
) q 
 
----по списку диагнозов, мужчины</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="per" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="5403000" Name="Форма 31" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 31.xls">
          <Queries>
            <Query>
              <Sql>z0(dd1,dd2) select sum(post) as cnt0, sum(leave) as cnt1, sum(dead) as cnt2, sum(end_year) as cnt3 
from ( 
select u.dan_id, u.date, u.sp_dispan_state_id, u.date_sn, 
d.date_born, 
case when u.sp_dispan_state_id=5 then 1 else 0 end as dead, 
case when u.date_sn &lt;= date(':per_2_:') then 1 else 0 end as leave, 
case when u.date between date(':per_1_:') and date(':per_2_:') then 1 else 0 end as post, 
case when u.date_sn &gt; date(':per_2_:') or u.date_sn is null then 1 else 0 end as end_year 
from 
dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where date_part('year', age(':per_2_:',d.date_born)) between dd1 and dd2 
and date&lt;=date(':per_2_:') 
) q</Sql>
            </Query>
            <Query>
              <Sql>z1 select sum(post) as cnt0, sum(leave) as cnt1, sum(dead) as cnt2, sum(end_year) as cnt3 
from ( 
select u.dan_id, u.date, u.sp_dispan_state_id, u.date_sn, 
d.date_born, 
case when u.sp_dispan_state_id=5 then 1 else 0 end as dead, 
case when u.date_sn &lt;= date(':per_2_:') then 1 else 0 end as leave, 
case when u.date between date(':per_1_:') and date(':per_2_:') then 1 else 0 end as post, 
case when u.date_sn &gt; date(':per_2_:') or u.date_sn is null then 1 else 0 end as end_year 
from 
dispan_uchet_tab u 
LEFT JOIN dan_tab d on d.dan_id = u.dan_id 
where date_part('year', age(':per_2_:',d.date_born)) =0 
and date&lt;=date(':per_2_:') 
) q</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="per" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="5603000" Name="Форма 34" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 34.xls">
          <Queries>
            <Query>
              <Sql>c1 select 
count(*) 
from dispan_uchet_tab u 
where diagn_id = 'A50.0' 
and u.date&gt;=date(':per_1_:')</Sql>
            </Query>
            <Query>
              <Sql>c2 select 
count(*) 
from dispan_uchet_tab u 
where (diagn_id = 'A50.1' or diagn_id = 'A50.2') 
and u.date&gt;=date(':per_1_:')</Sql>
            </Query>
            <Query>
              <Sql>c3 select 
count(*) 
from dispan_uchet_tab u 
where diagn_id between 'A50.3' and 'A50.7' 
and u.date&gt;=date(':per_1_:')</Sql>
            </Query>
            <Query>
              <Sql>c4 select 
count(*) 
from dispan_uchet_tab u 
where diagn_id = 'A52.0' 
and u.date&gt;=date(':per_1_:')</Sql>
            </Query>
            <Query>
              <Sql>c5 select 
count(*) 
from dispan_uchet_tab u 
where diagn_id between 'A52.1' and 'A52.3' 
and u.date&gt;=date(':per_1_:')</Sql>
            </Query>
            <Query>
              <Sql>c6 select 
count(*) 
from dispan_uchet_tab u 
where diagn_id = 'A52.7' 
and u.date&gt;=date(':per_1_:')</Sql>
            </Query>
            <Query>
              <Sql>c7 select 
count(*) 
from dispan_uchet_tab u 
where diagn_id = 'A52.8' 
and u.date&gt;=date(':per_1_:')</Sql>
            </Query>
            <Query>
              <Sql>c8 select 
count(*) 
from dispan_uchet_tab u 
where diagn_id = 'A53.0' 
and u.date&gt;=date(':per_1_:')</Sql>
            </Query>
            <Query>
              <Sql>cc1 select count(*) 
from dispan_uchet_tab u 
where diagn_id between 'A50' and 'A53.9' 
and date between date(':per_1_:') and date(':per_2_:') 
and date_sn between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>cc2 select count(*) 
from dispan_uchet_tab u 
where diagn_id between 'A54' and 'A54.9' 
and date between date(':per_1_:') and date(':per_2_:') 
and date_sn between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
            <Query>
              <Sql>sn1 select count(*) from dispan_uchet_tab u 
where u.date_sn between date(':per_1_:') and date(':per_2_:') and 
(diagn_id like 'A50%' or diagn_id like 'A51%' or diagn_id like 'A52%' or diagn_id like 'A53%' 
or diagn_id like 'A54%' or diagn_id like 'A56%' or diagn_id like 'A59%' or diagn_id like 'A60%' 
or diagn_id like 'A63%' or diagn_id like 'B35%' or diagn_id like 'B86%') 
and sp_dispan_state_id = 3</Sql>
            </Query>
            <Query>
              <Sql>sn2 select count(*) from dispan_uchet_tab u 
where u.date_sn between date(':per_1_:') and date(':per_2_:') and 
(diagn_id like 'A50%' or diagn_id like 'A51%' or diagn_id like 'A52%' or diagn_id like 'A53%' 
or diagn_id like 'A54%' or diagn_id like 'A56%' or diagn_id like 'A59%' or diagn_id like 'A60%' 
or diagn_id like 'A63%' or diagn_id like 'B35%' or diagn_id like 'B86%') 
and sp_dispan_state_id = 6</Sql>
            </Query>
            <Query>
              <Sql>sn3 select count(*) from dispan_uchet_tab u 
where u.date_sn between date(':per_1_:') and date(':per_2_:') and 
(diagn_id like 'A50%' or diagn_id like 'A51%' or diagn_id like 'A52%' or diagn_id like 'A53%' 
or diagn_id like 'A54%' or diagn_id like 'A56%' or diagn_id like 'A59%' or diagn_id like 'A60%' 
or diagn_id like 'A63%' or diagn_id like 'B35%' or diagn_id like 'B86%') 
and sp_dispan_state_id = 5</Sql>
            </Query>
            <Query>
              <Sql>snnn select count(*) from dispan_uchet_tab u 
where u.date_sn between date(':per_1_:') and date(':per_2_:') and 
(diagn_id like 'A50%' or diagn_id like 'A51%' or diagn_id like 'A52%' or diagn_id like 'A53%' 
or diagn_id like 'A54%' or diagn_id like 'A56%' or diagn_id like 'A59%' or diagn_id like 'A60%' 
or diagn_id like 'A63%' or diagn_id like 'B35%' or diagn_id like 'B86%')</Sql>
            </Query>
            <Query>
              <Sql>z0(d1,d2) select count(*), sum(cnt_new) as cnt_new, '' as cnt_an, '' as cnt_per, sum(cnt_end) as cnt_end 
from ( 
select dan_id, 
case 
   when u.date&gt;=date(':per_1_:') then 1 
   else 0 
   end as cnt_new, 
case 
   when u.date_sn&gt;date(':per_2_:') or date_sn is null  then 1 
   else 0 
   end as cnt_end 
from  dispan_uchet_tab u 
where diagn_id between 'd1' and 'd2' 
and (date_sn &gt; date(':per_1_:') or date_sn is null)) q</Sql>
            </Query>
            <Query>
              <Sql>z1(d1) select count(*), sum(cnt_new) as cnt_new, '' as cnt_an, '' as cnt_per, sum(cnt_end) as cnt_end 
from ( 
select dan_id, 
case 
   when u.date&gt;=date(':per_1_:') then 1 
   else 0 
   end as cnt_new, 
case 
   when u.date_sn&gt;date(':per_2_:') or date_sn is null  then 1 
   else 0 
   end as cnt_end 
from  dispan_uchet_tab u 
where diagn_id in (d1) 
and (date_sn &gt; date(':per_1_:') or date_sn is null)) q</Sql>
            </Query>
            <Query>
              <Sql>cc3 select count(*) 
from dispan_uchet_tab u 
where diagn_id between 'A56' and 'A56.9' 
and date between date(':per_1_:') and date(':per_2_:') 
and date_sn between date(':per_1_:') and date(':per_2_:')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="per" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="5803000" Name="Посещения за год" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Посещения за год.xls">
          <Queries>
            <Query>
              <Sql>lpu_name SELECT value FROm settings_tab WHERE name = 'LPU'</Sql>
            </Query>
            <Query>
              <Sql>pred_year select ':param1_1_:'::integer-1 as param2_1_</Sql>
            </Query>
            <Query>
              <Sql>zapros1(mm,ddolg) SELECT count(distinct visit_id) FROM visit_tab v 
JOIN talon_tab t ON t.talon_id=v.talon_id and t.result_id IS NOT NULL 
JOIN full_doctor_tab f ON f.doctor_id = v.doctor_id and f.dolg_doctor_id in (ddolg) 
WHERE 
v.data_vnes_inf between date(':param1_1_:'||'-'||'mm'||'-01') and date(':param1_1_:'||'-'||'mm'||'-28')+interval '4 days'-interval'1 minute' 
and date_part('month',v.data_vnes_inf)='mm' 
and date_part('year',v.data_vnes_inf)=':param1_1_:'</Sql>
            </Query>
            <Query>
              <Sql>zapros2(mm,ddolg) SELECT count(distinct visit_id)  FROM visit_tab v 
JOIN talon_tab t ON t.talon_id=v.talon_id and t.result_id IS NOT NULL 
JOIN full_doctor_tab f ON f.doctor_id = v.doctor_id and f.dolg_doctor_id in (ddolg) 
WHERE 
v.data_vnes_inf between date(':param1_1_:'||'-'||'mm'||'-01')-interval'1 year' 
and date(':param1_1_:'||'-'||'mm'||'-28')+interval '4 days'-interval'1 minute'-interval'1 year' 
and date_part('month',v.data_vnes_inf)='mm' 
and date_part('year',v.data_vnes_inf)::integer=':param1_1_:'::integer-1</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Выберите год:" Type="select">
              <Sql>select '2005'::integer +f.a as p1, '2005'::integer +f.a as p2 from generate_series(0,20) as f(a)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="9403000" Name="Флюоропаспорт" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Флюоропаспорт.xls">
          <Queries>
            <Query>
              <Sql>lpu_name select value from settings_tab where name = 'LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select distinct case when ':param2_1_:' = 'true' then 'Все отделения'::text else (select nam_otdel 
from otdel_tab f 
where f.otdel::text=':param2_1_:') end</Sql>
            </Query>
            <Query>
              <Sql>zapros2(date11,date12) select 
count(*) 
from dan_tab d 
join researches.fluorography_tab fl ON fl.dan_id = d.dan_id 
where fl.date_analisis between date(date_part('year',date(':param1_1_:'))||'-date11') and date(date_part('year',date(':param1_1_:'))||'-date12') and get_vozrast(d.date_born) between :param3_1_: and :param4_1_: 
and (d.uchactok_id = :param5_1_: or :param5_1_:=-1)</Sql>
            </Query>
            <Query>
              <Sql>zapros2feb select 
count(*) 
from dan_tab d 
join researches.fluorography_tab fl ON fl.dan_id = d.dan_id 
where fl.date_analisis between date(date_part('year',date(':param1_1_:'))||'-02-01') and date(date_part('year',date(':param1_1_:'))||'-03-01')-interval '1 day' and get_vozrast(d.date_born) between :param3_1_: and :param4_1_: 
and (d.uchactok_id = :param5_1_: or :param5_1_:=-1)</Sql>
            </Query>
            <Query>
              <Sql>zapros3(date11,date12,rdd) select 
count(*) 
from dan_tab d 
join researches.fluorography_tab fl ON fl.dan_id = d.dan_id 
where fl.date_analisis between date(date_part('year',date(':param1_1_:'))||'-date11') and date(date_part('year',date(':param1_1_:'))||'-date12') and get_vozrast(d.date_born) between :param3_1_: and :param4_1_: 
and d.risk_id=rdd 
and (d.uchactok_id = :param5_1_: or :param5_1_:=-1)</Sql>
            </Query>
            <Query>
              <Sql>zapros3feb(rdd) select 
count(*) 
from dan_tab d 
join researches.fluorography_tab fl ON fl.dan_id = d.dan_id 
where fl.date_analisis between date(date_part('year',date(':param1_1_:'))||'-02-01') and date(date_part('year',date(':param1_1_:'))||'-03-01')-interval '1 day' and get_vozrast(d.date_born) between :param3_1_: and :param4_1_: 
and d.risk_id=rdd 
and (d.uchactok_id = :param5_1_: or :param5_1_:=-1)</Sql>
            </Query>
            <Query>
              <Sql>zapros4(date11,date12) select 
count(*) 
from dan_tab d 
join researches.fluorography_tab fl ON fl.dan_id = d.dan_id 
where fl.date_analisis between date(date_part('year',date(':param1_1_:'))||'-date11') and date(date_part('year',date(':param1_1_:'))||'-date12') and get_vozrast(d.date_born) between :param3_1_: and :param4_1_: 
and (d.uchactok_id = :param5_1_: or :param5_1_:=-1) and get_vozrast(d.date_born) &gt;15</Sql>
            </Query>
            <Query>
              <Sql>zapros4feb select 
count(*) 
from dan_tab d 
join researches.fluorography_tab fl ON fl.dan_id = d.dan_id 
where fl.date_analisis between date(date_part('year',date(':param1_1_:'))||'-02-01') and date(date_part('year',date(':param1_1_:'))||'-03-01')-interval '1 day' and get_vozrast(d.date_born) between :param3_1_: and :param4_1_: 
and (d.uchactok_id = :param5_1_: or :param5_1_:=-1) and get_vozrast(d.date_born) &gt;15</Sql>
            </Query>
            <Query>
              <Sql>zapros5 select distinct case when ':param5_1_:' = '-1' then 'Все участки'::text else (select uchactok 
from uchactok_tab u 
where u.uchactok_id=:param5_1_:) end</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Отделение" Type="select">
              <Sql>SELECT 'true'::text, 'Все отделения'::text, 0  UNION  SELECT o.otdel::text,o.nam_otdel, 1 FROm otdel_tab o  ORDER BY 3,2 </Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param4" Caption="По возраст" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="С возраста" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="param5" Caption="Участок" Type="select">
              <Sql>select -1, 'Все' union select uchactok_id, uchactok from uchactok_tab</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="9603000" Name="Форма 19" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 19.xls">
          <Queries>
            <Query>
              <Sql>count_inval(age1,age2,sx) select count(*) from dan_tab d 
where d.inval_id is not null 
and d.sex ='sx' 
and (DATE_PART('year',AGE(date(':param1_2_:'), d.date_born)) BETWEEN age1 AND age2 )</Sql>
            </Query>
            <Query>
              <Sql>count_inval_first(age1,age2,sx) select count(*) from dan_tab d 
where d.inval_id is not null 
and d.sex ='sx' 
and (DATE_PART('year',AGE(date(':param1_2_:'), d.date_born)) BETWEEN age1 AND age2 ) 
and pred_inval_id is null</Sql>
            </Query>
            <Query>
              <Sql>lpu_address select value from settings_tab where name ='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name = 'LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros0(sx,age1,age2,mkb1,mkb2) select count(*) from dan_tab d 
left join dispan_uchet_tab du ON d.dan_id = du.dan_id 
where d.inval_id is not null 
and d.sex ='sx' 
AND (DATE_PART('year',AGE(date(':param1_2_:'), d.date_born)) BETWEEN age1 AND age2 ) 
and du.diagn_id between 'mkb1' and 'mkb2'</Sql>
            </Query>
            <Query>
              <Sql>zapros1(sx,age1,age2,mkb1,mkb2,mkb3,mkb4) select count(*) from dan_tab d 
left join dispan_uchet_tab du ON d.dan_id = du.dan_id 
where d.inval_id is not null 
and d.sex ='sx' 
AND (DATE_PART('year',AGE(date(':param1_2_:'), d.date_born)) BETWEEN age1 AND age2 ) 
and (du.diagn_id between 'mkb1' and 'mkb2' OR du.diagn_id between 'mkb3' and 'mkb4')</Sql>
            </Query>
            <Query>
              <Sql>zapros2(sx,age1,age2) select count(*) from dan_tab d 
left join dispan_uchet_tab du ON d.dan_id = du.dan_id 
where d.inval_id is not null 
and d.sex ='sx' 
AND (DATE_PART('year',AGE(date(':param1_2_:'), d.date_born)) BETWEEN age1 AND age2 ) 
and du.diagn_id between 'F80' and 'F98.9' 
and NOT (du.diagn_id between 'F84.0' and 'F84.4')</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="12000000" Name="Отчет по объему оказанной стоматологической помощи гражданам, подвергшимся воздействию радиации" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Отчет по объему оказанной стоматологической помощи гражданам, подвергшимся воздействию радиации.xls">
          <Queries>
            <Query>
              <Sql>zapros1(flg) select count(distinct disp.dan_id) from dispan_uchet_tab disp 
left join 
(SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) f ON f.dan_id = disp.dan_id 
where f.lgota in (flg) 
and (disp.date&lt;=date (':param1_1_:'||'-12-31')-interval '1 year') and 
((disp.date_sn is NULL) or ((disp.date_sn is not NULL) and (disp.date_sn&gt;date (':param1_1_:'||'-12-31')-interval '1 year')))</Sql>
            </Query>
            <Query>
              <Sql>zapros2(flg) select count(distinct disp.dan_id) from dispan_uchet_tab disp 
left join 
(SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) f ON f.dan_id = disp.dan_id 
where f.lgota in (flg) 
and (disp.date between date(':param1_1_:'||'-01-01') and date(':param1_1_:'||'-12-31'))</Sql>
            </Query>
            <Query>
              <Sql>zapros3(prsn,flg) select count(distinct disp.dan_id) from dispan_uchet_tab disp 
left join 
(SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) f ON f.dan_id = disp.dan_id 
where f.lgota in (flg) 
and disp.date &lt;date(':param1_1_:'||'-12-31') and disp.date_sn&gt;date(':param1_1_:'||'-01-01') and disp.prichin_sn_id = prsn</Sql>
            </Query>
            <Query>
              <Sql>zapros4(flg) select count(distinct disp.dan_id) from dispan_uchet_tab disp 
left join 
(SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) f ON f.dan_id = disp.dan_id 
where f.lgota in (flg) 
and (disp.date&lt;=date (':param1_1_:'||'-12-31')) and 
((disp.date_sn is NULL) or ((disp.date_sn is not NULL) and (disp.date_sn&gt;date (':param1_1_:'||'-12-31'))))</Sql>
            </Query>
            <Query>
              <Sql>zapros5(flg) select count(distinct disp.dan_id) from dispan_uchet_tab disp 
left join 
(SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) f ON f.dan_id = disp.dan_id 
left join talon_tab t ON disp.dan_id = t.dan_id 
left join visit_tab v ON v.talon_id = t.talon_id 
where f.lgota in (flg) 
and v.data_pos between date(':param1_1_:'||'-01-01') and date(':param1_1_:'||'-12-31') 
and v.target_pos_id = 4 ---посещение с целью профилактики</Sql>
            </Query>
            <Query>
              <Sql>zapros7 select distinct '$id'::text,  f.fam||' '||f.nam||' '||conv_to_null(f.mid) as fio, f.date_born, f.adr, f.floga, t.diag_osn, v.data_pos, stp.kod_usl, doc.full_fio 
from 
dispan_uchet_tab disp 
join (select distinct dan_id from 
(SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota FROm fed_lgota_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) q 
where q.lgota in ('092','093','094','098','110','113','123','124','128','131','132')) q ON disp.dan_id = q.dan_id 
left join fed_lgota_tab f ON f.dan_id = disp.dan_id 
left join talon_tab t ON disp.dan_id = t.dan_id 
left join visit_tab v ON v.talon_id = t.talon_id 
left join full_doctor_tab doc ON v.doctor_id = doc.doctor_id 
left join stand_patient_tab stp ON stp.talon_id = t.talon_id 
where v.data_pos between date(':param1_1_:'||'-01-01') and date(':param1_1_:'||'-12-31') 
and doc.dolg_doctor_id in (97,98)</Sql>
            </Query>
            <Query>
              <Sql>zapros6(ddolg,flg) select count(distinct disp.dan_id) from dispan_uchet_tab disp 
left join 
(SELECT f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota, f.pens as pens FROm fed_lgota_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null AND split_part(trim(f.floga), ',', t.a) is not null  AND split_part(trim(f.floga), ',', t.a) != '' ) f ON f.dan_id = disp.dan_id 
left join talon_tab t ON disp.dan_id = t.dan_id 
left join visit_tab v ON v.talon_id = t.talon_id 
left join full_doctor_tab doc ON v.doctor_id = doc.doctor_id 
where f.lgota in (flg) 
and v.data_pos between date(':param1_1_:'||'-01-01') and date(':param1_1_:'||'-12-31') 
and doc.dolg_doctor_id=ddolg</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Выберите год:" Type="select">
              <Sql>select '2000'::integer +f.a as p1, '2000'::integer +f.a as p2 from generate_series(0,20) as f(a)</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2007121802" Name="Форма 16" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 16.xls">
          <Queries>
            <Query>
              <Sql>count_blist_1(mkb_1,mkb_2,s_sex) SELECT count(distinct blist_id) 
FROM report_blist_tab 
WHERE NOT last_year 
AND diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2' 
AND sex = 's_sex';</Sql>
            </Query>
            <Query>
              <Sql>count_blist_12(mkb_1,mkb_2,s_sex,age1,age2) SELECT count(distinct blist_id) 
FROM report_blist_tab 
WHERE NOT last_year 
AND diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2' 
AND sex = 's_sex' 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>count_blist_2(mkb_1,mkb_2,mkb_3,mkb_4,s_sex) SELECT count(distinct blist_id) 
FROM report_blist_tab 
WHERE NOT last_year 
AND (diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2' OR diag_mkb_id BETWEEN 'mkb_3' AND 'mkb_4') 
AND sex = 's_sex';</Sql>
            </Query>
            <Query>
              <Sql>count_blist_22(mkb_1,mkb_2,mkb_3,mkb_4,s_sex,age1,age2) SELECT count(distinct blist_id) 
FROM report_blist_tab 
WHERE NOT last_year 
AND (diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2' OR diag_mkb_id BETWEEN 'mkb_3' AND 'mkb_4') 
AND sex = 's_sex' 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>count_blist_3(mkb_1,mkb_2,mkb_3,mkb_4,mkb5,mkb6,mkb7,mkb8,mkb9,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,s_sex) SELECT count(distinct blist_id) 
FROM report_blist_tab 
WHERE NOT last_year 
AND ((diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2') OR 
   (diag_mkb_id BETWEEN 'mkb_3' AND 'mkb_4') OR 
   (diag_mkb_id BETWEEN 'mkb5' AND 'mkb6') OR 
   (diag_mkb_id BETWEEN 'mkb7' AND 'mkb8') OR 
   (diag_mkb_id BETWEEN 'mkb9' AND 'mkb10') OR 
   (diag_mkb_id BETWEEN 'mkb11' AND 'mkb12') OR 
   (diag_mkb_id BETWEEN 'mkb13' AND 'mkb14') OR 
   (diag_mkb_id BETWEEN 'mkb15' AND 'mkb16') OR 
   (diag_mkb_id BETWEEN 'mkb17' AND 'mkb18')) 
AND sex = 's_sex';</Sql>
            </Query>
            <Query>
              <Sql>count_blist_32(mkb_1,mkb_2,mkb_3,mkb_4,mkb5,mkb6,mkb7,mkb8,mkb9,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,s_sex,age1,age2) SELECT count(distinct blist_id) 
FROM report_blist_tab 
WHERE NOT last_year 
AND ((diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2') OR 
   (diag_mkb_id BETWEEN 'mkb_3' AND 'mkb_4') OR 
   (diag_mkb_id BETWEEN 'mkb5' AND 'mkb6') OR 
   (diag_mkb_id BETWEEN 'mkb7' AND 'mkb8') OR 
   (diag_mkb_id BETWEEN 'mkb9' AND 'mkb10') OR 
   (diag_mkb_id BETWEEN 'mkb11' AND 'mkb12') OR 
   (diag_mkb_id BETWEEN 'mkb13' AND 'mkb14') OR 
   (diag_mkb_id BETWEEN 'mkb15' AND 'mkb16') OR 
   (diag_mkb_id BETWEEN 'mkb17' AND 'mkb18')) 
AND sex = 's_sex' 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>count_blist_4(mkb_1,mkb_2,mkb_3,mkb_4,mkb5,mkb6,mkb7,mkb8,mkb9,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,s_sex) SELECT count(distinct blist_id) 
FROM report_blist_tab 
WHERE NOT last_year 
AND ((diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2') OR 
   (diag_mkb_id BETWEEN 'mkb_3' AND 'mkb_4') OR 
   (diag_mkb_id BETWEEN 'mkb5' AND 'mkb6') OR 
   (diag_mkb_id BETWEEN 'mkb7' AND 'mkb8') OR 
   (diag_mkb_id BETWEEN 'mkb9' AND 'mkb10') OR 
   (diag_mkb_id BETWEEN 'mkb11' AND 'mkb12') OR 
   (diag_mkb_id BETWEEN 'mkb13' AND 'mkb14') OR 
   (diag_mkb_id BETWEEN 'mkb15' AND 'mkb16') OR 
   (diag_mkb_id BETWEEN 'mkb17' AND 'mkb18') OR 
   (diag_mkb_id BETWEEN 'mkb19' AND 'mkb20') OR 
   (diag_mkb_id BETWEEN 'mkb21' AND 'mkb22') OR 
   (diag_mkb_id BETWEEN 'mkb23' AND 'mkb24') OR 
   (diag_mkb_id BETWEEN 'mkb25' AND 'mkb26') OR 
   (diag_mkb_id BETWEEN 'mkb27' AND 'mkb28') OR 
   (diag_mkb_id BETWEEN 'mkb29' AND 'mkb30')) 
AND sex = 's_sex';</Sql>
            </Query>
            <Query>
              <Sql>count_blist_42(mkb_1,mkb_2,mkb_3,mkb_4,mkb5,mkb6,mkb7,mkb8,mkb9,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,s_sex,age1,age2) SELECT count(distinct blist_id) 
FROM report_blist_tab 
WHERE NOT last_year 
AND ((diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2') OR 
   (diag_mkb_id BETWEEN 'mkb_3' AND 'mkb_4') OR 
   (diag_mkb_id BETWEEN 'mkb5' AND 'mkb6') OR 
   (diag_mkb_id BETWEEN 'mkb7' AND 'mkb8') OR 
   (diag_mkb_id BETWEEN 'mkb9' AND 'mkb10') OR 
   (diag_mkb_id BETWEEN 'mkb11' AND 'mkb12') OR 
   (diag_mkb_id BETWEEN 'mkb13' AND 'mkb14') OR 
   (diag_mkb_id BETWEEN 'mkb15' AND 'mkb16') OR 
   (diag_mkb_id BETWEEN 'mkb17' AND 'mkb18') OR 
   (diag_mkb_id BETWEEN 'mkb19' AND 'mkb20') OR 
   (diag_mkb_id BETWEEN 'mkb21' AND 'mkb22') OR 
   (diag_mkb_id BETWEEN 'mkb23' AND 'mkb24') OR 
   (diag_mkb_id BETWEEN 'mkb25' AND 'mkb26') OR 
   (diag_mkb_id BETWEEN 'mkb27' AND 'mkb28') OR 
   (diag_mkb_id BETWEEN 'mkb29' AND 'mkb30')) 
AND sex = 's_sex' 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>count_blist_5(_prich,s_sex,age1,age2) SELECT count(distinct blist_id) 
FROM report_blist_tab 
WHERE NOT last_year 
AND sex = 's_sex' 
AND reason_id = _prich 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>end_report DROP TABLE report_blist_tab; 
SELECT '';</Sql>
            </Query>
            <Query>
              <Sql>init_report SELECT drop_if_exists('report_blist_tab'); 
 
CREATE TEMP TABLE report_blist_tab 
(age INTEGER, 
sex VARCHAR(1), 
duration integer, 
reason_id bigint, 
diag_mkb_id varchar, 
blist_id bigint PRIMARY KEY, 
last_year bool 
); 
  
 
INSERT INTO report_blist_tab(age, sex,duration,reason_id,diag_mkb_id,blist_id,last_year) 
(SELECT DATE_PART('year',AGE(date(':param1_2_:'), d.date_born)),d.sex,b.data_end - b.data_begin + 1, 
b.prichina_id, b.diag_mkb_id, b.blist_id, 
CASE WHEN b.data_end BETWEEN date(':param1_1_:') AND date(':param1_2_:') THEN false ELSE true END 
FROM blist_tab b 
LEFT JOIN dan_tab d ON d.dan_id = b.dan_id 
LEFT JOIN ( SELECT DISTINCT b1.blist_id, b1.doctor_id FROM blist_extend_tab b1 
JOIN ( SELECT min(date_from) AS datef, blist_id 
FROM blist_extend_tab group by blist_id ) b2 ON b2.blist_id = b1.blist_id 
AND b1.date_from = b2.datef ) bext ON bext.blist_id = b.blist_id 
LEFT JOIN full_doctor_tab doc ON bext.doctor_id = doc.doctor_id 
WHERE (b.data_end BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
OR b.data_end BETWEEN date(':param1_1_:')-'1 year'::interval AND date(':param1_2_:')-'1 year'::interval) 
AND :type_1_:  
AND :district_1_: 
and :param2_1_: 
and :param6_1_: 
and :param4_1_: 
and b.type_id!=8 
and d.spolref::int8 in (select * from get_all_lpu_numbers())); 
 
 
CREATE INDEX "report_blist_tab_diag_idx" ON "report_blist_tab" 
  USING btree ("diag_mkb_id"); 
  
CREATE INDEX "report_blist_tab_age_idx" ON "report_blist_tab" 
  USING btree ("age"); 
 
SELECT '  ';</Sql>
            </Query>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>sum_days_1(mkb_1,mkb_2,s_sex) SELECT CASE WHEN SUM(m) IS NULL THEN 0 ELSE SUM(m) END FROM ( 
SELECT SUM(duration) AS m 
FROM report_blist_tab 
WHERE NOT last_year 
AND diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2' 
AND sex = 's_sex') AS sub;</Sql>
            </Query>
            <Query>
              <Sql>sum_days_2(mkb_1,mkb_2,mkb_3,mkb_4,s_sex) SELECT CASE WHEN SUM(m) IS NULL THEN 0 ELSE SUM(m) END FROM ( 
SELECT SUM(duration) AS m 
FROM report_blist_tab 
WHERE NOT last_year 
AND (diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2' OR diag_mkb_id BETWEEN 'mkb_3' AND 'mkb_4') 
AND sex = 's_sex') AS sub;</Sql>
            </Query>
            <Query>
              <Sql>sum_days_3(mkb_1,mkb_2,mkb_3,mkb_4,mkb5,mkb6,mkb7,mkb8,mkb9,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,s_sex) SELECT CASE WHEN SUM(m) IS NULL THEN 0 ELSE SUM(m) END FROM ( 
SELECT SUM(duration) AS m 
FROM report_blist_tab 
WHERE NOT last_year 
AND ((diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2') OR 
   (diag_mkb_id BETWEEN 'mkb_3' AND 'mkb_4') OR 
   (diag_mkb_id BETWEEN 'mkb5' AND 'mkb6') OR 
   (diag_mkb_id BETWEEN 'mkb7' AND 'mkb8') OR 
   (diag_mkb_id BETWEEN 'mkb9' AND 'mkb10') OR 
   (diag_mkb_id BETWEEN 'mkb11' AND 'mkb12') OR 
   (diag_mkb_id BETWEEN 'mkb13' AND 'mkb14') OR 
   (diag_mkb_id BETWEEN 'mkb15' AND 'mkb16') OR 
   (diag_mkb_id BETWEEN 'mkb17' AND 'mkb18')) 
AND sex = 's_sex') AS sub;</Sql>
            </Query>
            <Query>
              <Sql>sum_days_4(mkb_1,mkb_2,mkb_3,mkb_4,mkb5,mkb6,mkb7,mkb8,mkb9,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,s_sex) SELECT CASE WHEN SUM(m) IS NULL THEN 0 ELSE SUM(m) END FROM ( 
SELECT SUM(duration) AS m 
FROM report_blist_tab 
WHERE NOT last_year 
AND ((diag_mkb_id BETWEEN 'mkb_1' AND 'mkb_2') OR 
   (diag_mkb_id BETWEEN 'mkb_3' AND 'mkb_4') OR 
   (diag_mkb_id BETWEEN 'mkb5' AND 'mkb6') OR 
   (diag_mkb_id BETWEEN 'mkb7' AND 'mkb8') OR 
   (diag_mkb_id BETWEEN 'mkb9' AND 'mkb10') OR 
   (diag_mkb_id BETWEEN 'mkb11' AND 'mkb12') OR 
   (diag_mkb_id BETWEEN 'mkb13' AND 'mkb14') OR 
   (diag_mkb_id BETWEEN 'mkb15' AND 'mkb16') OR 
   (diag_mkb_id BETWEEN 'mkb17' AND 'mkb18') OR 
   (diag_mkb_id BETWEEN 'mkb19' AND 'mkb20') OR 
   (diag_mkb_id BETWEEN 'mkb21' AND 'mkb22') OR 
   (diag_mkb_id BETWEEN 'mkb23' AND 'mkb24') OR 
   (diag_mkb_id BETWEEN 'mkb25' AND 'mkb26') OR 
   (diag_mkb_id BETWEEN 'mkb27' AND 'mkb28') OR 
   (diag_mkb_id BETWEEN 'mkb29' AND 'mkb30')) 
AND sex = 's_sex') AS sub;</Sql>
            </Query>
            <Query>
              <Sql>sum_days_5(_prich,s_sex) SELECT CASE WHEN SUM(m) IS NULL THEN 0 ELSE SUM(m) END FROM ( 
SELECT sum(duration)  AS m 
FROM report_blist_tab 
WHERE NOT last_year 
AND reason_id = _prich 
AND sex = 's_sex') AS sub;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Врач" Type="select">
              <Sql>SELECT 'true', 'Все врачи', 0  UNION  SELECT 'b.doctor_id='||f.full_doctor_id::varchar, f.full_fio,1 FROm full_doctor_view f where expiration_date&gt;=now() ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Отделение" Type="select">
              <Sql>SELECT 'true'::text, 'Все отделения'::text, 0  UNION  SELECT distinct 'doc.otdel::integer='||o.otdel::text,o.nam_otdel, 1 FROm otdel_tab o left join full_doctor_tab doc ON doc.otdel=o.otdel::text ORDER BY 3,2 </Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param6" Caption="Специальность врача" Type="select">
              <Sql>SELECT 'true'::text, 'Все специальности'::text, 0  UNION  SELECT distinct '(doc.dolg_doctor_id='||dolg_doctor_id::text||' OR (b.doctor_id is null and doc.dolg_doctor_id='||dolg_doctor_id::text||'))', doc.dolg_doctor, 1 FROm full_doctor_tab doc ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="type" Caption="Тип документа ВН" Type="select">
              <Sql>SELECT 'true' , 'все документы ВН',0 UNION SELECT 'b.type_id = '||type_id::varchar, type_name,1 FROM sp_blist_type_tab WHERE (type_id &gt;= 0) ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT 'true' , 'по всему ЛПУ',-1 UNION SELECT 'd.uchactok_id='||uchactok_id::varchar, uchactok,uchactok_id  FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY 3</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2007121803" Name="Форма 30" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 30.xls">
          <Queries>
            <Query>
              <Sql>akusherginekolog 39</Sql>
            </Query>
            <Query>
              <Sql>all_specialist terapevtall, kardiolog, gastroenterolog, endokrinolog, dermatolog, infectionist, hirurg_main, travmatolog, yrolog, allergolog, oftalmolog, otoloringolog, nevrolog, VOP, revmatolog, foniator, onkolog, psihiator, akusherginekolog, pulmonolog, nefrolog, gematolog, fizioterapeft, lfk, neirohirurg, stomatolog, 
manual_terapevt, pediatr, surdolog_otolar, chel_hirurg</Sql>
            </Query>
            <Query>
              <Sql>allergolog 42</Sql>
            </Query>
            <Query>
              <Sql>chel_hirurg 53</Sql>
            </Query>
            <Query>
              <Sql>count_pos_all_2102 SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
AND talon_tab.vid_oplat_id IN (2,4) 
 
 
--and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(vid_oplat1))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_all1 SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_all2(specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_all1 SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_all2(specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_seek1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_seek2(specialist,age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home2(specialist,age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_pervichn(specialist,age1,age2) SELECT COUNT(distinct talon_tab.dan_id) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
and (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2)</Sql>
            </Query>
            <Query>
              <Sql>count_pos_seek1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_seek2(specialist,age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_seek3(specialist,age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
and talon_tab.vid_oplat_id in (0,3)</Sql>
            </Query>
            <Query>
              <Sql>count_pos_sh_all1 SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (cityzen = 0) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_sh_all2(specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (cityzen = 0) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>dermatolog 18</Sql>
            </Query>
            <Query>
              <Sql>disablement_dispensary_list(disablement_id) SELECT ( 
 SELECT COUNT(DISTINCT du.dan_id) 
 FROM dispan_uchet_tab du 
 LEFT JOIN dan_tab d ON (d.dan_id = du.dan_id) 
 WHERE ((disablement_id &lt; 0) OR (d.inval_id = disablement_id)) 
  AND ((du.date_sn IS NULL) OR (du.date_sn &lt; ':param1_2_:')) 
  AND (get_vozrast(d.date_born) &gt;= 18) 
  AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
) AS dispensary_count, ( 
 SELECT COUNT(DISTINCT d.dan_id) 
 FROM inval_client_tab i 
 LEFT JOIN talon_tab t ON (t.talon_id = i.talon_id) 
 LEFT JOIN dan_tab d ON (d.dan_id = t.dan_id) 
 LEFT JOIN dispan_uchet_tab du ON (du.dan_id = d.dan_id) 
 WHERE ((disablement_id &lt; 0) OR (d.inval_id = disablement_id)) 
  AND ((du.date_sn IS NULL) OR (du.date_sn &lt; ':param1_2_:')) 
  AND (get_vozrast(d.date_born) &gt;= 18) 
  AND (date_part('year', i.date_change) = date_part('year', date(':param1_2_:'))) 
  AND ((i.last_inval IS NULL) OR (i.last_inval &lt;= 0)) 
  AND (i.current &gt; 0) 
  AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
) AS find_at_current_year, ( 
 SELECT COUNT(DISTINCT du.dan_id) 
 FROM dispan_uchet_tab du 
 LEFT JOIN dan_tab d ON (d.dan_id = du.dan_id) 
 WHERE ((disablement_id &lt; 0) OR (d.inval_id = disablement_id)) 
  AND ((du.date_sn IS NULL) OR (du.date_sn &lt; ':param1_2_:')) 
  AND (get_vozrast(d.date_born) &gt;= 18) 
  AND (d.inv_child) 
  AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
) AS invalid_from_childhood</Sql>
            </Query>
            <Query>
              <Sql>endokrinolog 17</Sql>
            </Query>
            <Query>
              <Sql>fizioterapeft 21</Sql>
            </Query>
            <Query>
              <Sql>foniator 93</Sql>
            </Query>
            <Query>
              <Sql>ftiziatr 7</Sql>
            </Query>
            <Query>
              <Sql>gastroenterolog 15</Sql>
            </Query>
            <Query>
              <Sql>gematolog 28</Sql>
            </Query>
            <Query>
              <Sql>hirurg_main 25</Sql>
            </Query>
            <Query>
              <Sql>infectionist 19</Sql>
            </Query>
            <Query>
              <Sql>kardiolog 14</Sql>
            </Query>
            <Query>
              <Sql>lfk 22</Sql>
            </Query>
            <Query>
              <Sql>manual_terapevt 95</Sql>
            </Query>
            <Query>
              <Sql>nefrolog 8</Sql>
            </Query>
            <Query>
              <Sql>neirohirurg 36</Sql>
            </Query>
            <Query>
              <Sql>nevrolog 49</Sql>
            </Query>
            <Query>
              <Sql>oftalmolog 43</Sql>
            </Query>
            <Query>
              <Sql>onkolog 6</Sql>
            </Query>
            <Query>
              <Sql>otoloringolog 44</Sql>
            </Query>
            <Query>
              <Sql>pediatr 10</Sql>
            </Query>
            <Query>
              <Sql>psihiator 2, 35</Sql>
            </Query>
            <Query>
              <Sql>pulmonolog 16</Sql>
            </Query>
            <Query>
              <Sql>revmatolog 79</Sql>
            </Query>
            <Query>
              <Sql>stomatolog 97,98</Sql>
            </Query>
            <Query>
              <Sql>surdolog_otolar 1</Sql>
            </Query>
            <Query>
              <Sql>t2600z1 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%020%' and floga not like '%010%'  and floga not like '%030%') 
and du.date&lt;':param1_1_:' and (du.date_sn&gt;':param1_1_:' or du.date_sn is null)</Sql>
            </Query>
            <Query>
              <Sql>t2600z10 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
f.floga like '%030%' 
and du.date between ':param1_1_:' and ':param1_2_:'</Sql>
            </Query>
            <Query>
              <Sql>t2600z11(prich_sn) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
f.floga like '%030%' 
and du.date_sn between ':param1_1_:' and ':param1_2_:' 
and prich_sn</Sql>
            </Query>
            <Query>
              <Sql>t2600z12(gr_inval) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
f.floga like '%030%' 
and du.date&lt;':param1_2_:' and (du.date_sn&gt;':param1_2_:' or du.date_sn is null) 
and gr_inval</Sql>
            </Query>
            <Query>
              <Sql>t2600z2 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%020%' and floga not like '%010%'  and floga not like '%030%') 
and du.date between ':param1_1_:' and ':param1_2_:'</Sql>
            </Query>
            <Query>
              <Sql>t2600z3(prich_sn) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%020%' and floga not like '%010%'  and floga not like '%030%') 
and du.date_sn between ':param1_1_:' and ':param1_2_:' 
and prich_sn</Sql>
            </Query>
            <Query>
              <Sql>t2600z4(gr_inval) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%020%' and floga not like '%010%'  and floga not like '%030%') 
and du.date&lt;':param1_2_:' and (du.date_sn&gt;':param1_2_:' or du.date_sn is null) 
and gr_inval</Sql>
            </Query>
            <Query>
              <Sql>t2600z5 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%010%' and floga not like '%030%' ) 
and du.date&lt;':param1_1_:' and (du.date_sn&gt;':param1_1_:' or du.date_sn is null)</Sql>
            </Query>
            <Query>
              <Sql>t2600z6 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%010%' and floga not like '%030%' ) 
and du.date between ':param1_1_:' and ':param1_2_:'</Sql>
            </Query>
            <Query>
              <Sql>t2600z7(prich_sn) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%010%' and floga not like '%030%' ) 
and du.date_sn between ':param1_1_:' and ':param1_2_:' 
and prich_sn</Sql>
            </Query>
            <Query>
              <Sql>t2600z8(gr_inval) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%010%' and floga not like '%030%' ) 
and du.date&lt;':param1_2_:' and (du.date_sn&gt;':param1_2_:' or du.date_sn is null) 
and gr_inval</Sql>
            </Query>
            <Query>
              <Sql>t2600z9 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
f.floga like '%030%' 
and du.date&lt;':param1_1_:' and (du.date_sn&gt;':param1_1_:' or du.date_sn is null)</Sql>
            </Query>
            <Query>
              <Sql>terapevtall terapevtsimple,terapevtpodrostkoviy</Sql>
            </Query>
            <Query>
              <Sql>terapevtpodrostkoviy 40</Sql>
            </Query>
            <Query>
              <Sql>terapevtsimple 11</Sql>
            </Query>
            <Query>
              <Sql>travmatolog 26, 24</Sql>
            </Query>
            <Query>
              <Sql>VOP 50</Sql>
            </Query>
            <Query>
              <Sql>yrolog 27</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2007121804" Name="Форма 30 (приложение)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 30 (приложение).xls">
          <Queries>
            <Query>
              <Sql>akusherginekolog 39</Sql>
            </Query>
            <Query>
              <Sql>all_specialist terapevtall, kardiolog, gastroenterolog, endokrinolog, dermatolog, infectionist, hirurg, travmatolog, yrolog, allergolog, oftalmolog, otoloringolog, nevrolog, VOP, revmatolog, foniator, onkolog, psihiator, akusherginekolog</Sql>
            </Query>
            <Query>
              <Sql>allergolog 42</Sql>
            </Query>
            <Query>
              <Sql>count_pos_all1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_all2(age1,age2,specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_all1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_all2(age1,age2,specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_seek1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_seek2(age1,age2,specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home2(age1,age2,specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_seek1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_seek2(age1,age2,specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_sh_all1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (cityzen = 0) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_sh_all2(age1,age2,specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (cityzen = 0) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>dermatolog 18</Sql>
            </Query>
            <Query>
              <Sql>endokrinolog 17</Sql>
            </Query>
            <Query>
              <Sql>foniator 93</Sql>
            </Query>
            <Query>
              <Sql>gastroenterolog 15</Sql>
            </Query>
            <Query>
              <Sql>hirurg 25</Sql>
            </Query>
            <Query>
              <Sql>infectionist 19</Sql>
            </Query>
            <Query>
              <Sql>kardiolog 14</Sql>
            </Query>
            <Query>
              <Sql>nevrolog 49</Sql>
            </Query>
            <Query>
              <Sql>oftalmolog 43</Sql>
            </Query>
            <Query>
              <Sql>onkolog 6</Sql>
            </Query>
            <Query>
              <Sql>otoloringolog 44</Sql>
            </Query>
            <Query>
              <Sql>psihiator 12</Sql>
            </Query>
            <Query>
              <Sql>revmatolog 79</Sql>
            </Query>
            <Query>
              <Sql>terapevtall terapevtsimple,terapevtpodrostkoviy</Sql>
            </Query>
            <Query>
              <Sql>terapevtpodrostkoviy 40</Sql>
            </Query>
            <Query>
              <Sql>terapevtsimple 11</Sql>
            </Query>
            <Query>
              <Sql>travmatolog 26</Sql>
            </Query>
            <Query>
              <Sql>VOP 50</Sql>
            </Query>
            <Query>
              <Sql>yrolog 27</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2007121805" Name="Форма 57" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 57.xls">
          <Queries>
            <Query>
              <Sql>func_1(mkb01,mkb02,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn BETWEEN 'mkb01' AND 'mkb02') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_15(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_16(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_2(mkb01,mkb02,mkb03,mkb04,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_20(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_24(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,mkb41,mkb42,mkb43,mkb44,mkb45,mkb46,mkb47,mkb48,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40') OR 
  (diagn_osn BETWEEN 'mkb41' AND 'mkb42') OR 
  (diagn_osn BETWEEN 'mkb43' AND 'mkb44') OR 
  (diagn_osn BETWEEN 'mkb45' AND 'mkb46') OR 
  (diagn_osn BETWEEN 'mkb47' AND 'mkb48')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_29(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,mkb41,mkb42,mkb43,mkb44,mkb45,mkb46,mkb47,mkb48,mkb49,mkb50,mkb51,mkb52,mkb53,mkb54,mkb55,mkb56,mkb57,mkb58,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40') OR 
  (diagn_osn BETWEEN 'mkb41' AND 'mkb42') OR 
  (diagn_osn BETWEEN 'mkb43' AND 'mkb44') OR 
  (diagn_osn BETWEEN 'mkb45' AND 'mkb46') OR 
  (diagn_osn BETWEEN 'mkb47' AND 'mkb48') OR 
  (diagn_osn BETWEEN 'mkb49' AND 'mkb50') OR 
  (diagn_osn BETWEEN 'mkb51' AND 'mkb52') OR 
  (diagn_osn BETWEEN 'mkb53' AND 'mkb54') OR 
  (diagn_osn BETWEEN 'mkb55' AND 'mkb56') OR 
  (diagn_osn BETWEEN 'mkb57' AND 'mkb58')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_30(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,mkb41,mkb42,mkb43,mkb44,mkb45,mkb46,mkb47,mkb48,mkb49,mkb50,mkb51,mkb52,mkb53,mkb54,mkb55,mkb56,mkb57,mkb58,mkb59,mkb60,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40') OR 
  (diagn_osn BETWEEN 'mkb41' AND 'mkb42') OR 
  (diagn_osn BETWEEN 'mkb43' AND 'mkb44') OR 
  (diagn_osn BETWEEN 'mkb45' AND 'mkb46') OR 
  (diagn_osn BETWEEN 'mkb47' AND 'mkb48') OR 
  (diagn_osn BETWEEN 'mkb49' AND 'mkb50') OR 
  (diagn_osn BETWEEN 'mkb51' AND 'mkb52') OR 
  (diagn_osn BETWEEN 'mkb53' AND 'mkb54') OR 
  (diagn_osn BETWEEN 'mkb55' AND 'mkb56') OR 
  (diagn_osn BETWEEN 'mkb57' AND 'mkb58') OR 
  (diagn_osn BETWEEN 'mkb59' AND 'mkb60')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_6(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_8(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_age1(mkb01,mkb02,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn BETWEEN 'mkb01' AND 'mkb02') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_age15(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_age16(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_age2(mkb01,mkb02,mkb03,mkb04,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_age20(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_age24(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,mkb41,mkb42,mkb43,mkb44,mkb45,mkb46,mkb47,mkb48,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40') OR 
  (diagn_osn BETWEEN 'mkb41' AND 'mkb42') OR 
  (diagn_osn BETWEEN 'mkb43' AND 'mkb44') OR 
  (diagn_osn BETWEEN 'mkb45' AND 'mkb46') OR 
  (diagn_osn BETWEEN 'mkb47' AND 'mkb48')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_age29(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,mkb41,mkb42,mkb43,mkb44,mkb45,mkb46,mkb47,mkb48,mkb49,mkb50,mkb51,mkb52,mkb53,mkb54,mkb55,mkb56,mkb57,mkb58,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40') OR 
  (diagn_osn BETWEEN 'mkb41' AND 'mkb42') OR 
  (diagn_osn BETWEEN 'mkb43' AND 'mkb44') OR 
  (diagn_osn BETWEEN 'mkb45' AND 'mkb46') OR 
  (diagn_osn BETWEEN 'mkb47' AND 'mkb48') OR 
  (diagn_osn BETWEEN 'mkb49' AND 'mkb50') OR 
  (diagn_osn BETWEEN 'mkb51' AND 'mkb52') OR 
  (diagn_osn BETWEEN 'mkb53' AND 'mkb54') OR 
  (diagn_osn BETWEEN 'mkb55' AND 'mkb56') OR 
  (diagn_osn BETWEEN 'mkb57' AND 'mkb58')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_age30(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,mkb41,mkb42,mkb43,mkb44,mkb45,mkb46,mkb47,mkb48,mkb49,mkb50,mkb51,mkb52,mkb53,mkb54,mkb55,mkb56,mkb57,mkb58,mkb59,mkb60,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40') OR 
  (diagn_osn BETWEEN 'mkb41' AND 'mkb42') OR 
  (diagn_osn BETWEEN 'mkb43' AND 'mkb44') OR 
  (diagn_osn BETWEEN 'mkb45' AND 'mkb46') OR 
  (diagn_osn BETWEEN 'mkb47' AND 'mkb48') OR 
  (diagn_osn BETWEEN 'mkb49' AND 'mkb50') OR 
  (diagn_osn BETWEEN 'mkb51' AND 'mkb52') OR 
  (diagn_osn BETWEEN 'mkb53' AND 'mkb54') OR 
  (diagn_osn BETWEEN 'mkb55' AND 'mkb56') OR 
  (diagn_osn BETWEEN 'mkb57' AND 'mkb58') OR 
  (diagn_osn BETWEEN 'mkb59' AND 'mkb60')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_age6(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_age8(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,travma_id,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (vid_travma IN (travma_id)) 
 AND (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_itogo1(mkb01,mkb02,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (diagn_osn BETWEEN 'mkb01' AND 'mkb02') 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_itogo15(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_itogo16(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_itogo2(mkb01,mkb02,mkb03,mkb04,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_itogo20(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_itogo24(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,mkb41,mkb42,mkb43,mkb44,mkb45,mkb46,mkb47,mkb48,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40') OR 
  (diagn_osn BETWEEN 'mkb41' AND 'mkb42') OR 
  (diagn_osn BETWEEN 'mkb43' AND 'mkb44') OR 
  (diagn_osn BETWEEN 'mkb45' AND 'mkb46') OR 
  (diagn_osn BETWEEN 'mkb47' AND 'mkb48')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_itogo29(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,mkb41,mkb42,mkb43,mkb44,mkb45,mkb46,mkb47,mkb48,mkb49,mkb50,mkb51,mkb52,mkb53,mkb54,mkb55,mkb56,mkb57,mkb58,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40') OR 
  (diagn_osn BETWEEN 'mkb41' AND 'mkb42') OR 
  (diagn_osn BETWEEN 'mkb43' AND 'mkb44') OR 
  (diagn_osn BETWEEN 'mkb45' AND 'mkb46') OR 
  (diagn_osn BETWEEN 'mkb47' AND 'mkb48') OR 
  (diagn_osn BETWEEN 'mkb49' AND 'mkb50') OR 
  (diagn_osn BETWEEN 'mkb51' AND 'mkb52') OR 
  (diagn_osn BETWEEN 'mkb53' AND 'mkb54') OR 
  (diagn_osn BETWEEN 'mkb55' AND 'mkb56') OR 
  (diagn_osn BETWEEN 'mkb57' AND 'mkb58')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_itogo30(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,mkb17,mkb18,mkb19,mkb20,mkb21,mkb22,mkb23,mkb24,mkb25,mkb26,mkb27,mkb28,mkb29,mkb30,mkb31,mkb32,mkb33,mkb34,mkb35,mkb36,mkb37,mkb38,mkb39,mkb40,mkb41,mkb42,mkb43,mkb44,mkb45,mkb46,mkb47,mkb48,mkb49,mkb50,mkb51,mkb52,mkb53,mkb54,mkb55,mkb56,mkb57,mkb58,mkb59,mkb60,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16') OR 
  (diagn_osn BETWEEN 'mkb17' AND 'mkb18') OR 
  (diagn_osn BETWEEN 'mkb19' AND 'mkb20') OR 
  (diagn_osn BETWEEN 'mkb21' AND 'mkb22') OR 
  (diagn_osn BETWEEN 'mkb23' AND 'mkb24') OR 
  (diagn_osn BETWEEN 'mkb25' AND 'mkb26') OR 
  (diagn_osn BETWEEN 'mkb27' AND 'mkb28') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb29' AND 'mkb30') OR 
  (diagn_osn BETWEEN 'mkb31' AND 'mkb32') OR 
  (diagn_osn BETWEEN 'mkb33' AND 'mkb34') OR 
  (diagn_osn BETWEEN 'mkb35' AND 'mkb36') OR 
  (diagn_osn BETWEEN 'mkb37' AND 'mkb38') OR 
  (diagn_osn BETWEEN 'mkb39' AND 'mkb40') OR 
  (diagn_osn BETWEEN 'mkb41' AND 'mkb42') OR 
  (diagn_osn BETWEEN 'mkb43' AND 'mkb44') OR 
  (diagn_osn BETWEEN 'mkb45' AND 'mkb46') OR 
  (diagn_osn BETWEEN 'mkb47' AND 'mkb48') OR 
  (diagn_osn BETWEEN 'mkb49' AND 'mkb50') OR 
  (diagn_osn BETWEEN 'mkb51' AND 'mkb52') OR 
  (diagn_osn BETWEEN 'mkb53' AND 'mkb54') OR 
  (diagn_osn BETWEEN 'mkb55' AND 'mkb56') OR 
  (diagn_osn BETWEEN 'mkb57' AND 'mkb58') OR 
  (diagn_osn BETWEEN 'mkb59' AND 'mkb60')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_itogo6(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>func_itogo8(mkb01,mkb02,mkb03,mkb04,mkb05,mkb06,mkb07,mkb08,mkb09,mkb10,mkb11,mkb12,mkb13,mkb14,mkb15,mkb16,_sex,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON dan_tab.uchactok_id = u.id 
left join full_doctor_tab f on f.full_doctor_id=diagn_tab.doctor_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (dan_tab.sex = '_sex') 
 AND (otmet != 'Х') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',age(diagn_tab.data, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND ((diagn_osn BETWEEN 'mkb01' AND 'mkb02') OR 
  (diagn_osn BETWEEN 'mkb03' AND 'mkb04') OR 
  (diagn_osn BETWEEN 'mkb05' AND 'mkb06') OR 
  (diagn_osn BETWEEN 'mkb07' AND 'mkb08') OR 
  (diagn_osn BETWEEN 'mkb09' AND 'mkb10') OR 
  (diagn_osn BETWEEN 'mkb11' AND 'mkb12') OR 
  (diagn_osn BETWEEN 'mkb13' AND 'mkb14') OR 
  (diagn_osn BETWEEN 'mkb15' AND 'mkb16')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
and (':param4_1_:'='-1' or f.otdel = ':param4_1_:')</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_bitovie 6</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_neproiz_dtp_trans 9</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_neproiz_trans 8</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_neproiz_ylich 7</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_prochie 11</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_proiz_dtp_trans 4</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_proiz_prochie 5</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_proiz_prom 1</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_proiz_sx 2</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_proiz_trans 3</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_shkolnie 12</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_sport 10</Sql>
            </Query>
            <Query>
              <Sql>trauma_kind_terrorist 13</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param4" Caption="Отделение" Type="select">
              <Sql>select '-1', 'Все отделения' union select otdel, nam_otdel from otdel_tab</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Считать только по прикрепленному населению" Type="select2">
              <Sql>false=нет| true=да|</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2007121806" Name="Форма 63" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 63.xls">
          <Queries>
            <Query>
              <Sql>all_XZ1(mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
-- AND (talon_tab.data_end IS NOT NULL) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>all_XZ2(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') OR 
  (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>all_XZ3(mkb1,mkb2,mkb3,mkb4,mkb5,mkb6) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') OR 
  (diagn_osn BETWEEN 'mkb3' AND 'mkb4') OR 
  (diagn_osn BETWEEN 'mkb5' AND 'mkb6')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>all_Z1(mkb1,mkb2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З','О')) 
 AND (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>all_Z2(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З','О')) 
 AND ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') OR 
  (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>all_Z3(mkb1,mkb2,mkb3,mkb4,mkb5,mkb6) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З','О')) 
 AND ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') OR 
  (diagn_osn BETWEEN 'mkb3' AND 'mkb4') OR 
  (diagn_osn BETWEEN 'mkb5' AND 'mkb6')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>sel_XZ1(mkb1,mkb2,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',AGE(CASE WHEN talon_tab.data_end IS NOT NULL THEN talon_tab.data_end ELSE CURRENT_DATE END, date_born)) BETWEEN age1 AND age2) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>sel_XZ2(mkb1,mkb2,mkb3,mkb4,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') OR 
  (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',AGE(CASE WHEN talon_tab.data_end IS NOT NULL THEN talon_tab.data_end ELSE CURRENT_DATE END, date_born)) BETWEEN age1 AND age2) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>sel_XZ3(mkb1,mkb2,mkb3,mkb4,mkb5,mkb6,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') OR 
  (diagn_osn BETWEEN 'mkb3' AND 'mkb4') OR 
  (diagn_osn BETWEEN 'mkb5' AND 'mkb6')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',AGE(CASE WHEN talon_tab.data_end IS NOT NULL THEN talon_tab.data_end ELSE CURRENT_DATE END, date_born)) BETWEEN age1 AND age2) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>sel_Z1(mkb1,mkb2,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З','О')) 
 AND (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',AGE(CASE WHEN talon_tab.data_end IS NOT NULL THEN talon_tab.data_end ELSE CURRENT_DATE END, date_born)) BETWEEN age1 AND age2) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>sel_Z2(mkb1,mkb2,mkb3,mkb4,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З','О')) 
 AND ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') OR 
  (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',AGE(CASE WHEN talon_tab.data_end IS NOT NULL THEN talon_tab.data_end ELSE CURRENT_DATE END, date_born)) BETWEEN age1 AND age2) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>sel_Z3(mkb1,mkb2,mkb3,mkb4,mkb5,mkb6,age1,age2) SELECT COUNT(*) 
FROM diagn_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = diagn_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
WHERE (diagn_tab.count_diagn_tab=1) 
 AND (otmet IN ('З','О')) 
 AND ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') OR 
  (diagn_osn BETWEEN 'mkb3' AND 'mkb4') OR 
  (diagn_osn BETWEEN 'mkb5' AND 'mkb6')) 
 AND (diagn_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (DATE_PART('year',AGE(CASE WHEN talon_tab.data_end IS NOT NULL THEN talon_tab.data_end ELSE CURRENT_DATE END, date_born)) BETWEEN age1 AND age2) 
 AND ((NOT :param2_1_:) OR (dan_tab.prikreplen = 1)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Считать только по прикрепленному населению" Type="select2">
              <Sql>false=нет| true=да|</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2009103000" Name="Сведения об объемах и финансовом обеспечении медицинской помощи в рамках введения одноканального финансирования" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Сведения об объемах и финансовом обеспечении медицинской помощи в рамках введения одноканального финансирования.xls">
          <Queries>
            <Query>
              <Sql>talons_last_year SELECT count(DISTINCT t.talon_id) FROM talon_tab t 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
WHERE t.result_id &lt; 10 
AND v.data_pos BETWEEN ':date_1_:' - interval '1 year' AND ':date_2_:' - interval '1 year'</Sql>
            </Query>
            <Query>
              <Sql>talons_this_year SELECT count(DISTINCT t.talon_id) FROM talon_tab t 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
WHERE t.result_id &lt; 10 
AND v.data_pos BETWEEN ':date_1_:' AND ':date_2_:'</Sql>
            </Query>
            <Query>
              <Sql>visits_n_last_year SELECT count(visit_id) FROM talon_tab t 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
WHERE ((t.pricpol&lt;&gt;(SELECT value FROM settings_tab WHERE name = 'LPU_ID')) OR (t.pricpol IS NULL)) 
AND v.data_pos BETWEEN ':date_1_:' - interval '1 year' AND ':date_2_:' - interval '1 year'</Sql>
            </Query>
            <Query>
              <Sql>visits_n_this_year SELECT count(visit_id) FROM talon_tab t 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
WHERE ((t.pricpol&lt;&gt;(SELECT value FROM settings_tab WHERE name = 'LPU_ID')) OR (t.pricpol IS NULL)) 
AND v.data_pos BETWEEN ':date_1_:' AND ':date_2_:'</Sql>
            </Query>
            <Query>
              <Sql>visits_p_last_year </Sql>
            </Query>
            <Query>
              <Sql>visits_p_this_year </Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="date" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2012303000" Name="Форма 30 (2009 год)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 30 (2009 год).xls">
          <Queries>
            <Query>
              <Sql>akusherginekolog 130</Sql>
            </Query>
            <Query>
              <Sql>all_specialist terapevtall, kardiolog, gastroenterolog, endokrinolog, dermatolog, infectionist, hirurg_main, travmatolog, urolog, allergolog, oftalmolog, otoloringolog, nevrolog, VOP, revmatolog, foniator, onkolog, psihiatr, akusherginekolog, pulmonolog, nefrolog, gematolog, fizioterapeft, lfk, neirohirurg, stomatolog, 
manual_terapevt, pediatr, surdolog_otolar, chel_hirurg, hirurg_sosud, geriatr, psihoterapevt, narkolog, dietolog, diabetolog, sport_vrach, 
radiolog, hirurg_detskiy, neonatolog, sexopatolog, sudpsihexpert, koloproktolog, toxikolog, genetik, intern, klinich_farmakolog, prochie, 
reflexoterapevt</Sql>
            </Query>
            <Query>
              <Sql>allergolog 111</Sql>
            </Query>
            <Query>
              <Sql>chel_hirurg 0</Sql>
            </Query>
            <Query>
              <Sql>count_pos_all_2102 SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
AND talon_tab.vid_oplat_id IN (2,4) 
 
 
--and t.vid_oplat_id   = ANY(get_kind_paid_subnodes(vid_oplat1))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_all1 SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_all2(specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_all1 SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_all2(specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_seek1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home_seek2(specialist,age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_home2(specialist,age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs IN ('Д','А')) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_pervichn(specialist,age1,age2) SELECT COUNT(distinct talon_tab.dan_id) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
and (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2)</Sql>
            </Query>
            <Query>
              <Sql>count_pos_seek1(age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_seek2(specialist,age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_seek3(specialist,age1,age2) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (target_pos_id IN (1,2,3)) 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (DATE_PART('year',AGE(data_pos, dan_tab.date_born)) BETWEEN age1 AND age2) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
and talon_tab.vid_oplat_id in (0,3)</Sql>
            </Query>
            <Query>
              <Sql>count_pos_sh_all1 SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (cityzen = 0) 
 AND (spec_doctor_tab.dolg_doctor_id IN (all_specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>count_pos_sh_all2(specialist) SELECT COUNT(*) 
FROM visit_tab 
LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
WHERE (mesto_obs = 'П') 
 AND (visit_tab.data_vnes_inf BETWEEN date(':param1_1_:') AND date (':param1_2_:')) 
 AND (cityzen = 0) 
 AND (spec_doctor_tab.dolg_doctor_id IN (specialist)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>dermatolog 143</Sql>
            </Query>
            <Query>
              <Sql>diabetolog 164</Sql>
            </Query>
            <Query>
              <Sql>dietolog 108</Sql>
            </Query>
            <Query>
              <Sql>disablement_dispensary_list(disablement_id) SELECT ( 
 SELECT COUNT(DISTINCT du.dan_id) 
 FROM dispan_uchet_tab du 
 LEFT JOIN dan_tab d ON (d.dan_id = du.dan_id) 
 WHERE ((disablement_id &lt; 0) OR (d.inval_id = disablement_id)) 
  AND ((du.date_sn IS NULL) OR (du.date_sn &lt; ':param1_2_:')) 
  AND (get_vozrast(d.date_born) &gt;= 18) 
  AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
) AS dispensary_count, ( 
 SELECT COUNT(DISTINCT d.dan_id) 
 FROM inval_client_tab i 
 LEFT JOIN talon_tab t ON (t.talon_id = i.talon_id) 
 LEFT JOIN dan_tab d ON (d.dan_id = t.dan_id) 
 LEFT JOIN dispan_uchet_tab du ON (du.dan_id = d.dan_id) 
 WHERE ((disablement_id &lt; 0) OR (d.inval_id = disablement_id)) 
  AND ((du.date_sn IS NULL) OR (du.date_sn &lt; ':param1_2_:')) 
  AND (get_vozrast(d.date_born) &gt;= 18) 
  AND (date_part('year', i.date_change) = date_part('year', date(':param1_2_:'))) 
  AND ((i.last_inval IS NULL) OR (i.last_inval &lt;= 0)) 
  AND (i.current &gt; 0) 
  AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
) AS find_at_current_year, ( 
 SELECT COUNT(DISTINCT du.dan_id) 
 FROM dispan_uchet_tab du 
 LEFT JOIN dan_tab d ON (d.dan_id = du.dan_id) 
 WHERE ((disablement_id &lt; 0) OR (d.inval_id = disablement_id)) 
  AND ((du.date_sn IS NULL) OR (du.date_sn &lt; ':param1_2_:')) 
  AND (get_vozrast(d.date_born) &gt;= 18) 
  AND (d.inv_child) 
  AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
) AS invalid_from_childhood</Sql>
            </Query>
            <Query>
              <Sql>doc_count(specialist) select count(*) from full_doctor_view 
where sp_spec_doctor_id IN (specialist) 
and expiration_date&gt;=':param1_2_:'</Sql>
            </Query>
            <Query>
              <Sql>endokrinolog 110</Sql>
            </Query>
            <Query>
              <Sql>endoskopist 126</Sql>
            </Query>
            <Query>
              <Sql>fizioterapeft 114</Sql>
            </Query>
            <Query>
              <Sql>foniator 0</Sql>
            </Query>
            <Query>
              <Sql>ftiziatr 136</Sql>
            </Query>
            <Query>
              <Sql>gastroenterolog 107</Sql>
            </Query>
            <Query>
              <Sql>gematolog 112</Sql>
            </Query>
            <Query>
              <Sql>genetik 148</Sql>
            </Query>
            <Query>
              <Sql>geriatr 158</Sql>
            </Query>
            <Query>
              <Sql>hirurg_detskiy 181</Sql>
            </Query>
            <Query>
              <Sql>hirurg_main 118</Sql>
            </Query>
            <Query>
              <Sql>hirurg_sosud 119</Sql>
            </Query>
            <Query>
              <Sql>infectionist 113</Sql>
            </Query>
            <Query>
              <Sql>intern 155</Sql>
            </Query>
            <Query>
              <Sql>kardiolog 106</Sql>
            </Query>
            <Query>
              <Sql>klinich_farmakolog 162</Sql>
            </Query>
            <Query>
              <Sql>koloproktolog 121</Sql>
            </Query>
            <Query>
              <Sql>lfk 115</Sql>
            </Query>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>manual_terapevt 161</Sql>
            </Query>
            <Query>
              <Sql>narkolog 139</Sql>
            </Query>
            <Query>
              <Sql>nefrolog 109</Sql>
            </Query>
            <Query>
              <Sql>neirohirurg 124</Sql>
            </Query>
            <Query>
              <Sql>neonatolog 132,166</Sql>
            </Query>
            <Query>
              <Sql>nevrolog 137</Sql>
            </Query>
            <Query>
              <Sql>oftalmolog 134</Sql>
            </Query>
            <Query>
              <Sql>onkolog 127</Sql>
            </Query>
            <Query>
              <Sql>otoloringolog 135</Sql>
            </Query>
            <Query>
              <Sql>pediatr 131,1313,1314,1315,1312,1311</Sql>
            </Query>
            <Query>
              <Sql>prochie 156</Sql>
            </Query>
            <Query>
              <Sql>psihiatr 138</Sql>
            </Query>
            <Query>
              <Sql>psihoterapevt 140</Sql>
            </Query>
            <Query>
              <Sql>pulmonolog 104</Sql>
            </Query>
            <Query>
              <Sql>radiolog 128</Sql>
            </Query>
            <Query>
              <Sql>reflexoterapevt 168</Sql>
            </Query>
            <Query>
              <Sql>revmatolog 105</Sql>
            </Query>
            <Query>
              <Sql>sexopatolog 141</Sql>
            </Query>
            <Query>
              <Sql>sport_vrach 116</Sql>
            </Query>
            <Query>
              <Sql>stomatolog 129</Sql>
            </Query>
            <Query>
              <Sql>sudpsihexpert 142</Sql>
            </Query>
            <Query>
              <Sql>surdolog_otolar 0</Sql>
            </Query>
            <Query>
              <Sql>t2510profosm(age1,age2) select count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id = v.talon_id 
JOIN dan_tab d ON d.dan_id = t.dan_id 
where t.date_visit between ':param1_1_:' and ':param1_2_:' 
and v.target_pos_id = 4 
and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN age1 AND age2) 
AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:))</Sql>
            </Query>
            <Query>
              <Sql>t2600z1 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%020%' and floga not like '%010%'  and floga not like '%030%') 
and du.date&lt;':param1_1_:' and (du.date_sn&gt;':param1_1_:' or du.date_sn is null)</Sql>
            </Query>
            <Query>
              <Sql>t2600z10 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
f.floga like '%030%' 
and du.date between ':param1_1_:' and ':param1_2_:'</Sql>
            </Query>
            <Query>
              <Sql>t2600z11(prich_sn) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
f.floga like '%030%' 
and du.date_sn between ':param1_1_:' and ':param1_2_:' 
and prich_sn</Sql>
            </Query>
            <Query>
              <Sql>t2600z12(gr_inval) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
f.floga like '%030%' 
and du.date&lt;':param1_2_:' and (du.date_sn&gt;':param1_2_:' or du.date_sn is null) 
and gr_inval</Sql>
            </Query>
            <Query>
              <Sql>t2600z2 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%020%' and floga not like '%010%'  and floga not like '%030%') 
and du.date between ':param1_1_:' and ':param1_2_:'</Sql>
            </Query>
            <Query>
              <Sql>t2600z3(prich_sn) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%020%' and floga not like '%010%'  and floga not like '%030%') 
and du.date_sn between ':param1_1_:' and ':param1_2_:' 
and prich_sn</Sql>
            </Query>
            <Query>
              <Sql>t2600z4(gr_inval) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%020%' and floga not like '%010%'  and floga not like '%030%') 
and du.date&lt;':param1_2_:' and (du.date_sn&gt;':param1_2_:' or du.date_sn is null) 
and gr_inval</Sql>
            </Query>
            <Query>
              <Sql>t2600z5 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%010%' and floga not like '%030%' ) 
and du.date&lt;':param1_1_:' and (du.date_sn&gt;':param1_1_:' or du.date_sn is null)</Sql>
            </Query>
            <Query>
              <Sql>t2600z6 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%010%' and floga not like '%030%' ) 
and du.date between ':param1_1_:' and ':param1_2_:'</Sql>
            </Query>
            <Query>
              <Sql>t2600z7(prich_sn) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%010%' and floga not like '%030%' ) 
and du.date_sn between ':param1_1_:' and ':param1_2_:' 
and prich_sn</Sql>
            </Query>
            <Query>
              <Sql>t2600z8(gr_inval) select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
(f.floga like '%010%' and floga not like '%030%' ) 
and du.date&lt;':param1_2_:' and (du.date_sn&gt;':param1_2_:' or du.date_sn is null) 
and gr_inval</Sql>
            </Query>
            <Query>
              <Sql>t2600z9 select count(distinct du.dan_id) from dispan_uchet_tab du 
left join dan_tab d On d.dan_id = du.dan_id 
left join fed_lgota_tab f On f.dan_id = du.dan_id 
where 
f.floga like '%030%' 
and du.date&lt;':param1_1_:' and (du.date_sn&gt;':param1_1_:' or du.date_sn is null)</Sql>
            </Query>
            <Query>
              <Sql>terapevtall terapevtsimple,terapevtpodrostkoviy,terapevtcehovoy</Sql>
            </Query>
            <Query>
              <Sql>terapevtcehovoy 1023</Sql>
            </Query>
            <Query>
              <Sql>terapevtpodrostkoviy 103</Sql>
            </Query>
            <Query>
              <Sql>terapevtsimple 102,9,10,176,177,1021,1022</Sql>
            </Query>
            <Query>
              <Sql>toxikolog 146</Sql>
            </Query>
            <Query>
              <Sql>travmatolog 122</Sql>
            </Query>
            <Query>
              <Sql>urolog 123</Sql>
            </Query>
            <Query>
              <Sql>VOP 152</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2014903000" Name="Форма  1 (ВОП) (новый)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма  1 (ВОП) (новый).xls">
          <Queries>
            <Query>
              <Sql>disp1(age1,age2,usl1) select count(distinct disp.dan_id) from 
dispensary_registration_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where d.prikreplen =1 and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN age1 AND age2) 
AND u.uchactok like '%ВСП%' 
AND (disp.leave_date&gt;=':period_2_:' OR leave_date is null) 
AND usl1</Sql>
            </Query>
            <Query>
              <Sql>disp2(sx,par1,usl1) select count(distinct disp.dan_id) from 
dispensary_registration_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where d.prikreplen =1 and 
(case when par1=1 then 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 18 AND 54) 
	else d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 18 AND 59)  end 
else 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 55 AND 200) 
	else d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 60 AND 200)  end 
end) 
AND u.uchactok like '%ВСП%' 
AND (disp.leave_date&gt;=':period_2_:' OR leave_date is null) 
AND usl1</Sql>
            </Query>
            <Query>
              <Sql>konsultacia 2</Sql>
            </Query>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>prik(age1,age2,mw) select count(*) from  dan_tab d 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where d.prikreplen =1 and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN age1 AND age2) 
and (mw) 
AND u.uchactok like '%ВСП%'</Sql>
            </Query>
            <Query>
              <Sql>prik2(age1,age2,mw,sex1) select count(*) from  dan_tab d 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where d.prikreplen =1 and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN age1 AND age2) 
and (mw) and d.sex='sex1' 
AND u.uchactok like '%ВСП%'</Sql>
            </Query>
            <Query>
              <Sql>profilaktika 4,5</Sql>
            </Query>
            <Query>
              <Sql>t3000amb1(age1,age2) select count(distinct t.dan_id) 
FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE t.date_visit between date(':period_1_:') and date(':period_2_:') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN age1 AND age2)  
AND u.uchactok like '%ВСП%'</Sql>
            </Query>
            <Query>
              <Sql>t3000amb2(sx,par1) select count(distinct t.dan_id) 
FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE t.date_visit between date(':period_1_:') and date(':period_2_:') 
AND t.result_id IS NOT NULL 
AND u.uchactok like '%ВСП%' 
AND (case when par1=1 then 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 54) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 59)  end 
else 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 55 AND 200) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 60 AND 200)  end 
end)</Sql>
            </Query>
            <Query>
              <Sql>t3000death_home1(age1,age2) select count(distinct t.dan_id) 
FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
WHERE t.date_visit between date(':period_1_:') and date(':period_2_:') 
AND t.result_id =9 --death 
AND (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN age1 AND age2)  
AND u.uchactok like '%ВСП%' 
AND visit_id = (select max(visit_id) from visit_tab v2 where v2.talon_id = v.talon_id) 
AND v.mesto_obs in ('Д','А')</Sql>
            </Query>
            <Query>
              <Sql>t3000death_home2(sx,par1) select count(distinct t.dan_id) 
FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
WHERE t.date_visit between date(':period_1_:') and date(':period_2_:') 
AND t.result_id =9 
AND u.uchactok like '%ВСП%' 
AND (case when par1=1 then 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 54) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 59)  end 
else 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 55 AND 200) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 60 AND 200)  end 
end) 
AND visit_id = (select max(visit_id) from visit_tab v2 where v2.talon_id = v.talon_id) 
AND v.mesto_obs in ('Д','А')</Sql>
            </Query>
            <Query>
              <Sql>t3000death1(age1,age2) select count(distinct t.dan_id) 
FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE t.date_visit between date(':period_1_:') and date(':period_2_:') 
AND t.result_id =9 --death 
AND (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN age1 AND age2)  
AND u.uchactok like '%ВСП%'</Sql>
            </Query>
            <Query>
              <Sql>t3000death2(sx,par1) select count(distinct t.dan_id) 
FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE t.date_visit between date(':period_1_:') and date(':period_2_:') 
AND t.result_id =9 
AND u.uchactok like '%ВСП%' 
AND (case when par1=1 then 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 54) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 59)  end 
else 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 55 AND 200) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 60 AND 200)  end 
end)</Sql>
            </Query>
            <Query>
              <Sql>t3000emerg_stac1(age1,age2) select count(distinct t.dan_id) 
FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE t.date_visit between date(':period_1_:') and date(':period_2_:') 
AND t.result_id=7 
AND (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN age1 AND age2)  
AND u.uchactok like '%ВСП%' 
AND t.is_emergency is true</Sql>
            </Query>
            <Query>
              <Sql>t3000emerg_stac2(sx,par1) select count(distinct t.dan_id) 
FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE t.date_visit between date(':period_1_:') and date(':period_2_:') 
AND t.result_id =7 
AND u.uchactok like '%ВСП%' 
AND (case when par1=1 then 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 54) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 59)  end 
else 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 55 AND 200) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 60 AND 200)  end 
end) 
AND t.is_emergency is true</Sql>
            </Query>
            <Query>
              <Sql>t3000emerg1(age1,age2) select count(distinct t.dan_id) 
FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE t.date_visit between date(':period_1_:') and date(':period_2_:') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN age1 AND age2)  
AND u.uchactok like '%ВСП%' 
AND t.is_emergency is true</Sql>
            </Query>
            <Query>
              <Sql>t3000emerg2(sx,par1) select count(distinct t.dan_id) 
FROM talon_tab t 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE t.date_visit between date(':period_1_:') and date(':period_2_:') 
AND t.result_id IS NOT NULL 
AND u.uchactok like '%ВСП%' 
AND (case when par1=1 then 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 54) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 59)  end 
else 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 55 AND 200) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 60 AND 200)  end 
end) 
AND t.is_emergency is true</Sql>
            </Query>
            <Query>
              <Sql>t3000inval1(age1,age2) select count(distinct i.dan_id) 
from inval_client_tab i 
LEFT JOIN dan_tab d ON d.dan_id = i.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where d.prikreplen =1 
AND u.uchactok like '%ВСП%' 
AND (last_inval is null or last_inval=0) 
AND date_change between ':period_1_:' and ':period_2_:' 
AND (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN age1 AND age2)</Sql>
            </Query>
            <Query>
              <Sql>t3000inval2(sx,par1) select count(distinct i.dan_id) 
from inval_client_tab i 
LEFT JOIN dan_tab d ON d.dan_id = i.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where d.prikreplen =1 
AND u.uchactok like '%ВСП%' 
AND (last_inval is null or last_inval=0) 
AND date_change between ':period_1_:' and ':period_2_:' 
AND (case when par1=1 then 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 18 AND 54) 
	else d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 18 AND 59)  end 
else 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 55 AND 200) 
	else d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 60 AND 200)  end 
end)</Sql>
            </Query>
            <Query>
              <Sql>t3000kons1(age1,age2) select count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE v.data_pos between date(':period_1_:') and date(':period_2_:') 
 ---(':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN age1 AND age2)  
AND v.target_pos_id in (konsultacia) 
AND u.uchactok like '%ВСП%'</Sql>
            </Query>
            <Query>
              <Sql>t3000kons2(sx,par1) select count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE v.data_pos between date(':period_1_:') and date(':period_2_:') 
 --- (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND v.target_pos_id in (konsultacia) 
AND u.uchactok like '%ВСП%' 
AND (case when par1=1 then 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 54) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 18 AND 59)  end 
else 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 55 AND 200) 
	else d.sex='sx' and (DATE_PART('year',AGE(date_visit, d.date_born)) BETWEEN 60 AND 200)  end 
end)</Sql>
            </Query>
            <Query>
              <Sql>t3000kur1(age1,age2) select count(*) from kurort_tab k 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where d.prikreplen =1 and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN age1 AND age2) 
AND u.uchactok like '%ВСП%' 
AND k.date between ':period_1_:' and ':period_2_:' 
AND k.proshel='1'</Sql>
            </Query>
            <Query>
              <Sql>t3000kur2(sx,par1) select count(*) from kurort_tab k 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where d.prikreplen =1 
AND u.uchactok like '%ВСП%' 
AND k.date between ':period_1_:' and ':period_2_:' 
AND k.proshel='1' 
AND (case when par1=1 then 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 18 AND 54) 
	else d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 18 AND 59)  end 
else 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 55 AND 200) 
	else d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 60 AND 200)  end 
end)</Sql>
            </Query>
            <Query>
              <Sql>t3000priv1(age1,age2) select count(*) from priviv_tab p 
LEFT JOIN dan_tab d ON d.dan_id = p.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where d.prikreplen =1 and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN age1 AND age2) 
AND u.uchactok like '%ВСП%' 
AND date_priviv between ':period_1_:' and ':period_2_:'</Sql>
            </Query>
            <Query>
              <Sql>t3000priv2(sx,par1) select count(*) from priviv_tab p 
LEFT JOIN dan_tab d ON d.dan_id = p.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where d.prikreplen =1 AND u.uchactok like '%ВСП%' 
AND date_priviv between ':period_1_:' and ':period_2_:' 
AND (case when par1=1 then 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 18 AND 54) 
	else d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 18 AND 59)  end 
else 
	case when 'sx'='ж' then d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 55 AND 200) 
	else d.sex='sx' and (DATE_PART('year',AGE(date(':period_2_:'), d.date_born)) BETWEEN 60 AND 200)  end 
end)</Sql>
            </Query>
            <Query>
              <Sql>z1(age1,age2,targetpos,mkb1,mkb2) select count(*) 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE v.data_pos between date(':period_1_:') and date(':period_2_:') 
 --- (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN age1 AND age2)  
AND v.target_pos_id in (targetpos) 
and t.diag_osn between 'mkb1' and 'mkb2' 
AND u.uchactok like '%ВСП%'</Sql>
            </Query>
            <Query>
              <Sql>z2(targetpos,mkb1,mkb2) select sum(mr+fr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 1 else 0 end as mr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 1 else 0 end as fr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE v.data_pos between date(':period_1_:') and date(':period_2_:') 
 --- (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59)  
AND v.target_pos_id in (targetpos)  
and t.diag_osn between 'mkb1' and 'mkb2' 
AND u.uchactok like '%ВСП%' 
) q</Sql>
            </Query>
            <Query>
              <Sql>z3(targetpos,mkb1,mkb2) select sum(mr+fr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 1 else 0 end as mr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 1 else 0 end as fr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE v.data_pos between date(':period_1_:') and date(':period_2_:') 
 --- (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59)  
AND v.target_pos_id in (targetpos)  AND v.mesto_obs = 'Д' 
and t.diag_osn between 'mkb1' and 'mkb2' 
AND u.uchactok like '%ВСП%' 
) q</Sql>
            </Query>
            <Query>
              <Sql>z4(targetpos,mkb1,mkb2) select sum(mnr+fnr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 0 else 1 end as mnr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 0 else 1 end as fnr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE v.data_pos between date(':period_1_:') and date(':period_2_:') 
 --- (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 54 AND 200)  
AND v.target_pos_id in (targetpos)  
and t.diag_osn between 'mkb1' and 'mkb2' 
AND u.uchactok like '%ВСП%' 
) q</Sql>
            </Query>
            <Query>
              <Sql>z5(targetpos,mkb1,mkb2) select sum(mnr+fnr) from ( 
select v.visit_id, d.sex, DATE_PART('year',AGE(data_pos, d.date_born)) as age, 
case when d.sex = 'м' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 59) then 0 else 1 end as mnr, 
case when d.sex = 'ж' and (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 18 AND 54) then 0 else 1 end as fnr 
from visit_tab v 
LEFT JOIN talon_tab t ON t.talon_id=v.talon_id 
LEFT JOIN dan_tab d ON d.dan_id=t.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
WHERE v.data_pos between date(':period_1_:') and date(':period_2_:') 
 --- (':period_2_:'::date + interval '1 month' - interval '1 day') 
AND t.result_id IS NOT NULL 
AND (DATE_PART('year',AGE(data_pos, d.date_born)) BETWEEN 54 AND 200)  
AND v.target_pos_id in (targetpos)  AND v.mesto_obs = 'Д' 
and t.diag_osn between 'mkb1' and 'mkb2' 
AND u.uchactok like '%ВСП%' 
) q</Sql>
            </Query>
            <Query>
              <Sql>zabolevania 1</Sql>
            </Query>
            <Query>
              <Sql>zapros_title select value from settings_tab where name='LPU'</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период:" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2016103001" Name="Форма 6 исправленная" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 6 исправленная.xls">
          <Queries>
            <Query>
              <Sql>z0(par1,par2,par3,par4) select count(*) from ( 
select distinct pr.dan_id 
from priviv_tab pr 
LEFT JOIN dan_tab d on d.dan_id = pr.dan_id 
where 
date_part('year', age(date(':per_1_:'),d.date_born)) = par1 
and  (pr.vid_Priviv between par2 and par3) and preparat in (par4) 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
 
---1Количество привитых (вакцинация и ревакцинация) по возрастам. par2, par3 - диапазон id для определения ----вакцинация/ревакцинация, par4 - вакцина. Все значения из таблицы sp_priv_univ_tab. par1 - число лет.</Sql>
            </Query>
            <Query>
              <Sql>z1(par4) select count(*) from ( 
select distinct pr.dan_id 
from priviv_tab pr 
LEFT JOIN dan_tab d on d.dan_id = pr.dan_id 
where 
-- pr.date_priviv between date(':per_1_:') and date(':per_2_:') and 
date_part('year', age(date(':per_1_:'),d.date_born)) = 0 and date_part('month', age(date(':per_1_:'),d.date_born)) between 0 and 6 
and  (pr.vid_Priviv between 9 and 12) and  preparat in (par4) 
-- pr.infection in (par4,par5,par6) 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
  
----количество привитых (вакцинация) в возрасте 0-6 мес. par4 - вид вакцины</Sql>
            </Query>
            <Query>
              <Sql>z11(par4) select count(*) from ( 
select distinct pr.dan_id  
from priviv_tab pr 
LEFT JOIN dan_tab d on d.dan_id = pr.dan_id 
where 
-- pr.date_priviv between date(':per_1_:') and date(':per_2_:') and 
date_part('year', age(date(':per_1_:'),d.date_born)) = 0 and date_part('month', age(date(':per_1_:'),d.date_born)) between 0 and 6 
and  (pr.vid_Priviv between 13 and 20) and  preparat in (par4) 
--pr.infection in (par4,par5,par6) 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
----количество привитых (ревакцинация) в возрасте 0-6 мес. par4 - вакцина</Sql>
            </Query>
            <Query>
              <Sql>z2(par11,par12,par2) select count(*), COALESCE(sum(priv),0) as priv from ( 
select distinct t.dan_id, case when pr.date_Priviv is null then 0 else 1 end as priv 
from talon_tab t /*diagn_tab ds */ 
LEFT JOIN dan_tab d on d.dan_id = t.dan_id 
LEFT JOIN priviv_tab pr on pr.dan_id = t.dan_id 
where t.diag_osn between par11 and par12 
--and t.data_vnes_inf between date(':per_1_:') and date(':per_2_:') 
 and date_part('year', age(date(':per_1_:'),d.date_born)) = par2 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
----Переболевшие корью, эпидпаротитом, краснухой. Параметры: par11, par12 - диапазон диагнозов, 
----par2 - количество лет пациента (страница 4 отчёта)</Sql>
            </Query>
            <Query>
              <Sql>z3(par1,par2) select count(*), COALESCE(sum(priv),0) as priv from ( 
select distinct t.dan_id, case when pr.date_Priviv is null then 0 else 1 end as priv 
from talon_tab t /*diagn_tab ds */ 
LEFT JOIN dan_tab d on d.dan_id = t.dan_id 
LEFT JOIN priviv_tab pr on pr.dan_id = t.dan_id 
where t.diag_osn between par1 and par2 
 
and  date_part('year', age(date(':per_1_:'),d.date_born)) = 0 and date_part('month', age(date(':per_1_:'),d.date_born)) between 0 and 6 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
---- переболевшие корью, эпидпаротитом и краснухой в возрасте 0-6 мес (страница 4 отчёта). 
----Параметры - диапазон диагнозов</Sql>
            </Query>
            <Query>
              <Sql>z4(par1,par2,par3,age1,age2) select count(*) from ( 
select distinct pr.dan_id 
from priviv_tab pr 
LEFT JOIN dan_tab d on d.dan_id = pr.dan_id 
where 
date_part('year', age(date(':per_1_:'),d.date_born)) between age1 and age2 
and  (pr.vid_Priviv between par1 and par2) and preparat in (par3) 
 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
----привитые старше 60 лет (вакцинация и ревакцинация). par1, par2 - диапазон id для определения вакцинация/ревакцинация, 
----par3 - вакцина. Все значения из таблицы sp_priv_univ_tab</Sql>
            </Query>
            <Query>
              <Sql>z5 select count(*), COALESCE(sum(priv),0) as priv from ( 
select distinct t.dan_id, 
case when pr.date_Priviv is null then 0 else 1 end as priv 
from talon_tab t /*diagn_tab ds */ 
LEFT JOIN dan_tab d on d.dan_id = t.dan_id 
LEFT JOIN priviv_tab pr on pr.dan_id = t.dan_id 
where t.diag_osn between 'B05' and 'B05.9' 
and date_part('year', age(date(':per_1_:'),d.date_born)) &gt;=60 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q 
 
--- переболевшие корью старше 60 лет</Sql>
            </Query>
            <Query>
              <Sql>z6(par1) select count(*) from dan_tab 
where date_part('year', age(date(':per_1_:'),date_born)) = par1 
--and prikreplen=1 
and (:param2_1_:=-1 OR uchactok_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>z7(age1,age2) select count(*) from dan_tab 
where date_part('year', age(date(':per_1_:'),date_born)) between age1 and age2 
and prikreplen=1 
and (:param2_1_:=-1 OR uchactok_id = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>z8(par11,par12,age1,age2) select count(*), COALESCE(sum(priv),0) as priv from ( 
select distinct ds.dan_id, 
case when pr.date_Priviv is null then 0 else 1 end as priv 
from diagn_tab ds 
LEFT JOIN dan_tab d on d.dan_id = ds.dan_id 
LEFT JOIN priviv_tab pr on pr.dan_id = ds.dan_id 
where diagn_osn between par11 and par12 
and date_part('year', age(date(':per_1_:'),d.date_born)) between age1 and age2 
and (:param2_1_:=-1 OR d.uchactok_id = :param2_1_:) 
) q</Sql>
            </Query>
            <Query>
              <Sql>z9 select count(*) from dan_tab 
where date_part('year', age(date(':per_1_:'),date_born)) = 0 and date_part('month', age(date(':per_1_:'),date_born)) between 0 and 6 
and prikreplen=1 
and (:param2_1_:=-1 OR uchactok_id = :param2_1_:)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="per" Caption="Дата" Type="date">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2016703001" Name="ф12" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\ф12.xls">
          <Queries>
            <Query>
              <Sql>diagn_exception (diagn.diagn_osn NOT BETWEEN 'A39' AND 'A39.9' AND diagn.diagn_osn NOT BETWEEN 'A40' AND 'A41.9' AND diagn.diagn_osn NOT BETWEEN 'A80' AND 'A80.9' AND diagn.diagn_osn NOT BETWEEN 'D60' AND 'D61.9' AND diagn.diagn_osn NOT BETWEEN 'D65' AND 'D65.' AND diagn.diagn_osn NOT BETWEEN 'E23' AND 'E23.7' AND diagn.diagn_osn NOT BETWEEN 'E25' AND 'E25.9' AND diagn.diagn_osn NOT BETWEEN 'E28' AND 'E28.9' AND diagn.diagn_osn NOT BETWEEN 'E29' AND 'E29.9' AND diagn.diagn_osn NOT BETWEEN 'E70' AND 'E70.9' AND diagn.diagn_osn NOT BETWEEN 'E74.2' AND 'E74.2' AND diagn.diagn_osn NOT BETWEEN 'E75.5' AND 'E75.5' AND diagn.diagn_osn NOT BETWEEN 'E76' AND 'E76.9' AND diagn.diagn_osn NOT BETWEEN 'E84' AND 'E84.9' AND diagn.diagn_osn NOT BETWEEN 'F00' AND 'F99.' AND diagn.diagn_osn NOT BETWEEN 'G00' AND 'G00.9' AND diagn.diagn_osn NOT BETWEEN 'G10' AND 'G12.9' AND diagn.diagn_osn NOT BETWEEN 'G30' AND 'G31.9' AND diagn.diagn_osn NOT BETWEEN 'G61' AND 'G61.0' AND diagn.diagn_osn NOT BETWEEN 'G70' AND 'G73.7' AND diagn.diagn_osn NOT BETWEEN 'G95.1' AND 'G95.1' AND diagn.diagn_osn NOT BETWEEN 'H46' AND 'H46.' AND diagn.diagn_osn NOT BETWEEN 'H80' AND 'H80.9' AND diagn.diagn_osn NOT BETWEEN 'I00' AND 'I02.9' AND diagn.diagn_osn NOT BETWEEN 'I12' AND 'I13.9' AND diagn.diagn_osn NOT BETWEEN 'I20' AND 'I20.0' AND diagn.diagn_osn NOT BETWEEN 'I22' AND 'I22.9' AND diagn.diagn_osn NOT BETWEEN 'I24' AND 'I24.9' AND diagn.diagn_osn NOT BETWEEN 'I26' AND 'I26.9' AND diagn.diagn_osn NOT BETWEEN 'I33' AND 'I33.9' AND diagn.diagn_osn NOT BETWEEN 'I40' AND 'I40.9' AND diagn.diagn_osn NOT BETWEEN 'I42' AND 'I42.9' AND diagn.diagn_osn NOT BETWEEN 'I60' AND 'I60.9' AND diagn.diagn_osn NOT BETWEEN 'I61' AND 'I63.9' AND diagn.diagn_osn NOT BETWEEN 'I65' AND 'I66.9' AND diagn.diagn_osn NOT BETWEEN 'I69' AND 'I69.8' AND diagn.diagn_osn NOT BETWEEN 'I81' AND 'I81.' AND diagn.diagn_osn NOT BETWEEN 'J05' AND 'J05.1' AND diagn.diagn_osn NOT BETWEEN 'J10' AND 'J11.8' AND diagn.diagn_osn NOT BETWEEN 'J84' AND 'J94.9' AND diagn.diagn_osn NOT BETWEEN 'K00' AND 'K14.9' AND diagn.diagn_osn NOT BETWEEN 'K56' AND 'K56.7' AND diagn.diagn_osn NOT BETWEEN 'K65' AND 'K65.9' AND diagn.diagn_osn NOT BETWEEN 'L10' AND 'L10.9' AND diagn.diagn_osn NOT BETWEEN 'L12' AND 'L12.9' AND diagn.diagn_osn NOT BETWEEN 'L13' AND 'L13.0' AND diagn.diagn_osn NOT BETWEEN 'L20' AND 'L20.9' AND diagn.diagn_osn NOT BETWEEN 'L23' AND 'L25.9' AND diagn.diagn_osn NOT BETWEEN 'L30' AND 'L30.9' AND diagn.diagn_osn NOT BETWEEN 'L43' AND 'L43.9' AND diagn.diagn_osn NOT BETWEEN 'L93' AND 'L93.0' AND diagn.diagn_osn NOT BETWEEN 'L94' AND 'L94.0' AND diagn.diagn_osn NOT BETWEEN 'M02' AND 'M02.9' AND diagn.diagn_osn NOT BETWEEN 'M08' AND 'M08.9' AND diagn.diagn_osn NOT BETWEEN 'N46' AND 'N46.' AND diagn.diagn_osn NOT BETWEEN 'N60' AND 'N60.9' AND diagn.diagn_osn NOT BETWEEN 'N70' AND 'N70.9' AND diagn.diagn_osn NOT BETWEEN 'N80' AND 'N80.9' AND diagn.diagn_osn NOT BETWEEN 'N86' AND 'N86.' AND diagn.diagn_osn NOT BETWEEN 'N91' AND 'N94.9' AND diagn.diagn_osn NOT BETWEEN 'N97' AND 'N97.9' AND diagn.diagn_osn NOT BETWEEN 'O00' AND 'O99.8' AND diagn.diagn_osn NOT BETWEEN 'P00' AND 'P96.9' AND diagn.diagn_osn NOT BETWEEN 'Q00' AND 'Q07.9' AND diagn.diagn_osn NOT BETWEEN 'Q20' AND 'Q28.9' AND diagn.diagn_osn NOT BETWEEN 'Q51' AND 'Q52.9' AND diagn.diagn_osn NOT BETWEEN 'Q56' AND 'Q56.4' AND diagn.diagn_osn NOT BETWEEN 'Q65' AND 'Q65.9' AND diagn.diagn_osn NOT BETWEEN 'Q80' AND 'Q80.9' AND diagn.diagn_osn NOT BETWEEN 'Q85' AND 'Q85.9' AND diagn.diagn_osn NOT BETWEEN 'Q90' AND 'Q90.9' AND diagn.diagn_osn NOT BETWEEN 'R00' AND 'R99.9')</Sql>
            </Query>
            <Query>
              <Sql>disp_exception (diagn_id NOT BETWEEN 'A39' AND 'A39.9' AND diagn_id NOT BETWEEN 'A40' AND 'A41.9' AND diagn_id NOT BETWEEN 'A80' AND 'A80.9' AND diagn_id NOT BETWEEN 'D60' AND 'D61.9' AND diagn_id NOT BETWEEN 'D65' AND 'D65.' AND diagn_id NOT BETWEEN 'E23' AND 'E23.7' AND diagn_id NOT BETWEEN 'E25' AND 'E25.9' AND diagn_id NOT BETWEEN 'E28' AND 'E28.9' AND diagn_id NOT BETWEEN 'E29' AND 'E29.9' AND diagn_id NOT BETWEEN 'E70' AND 'E70.9' AND diagn_id NOT BETWEEN 'E74.2' AND 'E74.2' AND diagn_id NOT BETWEEN 'E75.5' AND 'E75.5' AND diagn_id NOT BETWEEN 'E76' AND 'E76.9' AND diagn_id NOT BETWEEN 'E84' AND 'E84.9' AND diagn_id NOT BETWEEN 'F00' AND 'F99.' AND diagn_id NOT BETWEEN 'G00' AND 'G00.9' AND diagn_id NOT BETWEEN 'G10' AND 'G12.9' AND diagn_id NOT BETWEEN 'G30' AND 'G31.9' AND diagn_id NOT BETWEEN 'G61' AND 'G61.0' AND diagn_id NOT BETWEEN 'G70' AND 'G73.7' AND diagn_id NOT BETWEEN 'G95.1' AND 'G95.1' AND diagn_id NOT BETWEEN 'H46' AND 'H46.' AND diagn_id NOT BETWEEN 'H80' AND 'H80.9' AND diagn_id NOT BETWEEN 'I00' AND 'I02.9' AND diagn_id NOT BETWEEN 'I12' AND 'I13.9' AND diagn_id NOT BETWEEN 'I20' AND 'I20.0' AND diagn_id NOT BETWEEN 'I22' AND 'I22.9' AND diagn_id NOT BETWEEN 'I24' AND 'I24.9' AND diagn_id NOT BETWEEN 'I26' AND 'I26.9' AND diagn_id NOT BETWEEN 'I33' AND 'I33.9' AND diagn_id NOT BETWEEN 'I40' AND 'I40.9' AND diagn_id NOT BETWEEN 'I42' AND 'I42.9' AND diagn_id NOT BETWEEN 'I60' AND 'I60.9' AND diagn_id NOT BETWEEN 'I61' AND 'I63.9' AND diagn_id NOT BETWEEN 'I65' AND 'I66.9' AND diagn_id NOT BETWEEN 'I69' AND 'I69.8' AND diagn_id NOT BETWEEN 'I81' AND 'I81.' AND diagn_id NOT BETWEEN 'J05' AND 'J05.1' AND diagn_id NOT BETWEEN 'J10' AND 'J11.8' AND diagn_id NOT BETWEEN 'J84' AND 'J94.9' AND diagn_id  NOT BETWEEN 'K00' AND 'K14.9' AND diagn_id NOT BETWEEN 'K56' AND 'K56.7' AND diagn_id NOT BETWEEN 'K65' AND 'K65.9' AND diagn_id NOT BETWEEN 'L10' AND 'L10.9' AND diagn_id NOT BETWEEN 'L12' AND 'L12.9' AND diagn_id NOT BETWEEN 'L13' AND 'L13.0' AND diagn_id NOT BETWEEN 'L20' AND 'L20.9' AND diagn_id NOT BETWEEN 'L23' AND 'L25.9' AND diagn_id NOT BETWEEN 'L30' AND 'L30.9' AND diagn_id NOT BETWEEN 'L43' AND 'L43.9' AND diagn_id NOT BETWEEN 'L93' AND 'L93.0' AND diagn_id NOT BETWEEN 'L94' AND 'L94.0' AND diagn_id NOT BETWEEN 'M02' AND 'M02.9' AND diagn_id NOT BETWEEN 'M08' AND 'M08.9' AND diagn_id NOT BETWEEN 'N46' AND 'N46.' AND diagn_id NOT BETWEEN 'N60' AND 'N60.9' AND diagn_id NOT BETWEEN 'N70' AND 'N70.9' AND diagn_id NOT BETWEEN 'N80' AND 'N80.9' AND diagn_id NOT BETWEEN 'N86' AND 'N86.' AND diagn_id NOT BETWEEN 'N91' AND 'N94.9' AND diagn_id NOT BETWEEN 'N97' AND 'N97.9' AND diagn_id NOT BETWEEN 'O00' AND 'O99.8' AND diagn_id NOT BETWEEN 'P00' AND 'P96.9' AND diagn_id NOT BETWEEN 'Q00' AND 'Q07.9' AND diagn_id NOT BETWEEN 'Q20' AND 'Q28.9' AND diagn_id NOT BETWEEN 'Q51' AND 'Q52.9' AND diagn_id NOT BETWEEN 'Q56' AND 'Q56.4' AND diagn_id NOT BETWEEN 'Q65' AND 'Q65.9' AND diagn_id NOT BETWEEN 'Q80' AND 'Q80.9' AND diagn_id NOT BETWEEN 'Q85' AND 'Q85.9' AND diagn_id NOT BETWEEN 'Q90' AND 'Q90.9' AND diagn_id NOT BETWEEN 'R00' AND 'R99.9')</Sql>
            </Query>
            <Query>
              <Sql>dispans_all(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m3(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9'))  
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9'))  
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5') 
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_p(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2')  
 AND age&gt;=case when sex='м' then 60 else 55 end</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_p5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5')  
 AND age&gt;=case when sex='м' then 60 else 55 end</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4'))  
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m3(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9'))  
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9'))  
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_sp(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2')  
 AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_sp5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5')  
 AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2_p(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2_sp(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
AND cityzen=0 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3_p(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3_s(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (age BETWEEN age1 AND age2) AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3_sp(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4_p(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (age BETWEEN age1 AND age2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4_sp(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' 
or diagn_id ilike 'mkb2' 
or diagn_id ilike 'mkb3' 
or diagn_id ilike 'mkb4' 
or diagn_id ilike 'mkb5' ) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans2_all(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans2_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dop_dd_dispans SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab d ON d.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN kart_dd_tab k ON dispan_uchet_tab.dan_id = k.dan_id 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
WHERE (date BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND :district_1_: 
AND k.date_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
and dop.sp_stadiya_diagn_id =2</Sql>
            </Query>
            <Query>
              <Sql>dop_dd_first select count(*) 
from diagn_tab diag 
LEFT JOIN kart_dd_tab k ON k.talon_id = diag.talon_id 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
LEFT JOIN talon_tab t ON t.talon_id = k.talon_id 
LEFT JOIN dan_tab d On d.dan_id = k.dan_id 
where k.date_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
and dop.sp_stadiya_diagn_id =2 
 AND :param2_1_: 
 AND :district_1_:</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_stud(mkb_1,mkb_2,param_1,param_2) select count(distinct id) 
from report_stud_disp_tab 
where (diagn_id between 'mkb_1' and 'mkb_2' param_2) 
and param_1</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_stud_all select count(distinct id) 
from report_stud_disp_tab</Sql>
            </Query>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>report_clear SELECT ''; SELECT drop_if_exists('report_diagn_tab'); 
 
SELECT drop_if_exists('report_disp_tab'); 
SELECT drop_if_exists('report_stud_disp_tab');</Sql>
            </Query>
            <Query>
              <Sql>report_init SELECT ''; SELECT drop_if_exists('report_diagn_tab'); 
 
SELECT drop_if_exists('report_disp_tab'); 
SELECT drop_if_exists('report_stud_disp_tab');  
 
CREATE TEMP TABLE report_disp_tab 
(age INTEGER, 
sex VARCHAR(1), 
cityzen INTEGER, 
diagn_id VARCHAR, 
dan_id BIGINT, 
id BIGINT PRIMARY KEY 
); 
 
INSERT INTO report_disp_tab (age,sex,cityzen,diagn_id,dan_id,id) 
(SELECT  DATE_PART('year',AGE(date(':param1_2_:'), d.date_born)), 
d.sex, d.cityzen, diagn.diagn_id,d.dan_id,diagn.id 
FROM dispensary_registration_tab diagn 
JOIN dan_tab d ON d.dan_id = diagn.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab dt on dt.doctor_id=u.doctor_id 
left join otdel_tab o on o.otdel = dt.sp_otdel_id  
LEFt JOIN settings_tab ON UPPER(settings_tab.name) = 'LPU_NUMBER' 
WHERE 
 entry_date &lt; date(':param1_2_:') 
 AND (leave_date IS NULL OR leave_date &gt;date(':param1_2_:')) 
 /*AND disp_exception  */ 
 AND :district_1_: 
 AND :disp_prik_1_: 
and :otdel_1_: 
and :vrach_1_: 
and case when settings_tab.value in ('0152','0151') then d.uchactok_id!=1000 else true end 
); 
 
CREATE TEMP TABLE report_diagn_tab 
(age INTEGER, 
sex VARCHAR(1), 
cityzen INTEGER, 
diagn_osn VARCHAR, 
dan_id BIGINT, 
diagn_type_id BIGINT, 
count INTEGER, 
id BIGINT PRIMARY KEY, 
_end INTEGER, 
spec bigint 
); 
  
 
INSERT INTO report_diagn_tab(age,sex,cityzen,diagn_osn,dan_id,diagn_type_id,id,count,_end,spec) 
(SELECT  DATE_PART('year',AGE(date(diagn.data_vnes_inf), d.date_born)), 
d.sex, d.cityzen, diagn.diagn_osn,d.dan_id,diagn.diagn_type_id,diagn.id,diagn.count,rez._end,dt.sp_spec_doctor_id 
FROM diagn_tab diagn 
JOIN talon_tab t ON t.talon_id = diagn.talon_id AND :param5_1_: 
left join codifiers.visit_result_common_tab rez On rez.id = t.result_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
left join doctor_tab dt on dt.doctor_id=diagn.doctor_id 
left join otdel_tab o on o.otdel = dt.sp_otdel_id  
LEFt JOIN settings_tab ON UPPER(settings_tab.name) = 'LPU_NUMBER' 
WHERE (diagn.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
/*AND diagn_exception  */ 
AND :param2_1_: 
 AND :district_1_: 
and :otdel_1_: 
and :vrach_1_: 
and case when settings_tab.value in ('0152','0151') then d.uchactok_id!=1000 else true end); 
 
 
CREATE TEMP TABLE report_stud_disp_tab 
(id BIGINT, 
diagn_id VARCHAR, 
disp_uchet INTEGER);  
 
 
INSERT INTO report_stud_disp_tab(id,diagn_id,disp_uchet) 
(SELECT d.dan_id, diagn.diagn_osn,case when disp.dan_id is not null then 1 else 0 end     
FROM kart_dd_tab k 
LEFT JOIN dop_dispan_tab diagn ON diagn.kart_dd_id = k.kart_dd_id 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
left join dispan_uchet_tab disp on disp.dan_id=d.dan_id 
LEFt JOIN settings_tab ON UPPER(settings_tab.name) = 'LPU_NUMBER' 
where k.date_vnes_inf between date(':param1_1_:') AND date(':param1_2_:') 
and :vrach_1_: 
and case when get_lpu_number() in ('0035') 
		 then  (d.kat in (2,12) and (d.sozstatus_id in (2,12) or d.sozstatus_id is null)) 
		 else (d.sozstatus_id in (12) and (d.kat in (12) or d.kat is null)) end 
and case when settings_tab.value in ('0152','0151') then d.uchactok_id!=1000 else true end); 
 
 
CREATE INDEX "report_disp_tab_diag_idx" ON "report_disp_tab" 
  USING btree ("diagn_id"); 
  
CREATE INDEX "report_disp_tab_age_idx" ON "report_disp_tab" 
  USING btree ("age"); 
 
CREATE INDEX "report_diagn_tab_diag_idx" ON "report_diagn_tab" 
  USING btree ("diagn_osn"); 
  
CREATE INDEX "report_diagn_tab_age_idx" ON "report_diagn_tab" 
  USING btree ("age");</Sql>
            </Query>
            <Query>
              <Sql>seek(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>seek_all(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp3(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (rep.diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn ilike 'mkb1' 
or rep.diagn_osn ilike 'mkb2' 
or rep.diagn_osn ilike 'mkb3' 
or rep.diagn_osn ilike 'mkb4' 
or rep.diagn_osn ilike 'mkb5' ) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp3(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (rep.diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn ilike 'mkb1' 
or rep.diagn_osn ilike 'mkb2' 
or rep.diagn_osn ilike 'mkb3' 
or rep.diagn_osn ilike 'mkb4' 
or rep.diagn_osn ilike 'mkb5' ) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_p_disp(mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_p5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_prof(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab_prof 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_s5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_sp5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_p_disp(mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_p_disp(mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_p_disp(mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (rep.diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' 
or diagn_osn ilike 'mkb2' 
or diagn_osn ilike 'mkb3' 
or diagn_osn ilike 'mkb4' 
or diagn_osn ilike 'mkb5' ) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first5_p_disp(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn ilike 'mkb1' 
or rep.diagn_osn ilike 'mkb2' 
or rep.diagn_osn ilike 'mkb3' 
or rep.diagn_osn ilike 'mkb4' 
or rep.diagn_osn ilike 'mkb5' ) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5' ) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_p5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0 
AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_sp5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0 
AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE  ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' 
or diagn_osn ilike 'mkb2' 
or diagn_osn ilike 'mkb3' 
or diagn_osn ilike 'mkb4' 
or diagn_osn ilike 'mkb5' ) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end ;</Sql>
            </Query>
            <Query>
              <Sql>seek_povt(age1,age2,mkb1,mkb2) select sum(f.id) from 
(SELECT (count(id)-1)as id,dan_id,spec FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
group by 2,3 
having count(id)&gt;1)as f;</Sql>
            </Query>
            <Query>
              <Sql>seek_povt_p(mkb1,mkb2) select sum(f.id) from 
(SELECT (count(id)-1)as id,dan_id,spec FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end 
group by 2,3 
having count(id)&gt;1)as f;</Sql>
            </Query>
            <Query>
              <Sql>seek_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end  AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_zak(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND _end = 1 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>seek_zak_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND _end = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek2_all(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek2_all_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek2_all_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek2_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>z1(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>z1_p SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>z1_s(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z1_sp SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z2(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>z2_p SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>z2_s(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2 
AND diagn_type_id IN (0,2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z2_sp SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND diagn_type_id IN (0,2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z3(age1,age2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>z3_p SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
 AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>z3_s(age1,age2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
 AND (age BETWEEN age1 AND age2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z3_sp SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="vrach" Caption="Врач" Type="select">
              <Sql>select 'true','Все',0 union select 'diagn.doctor_id='||full_doctor_id,full_fio,1 from full_doctor_tab  order by 3,2</Sql>
            </Parameter>
            <Parameter Name="disp_prik" Caption="На диспансерном учёте считать только прикреплённых" Type="select">
              <Sql>SELECT 'true', 'Нет',1 UNION SELECT 'd.spolref::int8 in (select * from get_all_lpu_numbers())','Да',0 ORDER BY 3</Sql>
            </Parameter>
            <Parameter Name="otdel" Caption="Отделение" Type="select">
              <Sql>SELECT 'true', 'Все',0 UNION SELECT 'dt.sp_otdel_id  ='||o.otdel, o.nam_otdel,1 FROM otdel_tab o order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param5" Caption="Считать только по основному диагнозу" Type="select">
              <Sql>SELECT 'true'::text, 'Нет'::text,0 UNION SELECT 't.diag_osn = diagn.diagn_osn '::text, 'Да'::text,1 ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Считать только по прикрепленному населению" Type="select">
              <Sql>SELECT 'true', 'Нет', 1 UNION SELECT 't.pricpol::int8 in (select * from get_all_lpu_numbers())','Да',0 ORDER BY 3</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT 'true', 'По всему ЛПУ', -1,0 UNION SELECT 'd.uchactok_id ='||(uchactok_id::text), uchactok,1,uchactok_id FROM uchactok_tab UNION SELECT 'd.uchactok_id IN (1001,1002,1003,1006)', '1, 2, 3, 6 участки - аттест. сотр. УВД', 100000,90000 ORDER BY 3, 4</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2017103001" Name="Форма 12(new)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 12(new).xls">
          <Queries>
            <Query>
              <Sql>diagn_exception (diagn.diagn_osn NOT BETWEEN 'A39' AND 'A39.9' AND diagn.diagn_osn NOT BETWEEN 'A40' AND 'A41.9' AND diagn.diagn_osn NOT BETWEEN 'A80' AND 'A80.9' AND diagn.diagn_osn NOT BETWEEN 'D60' AND 'D61.9' AND diagn.diagn_osn NOT BETWEEN 'D65' AND 'D65.' AND diagn.diagn_osn NOT BETWEEN 'E23' AND 'E23.7' AND diagn.diagn_osn NOT BETWEEN 'E25' AND 'E25.9' AND diagn.diagn_osn NOT BETWEEN 'E28' AND 'E28.9' AND diagn.diagn_osn NOT BETWEEN 'E29' AND 'E29.9' AND diagn.diagn_osn NOT BETWEEN 'E70' AND 'E70.9' AND diagn.diagn_osn NOT BETWEEN 'E74.2' AND 'E74.2' AND diagn.diagn_osn NOT BETWEEN 'E75.5' AND 'E75.5' AND diagn.diagn_osn NOT BETWEEN 'E76' AND 'E76.9' AND diagn.diagn_osn NOT BETWEEN 'E84' AND 'E84.9' AND diagn.diagn_osn NOT BETWEEN 'F00' AND 'F99.' AND diagn.diagn_osn NOT BETWEEN 'G00' AND 'G00.9' AND diagn.diagn_osn NOT BETWEEN 'G10' AND 'G12.9' AND diagn.diagn_osn NOT BETWEEN 'G30' AND 'G31.9' AND diagn.diagn_osn NOT BETWEEN 'G61' AND 'G61.0' AND diagn.diagn_osn NOT BETWEEN 'G70' AND 'G73.7' AND diagn.diagn_osn NOT BETWEEN 'G95.1' AND 'G95.1' AND diagn.diagn_osn NOT BETWEEN 'H46' AND 'H46.' AND diagn.diagn_osn NOT BETWEEN 'H80' AND 'H80.9' AND diagn.diagn_osn NOT BETWEEN 'I00' AND 'I02.9' AND diagn.diagn_osn NOT BETWEEN 'I12' AND 'I13.9' AND diagn.diagn_osn NOT BETWEEN 'I20' AND 'I20.0' AND diagn.diagn_osn NOT BETWEEN 'I22' AND 'I22.9' AND diagn.diagn_osn NOT BETWEEN 'I24' AND 'I24.9' AND diagn.diagn_osn NOT BETWEEN 'I26' AND 'I26.9' AND diagn.diagn_osn NOT BETWEEN 'I33' AND 'I33.9' AND diagn.diagn_osn NOT BETWEEN 'I40' AND 'I40.9' AND diagn.diagn_osn NOT BETWEEN 'I42' AND 'I42.9' AND diagn.diagn_osn NOT BETWEEN 'I60' AND 'I60.9' AND diagn.diagn_osn NOT BETWEEN 'I61' AND 'I63.9' AND diagn.diagn_osn NOT BETWEEN 'I65' AND 'I66.9' AND diagn.diagn_osn NOT BETWEEN 'I69' AND 'I69.8' AND diagn.diagn_osn NOT BETWEEN 'I81' AND 'I81.' AND diagn.diagn_osn NOT BETWEEN 'J05' AND 'J05.1' AND diagn.diagn_osn NOT BETWEEN 'J10' AND 'J11.8' AND diagn.diagn_osn NOT BETWEEN 'J84' AND 'J94.9' AND diagn.diagn_osn NOT BETWEEN 'K00' AND 'K14.9' AND diagn.diagn_osn NOT BETWEEN 'K56' AND 'K56.7' AND diagn.diagn_osn NOT BETWEEN 'K65' AND 'K65.9' AND diagn.diagn_osn NOT BETWEEN 'L10' AND 'L10.9' AND diagn.diagn_osn NOT BETWEEN 'L12' AND 'L12.9' AND diagn.diagn_osn NOT BETWEEN 'L13' AND 'L13.0' AND diagn.diagn_osn NOT BETWEEN 'L20' AND 'L20.9' AND diagn.diagn_osn NOT BETWEEN 'L23' AND 'L25.9' AND diagn.diagn_osn NOT BETWEEN 'L30' AND 'L30.9' AND diagn.diagn_osn NOT BETWEEN 'L43' AND 'L43.9' AND diagn.diagn_osn NOT BETWEEN 'L93' AND 'L93.0' AND diagn.diagn_osn NOT BETWEEN 'L94' AND 'L94.0' AND diagn.diagn_osn NOT BETWEEN 'M02' AND 'M02.9' AND diagn.diagn_osn NOT BETWEEN 'M08' AND 'M08.9' AND diagn.diagn_osn NOT BETWEEN 'N46' AND 'N46.' AND diagn.diagn_osn NOT BETWEEN 'N60' AND 'N60.9' AND diagn.diagn_osn NOT BETWEEN 'N70' AND 'N70.9' AND diagn.diagn_osn NOT BETWEEN 'N80' AND 'N80.9' AND diagn.diagn_osn NOT BETWEEN 'N86' AND 'N86.' AND diagn.diagn_osn NOT BETWEEN 'N91' AND 'N94.9' AND diagn.diagn_osn NOT BETWEEN 'N97' AND 'N97.9' AND diagn.diagn_osn NOT BETWEEN 'O00' AND 'O99.8' AND diagn.diagn_osn NOT BETWEEN 'P00' AND 'P96.9' AND diagn.diagn_osn NOT BETWEEN 'Q00' AND 'Q07.9' AND diagn.diagn_osn NOT BETWEEN 'Q20' AND 'Q28.9' AND diagn.diagn_osn NOT BETWEEN 'Q51' AND 'Q52.9' AND diagn.diagn_osn NOT BETWEEN 'Q56' AND 'Q56.4' AND diagn.diagn_osn NOT BETWEEN 'Q65' AND 'Q65.9' AND diagn.diagn_osn NOT BETWEEN 'Q80' AND 'Q80.9' AND diagn.diagn_osn NOT BETWEEN 'Q85' AND 'Q85.9' AND diagn.diagn_osn NOT BETWEEN 'Q90' AND 'Q90.9' AND diagn.diagn_osn NOT BETWEEN 'R00' AND 'R99.9')</Sql>
            </Query>
            <Query>
              <Sql>disp_exception (diagn_id NOT BETWEEN 'A39' AND 'A39.9' AND diagn_id NOT BETWEEN 'A40' AND 'A41.9' AND diagn_id NOT BETWEEN 'A80' AND 'A80.9' AND diagn_id NOT BETWEEN 'D60' AND 'D61.9' AND diagn_id NOT BETWEEN 'D65' AND 'D65.' AND diagn_id NOT BETWEEN 'E23' AND 'E23.7' AND diagn_id NOT BETWEEN 'E25' AND 'E25.9' AND diagn_id NOT BETWEEN 'E28' AND 'E28.9' AND diagn_id NOT BETWEEN 'E29' AND 'E29.9' AND diagn_id NOT BETWEEN 'E70' AND 'E70.9' AND diagn_id NOT BETWEEN 'E74.2' AND 'E74.2' AND diagn_id NOT BETWEEN 'E75.5' AND 'E75.5' AND diagn_id NOT BETWEEN 'E76' AND 'E76.9' AND diagn_id NOT BETWEEN 'E84' AND 'E84.9' AND diagn_id NOT BETWEEN 'F00' AND 'F99.' AND diagn_id NOT BETWEEN 'G00' AND 'G00.9' AND diagn_id NOT BETWEEN 'G10' AND 'G12.9' AND diagn_id NOT BETWEEN 'G30' AND 'G31.9' AND diagn_id NOT BETWEEN 'G61' AND 'G61.0' AND diagn_id NOT BETWEEN 'G70' AND 'G73.7' AND diagn_id NOT BETWEEN 'G95.1' AND 'G95.1' AND diagn_id NOT BETWEEN 'H46' AND 'H46.' AND diagn_id NOT BETWEEN 'H80' AND 'H80.9' AND diagn_id NOT BETWEEN 'I00' AND 'I02.9' AND diagn_id NOT BETWEEN 'I12' AND 'I13.9' AND diagn_id NOT BETWEEN 'I20' AND 'I20.0' AND diagn_id NOT BETWEEN 'I22' AND 'I22.9' AND diagn_id NOT BETWEEN 'I24' AND 'I24.9' AND diagn_id NOT BETWEEN 'I26' AND 'I26.9' AND diagn_id NOT BETWEEN 'I33' AND 'I33.9' AND diagn_id NOT BETWEEN 'I40' AND 'I40.9' AND diagn_id NOT BETWEEN 'I42' AND 'I42.9' AND diagn_id NOT BETWEEN 'I60' AND 'I60.9' AND diagn_id NOT BETWEEN 'I61' AND 'I63.9' AND diagn_id NOT BETWEEN 'I65' AND 'I66.9' AND diagn_id NOT BETWEEN 'I69' AND 'I69.8' AND diagn_id NOT BETWEEN 'I81' AND 'I81.' AND diagn_id NOT BETWEEN 'J05' AND 'J05.1' AND diagn_id NOT BETWEEN 'J10' AND 'J11.8' AND diagn_id NOT BETWEEN 'J84' AND 'J94.9' AND diagn_id  NOT BETWEEN 'K00' AND 'K14.9' AND diagn_id NOT BETWEEN 'K56' AND 'K56.7' AND diagn_id NOT BETWEEN 'K65' AND 'K65.9' AND diagn_id NOT BETWEEN 'L10' AND 'L10.9' AND diagn_id NOT BETWEEN 'L12' AND 'L12.9' AND diagn_id NOT BETWEEN 'L13' AND 'L13.0' AND diagn_id NOT BETWEEN 'L20' AND 'L20.9' AND diagn_id NOT BETWEEN 'L23' AND 'L25.9' AND diagn_id NOT BETWEEN 'L30' AND 'L30.9' AND diagn_id NOT BETWEEN 'L43' AND 'L43.9' AND diagn_id NOT BETWEEN 'L93' AND 'L93.0' AND diagn_id NOT BETWEEN 'L94' AND 'L94.0' AND diagn_id NOT BETWEEN 'M02' AND 'M02.9' AND diagn_id NOT BETWEEN 'M08' AND 'M08.9' AND diagn_id NOT BETWEEN 'N46' AND 'N46.' AND diagn_id NOT BETWEEN 'N60' AND 'N60.9' AND diagn_id NOT BETWEEN 'N70' AND 'N70.9' AND diagn_id NOT BETWEEN 'N80' AND 'N80.9' AND diagn_id NOT BETWEEN 'N86' AND 'N86.' AND diagn_id NOT BETWEEN 'N91' AND 'N94.9' AND diagn_id NOT BETWEEN 'N97' AND 'N97.9' AND diagn_id NOT BETWEEN 'O00' AND 'O99.8' AND diagn_id NOT BETWEEN 'P00' AND 'P96.9' AND diagn_id NOT BETWEEN 'Q00' AND 'Q07.9' AND diagn_id NOT BETWEEN 'Q20' AND 'Q28.9' AND diagn_id NOT BETWEEN 'Q51' AND 'Q52.9' AND diagn_id NOT BETWEEN 'Q56' AND 'Q56.4' AND diagn_id NOT BETWEEN 'Q65' AND 'Q65.9' AND diagn_id NOT BETWEEN 'Q80' AND 'Q80.9' AND diagn_id NOT BETWEEN 'Q85' AND 'Q85.9' AND diagn_id NOT BETWEEN 'Q90' AND 'Q90.9' AND diagn_id NOT BETWEEN 'R00' AND 'R99.9')</Sql>
            </Query>
            <Query>
              <Sql>dispans_all(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m3(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9'))  
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9'))  
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5') 
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_p(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2')  
 AND age&gt;=case when sex='м' then 60 else 55 end</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_p5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5')  
 AND age&gt;=case when sex='м' then 60 else 55 end</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4'))  
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m3(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9'))  
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9'))  
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_sp(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2')  
 AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_sp5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5')  
 AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2_p(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2_sp(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
AND cityzen=0 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3_p(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3_s(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (age BETWEEN age1 AND age2) AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3_sp(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4_p(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (age BETWEEN age1 AND age2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4_sp(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' 
or diagn_id ilike 'mkb2' 
or diagn_id ilike 'mkb3' 
or diagn_id ilike 'mkb4' 
or diagn_id ilike 'mkb5' ) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans2_all(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans2_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dop_dd_dispans SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab d ON d.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN kart_dd_tab k ON dispan_uchet_tab.dan_id = k.dan_id 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
WHERE (date BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND :district_1_: 
AND k.date_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
and dop.sp_stadiya_diagn_id =2</Sql>
            </Query>
            <Query>
              <Sql>dop_dd_first select count(*) 
from diagn_tab diag 
LEFT JOIN kart_dd_tab k ON k.talon_id = diag.talon_id 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
LEFT JOIN talon_tab t ON t.talon_id = k.talon_id 
LEFT JOIN dan_tab d On d.dan_id = k.dan_id 
where k.date_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
and dop.sp_stadiya_diagn_id =2 
 AND :param2_1_: 
 AND :district_1_:</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_stud(mkb_1,mkb_2,param_1,param_2) select count(distinct id) 
from report_stud_disp_tab 
where (diagn_id between 'mkb_1' and 'mkb_2' param_2) 
and param_1</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_stud_all select count(distinct id) 
from report_stud_disp_tab</Sql>
            </Query>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>report_clear SELECT ''; SELECT drop_if_exists('report_diagn_tab'); 
 
SELECT drop_if_exists('report_disp_tab'); 
SELECT drop_if_exists('report_stud_disp_tab');</Sql>
            </Query>
            <Query>
              <Sql>report_init SELECT ''; SELECT drop_if_exists('report_diagn_tab'); 
 
SELECT drop_if_exists('report_disp_tab'); 
SELECT drop_if_exists('report_stud_disp_tab');  
 
CREATE TEMP TABLE report_disp_tab 
(age INTEGER, 
sex VARCHAR(1), 
cityzen INTEGER, 
diagn_id VARCHAR, 
dan_id BIGINT, 
id BIGINT PRIMARY KEY 
); 
 
INSERT INTO report_disp_tab (age,sex,cityzen,diagn_id,dan_id,id) 
(SELECT  DATE_PART('year',AGE(date(':param1_2_:'), d.date_born)), 
d.sex, d.cityzen, diagn.diagn_id,d.dan_id,diagn.id 
FROM dispensary_registration_tab diagn 
JOIN dan_tab d ON d.dan_id = diagn.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab dt on dt.doctor_id=u.doctor_id 
left join otdel_tab o on o.otdel = dt.sp_otdel_id  
LEFt JOIN settings_tab ON UPPER(settings_tab.name) = 'LPU_NUMBER' 
WHERE 
 entry_date &lt; date(':param1_2_:') 
 AND (leave_date IS NULL OR leave_date &gt;date(':param1_2_:')) 
 /*AND disp_exception  */ 
 AND :district_1_: 
 AND :disp_prik_1_: 
and :otdel_1_: 
and :vrach_1_: 
and case when settings_tab.value in ('0152','0151') then d.uchactok_id!=1000 else true end 
); 
 
CREATE TEMP TABLE report_diagn_tab 
(age INTEGER, 
sex VARCHAR(1), 
cityzen INTEGER, 
diagn_osn VARCHAR, 
dan_id BIGINT, 
diagn_type_id BIGINT, 
count INTEGER, 
id BIGINT PRIMARY KEY, 
_end INTEGER, 
spec bigint 
); 
  
 
INSERT INTO report_diagn_tab(age,sex,cityzen,diagn_osn,dan_id,diagn_type_id,id,count,_end,spec) 
(SELECT  DATE_PART('year',AGE(date(diagn.data_vnes_inf), d.date_born)), 
d.sex, d.cityzen, diagn.diagn_osn,d.dan_id,diagn.diagn_type_id,diagn.id,diagn.count,rez._end,dt.sp_spec_doctor_id 
FROM diagn_tab diagn 
JOIN talon_tab t ON t.talon_id = diagn.talon_id AND :param5_1_: 
left join codifiers.visit_result_common_tab rez On rez.id = t.result_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
left join doctor_tab dt on dt.doctor_id=diagn.doctor_id 
left join otdel_tab o on o.otdel = dt.sp_otdel_id  
LEFt JOIN settings_tab ON UPPER(settings_tab.name) = 'LPU_NUMBER' 
WHERE (diagn.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
/*AND diagn_exception  */ 
AND :param2_1_: 
 AND :district_1_: 
and :otdel_1_: 
and :vrach_1_: 
and case when settings_tab.value in ('0152','0151') then d.uchactok_id!=1000 else true end); 
 
 
CREATE TEMP TABLE report_stud_disp_tab 
(id BIGINT, 
diagn_id VARCHAR, 
disp_uchet INTEGER);  
 
 
INSERT INTO report_stud_disp_tab(id,diagn_id,disp_uchet) 
(SELECT d.dan_id, diagn.diagn_osn,case when disp.dan_id is not null then 1 else 0 end     
FROM kart_dd_tab k 
LEFT JOIN dop_dispan_tab diagn ON diagn.kart_dd_id = k.kart_dd_id 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
left join dispan_uchet_tab disp on disp.dan_id=d.dan_id 
LEFt JOIN settings_tab ON UPPER(settings_tab.name) = 'LPU_NUMBER' 
where k.date_vnes_inf between date(':param1_1_:') AND date(':param1_2_:') 
and :vrach_1_: 
and case when get_lpu_number() in ('0035') 
		 then  (d.kat in (2,12) and (d.sozstatus_id in (2,12) or d.sozstatus_id is null)) 
		 else (d.sozstatus_id in (12) and (d.kat in (12) or d.kat is null)) end 
and case when settings_tab.value in ('0152','0151') then d.uchactok_id!=1000 else true end); 
 
 
CREATE INDEX "report_disp_tab_diag_idx" ON "report_disp_tab" 
  USING btree ("diagn_id"); 
  
CREATE INDEX "report_disp_tab_age_idx" ON "report_disp_tab" 
  USING btree ("age"); 
 
CREATE INDEX "report_diagn_tab_diag_idx" ON "report_diagn_tab" 
  USING btree ("diagn_osn"); 
  
CREATE INDEX "report_diagn_tab_age_idx" ON "report_diagn_tab" 
  USING btree ("age");</Sql>
            </Query>
            <Query>
              <Sql>seek(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>seek_all(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp3(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (rep.diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn ilike 'mkb1' 
or rep.diagn_osn ilike 'mkb2' 
or rep.diagn_osn ilike 'mkb3' 
or rep.diagn_osn ilike 'mkb4' 
or rep.diagn_osn ilike 'mkb5' ) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp3(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (rep.diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn ilike 'mkb1' 
or rep.diagn_osn ilike 'mkb2' 
or rep.diagn_osn ilike 'mkb3' 
or rep.diagn_osn ilike 'mkb4' 
or rep.diagn_osn ilike 'mkb5' ) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_p_disp(mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_p5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_prof(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab_prof 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_s5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_sp5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_p_disp(mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_p_disp(mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_p_disp(mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (rep.diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' 
or diagn_osn ilike 'mkb2' 
or diagn_osn ilike 'mkb3' 
or diagn_osn ilike 'mkb4' 
or diagn_osn ilike 'mkb5' ) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first5_p_disp(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn ilike 'mkb1' 
or rep.diagn_osn ilike 'mkb2' 
or rep.diagn_osn ilike 'mkb3' 
or rep.diagn_osn ilike 'mkb4' 
or rep.diagn_osn ilike 'mkb5' ) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5' ) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_p5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0 
AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_sp5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0 
AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE  ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' 
or diagn_osn ilike 'mkb2' 
or diagn_osn ilike 'mkb3' 
or diagn_osn ilike 'mkb4' 
or diagn_osn ilike 'mkb5' ) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end ;</Sql>
            </Query>
            <Query>
              <Sql>seek_povt(age1,age2,mkb1,mkb2) select sum(f.id) from 
(SELECT (count(id)-1)as id,dan_id,spec FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
group by 2,3 
having count(id)&gt;1)as f;</Sql>
            </Query>
            <Query>
              <Sql>seek_povt_p(mkb1,mkb2) select sum(f.id) from 
(SELECT (count(id)-1)as id,dan_id,spec FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end 
group by 2,3 
having count(id)&gt;1)as f;</Sql>
            </Query>
            <Query>
              <Sql>seek_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end  AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_zak(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND _end = 1 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>seek_zak_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND _end = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek2_all(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek2_all_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek2_all_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek2_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>z1(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>z1_p SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>z1_s(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z1_sp SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z2(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>z2_p SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>z2_s(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2 
AND diagn_type_id IN (0,2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z2_sp SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND diagn_type_id IN (0,2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z3(age1,age2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>z3_p SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
 AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>z3_s(age1,age2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
 AND (age BETWEEN age1 AND age2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z3_sp SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="vrach" Caption="Врач" Type="select">
              <Sql>select 'true','Все',0 union select 'diagn.doctor_id='||full_doctor_id,full_fio,1 from full_doctor_tab  order by 3,2</Sql>
            </Parameter>
            <Parameter Name="disp_prik" Caption="На диспансерном учёте считать только прикреплённых" Type="select">
              <Sql>SELECT 'true', 'Нет',1 UNION SELECT 'd.spolref::int8 in (select * from get_all_lpu_numbers())','Да',0 ORDER BY 3</Sql>
            </Parameter>
            <Parameter Name="otdel" Caption="Отделение" Type="select">
              <Sql>SELECT 'true', 'Все',0 UNION SELECT 'dt.sp_otdel_id  ='||o.otdel, o.nam_otdel,1 FROM otdel_tab o order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param5" Caption="Считать только по основному диагнозу" Type="select">
              <Sql>SELECT 'true'::text, 'Нет'::text,0 UNION SELECT 't.diag_osn = diagn.diagn_osn '::text, 'Да'::text,1 ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Считать только по прикрепленному населению" Type="select">
              <Sql>SELECT 'true', 'Нет', 1 UNION SELECT 't.pricpol::int8 in (select * from get_all_lpu_numbers())','Да',0 ORDER BY 3</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT 'true', 'По всему ЛПУ', -1,0 UNION SELECT 'd.uchactok_id ='||(uchactok_id::text), uchactok,1,uchactok_id FROM uchactok_tab UNION SELECT 'd.uchactok_id IN (1001,1002,1003,1006)', '1, 2, 3, 6 участки - аттест. сотр. УВД', 100000,90000 ORDER BY 3, 4</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2018503000" Name="Форма 12 (раскрытая)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 12 (раскрытая).xls">
          <Queries>
            <Query>
              <Sql>dispans_all SELECT COUNT(DISTINCT du.dan_id) 
FROM dispan_uchet_tab du 
LEFT JOIN dan_tab d ON d.dan_id = du.dan_id 
WHERE du.diagn_id=':diag:' 
 AND (du.date &lt; date(':param1_2_:')) 
 AND ((du.date_sn IS NULL) OR ((du.date_sn IS NOT NULL) AND (du.date_sn &gt;date(':param1_2_:')))) 
 AND (du.diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND (du.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
            <Query>
              <Sql>itogo1 select sum(ff.kol_vo) from ( 
SELECT  COUNT(dt.id) as kol_vo 
from diagn_tab dt 
left join mkb_tab mkb on mkb.kod_d=dt.diagn_osn 
LEFT JOIN dan_tab d ON d.dan_id = dt.dan_id 
LEFT JOIN talon_tab t ON t.talon_id = dt.talon_id 
where (dt.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
AND (dt.count_diagn_tab=1) 
AND (dt.diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (t.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 and (dt.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_: 
) as ff</Sql>
            </Query>
            <Query>
              <Sql>itogo2 select sum(ff.kol_vo) from ( 
SELECT COUNT(*) as kol_vo 
FROM diagn_tab dt 
LEFT JOIN dan_tab d ON d.dan_id = dt.dan_id 
LEFT JOIN talon_tab t ON t.talon_id = dt.talon_id 
WHERE  (dt.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (dt.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
  AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (t.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 and (dt.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_: 
) as ff</Sql>
            </Query>
            <Query>
              <Sql>itogo3 select sum(ff.kol_vo) from ( 
SELECT COUNT(DISTINCT du.dan_id) as kol_vo 
FROM dispan_uchet_tab du 
LEFT JOIN dan_tab d ON d.dan_id = du.dan_id 
WHERE  (du.date &lt; date(':param1_2_:')) 
 AND ((du.date_sn IS NULL) OR ((du.date_sn IS NOT NULL) AND (du.date_sn &gt;date(':param1_2_:')))) 
 AND (du.diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 AND (du.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_: 
) as ff</Sql>
            </Query>
            <Query>
              <Sql>seek_all SELECT '$id'::text, mkb.mkb as mkb, COUNT(dt.id) as kol_vo, dt.diagn_osn as diag 
from diagn_tab dt 
left join mkb_tab mkb on mkb.kod_d=dt.diagn_osn 
LEFT JOIN dan_tab d ON d.dan_id = dt.dan_id 
LEFT JOIN talon_tab t ON t.talon_id = dt.talon_id 
where (dt.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
AND (dt.count_diagn_tab=1) 
AND (dt.diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (t.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 and (dt.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_: 
group by 2,4 
order by 4</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first SELECT COUNT(*) 
FROM diagn_tab dt 
LEFT JOIN dan_tab d ON d.dan_id = dt.dan_id 
LEFT JOIN talon_tab t ON t.talon_id = dt.talon_id 
WHERE dt.diagn_osn=':diag:'  
 AND (dt.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (dt.count_diagn_tab=1) 
 AND (otmet IN ('З', 'О')) 
  AND (diagn_osn NOT BETWEEN 'K00' AND 'K14.9') 
 AND ((NOT :param2_1_:) OR (t.pricpol::int8 in (select * from get_all_lpu_numbers()))) 
 AND ((:district_1_: &lt; 0) OR (d.uchactok_id = :district_1_:)) 
 and (dt.doctor_id = :param4_1_: or :param4_1_:=-1) 
and :otd_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param4" Caption="Врач" Type="select">
              <Sql>select -1, 'Все врачи' union SELECT f.full_doctor_id, f.full_doctor_id||' '||f.fio||' ('||f.dolg_doctor||')' FROm full_doctor_tab f where f.dolg_doctor_id !=900 ORDER BY 1,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="otd" Caption="Отделение" Type="select">
              <Sql>select 'true'::text, 'Все',0 union select 'd.spolref='''||lpu_tab.pricpol||'''',lpu_tab.name,1 from lpu_tab  order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Считать только по прикрепленному населению" Type="select2">
              <Sql>true=да| false=нет|</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2018903000" Name="Флюоропаспорт (новый)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Флюоропаспорт (новый).xls">
          <Queries>
            <Query>
              <Sql>z1(par1,par2) select count(*) 
from researches.fluorography_tab fluo 
LEFT JOIN dan_tab d ON d.dan_id = fluo.dan_id 
left join naprav_tab n ON n.id = fluo.naprav_id 
left join visit_tab v ON v.talon_id = n.talon_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
where  fluo.date_analisis between ':param1_1_:' and ':param1_2_:'  
AND :param2_1_: 
:param3_1_: 
and 
case when o.otdel=101 THEN d.uchactok_id IN (1800010,1810010,1350010,1330010,1630010,1640010,1660010,1680010,1940010) 
WHEN o.otdel=102 THEN d.uchactok_id IN (1670010,1950010,1650010,1820010,1690010,1700010,1730010,1740010,1770010) 
WHEN o.otdel=103 THEN d.uchactok_id IN (1710010,1720010,1840010,1850010,1760010) 
end 
and :param4_1_: 
and par1 and par2</Sql>
            </Query>
            <Query>
              <Sql>z2(par1,par2) select count(*) 
from researches.fluorography_tab fluo 
LEFT JOIN dan_tab d ON d.dan_id = fluo.dan_id 
left join naprav_tab n ON n.id = fluo.naprav_id 
left join visit_tab v ON v.talon_id = n.talon_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab doc ON doc.doctor_id = u.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
where  fluo.date_analisis between ':param1_1_:' and ':param1_2_:'  
AND :param2_1_: :param3_1_: 
and 
case when o.otdel=101 THEN d.uchactok_id IN (1800010,1810010,1350010,1330010,1630010,1640010,1660010,1680010,1940010) 
WHEN o.otdel=102 THEN d.uchactok_id IN (1670010,1950010,1650010,1820010,1690010,1700010,1730010,1740010,1770010) 
WHEN o.otdel=103 THEN d.uchactok_id IN (1710010,1720010,1840010,1850010,1760010) 
end 
and :param4_1_: 
and par1 and par2 
AND d.dan_id IN 
(SELECT dan_id FROM researches.fluorography_tab 
GROUP BY dan_id 
HAVING max(date_analisis) between date(':param1_1_:') and date(':param1_2_:') 
AND count(id) &gt; 1)  and :param4_1_:</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Отделение" Type="select">
              <Sql>(select 'and o.otdel='||otdel, nam_otdel from otdel_tab order by otdel) union (select ' and true', 'Все')</Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Прикреплен" Type="select">
              <Sql>select 'd.prikreplen=1', 'Да', 0 union  select 'd.prikreplen!=1', 'Нет', 1 union  select 'true','Все',2 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Участок" Type="select">
              <Sql>SELECT 'true'::text, 'все'::text, 0 UNION SELECT 'd.uchactok_id = '||u.id::text,u.name, 1 FROm codifiers.uchactok_tab u ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2021503000" Name="Форма 12" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма 12.xls">
          <Queries>
            <Query>
              <Sql>diagn_exception (diagn.diagn_osn NOT BETWEEN 'A39' AND 'A39.9' AND diagn.diagn_osn NOT BETWEEN 'A40' AND 'A41.9' AND diagn.diagn_osn NOT BETWEEN 'A80' AND 'A80.9' AND diagn.diagn_osn NOT BETWEEN 'D60' AND 'D61.9' AND diagn.diagn_osn NOT BETWEEN 'D65' AND 'D65.' AND diagn.diagn_osn NOT BETWEEN 'E23' AND 'E23.7' AND diagn.diagn_osn NOT BETWEEN 'E25' AND 'E25.9' AND diagn.diagn_osn NOT BETWEEN 'E28' AND 'E28.9' AND diagn.diagn_osn NOT BETWEEN 'E29' AND 'E29.9' AND diagn.diagn_osn NOT BETWEEN 'E70' AND 'E70.9' AND diagn.diagn_osn NOT BETWEEN 'E74.2' AND 'E74.2' AND diagn.diagn_osn NOT BETWEEN 'E75.5' AND 'E75.5' AND diagn.diagn_osn NOT BETWEEN 'E76' AND 'E76.9' AND diagn.diagn_osn NOT BETWEEN 'E84' AND 'E84.9' AND diagn.diagn_osn NOT BETWEEN 'F00' AND 'F99.' AND diagn.diagn_osn NOT BETWEEN 'G00' AND 'G00.9' AND diagn.diagn_osn NOT BETWEEN 'G10' AND 'G12.9' AND diagn.diagn_osn NOT BETWEEN 'G30' AND 'G31.9' AND diagn.diagn_osn NOT BETWEEN 'G61' AND 'G61.0' AND diagn.diagn_osn NOT BETWEEN 'G70' AND 'G73.7' AND diagn.diagn_osn NOT BETWEEN 'G95.1' AND 'G95.1' AND diagn.diagn_osn NOT BETWEEN 'H46' AND 'H46.' AND diagn.diagn_osn NOT BETWEEN 'H80' AND 'H80.9' AND diagn.diagn_osn NOT BETWEEN 'I00' AND 'I02.9' AND diagn.diagn_osn NOT BETWEEN 'I12' AND 'I13.9' AND diagn.diagn_osn NOT BETWEEN 'I20' AND 'I20.0' AND diagn.diagn_osn NOT BETWEEN 'I22' AND 'I22.9' AND diagn.diagn_osn NOT BETWEEN 'I24' AND 'I24.9' AND diagn.diagn_osn NOT BETWEEN 'I26' AND 'I26.9' AND diagn.diagn_osn NOT BETWEEN 'I33' AND 'I33.9' AND diagn.diagn_osn NOT BETWEEN 'I40' AND 'I40.9' AND diagn.diagn_osn NOT BETWEEN 'I42' AND 'I42.9' AND diagn.diagn_osn NOT BETWEEN 'I60' AND 'I60.9' AND diagn.diagn_osn NOT BETWEEN 'I61' AND 'I63.9' AND diagn.diagn_osn NOT BETWEEN 'I65' AND 'I66.9' AND diagn.diagn_osn NOT BETWEEN 'I69' AND 'I69.8' AND diagn.diagn_osn NOT BETWEEN 'I81' AND 'I81.' AND diagn.diagn_osn NOT BETWEEN 'J05' AND 'J05.1' AND diagn.diagn_osn NOT BETWEEN 'J10' AND 'J11.8' AND diagn.diagn_osn NOT BETWEEN 'J84' AND 'J94.9' AND diagn.diagn_osn NOT BETWEEN 'K00' AND 'K14.9' AND diagn.diagn_osn NOT BETWEEN 'K56' AND 'K56.7' AND diagn.diagn_osn NOT BETWEEN 'K65' AND 'K65.9' AND diagn.diagn_osn NOT BETWEEN 'L10' AND 'L10.9' AND diagn.diagn_osn NOT BETWEEN 'L12' AND 'L12.9' AND diagn.diagn_osn NOT BETWEEN 'L13' AND 'L13.0' AND diagn.diagn_osn NOT BETWEEN 'L20' AND 'L20.9' AND diagn.diagn_osn NOT BETWEEN 'L23' AND 'L25.9' AND diagn.diagn_osn NOT BETWEEN 'L30' AND 'L30.9' AND diagn.diagn_osn NOT BETWEEN 'L43' AND 'L43.9' AND diagn.diagn_osn NOT BETWEEN 'L93' AND 'L93.0' AND diagn.diagn_osn NOT BETWEEN 'L94' AND 'L94.0' AND diagn.diagn_osn NOT BETWEEN 'M02' AND 'M02.9' AND diagn.diagn_osn NOT BETWEEN 'M08' AND 'M08.9' AND diagn.diagn_osn NOT BETWEEN 'N46' AND 'N46.' AND diagn.diagn_osn NOT BETWEEN 'N60' AND 'N60.9' AND diagn.diagn_osn NOT BETWEEN 'N70' AND 'N70.9' AND diagn.diagn_osn NOT BETWEEN 'N80' AND 'N80.9' AND diagn.diagn_osn NOT BETWEEN 'N86' AND 'N86.' AND diagn.diagn_osn NOT BETWEEN 'N91' AND 'N94.9' AND diagn.diagn_osn NOT BETWEEN 'N97' AND 'N97.9' AND diagn.diagn_osn NOT BETWEEN 'O00' AND 'O99.8' AND diagn.diagn_osn NOT BETWEEN 'P00' AND 'P96.9' AND diagn.diagn_osn NOT BETWEEN 'Q00' AND 'Q07.9' AND diagn.diagn_osn NOT BETWEEN 'Q20' AND 'Q28.9' AND diagn.diagn_osn NOT BETWEEN 'Q51' AND 'Q52.9' AND diagn.diagn_osn NOT BETWEEN 'Q56' AND 'Q56.4' AND diagn.diagn_osn NOT BETWEEN 'Q65' AND 'Q65.9' AND diagn.diagn_osn NOT BETWEEN 'Q80' AND 'Q80.9' AND diagn.diagn_osn NOT BETWEEN 'Q85' AND 'Q85.9' AND diagn.diagn_osn NOT BETWEEN 'Q90' AND 'Q90.9' AND diagn.diagn_osn NOT BETWEEN 'R00' AND 'R99.9')</Sql>
            </Query>
            <Query>
              <Sql>disp_exception (diagn_id NOT BETWEEN 'A39' AND 'A39.9' AND diagn_id NOT BETWEEN 'A40' AND 'A41.9' AND diagn_id NOT BETWEEN 'A80' AND 'A80.9' AND diagn_id NOT BETWEEN 'D60' AND 'D61.9' AND diagn_id NOT BETWEEN 'D65' AND 'D65.' AND diagn_id NOT BETWEEN 'E23' AND 'E23.7' AND diagn_id NOT BETWEEN 'E25' AND 'E25.9' AND diagn_id NOT BETWEEN 'E28' AND 'E28.9' AND diagn_id NOT BETWEEN 'E29' AND 'E29.9' AND diagn_id NOT BETWEEN 'E70' AND 'E70.9' AND diagn_id NOT BETWEEN 'E74.2' AND 'E74.2' AND diagn_id NOT BETWEEN 'E75.5' AND 'E75.5' AND diagn_id NOT BETWEEN 'E76' AND 'E76.9' AND diagn_id NOT BETWEEN 'E84' AND 'E84.9' AND diagn_id NOT BETWEEN 'F00' AND 'F99.' AND diagn_id NOT BETWEEN 'G00' AND 'G00.9' AND diagn_id NOT BETWEEN 'G10' AND 'G12.9' AND diagn_id NOT BETWEEN 'G30' AND 'G31.9' AND diagn_id NOT BETWEEN 'G61' AND 'G61.0' AND diagn_id NOT BETWEEN 'G70' AND 'G73.7' AND diagn_id NOT BETWEEN 'G95.1' AND 'G95.1' AND diagn_id NOT BETWEEN 'H46' AND 'H46.' AND diagn_id NOT BETWEEN 'H80' AND 'H80.9' AND diagn_id NOT BETWEEN 'I00' AND 'I02.9' AND diagn_id NOT BETWEEN 'I12' AND 'I13.9' AND diagn_id NOT BETWEEN 'I20' AND 'I20.0' AND diagn_id NOT BETWEEN 'I22' AND 'I22.9' AND diagn_id NOT BETWEEN 'I24' AND 'I24.9' AND diagn_id NOT BETWEEN 'I26' AND 'I26.9' AND diagn_id NOT BETWEEN 'I33' AND 'I33.9' AND diagn_id NOT BETWEEN 'I40' AND 'I40.9' AND diagn_id NOT BETWEEN 'I42' AND 'I42.9' AND diagn_id NOT BETWEEN 'I60' AND 'I60.9' AND diagn_id NOT BETWEEN 'I61' AND 'I63.9' AND diagn_id NOT BETWEEN 'I65' AND 'I66.9' AND diagn_id NOT BETWEEN 'I69' AND 'I69.8' AND diagn_id NOT BETWEEN 'I81' AND 'I81.' AND diagn_id NOT BETWEEN 'J05' AND 'J05.1' AND diagn_id NOT BETWEEN 'J10' AND 'J11.8' AND diagn_id NOT BETWEEN 'J84' AND 'J94.9' AND diagn_id  NOT BETWEEN 'K00' AND 'K14.9' AND diagn_id NOT BETWEEN 'K56' AND 'K56.7' AND diagn_id NOT BETWEEN 'K65' AND 'K65.9' AND diagn_id NOT BETWEEN 'L10' AND 'L10.9' AND diagn_id NOT BETWEEN 'L12' AND 'L12.9' AND diagn_id NOT BETWEEN 'L13' AND 'L13.0' AND diagn_id NOT BETWEEN 'L20' AND 'L20.9' AND diagn_id NOT BETWEEN 'L23' AND 'L25.9' AND diagn_id NOT BETWEEN 'L30' AND 'L30.9' AND diagn_id NOT BETWEEN 'L43' AND 'L43.9' AND diagn_id NOT BETWEEN 'L93' AND 'L93.0' AND diagn_id NOT BETWEEN 'L94' AND 'L94.0' AND diagn_id NOT BETWEEN 'M02' AND 'M02.9' AND diagn_id NOT BETWEEN 'M08' AND 'M08.9' AND diagn_id NOT BETWEEN 'N46' AND 'N46.' AND diagn_id NOT BETWEEN 'N60' AND 'N60.9' AND diagn_id NOT BETWEEN 'N70' AND 'N70.9' AND diagn_id NOT BETWEEN 'N80' AND 'N80.9' AND diagn_id NOT BETWEEN 'N86' AND 'N86.' AND diagn_id NOT BETWEEN 'N91' AND 'N94.9' AND diagn_id NOT BETWEEN 'N97' AND 'N97.9' AND diagn_id NOT BETWEEN 'O00' AND 'O99.8' AND diagn_id NOT BETWEEN 'P00' AND 'P96.9' AND diagn_id NOT BETWEEN 'Q00' AND 'Q07.9' AND diagn_id NOT BETWEEN 'Q20' AND 'Q28.9' AND diagn_id NOT BETWEEN 'Q51' AND 'Q52.9' AND diagn_id NOT BETWEEN 'Q56' AND 'Q56.4' AND diagn_id NOT BETWEEN 'Q65' AND 'Q65.9' AND diagn_id NOT BETWEEN 'Q80' AND 'Q80.9' AND diagn_id NOT BETWEEN 'Q85' AND 'Q85.9' AND diagn_id NOT BETWEEN 'Q90' AND 'Q90.9' AND diagn_id NOT BETWEEN 'R00' AND 'R99.9')</Sql>
            </Query>
            <Query>
              <Sql>dispans_all(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m3(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9'))  
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9'))  
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5') 
 AND (age BETWEEN age1 AND age2) 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_p(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2')  
 AND age&gt;=case when sex='м' then 60 else 55 end</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_p5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5')  
 AND age&gt;=case when sex='м' then 60 else 55 end</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4'))  
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m3(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9'))  
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9'))  
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0  AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_s5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5') 
 AND (age BETWEEN age1 AND age2) AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_sp(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2')  
 AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all_sp5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' or 
diagn_id ilike 'mkb2' or 
diagn_id ilike 'mkb3' or 
diagn_id ilike 'mkb4' or 
diagn_id ilike 'mkb5')  
 AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2_p(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all2_sp(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
AND cityzen=0 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3_p(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3_s(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND (age BETWEEN age1 AND age2) AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all3_sp(mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4_p(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND (age BETWEEN age1 AND age2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all4_sp(mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_id BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_id BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_id BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>dispans_all5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id ilike 'mkb1' 
or diagn_id ilike 'mkb2' 
or diagn_id ilike 'mkb3' 
or diagn_id ilike 'mkb4' 
or diagn_id ilike 'mkb5' ) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans2_all(age1,age2,mkb1,mkb2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'mkb1'AND 'mkb2') 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dispans2_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE ((diagn_id BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_id BETWEEN 'mkb3' AND 'mkb4')) 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>dop_dd_dispans SELECT COUNT(DISTINCT dispan_uchet_tab.dan_id) 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab d ON d.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN kart_dd_tab k ON dispan_uchet_tab.dan_id = k.dan_id 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
WHERE (date BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
 AND (diagn_id NOT BETWEEN 'K00' AND 'K14.9') 
 AND :district_1_: 
AND k.date_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
and dop.sp_stadiya_diagn_id =2</Sql>
            </Query>
            <Query>
              <Sql>dop_dd_first select count(*) 
from diagn_tab diag 
LEFT JOIN kart_dd_tab k ON k.talon_id = diag.talon_id 
LEFT JOIN dop_dispan_tab dop ON dop.kart_dd_id = k.kart_dd_id 
LEFT JOIN talon_tab t ON t.talon_id = k.talon_id 
LEFT JOIN dan_tab d On d.dan_id = k.dan_id 
where k.date_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
and dop.sp_stadiya_diagn_id =2 
 AND :param2_1_: 
 AND :district_1_:</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_stud(mkb_1,mkb_2,param_1,param_2) select count(distinct id) 
from report_stud_disp_tab 
where (diagn_id between 'mkb_1' and 'mkb_2' param_2) 
and param_1</Sql>
            </Query>
            <Query>
              <Sql>dop_disp_stud_all select count(distinct id) 
from report_stud_disp_tab</Sql>
            </Query>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>report_clear SELECT ''; SELECT drop_if_exists('report_diagn_tab'); 
 
SELECT drop_if_exists('report_disp_tab'); 
SELECT drop_if_exists('report_stud_disp_tab');</Sql>
            </Query>
            <Query>
              <Sql>report_init SELECT ''; SELECT drop_if_exists('report_diagn_tab'); 
 
SELECT drop_if_exists('report_disp_tab'); 
SELECT drop_if_exists('report_stud_disp_tab');  
 
CREATE TEMP TABLE report_disp_tab 
(age INTEGER, 
sex VARCHAR(1), 
cityzen INTEGER, 
diagn_id VARCHAR, 
dan_id BIGINT, 
id BIGINT PRIMARY KEY 
); 
 
INSERT INTO report_disp_tab (age,sex,cityzen,diagn_id,dan_id,id) 
(SELECT  DATE_PART('year',AGE(date(':param1_2_:'), d.date_born)), 
d.sex, d.cityzen, diagn.diagn_id,d.dan_id,diagn.id 
FROM dispensary_registration_tab diagn 
JOIN dan_tab d ON d.dan_id = diagn.dan_id 
left join uchactok_tab u on u.uchactok_id=d.uchactok_id 
left join doctor_tab dt on dt.doctor_id=u.doctor_id 
left join otdel_tab o on o.otdel = dt.sp_otdel_id  
LEFt JOIN settings_tab ON UPPER(settings_tab.name) = 'LPU_NUMBER' 
WHERE 
 entry_date &lt; date(':param1_2_:') 
 AND (leave_date IS NULL OR leave_date &gt;date(':param1_2_:')) 
 /*AND disp_exception  */ 
 AND :district_1_: 
 AND :disp_prik_1_: 
and :otdel_1_: 
and :vrach_1_: 
and case when settings_tab.value in ('0152','0151') then d.uchactok_id!=1000 else true end 
); 
 
CREATE TEMP TABLE report_diagn_tab 
(age INTEGER, 
sex VARCHAR(1), 
cityzen INTEGER, 
diagn_osn VARCHAR, 
dan_id BIGINT, 
diagn_type_id BIGINT, 
count INTEGER, 
id BIGINT PRIMARY KEY, 
_end INTEGER, 
spec bigint 
); 
  
 
INSERT INTO report_diagn_tab(age,sex,cityzen,diagn_osn,dan_id,diagn_type_id,id,count,_end,spec) 
(SELECT  DATE_PART('year',AGE(date(diagn.data_vnes_inf), d.date_born)), 
d.sex, d.cityzen, diagn.diagn_osn,d.dan_id,diagn.diagn_type_id,diagn.id,diagn.count,rez._end,dt.sp_spec_doctor_id 
FROM diagn_tab diagn 
JOIN talon_tab t ON t.talon_id = diagn.talon_id AND :param5_1_: 
left join codifiers.visit_result_common_tab rez On rez.id = t.result_id 
LEFT JOIN dan_tab d ON d.dan_id = t.dan_id 
left join doctor_tab dt on dt.doctor_id=diagn.doctor_id 
left join otdel_tab o on o.otdel = dt.sp_otdel_id  
LEFt JOIN settings_tab ON UPPER(settings_tab.name) = 'LPU_NUMBER' 
WHERE (diagn.data_vnes_inf BETWEEN date(':param1_1_:') AND date(':param1_2_:')) 
/*AND diagn_exception  */ 
AND :param2_1_: 
 AND :district_1_: 
and :otdel_1_: 
and :vrach_1_: 
and case when settings_tab.value in ('0152','0151') then d.uchactok_id!=1000 else true end); 
 
 
CREATE TEMP TABLE report_stud_disp_tab 
(id BIGINT, 
diagn_id VARCHAR, 
disp_uchet INTEGER);  
 
 
INSERT INTO report_stud_disp_tab(id,diagn_id,disp_uchet) 
(SELECT d.dan_id, diagn.diagn_osn,case when disp.dan_id is not null then 1 else 0 end     
FROM kart_dd_tab k 
LEFT JOIN dop_dispan_tab diagn ON diagn.kart_dd_id = k.kart_dd_id 
LEFT JOIN dan_tab d ON d.dan_id = k.dan_id 
left join dispan_uchet_tab disp on disp.dan_id=d.dan_id 
LEFt JOIN settings_tab ON UPPER(settings_tab.name) = 'LPU_NUMBER' 
where k.date_vnes_inf between date(':param1_1_:') AND date(':param1_2_:') 
and :vrach_1_: 
and case when get_lpu_number() in ('0035') 
		 then  (d.kat in (2,12) and (d.sozstatus_id in (2,12) or d.sozstatus_id is null)) 
		 else (d.sozstatus_id in (12) and (d.kat in (12) or d.kat is null)) end 
and case when settings_tab.value in ('0152','0151') then d.uchactok_id!=1000 else true end); 
 
 
CREATE INDEX "report_disp_tab_diag_idx" ON "report_disp_tab" 
  USING btree ("diagn_id"); 
  
CREATE INDEX "report_disp_tab_age_idx" ON "report_disp_tab" 
  USING btree ("age"); 
 
CREATE INDEX "report_diagn_tab_diag_idx" ON "report_diagn_tab" 
  USING btree ("diagn_osn"); 
  
CREATE INDEX "report_diagn_tab_age_idx" ON "report_diagn_tab" 
  USING btree ("age");</Sql>
            </Query>
            <Query>
              <Sql>seek(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>seek_all(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp3(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (rep.diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_disp5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn ilike 'mkb1' 
or rep.diagn_osn ilike 'mkb2' 
or rep.diagn_osn ilike 'mkb3' 
or rep.diagn_osn ilike 'mkb4' 
or rep.diagn_osn ilike 'mkb5' ) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp3(age1,age2,mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (rep.diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_disp5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn ilike 'mkb1' 
or rep.diagn_osn ilike 'mkb2' 
or rep.diagn_osn ilike 'mkb3' 
or rep.diagn_osn ilike 'mkb4' 
or rep.diagn_osn ilike 'mkb5' ) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_p_disp(mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_p5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_prof(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab_prof 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_s5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first_sp5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_p_disp(mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first2_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_p_disp(mkb1,mkb2) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first3_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_p_disp(mkb1,mkb2,mkb3,mkb4) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE ((rep.diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (rep.diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (rep.diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (rep.diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first4_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' 
or diagn_osn ilike 'mkb2' 
or diagn_osn ilike 'mkb3' 
or diagn_osn ilike 'mkb4' 
or diagn_osn ilike 'mkb5' ) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_first5_p_disp(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(rep.id) FROM report_diagn_tab rep 
LEFT JOIN dispensary_registration_tab disp on disp.dan_id = rep.dan_id 
WHERE (rep.diagn_osn ilike 'mkb1' 
or rep.diagn_osn ilike 'mkb2' 
or rep.diagn_osn ilike 'mkb3' 
or rep.diagn_osn ilike 'mkb4' 
or rep.diagn_osn ilike 'mkb5' ) 
AND disp.entry_date BETWEEN date(':param1_1_:') AND date(':param1_2_:') 
AND count = 1 
AND diagn_type_id IN (0,2) 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m_first5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5' ) 
 AND count = 1 
AND diagn_type_id IN (0,2) 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND age BETWEEN age1 AND age2 
 AND (sex = 'м');</Sql>
            </Query>
            <Query>
              <Sql>seek_all_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_p5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m_first5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м' 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s_m5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
AND count = 1 
AND cityzen=0 
AND sex = 'м';</Sql>
            </Query>
            <Query>
              <Sql>seek_all_s5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0 
AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all_sp5(mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' or 
diagn_osn ilike 'mkb2' or 
diagn_osn ilike 'mkb3' or 
diagn_osn ilike 'mkb4' or 
diagn_osn ilike 'mkb5') 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen = 0 
AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all2_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all3_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4_p(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE  ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4_s(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all4_sp(mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb1.9') 
  OR (diagn_osn BETWEEN 'mkb2' AND 'mkb2.9') OR (diagn_osn BETWEEN 'mkb3' AND 'mkb3.9') OR (diagn_osn BETWEEN 'mkb4' AND 'mkb4.9')) 
 AND count = 1 
AND age&gt;=case when sex='м' then 60 else 55 end AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_all5(age1,age2,mkb1,mkb2,mkb3,mkb4,mkb5) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn ilike 'mkb1' 
or diagn_osn ilike 'mkb2' 
or diagn_osn ilike 'mkb3' 
or diagn_osn ilike 'mkb4' 
or diagn_osn ilike 'mkb5' ) 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end ;</Sql>
            </Query>
            <Query>
              <Sql>seek_povt(age1,age2,mkb1,mkb2) select sum(f.id) from 
(SELECT (count(id)-1)as id,dan_id,spec FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
group by 2,3 
having count(id)&gt;1)as f;</Sql>
            </Query>
            <Query>
              <Sql>seek_povt_p(mkb1,mkb2) select sum(f.id) from 
(SELECT (count(id)-1)as id,dan_id,spec FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end 
group by 2,3 
having count(id)&gt;1)as f;</Sql>
            </Query>
            <Query>
              <Sql>seek_s(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_sp(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age&gt;=case when sex='м' then 60 else 55 end  AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>seek_zak(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND _end = 1 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>seek_zak_p(mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND _end = 1 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>seek2_all(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>seek2_all_first(age1,age2,mkb1,mkb2) SELECT count(id) FROM report_diagn_tab 
WHERE (diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek2_all_first2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
  OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
 AND count = 1 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>seek2_all2(age1,age2,mkb1,mkb2,mkb3,mkb4) SELECT count(id) FROM report_diagn_tab 
WHERE ((diagn_osn BETWEEN 'mkb1' AND 'mkb2') 
OR (diagn_osn BETWEEN 'mkb3' AND 'mkb4')) 
AND age BETWEEN age1 AND age2 
AND count = 1;</Sql>
            </Query>
            <Query>
              <Sql>z1(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2;</Sql>
            </Query>
            <Query>
              <Sql>z1_p SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>z1_s(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z1_sp SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z2(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>z2_p SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND diagn_type_id IN (0,2);</Sql>
            </Query>
            <Query>
              <Sql>z2_s(age1,age2) SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age BETWEEN age1 AND age2 
AND diagn_type_id IN (0,2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z2_sp SELECT count(distinct dan_id) FROM report_diagn_tab 
WHERE count = 1 
AND diagn_osn BETWEEN 'A' AND 'T98.9' 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND diagn_type_id IN (0,2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z3(age1,age2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
 AND (age BETWEEN age1 AND age2);</Sql>
            </Query>
            <Query>
              <Sql>z3_p SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
 AND age&gt;=case when sex='м' then 60 else 55 end;</Sql>
            </Query>
            <Query>
              <Sql>z3_s(age1,age2) SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
 AND (age BETWEEN age1 AND age2) 
AND cityzen=0;</Sql>
            </Query>
            <Query>
              <Sql>z3_sp SELECT COUNT(DISTINCT dan_id) 
FROM report_disp_tab 
WHERE (diagn_id BETWEEN 'A' AND 'T98.9') 
AND age&gt;=case when sex='м' then 60 else 55 end 
AND cityzen=0;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="vrach" Caption="Врач" Type="select">
              <Sql>select 'true','Все',0 union select 'diagn.doctor_id='||full_doctor_id,full_fio,1 from full_doctor_tab  order by 3,2</Sql>
            </Parameter>
            <Parameter Name="disp_prik" Caption="На диспансерном учёте считать только прикреплённых" Type="select">
              <Sql>SELECT 'true', 'Нет',1 UNION SELECT 'd.spolref::int8 in (select * from get_all_lpu_numbers())','Да',0 ORDER BY 3</Sql>
            </Parameter>
            <Parameter Name="otdel" Caption="Отделение" Type="select">
              <Sql>SELECT 'true', 'Все',0 UNION SELECT 'dt.sp_otdel_id  ='||o.otdel, o.nam_otdel,1 FROM otdel_tab o order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Период отчетности" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param5" Caption="Считать только по основному диагнозу" Type="select">
              <Sql>SELECT 'true'::text, 'Нет'::text,0 UNION SELECT 't.diag_osn = diagn.diagn_osn '::text, 'Да'::text,1 ORDER BY 3,2</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Считать только по прикрепленному населению" Type="select">
              <Sql>SELECT 'true', 'Нет', 1 UNION SELECT 't.pricpol::int8 in (select * from get_all_lpu_numbers())','Да',0 ORDER BY 3</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT 'true', 'По всему ЛПУ', -1,0 UNION SELECT 'd.uchactok_id ='||(uchactok_id::text), uchactok,1,uchactok_id FROM uchactok_tab UNION SELECT 'd.uchactok_id IN (1001,1002,1003,1006)', '1, 2, 3, 6 участки - аттест. сотр. УВД', 100000,90000 ORDER BY 3, 4</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2027103000" Name="Форма №030-ПО/о-12 (Сведения о ПМО детей)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Годовые отчеты\Форма №030-ПО_о-12 (Сведения о ПМО детей).xls">
          <Queries>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>report_clear SELECT ''; 
SELECT drop_if_exists('report_prof_tab');</Sql>
            </Query>
            <Query>
              <Sql>report_init SELECT ''; 
SELECT drop_if_exists('report_prof_tab'); 
 
CREATE TEMP TABLE report_prof_tab 
( 
age		INTEGER, 
diag_osn 	VARCHAR, 
dan_id 		BIGINT, 
sex 		VARCHAR(1), 
diagn_stage_id	BIGINT, 
invalid BIGINT, 
invalid_first_date DATE, 
invalid_inspection_date DATE, 
vaccination bigint, 
phys bigint, 
weight_deficit boolean, 
weight_excess boolean, 
low_height boolean, 
high_height boolean, 
health_group_phys_before bigint, 
health_group_phys_after bigint, 
health_group_before bigint, 
health_group_after bigint 
); 
 
INSERT INTO report_prof_tab ( age, diag_osn, dan_id, sex, diagn_stage_id,invalid,invalid_first_date, invalid_inspection_date,vaccination,phys,weight_deficit,weight_excess,low_height,high_height,health_group_phys_before, 
health_group_phys_after,health_group_before,health_group_after  ) 
(SELECT  
get_vozrast(d.date_born), 
ds.mkb_code as diag_osn, 
dd.dan_id, 
d.sex, 
ds.diagn_stage_id, 
kd.invalid, 
kd.invalid_first_date, 
kd.invalid_inspection_date, 
kd.vaccination, 
kd.phys, 
kd.weight_deficit, 
kd.weight_excess, 
kd.low_height, 
kd.high_height, 
kd.health_group_phys_before, 
kd.health_group_phys_after, 
kd.health_group_before, 
kd.health_group_after     
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
left join codifiers.uchactok_tab uch on uch.id=d.uchactok_id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join codifiers.med_help_result_tab mh on mh.id=dd.result_stage_1 
left join codifiers.med_help_result_tab mh1 on mh1.id=dd.result_stage_2 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
left join sp_health_group_tab h on h.sp_health_group_id=dd.sp_health_group_id 
left join dop_disp_kinders_results_tab kd on kd.dop_disp_main_id=dd.id   
where ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) 
and get_vozrast(d.date_born) between 0 and 17 
and :param2_1_: 				 
 
); 
 
 
SELECT drop_if_exists('report_prof_disp_tab'); 
 
CREATE TEMP TABLE report_prof_disp_tab 
( 
age		INTEGER, 
diagn_id 	VARCHAR, 
dan_id 		BIGINT, 
sex 		VARCHAR(1) 
); 
 
INSERT INTO report_prof_disp_tab ( age, diagn_id, dan_id, sex ) 
( 
SELECT  get_vozrast(d.date_born), 
disp.diagn_id, 
d.dan_id, 
d.sex 
FROM dispensary_registration_tab disp 
left JOIN dan_tab d ON d.dan_id = disp.dan_id 
WHERE 
 entry_date &lt; date(':param1_2_:') 
 AND (leave_date IS NULL OR leave_date &gt;date(':param1_2_:')) 
); 
 
CREATE INDEX "report_prof_tab_age_idx" ON "report_prof_tab" 
  USING btree ("age"); 
 
CREATE INDEX "report_prof_tab_diag_osn_idx" ON "report_prof_tab" 
  USING btree ("diag_osn"); 
 
CREATE INDEX "report_prof_disp_tab_age_idx" ON "report_prof_disp_tab" 
  USING btree ("age"); 
 
CREATE INDEX "report_prof_disp_tab_diag_osn_idx" ON "report_prof_disp_tab" 
  USING btree ("diagn_id");</Sql>
            </Query>
            <Query>
              <Sql>z1(v1,v2,diag1,diag2,param2) select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2 
and diag_osn between 'diag1' and 'diag2' 
param2</Sql>
            </Query>
            <Query>
              <Sql>z10_heals_group_phys(v1,v2,s1,param2) select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2 
and s1 
param2</Sql>
            </Query>
            <Query>
              <Sql>z11_heals_group(v1,v2,s1,param2) select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2 
and s1 
param2</Sql>
            </Query>
            <Query>
              <Sql>z2(v1,v2,diag1,diag2,param2) select count(distinct dan_id) 
from report_prof_disp_tab 
where age between v1 and v2 
and diagn_id between 'diag1' and 'diag2' 
param2</Sql>
            </Query>
            <Query>
              <Sql>z3(v1,v2,param2) select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2 
param2</Sql>
            </Query>
            <Query>
              <Sql>z4_invalid(v1,v2,i1) select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2 
and invalid = 'i1' 
and (invalid_first_date &lt;':param1_1_:')</Sql>
            </Query>
            <Query>
              <Sql>z5_invalid(v1,v2,i1,i2) select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2 
and invalid in ('i1','i2') 
and (invalid_first_date between ':param1_1_:' and ':param1_2_:'     
or invalid_inspection_date between ':param1_1_:' and ':param1_2_:' )</Sql>
            </Query>
            <Query>
              <Sql>z6_invalid%(v1,v2,i1) select((select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2 
and invalid = 'i1' 
and (invalid_first_date &lt;':param1_1_:'))*100)/case when(select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2)=0 then 1  else (select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2) end</Sql>
            </Query>
            <Query>
              <Sql>z7_invalid%(v1,v2,i1,i2) select ((select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2 
and invalid in ('i1','i2') 
and (invalid_first_date between ':param1_1_:' and ':param1_2_:'     
or invalid_inspection_date between ':param1_1_:' and ':param1_2_:' ))*100)/case when(select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2)=0 then 1  else (select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2) end</Sql>
            </Query>
            <Query>
              <Sql>z8_vacc(v1,v2,vc1,vc2) select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2 
and vaccination in ('vc1','vc2')</Sql>
            </Query>
            <Query>
              <Sql>z9_phys(v1,v2,p1,param2,p2) select count(distinct dan_id) 
from report_prof_tab 
where age between v1 and v2 
and phys = 'p1' 
and p2 
param2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Тип ДД" Type="select">
              <Sql>select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Уровень качества лечения">
      <Reports>
        <Report Id="2008012901" Name="Уровень качества лечения (N608/186 от 24.12.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Уровень качества лечения\Уровень качества лечения (N608_186 от 24.12.2007).xls">
          <Queries>
            <Query>
              <Sql>query_for_table1(dolg_doctor_id_param) SELECT core_query.*, round((100.0 * core_query.ukl_count / zero_to_null(core_query.ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level1_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level1_od), 1) AS od, 
  round(AVG(ukl_tab.level1_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level1_osp), 1) AS osp, 
  round(AVG(ukl_tab.level1_okvs)::numeric, 2) AS okvs, 
  round(0.0025 * AVG(ukl_tab.level1_okvs * (ukl_tab.level1_ondm + ukl_tab.level1_onlm) + ukl_tab.level1_od + ukl_tab.level1_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = ukl_tab.level1_doctor_id 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
  AND (ukl_tab.level1_doctor_id &gt; 0) 
  AND (ukl_tab.level1_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
            <Query>
              <Sql>query_for_table1_1(dolg_doctor_id_param) SELECT COUNT(DISTINCT blist_tab.blist_id) AS blist_count 
FROM blist_tab 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor =  blist_tab.doctor_id 
WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
 AND (blist_tab.data_begin BETWEEN date(':period1_1_:') AND date(':period1_2_:'))</Sql>
            </Query>
            <Query>
              <Sql>query_for_table1_2(dolg_doctor_id_param) SELECT COUNT(DISTINCT ukl_tab.talon_id) AS ukl_blist_count 
FROM blist_tab 
LEFT JOIN talon_tab ON talon_tab.dan_id = blist_tab.dan_id 
JOIN visit_tab ON visit_tab.talon_id = talon_tab.talon_id AND visit_tab.data_pos between blist_tab.data_begin AND blist_tab.data_end 
LEFT JOIN ukl_tab ON ukl_tab.talon_id = talon_tab.talon_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = ukl_tab.level1_doctor_id 
WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
 AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:'))</Sql>
            </Query>
            <Query>
              <Sql>query_for_table2(dolg_doctor_id_param) SELECT core_query.*, round((100.0 * core_query.ukl_count / zero_to_null(core_query.ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level2_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level2_od), 1) AS od, 
  round(AVG(ukl_tab.level2_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level2_osp), 1) AS osp, 
  round(AVG(ukl_tab.level2_okvs)::numeric, 2) AS okvs, 
  round(0.0025 * AVG(ukl_tab.level2_okvs * (ukl_tab.level2_ondm + ukl_tab.level2_onlm) + ukl_tab.level2_od + ukl_tab.level2_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = ukl_tab.level1_doctor_id 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
  AND (ukl_tab.level2_doctor_id &gt; 0) 
  AND (ukl_tab.level2_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
            <Query>
              <Sql>query_for_table3(dolg_doctor_id_param) SELECT core_query.*, round((100.0 * core_query.ukl_count / zero_to_null(core_query.ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level3_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level3_od), 1) AS od, 
  round(AVG(ukl_tab.level3_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level3_osp), 1) AS osp, 
  round(AVG(ukl_tab.level3_okvs)::numeric, 2) AS okvs, 
  round(0.0025 * AVG(ukl_tab.level3_okvs * (ukl_tab.level3_ondm + ukl_tab.level3_onlm) + ukl_tab.level3_od + ukl_tab.level3_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = ukl_tab.level1_doctor_id 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
  AND (ukl_tab.level3_doctor_id &gt; 0) 
  AND (ukl_tab.level3_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
            <Query>
              <Sql>speciality_list SELECT dolg_doctor_tab.dolg_doctor, spec_doctor_tab.dolg_doctor_id 
FROM spec_doctor_tab 
LEFT JOIN dolg_doctor_tab ON dolg_doctor_tab.dolg_doctor_id = spec_doctor_tab.dolg_doctor_id 
GROUP BY dolg_doctor_tab.dolg_doctor, spec_doctor_tab.dolg_doctor_id 
HAVING SUM(spec_doctor_tab.stavka) &gt; 0 
ORDER BY dolg_doctor_tab.dolg_doctor</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008012902" Name="Уровень качества лечения по отделениям (N608/186 от 24.12.2007)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Уровень качества лечения\Уровень качества лечения по отделениям (N608_186 от 24.12.2007).xls">
          <Queries>
            <Query>
              <Sql>department_name SELECT nam_otdel 
FROM otdel_tab 
WHERE (otdel = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>doctor_list SELECT spec_doctor_tab.kod_doctor, 
 CASE WHEN dan_tab.mid IS NULL THEN 
  ((dan_tab.fam::text || ' '::text) || substr(dan_tab.nam::text, 1, 1)) || '.'::text 
 ELSE 
  ((((dan_tab.fam::text || ' '::text) || substr(dan_tab.nam::text, 1, 1)) || '.'::text) || substr(dan_tab.mid::text, 1, 1)) || '.'::text 
 END || ' (' || substr(dolg_doctor_tab.dolg_doctor, 1, 3) || '.)' AS doctor_name 
FROM spec_doctor_tab 
LEFT JOIN doctor_tab ON doctor_tab.doctor_id = spec_doctor_tab.doctor_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = doctor_tab.dan_id 
LEFT JOIN dolg_doctor_tab ON dolg_doctor_tab.dolg_doctor_id = spec_doctor_tab.dolg_doctor_id 
WHERE (spec_doctor_tab.otdel = ':param2_1_:') 
GROUP BY spec_doctor_tab.kod_doctor, doctor_name 
HAVING SUM(spec_doctor_tab.stavka) &gt; 0 
ORDER BY spec_doctor_tab.kod_doctor</Sql>
            </Query>
            <Query>
              <Sql>query_for_table1(doctor_id_param) SELECT core_query.*, round((100.0 * ukl_count / zero_to_null(ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level1_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level1_od), 1) AS od, 
  round(AVG(ukl_tab.level1_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level1_osp), 1) AS osp, 
  round(AVG(ukl_tab.level1_okvs)::numeric, 2) AS okvs, 
  round(0.0025 * AVG(ukl_tab.level1_okvs * (ukl_tab.level1_ondm + ukl_tab.level1_onlm) + ukl_tab.level1_od + ukl_tab.level1_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE (visit_tab.doctor_id IN (doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE (ukl_tab.level1_doctor_id IN (doctor_id_param)) 
  AND (ukl_tab.level1_doctor_id &gt; 0) 
  AND (ukl_tab.level1_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
            <Query>
              <Sql>query_for_table1_1(doctor_id_param) SELECT COUNT(DISTINCT blist_tab.blist_id) AS blist_count 
FROM blist_tab 
WHERE (blist_tab.doctor_id IN (doctor_id_param)) 
 AND (blist_tab.data_begin BETWEEN date(':period1_1_:') AND date(':period1_2_:'))</Sql>
            </Query>
            <Query>
              <Sql>query_for_table1_2(doctor_id_param) SELECT COUNT(DISTINCT ukl_tab.talon_id) AS ukl_blist_count 
FROM blist_tab 
LEFT JOIN talon_tab ON talon_tab.dan_id = blist_tab.dan_id 
JOIN visit_tab ON visit_tab.talon_id = talon_tab.talon_id AND visit_tab.data_pos between blist_tab.data_begin AND blist_tab.data_end 
LEFT JOIN ukl_tab ON ukl_tab.talon_id = talon_tab.talon_id 
WHERE (ukl_tab.level1_doctor_id IN (doctor_id_param)) 
 AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:'))</Sql>
            </Query>
            <Query>
              <Sql>query_for_table2(doctor_id_param) SELECT core_query.*, round((100.0 * ukl_count / zero_to_null(ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level2_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level2_od), 1) AS od, 
  round(AVG(ukl_tab.level2_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level2_osp), 1) AS osp, 
  round(AVG(ukl_tab.level2_okvs)::numeric, 2) AS okvs, 
  round(0.0025 * AVG(ukl_tab.level2_okvs * (ukl_tab.level2_ondm + ukl_tab.level2_onlm) + ukl_tab.level2_od + ukl_tab.level2_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE (visit_tab.doctor_id IN (doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE (ukl_tab.level1_doctor_id IN (doctor_id_param)) 
  AND (ukl_tab.level2_doctor_id &gt; 0) 
  AND (ukl_tab.level2_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
            <Query>
              <Sql>query_for_table3(doctor_id_param) SELECT core_query.*, round((100.0 * ukl_count / zero_to_null(ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level3_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level3_od), 1) AS od, 
  round(AVG(ukl_tab.level3_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level3_osp), 1) AS osp, 
  round(AVG(ukl_tab.level3_okvs)::numeric, 2) AS okvs, 
  round(0.0025 * AVG(ukl_tab.level3_okvs * (ukl_tab.level3_ondm + ukl_tab.level3_onlm) + ukl_tab.level3_od + ukl_tab.level3_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE (visit_tab.doctor_id IN (doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE (ukl_tab.level1_doctor_id IN (doctor_id_param)) 
  AND (ukl_tab.level3_doctor_id &gt; 0) 
  AND (ukl_tab.level3_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Отделение" Type="select">
              <Sql>SELECT otdel, nam_otdel FROM otdel_tab ORDER BY nam_otdel</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008012903" Name="Уровень качества лечения (N176/79 от 15.05.2008)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Уровень качества лечения\Уровень качества лечения (N176_79 от 15.05.2008).xls">
          <Queries>
            <Query>
              <Sql>query_for_table1(dolg_doctor_id_param) SELECT core_query.*, round((100.0 * core_query.ukl_count / zero_to_null(core_query.ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level1_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level1_od), 1) AS od, 
  round(AVG(ukl_tab.level1_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level1_osp), 1) AS osp, 
  round(0.0025 * AVG(ukl_tab.level1_ondm + ukl_tab.level1_od + ukl_tab.level1_onlm + ukl_tab.level1_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = ukl_tab.level1_doctor_id 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
  AND (ukl_tab.level1_doctor_id &gt; 0) 
  AND (ukl_tab.level1_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
            <Query>
              <Sql>query_for_table1_1(dolg_doctor_id_param) SELECT COUNT(DISTINCT blist_tab.blist_id) AS blist_count 
FROM blist_tab 
LEFT JOIN blist_tab b1 ON blist_tab.nomer = b1.prev_blist_num 	 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = blist_tab.doctor_id 
WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
 AND (blist_tab.data_begin BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
AND blist_tab.fl_clos=1 and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>query_for_table1_2(dolg_doctor_id_param) SELECT COUNT(DISTINCT ukl_tab.talon_id) AS ukl_blist_count 
FROM blist_tab 
LEFT JOIN blist_tab b1 ON blist_tab.nomer = b1.prev_blist_num 	 
LEFT JOIN talon_tab ON talon_tab.dan_id = blist_tab.dan_id 
JOIN visit_tab ON visit_tab.talon_id = talon_tab.talon_id AND visit_tab.data_pos between blist_tab.data_begin AND blist_tab.data_end 
LEFT JOIN ukl_tab ON ukl_tab.talon_id = talon_tab.talon_id 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = ukl_tab.level1_doctor_id 
WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
 AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
AND blist_tab.fl_clos=1 and b1.prev_blist_num is null</Sql>
            </Query>
            <Query>
              <Sql>query_for_table2(dolg_doctor_id_param) SELECT core_query.*, round((100.0 * core_query.ukl_count / zero_to_null(core_query.ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level2_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level2_od), 1) AS od, 
  round(AVG(ukl_tab.level2_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level2_osp), 1) AS osp, 
  round(0.0025 * AVG(ukl_tab.level2_ondm + ukl_tab.level2_od + ukl_tab.level2_onlm + ukl_tab.level2_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = ukl_tab.level1_doctor_id 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
  AND (ukl_tab.level2_doctor_id &gt; 0) 
  AND (ukl_tab.level2_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
            <Query>
              <Sql>query_for_table3(dolg_doctor_id_param) SELECT core_query.*, round((100.0 * core_query.ukl_count / zero_to_null(core_query.ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level3_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level3_od), 1) AS od, 
  round(AVG(ukl_tab.level3_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level3_osp), 1) AS osp, 
  round(0.0025 * AVG(ukl_tab.level3_ondm + ukl_tab.level3_od + ukl_tab.level3_onlm + ukl_tab.level3_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = visit_tab.doctor_id 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = ukl_tab.level1_doctor_id 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE ((dolg_doctor_id_param &lt; 0) OR (spec_doctor_tab.dolg_doctor_id = dolg_doctor_id_param)) 
  AND (ukl_tab.level3_doctor_id &gt; 0) 
  AND (ukl_tab.level3_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
            <Query>
              <Sql>speciality_list SELECT dolg_doctor_tab.dolg_doctor, spec_doctor_tab.dolg_doctor_id 
FROM spec_doctor_tab 
LEFT JOIN dolg_doctor_tab ON dolg_doctor_tab.dolg_doctor_id = spec_doctor_tab.dolg_doctor_id 
GROUP BY dolg_doctor_tab.dolg_doctor, spec_doctor_tab.dolg_doctor_id 
HAVING SUM(spec_doctor_tab.stavka) &gt; 0 
ORDER BY dolg_doctor_tab.dolg_doctor</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008012904" Name="Уровень качества лечения по отделениям (N176/79 от 15.05.2008)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Уровень качества лечения\Уровень качества лечения по отделениям (N176_79 от 15.05.2008).xls">
          <Queries>
            <Query>
              <Sql>department_name SELECT nam_otdel 
FROM otdel_tab 
WHERE (otdel = :param2_1_:)</Sql>
            </Query>
            <Query>
              <Sql>doctor_list SELECT spec_doctor_tab.kod_doctor, 
 CASE WHEN dan_tab.mid IS NULL THEN 
  ((dan_tab.fam::text || ' '::text) || substr(dan_tab.nam::text, 1, 1)) || '.'::text 
 ELSE 
  ((((dan_tab.fam::text || ' '::text) || substr(dan_tab.nam::text, 1, 1)) || '.'::text) || substr(dan_tab.mid::text, 1, 1)) || '.'::text 
 END || ' (' || substr(dolg_doctor_tab.dolg_doctor, 1, 3) || '.)' AS doctor_name 
FROM spec_doctor_tab 
LEFT JOIN doctor_tab ON doctor_tab.doctor_id = spec_doctor_tab.doctor_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = doctor_tab.dan_id 
LEFT JOIN dolg_doctor_tab ON dolg_doctor_tab.dolg_doctor_id = spec_doctor_tab.dolg_doctor_id 
WHERE (spec_doctor_tab.otdel = ':param2_1_:') 
GROUP BY spec_doctor_tab.kod_doctor, doctor_name 
HAVING SUM(spec_doctor_tab.stavka) &gt; 0 
ORDER BY spec_doctor_tab.kod_doctor</Sql>
            </Query>
            <Query>
              <Sql>query_for_table1(doctor_id_param) SELECT core_query.*, round((100.0 * ukl_count / zero_to_null(ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level1_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level1_od), 1) AS od, 
  round(AVG(ukl_tab.level1_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level1_osp), 1) AS osp, 
  round(0.0025 * AVG(ukl_tab.level1_ondm + ukl_tab.level1_od + ukl_tab.level1_onlm + ukl_tab.level1_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE (visit_tab.doctor_id IN (doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE (ukl_tab.level1_doctor_id IN (doctor_id_param)) 
  AND (ukl_tab.level1_doctor_id &gt; 0) 
  AND (ukl_tab.level1_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
            <Query>
              <Sql>query_for_table1_1(doctor_id_param) SELECT COUNT(DISTINCT blist_tab.blist_id) AS blist_count 
FROM blist_tab 
WHERE (blist_tab.doctor_id IN (doctor_id_param)) 
 AND (blist_tab.data_begin BETWEEN date(':period1_1_:') AND date(':period1_2_:'))</Sql>
            </Query>
            <Query>
              <Sql>query_for_table1_2(doctor_id_param) SELECT COUNT(DISTINCT ukl_tab.talon_id) AS ukl_blist_count 
FROM blist_tab 
LEFT JOIN talon_tab ON talon_tab.dan_id = blist_tab.dan_id 
JOIN visit_tab ON visit_tab.talon_id = talon_tab.talon_id AND visit_tab.data_pos between blist_tab.data_begin AND blist_tab.data_end 
LEFT JOIN ukl_tab ON ukl_tab.talon_id = talon_tab.talon_id 
WHERE (ukl_tab.level1_doctor_id IN (doctor_id_param)) 
 AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:'))</Sql>
            </Query>
            <Query>
              <Sql>query_for_table2(doctor_id_param) SELECT core_query.*, round((100.0 * ukl_count / zero_to_null(ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level2_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level2_od), 1) AS od, 
  round(AVG(ukl_tab.level2_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level2_osp), 1) AS osp, 
  round(0.0025 * AVG(ukl_tab.level2_ondm + ukl_tab.level2_od + ukl_tab.level2_onlm + ukl_tab.level2_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE (visit_tab.doctor_id IN (doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE (ukl_tab.level1_doctor_id IN (doctor_id_param)) 
  AND (ukl_tab.level2_doctor_id &gt; 0) 
  AND (ukl_tab.level2_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
            <Query>
              <Sql>query_for_table3(doctor_id_param) SELECT core_query.*, round((100.0 * ukl_count / zero_to_null(ukl_talon_count)::int4), 1) AS ukl_percent 
FROM ( 
 SELECT round(AVG(ukl_tab.level3_ondm), 1) AS ondm, 
  round(AVG(ukl_tab.level3_od), 1) AS od, 
  round(AVG(ukl_tab.level3_onlm), 1) AS onlm, 
  round(AVG(ukl_tab.level3_osp), 1) AS osp, 
  round(0.0025 * AVG(ukl_tab.level3_ondm + ukl_tab.level3_od + ukl_tab.level3_onlm + ukl_tab.level3_osp)::numeric, 2) AS ukl_value, 
  COUNT(*) AS ukl_count, ( 
   SELECT COUNT(DISTINCT talon_tab.talon_id) 
   FROM visit_tab 
   LEFT JOIN talon_tab ON talon_tab.talon_id = visit_tab.talon_id 
   LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
   WHERE (visit_tab.doctor_id IN (doctor_id_param)) 
    AND (visit_tab.target_pos_id IN (1,2,3)) 
    AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
    AND (result_tab._end = 1) 
  ) AS ukl_talon_count 
 FROM ukl_tab 
 LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
 LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
 WHERE (ukl_tab.level1_doctor_id IN (doctor_id_param)) 
  AND (ukl_tab.level3_doctor_id &gt; 0) 
  AND (ukl_tab.level3_ondm &gt; 0) 
  AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
  AND (result_tab._end = 1) 
) AS core_query</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Отделение" Type="select">
              <Sql>SELECT otdel, nam_otdel FROM otdel_tab ORDER BY nam_otdel</Sql>
            </Parameter>
            <Parameter Name="period1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008012905" Name="Список талонов несоответствующих приказу N176/79 от 15.05.2008 (с КВС неравным единице)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Уровень качества лечения\Список талонов несоответствующих приказу N176_79 от 15.05.2008 (с КВС неравным единице).xls">
          <Queries>
            <Query>
              <Sql>query_for_table1 SELECT talon_tab.talon_id, 
 conv_to_null(dan_tab.fam) || ' ' || conv_to_null(dan_tab.nam) || ' ' || conv_to_null(dan_tab.mid) AS patient_name, 
 round(ukl_tab.level1_ondm, 1) AS ondm, 
 round(ukl_tab.level1_od, 1) AS od, 
 round(ukl_tab.level1_onlm, 1) AS onlm, 
 round(ukl_tab.level1_osp, 1) AS osp, 
 round((ukl_tab.level1_okvs)::numeric, 2) AS okvs, 
 round(0.0025 * (ukl_tab.level1_okvs * (ukl_tab.level1_ondm + ukl_tab.level1_onlm) + ukl_tab.level1_od + ukl_tab.level1_osp)::numeric, 2) AS ukl_value_old, 
 round(0.0025 * (ukl_tab.level1_ondm + ukl_tab.level1_od + ukl_tab.level1_onlm + ukl_tab.level1_osp)::numeric, 2) AS ukl_value_new 
FROM ukl_tab 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = ukl_tab.level1_doctor_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
WHERE (ukl_tab.level1_doctor_id &gt; 0) 
 AND (ukl_tab.level1_ondm &gt; 0) 
 AND (ukl_tab.level1_okvs != 1.0) 
 AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (result_tab._end = 1)</Sql>
            </Query>
            <Query>
              <Sql>query_for_table2 SELECT talon_tab.talon_id, 
 conv_to_null(dan_tab.fam) || ' ' || conv_to_null(dan_tab.nam) || ' ' || conv_to_null(dan_tab.mid) AS patient_name, 
 round(ukl_tab.level2_ondm, 1) AS ondm, 
 round(ukl_tab.level2_od, 1) AS od, 
 round(ukl_tab.level2_onlm, 1) AS onlm, 
 round(ukl_tab.level2_osp, 1) AS osp, 
 round((ukl_tab.level2_okvs)::numeric, 2) AS okvs, 
 round(0.0025 * (ukl_tab.level2_okvs * (ukl_tab.level2_ondm + ukl_tab.level2_onlm) + ukl_tab.level2_od + ukl_tab.level2_osp)::numeric, 2) AS ukl_value_old, 
 round(0.0025 * (ukl_tab.level2_ondm + ukl_tab.level2_od + ukl_tab.level2_onlm + ukl_tab.level2_osp)::numeric, 2) AS ukl_value_new 
FROM ukl_tab 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = ukl_tab.level1_doctor_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
WHERE (ukl_tab.level2_doctor_id &gt; 0) 
 AND (ukl_tab.level2_ondm &gt; 0) 
 AND (ukl_tab.level2_okvs != 1.0) 
 AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (result_tab._end = 1)</Sql>
            </Query>
            <Query>
              <Sql>query_for_table3 SELECT talon_tab.talon_id, 
 conv_to_null(dan_tab.fam) || ' ' || conv_to_null(dan_tab.nam) || ' ' || conv_to_null(dan_tab.mid) AS patient_name, 
 round(ukl_tab.level3_ondm, 1) AS ondm, 
 round(ukl_tab.level3_od, 1) AS od, 
 round(ukl_tab.level3_onlm, 1) AS onlm, 
 round(ukl_tab.level3_osp, 1) AS osp, 
 round((ukl_tab.level3_okvs)::numeric, 2) AS okvs, 
 round(0.0025 * (ukl_tab.level3_okvs * (ukl_tab.level3_ondm + ukl_tab.level3_onlm) + ukl_tab.level3_od + ukl_tab.level3_osp)::numeric, 2) AS ukl_value_old, 
 round(0.0025 * (ukl_tab.level3_ondm + ukl_tab.level3_od + ukl_tab.level3_onlm + ukl_tab.level3_osp)::numeric, 2) AS ukl_value_new 
FROM ukl_tab 
LEFT JOIN spec_doctor_tab ON spec_doctor_tab.kod_doctor = ukl_tab.level1_doctor_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = ukl_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = talon_tab.dan_id 
LEFT JOIN result_tab ON result_tab.result_id = talon_tab.result_id 
WHERE (ukl_tab.level3_doctor_id &gt; 0) 
 AND (ukl_tab.level3_ondm &gt; 0) 
 AND (ukl_tab.level3_okvs != 1.0) 
 AND (talon_tab.data_vnes_inf BETWEEN date(':period1_1_:') AND date(':period1_2_:')) 
 AND (result_tab._end = 1)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Стойкая потеря трудоспособности (инвалиды)">
      <Reports>
        <Report Id="2008020501" Name="Список пациентов, прошедших МСЭК (первичный выход на инвалидность)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Стойкая потеря трудоспособности (инвалиды)\Список пациентов, прошедших МСЭК (первичный выход на инвалидность).xls">
          <Queries>
            <Query>
              <Sql>patient_list SELECT '$id'::text, conv_to_null(dan_tab.fam||' ')||conv_to_null(dan_tab.nam||' ')||conv_to_null(dan_tab.mid) AS full_name, dan_tab.date_born, dan_tab.address, inval_client_tab.kod_mkb, CASE WHEN ((inval_client_tab.current IS NULL) OR (inval_client_tab.current &lt;= 0)) THEN '-'::text WHEN (inval_client_tab.current &gt; 3) THEN 'Д'::text ELSE inval_client_tab.current::text END AS current 
FROM inval_client_tab 
--LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = inval_client_tab.dan_id 
WHERE ((inval_client_tab.last_inval IS NULL) OR (inval_client_tab.last_inval &lt;= 0)) 
 AND (inval_client_tab.current &gt;= 0) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (inval_client_tab.date_change BETWEEN date(':period_1_:') AND date(':period_2_:')) 
ORDER BY dan_tab.fam, dan_tab.nam, dan_tab.mid</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008020502" Name="Список пациентов, прошедших МСЭК (переосвидетельствование)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Стойкая потеря трудоспособности (инвалиды)\Список пациентов, прошедших МСЭК (переосвидетельствование).xls">
          <Queries>
            <Query>
              <Sql>patient_list SELECT '$id'::text, conv_to_null(dan_tab.fam||' ')||conv_to_null(dan_tab.nam||' ')||conv_to_null(dan_tab.mid) AS full_name, dan_tab.date_born, dan_tab.address, inval_client_tab.kod_mkb, CASE WHEN ((inval_client_tab.last_inval IS NULL) OR (inval_client_tab.last_inval &lt;= 0)) THEN '-'::text WHEN (inval_client_tab.last_inval &gt; 3) THEN 'Д'::text ELSE inval_client_tab.last_inval::text END AS last_inval, CASE WHEN ((inval_client_tab.current IS NULL) OR (inval_client_tab.current &lt;= 0)) THEN '-'::text WHEN (inval_client_tab.current &gt; 3) THEN 'Д'::text ELSE inval_client_tab.current::text END AS current 
FROM inval_client_tab 
--LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = inval_client_tab.dan_id 
WHERE ((inval_client_tab.last_inval IS NOT NULL) AND (inval_client_tab.last_inval &gt; 0)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (inval_client_tab.date_change BETWEEN date(':period_1_:') AND date(':period_2_:')) 
ORDER BY dan_tab.fam, dan_tab.nam, dan_tab.mid</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008020503" Name="Итоги переосвидетельствования на МСЭК" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Стойкая потеря трудоспособности (инвалиды)\Итоги переосвидетельствования на МСЭК.xls">
          <Queries>
            <Query>
              <Sql>all_sicks(disablement_id) SELECT COUNT(*) 
FROM inval_client_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = inval_client_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
WHERE ((inval_client_tab.last_inval IS NOT NULL) AND (inval_client_tab.last_inval &gt; 0)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (inval_client_tab.date_change BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (inval_client_tab.current = disablement_id)</Sql>
            </Query>
            <Query>
              <Sql>range_sicks(mkb_begin,mkb_end,disablement_id) SELECT COUNT(*) 
FROM inval_client_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = inval_client_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
WHERE ((inval_client_tab.last_inval IS NOT NULL) AND (inval_client_tab.last_inval &gt; 0)) 
 AND (inval_client_tab.kod_mkb BETWEEN 'mkb_begin' and 'mkb_end') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (inval_client_tab.date_change BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (inval_client_tab.current = disablement_id)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008020504" Name="Список инвалидов" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Стойкая потеря трудоспособности (инвалиды)\Список инвалидов.xls">
          <Queries>
            <Query>
              <Sql>filter_description SELECT CASE WHEN (:isonlyteen_1_:) THEN 'только подростки'::text ELSE 'без ограничений по возрасту'::text END AS description</Sql>
            </Query>
            <Query>
              <Sql>patient_list SELECT distinct '$id'::text, conv_to_null(dan_tab.fam) || ' ' || conv_to_null(dan_tab.nam) || ' ' || conv_to_null(dan_tab.mid) AS full_name, dan_tab.date_born, dan_tab.address, inval_client_tab.current 
FROM ( 
 SELECT dan_id AS d, MAX(date_change) AS c , max(id) as c2 
 FROM inval_client_tab 
-- LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
 GROUP BY dan_id 
) AS foo 
LEFT JOIN dan_tab ON dan_tab.dan_id = foo.d 
LEFT JOIN inval_client_tab ON inval_client_tab.date_change = foo.c and inval_client_tab.id = foo.c2 
--LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
WHERE ((inval_client_tab.current IS NOT NULL) AND (inval_client_tab.current &gt; 0)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (dan_tab.prikreplen = 1) 
 AND ((NOT :isonlyteen_1_:) OR (DATE_PART('year', AGE(inval_client_tab.date_change, dan_tab.date_born)) BETWEEN 15 AND 17)) 
-- AND (talon_tab.dan_id = foo.d) 
ORDER BY 2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="isonlyteen" Caption="Только подростки" Type="select2">
              <Sql>false=нет| true=да|</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008020505" Name="Отчет по стойкой утрате трудоспособности (первичный выход на инвалидность)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Стойкая потеря трудоспособности (инвалиды)\Отчет по стойкой утрате трудоспособности (первичный выход на инвалидность).xls">
          <Queries>
            <Query>
              <Sql>all_sicks(disablement_id,worker) SELECT COUNT(*) 
FROM inval_client_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = inval_client_tab.dan_id 
--LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
WHERE ((inval_client_tab.last_inval IS NULL) OR (inval_client_tab.last_inval &lt;= 0)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (inval_client_tab.date_change BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (inval_client_tab.current = disablement_id) 
 AND (((worker) AND (((dan_tab.sex = 'ж') AND (DATE_PART('year', AGE(date(':period_2_:'), dan_tab.date_born)) BETWEEN 0 AND 55)) OR 
                     ((dan_tab.sex = 'м') AND (DATE_PART('year', AGE(date(':period_2_:'), dan_tab.date_born)) BETWEEN 0 AND 60)))) OR 
  ((NOT worker) AND (((dan_tab.sex = 'ж') AND (DATE_PART('year', AGE(date(':period_2_:'), dan_tab.date_born)) &gt;= 56)) OR 
                     ((dan_tab.sex = 'м') AND (DATE_PART('year', AGE(date(':period_2_:'), dan_tab.date_born)) &gt;= 61)))))</Sql>
            </Query>
            <Query>
              <Sql>range_sicks(mkb_begin,mkb_end,disablement_id,worker) SELECT COUNT(*) 
FROM inval_client_tab 
--LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
LEFT JOIN dan_tab ON dan_tab.dan_id = inval_client_tab.dan_id 
WHERE ((inval_client_tab.last_inval IS NULL) OR (inval_client_tab.last_inval &lt;= 0)) 
 AND (inval_client_tab.kod_mkb BETWEEN 'mkb_begin' and 'mkb_end') 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND (inval_client_tab.date_change BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND (inval_client_tab.current = disablement_id) 
 AND (((worker) AND (((dan_tab.sex = 'ж') AND (DATE_PART('year', AGE(date(':period_2_:'), dan_tab.date_born)) BETWEEN 0 AND 55)) OR 
                     ((dan_tab.sex = 'м') AND (DATE_PART('year', AGE(date(':period_2_:'), dan_tab.date_born)) BETWEEN 0 AND 60)))) OR 
  ((NOT worker) AND (((dan_tab.sex = 'ж') AND (DATE_PART('year', AGE(date(':period_2_:'), dan_tab.date_born)) &gt;= 56)) OR 
                     ((dan_tab.sex = 'м') AND (DATE_PART('year', AGE(date(':period_2_:'), dan_tab.date_born)) &gt;= 61)))))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008020506" Name="Динамика группы инвалидности" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Стойкая потеря трудоспособности (инвалиды)\Динамика группы инвалидности.xls">
          <Queries>
            <Query>
              <Sql>all_query SELECT COUNT(*) 
FROM inval_client_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = inval_client_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
WHERE (inval_client_tab.date_change BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND ((inval_client_tab.last_inval IS NOT NULL) AND (inval_client_tab.last_inval &gt; 0)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
and (not :param1_1_: OR (talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()) OR (inval_client_tab.talon_id is null and dan_tab.spolref::int8  in (select * from get_all_lpu_numbers()) )) )</Sql>
            </Query>
            <Query>
              <Sql>bad_query SELECT COUNT(*) 
FROM inval_client_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = inval_client_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
LEFT JOIN inval_tab AS current_inval_tab ON current_inval_tab.inval_id = inval_client_tab.current 
LEFT JOIN inval_tab AS previous_inval_tab ON previous_inval_tab.inval_id = inval_client_tab.last_inval 
WHERE (inval_client_tab.date_change BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND ((inval_client_tab.current IS NOT NULL) AND (inval_client_tab.current &gt; 0)) 
 AND ((inval_client_tab.last_inval IS NOT NULL) AND (inval_client_tab.last_inval &gt; 0)) 
 AND (current_inval_tab.compare_index &lt; previous_inval_tab.compare_index) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
and (not :param1_1_: OR (talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()) OR (inval_client_tab.talon_id is null and dan_tab.spolref::int8  in (select * from get_all_lpu_numbers()) )) )</Sql>
            </Query>
            <Query>
              <Sql>good_full_query SELECT COUNT(*) 
FROM inval_client_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = inval_client_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
WHERE (inval_client_tab.date_change BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND ((inval_client_tab.current IS NULL) OR (current &lt;= 0)) 
 AND ((inval_client_tab.last_inval IS NOT NULL) AND (inval_client_tab.last_inval &gt; 0)) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
and (not :param1_1_: OR (talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()) OR (inval_client_tab.talon_id is null and dan_tab.spolref::int8  in (select * from get_all_lpu_numbers()) )) )</Sql>
            </Query>
            <Query>
              <Sql>good_part_query SELECT COUNT(*) 
FROM inval_client_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = inval_client_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
LEFT JOIN inval_tab AS current_inval_tab ON current_inval_tab.inval_id = inval_client_tab.current 
LEFT JOIN inval_tab AS previous_inval_tab ON previous_inval_tab.inval_id = inval_client_tab.last_inval 
WHERE (inval_client_tab.date_change BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND ((inval_client_tab.current IS NOT NULL) AND (inval_client_tab.current &gt; 0)) 
 AND ((inval_client_tab.last_inval IS NOT NULL) AND (inval_client_tab.last_inval &gt; 0)) 
 AND (current_inval_tab.compare_index &gt; previous_inval_tab.compare_index) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
and (not :param1_1_: OR (talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()) OR (inval_client_tab.talon_id is null and dan_tab.spolref::int8  in (select * from get_all_lpu_numbers()) )) )</Sql>
            </Query>
            <Query>
              <Sql>stable_query SELECT COUNT(*) 
FROM inval_client_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = inval_client_tab.dan_id 
LEFT JOIN talon_tab ON talon_tab.talon_id = inval_client_tab.talon_id 
WHERE (inval_client_tab.date_change BETWEEN date(':period_1_:') AND date(':period_2_:')) 
 AND ((inval_client_tab.current IS NOT NULL) AND (inval_client_tab.current &gt; 0)) 
 AND ((inval_client_tab.last_inval IS NOT NULL) AND (inval_client_tab.last_inval &gt; 0)) 
 AND (inval_client_tab.current = inval_client_tab.last_inval) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
and (not :param1_1_: OR (talon_tab.pricpol::int8 in (select * from get_all_lpu_numbers()) OR (inval_client_tab.talon_id is null and dan_tab.spolref::int8  in (select * from get_all_lpu_numbers()) )) )</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Прикреплен" Type="select2">
              <Sql>true=да | false=нет</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всему ЛПУ' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008020507" Name="Отчет о выполнении ФЗ N181" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Стойкая потеря трудоспособности (инвалиды)\Отчет о выполнении ФЗ N181.xls">
          <Queries>
            <Query>
              <Sql>category_list(disablement_id) SELECT core_query.*, 
 round((100.0 * core_query.dispensary_state_count / zero_to_null(core_query.belong_count)::int4), 1) AS dispensary_state_percent, 
 round((100.0 * core_query.dispensary_visit_count / zero_to_null(core_query.belong_count)::int4), 1) AS dispensary_visit_percent 
FROM (SELECT ( 
  SELECT COUNT(DISTINCT d.dan_id) 
  FROM dan_tab d 
  WHERE ((disablement_id &lt; 0) OR (d.inval_id = disablement_id)) 
   AND (d.prikreplen = 1) 
 ) AS belong_count, ( 
  SELECT COUNT(DISTINCT du.dan_id) 
  FROM dispan_uchet_tab du 
  LEFT JOIN dan_tab d ON (d.dan_id = du.dan_id) 
  WHERE ((disablement_id &lt; 0) OR (d.inval_id = disablement_id)) 
   AND (d.prikreplen = 1) 
   AND ((du.date_sn IS NULL) OR (du.date_sn &lt; ':period_1_:')) 
 ) AS dispensary_state_count, ( 
  SELECT COUNT(DISTINCT t.dan_id) 
  FROM talon_tab t 
  LEFT JOIN dan_tab d ON (d.dan_id = t.dan_id) 
  LEFT JOIN visit_tab v ON (v.talon_id = t.talon_id) 
  WHERE ((disablement_id &lt; 0) OR (d.inval_id = disablement_id)) 
   AND (d.prikreplen = 1) 
   AND (v.target_pos_id = 3) 
 ) AS dispensary_visit_count, ( 
  SELECT COUNT(DISTINCT k.dan_id) 
  FROM kurort_tab k 
  LEFT JOIN dan_tab d ON (d.dan_id = k.dan_id) 
  WHERE ((disablement_id &lt; 0) OR (d.inval_id = disablement_id)) 
   AND (d.prikreplen = 1) 
 ) AS provide_resort_cure 
) AS core_query</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата" Type="date">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Диспансерный учет">
      <Reports>
        <Report Id="2008030501" Name="Дата следующей явки на Д-осмотр" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансерный учет\Дата следующей явки на Д-осмотр.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid), 
 d.date_born as param_1_1_, d.address as param_1_2_, d.telephon as param_1_3_, dis.date_next as param_1_4_ 
  from dispan_uchet_tab dis 
 left join dan_tab d on d.dan_id=dis.dan_id 
 where dis.date_next between date(':period_1_1_:') and date(':period_1_2_:') 
 :period_2_1_: :period_3_1_: AND (dis.date_sn IS NULL OR dis.date_sn &gt; date(':period_1_1_:'))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_3" Caption="Специалист" Type="select">
              <Sql>(select 'and dis.spec='||dolg_doctor_id, dolg_doctor from dolg_doctor_tab order by dolg_doctor) union (select ' and true', 'Все')</Sql>
            </Parameter>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>(select 'and d.uchactok_id='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008030502" Name="Список диспансерных больных по последней дате посещения" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансерный учет\Список диспансерных больных по последней дате посещения.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) as fio,  d.date_born as param_1_1_, d.address as param_1_2_, param_1_4_ , param_5_1_ 
 from  (SELECT dis.dan_id, dis.spec, MAX(v.data_pos) as param_1_4_, dis.diagn_id as param_5_1_  FROM dispan_uchet_tab dis 
LEFT JOIN talon_tab t ON t.dan_id= dis.dan_id 
LEFT JOIN visit_tab v On v.talon_id = t.talon_id AND v.target_pos_id = 3 
WHERE dis.date_sn is not null 
GROUP BY dis.dan_id, dis.spec , dis.diagn_id 
) as foo  
 left join dan_tab d on d.dan_id=foo.dan_id  where true :period_2_1_: :period_3_1_: 
 order by fio</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_3" Caption="Специалист" Type="select">
              <Sql>(select 'and foo.spec='||dolg_doctor_id, dolg_doctor from dolg_doctor_tab order by dolg_doctor) union (select ' and true', 'Все')</Sql>
            </Parameter>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>(select 'and d.uchactok_id='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008030503" Name="Движение заболеваний Д-учета (по дате последнего посещения)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансерный учет\Движение заболеваний Д-учета (по дате последнего посещения).xls">
          <Queries>
            <Query>
              <Sql>zapros_1 select * from (select 
(ARRAY['Всего', 'Некоторые инфекционные и паразитарные болезни', 
'Новообразования', 'Болезни крови, кроветворных органов и отдельные нарушения, вовлекающие имунный механизм', 
'Болезни эндокринной системы, расстройства питания и нарушения обмена веществ', 
'Психические расстройства и расстройства поведения', 'Болезни нервной системы', 
'Болезни глаза и его придаточного аппарата', 'Болезни уха и сосцевидного отростка', 
'Болезни системы кровообращения', 'Болезни органов дыхания', 'Болезни органов пищеварения', 
'Болезни кожи и подкожной клетчатки', 'Болезни костно-мышечной системы и соединительной ткани', 
'Болезни мочеполовой системы', 'Беременность, роды и послеродовый период', 
'Врожденные аномалии (пороки развития), деформации и хромосомные нарушения', 
'Симптомы, признаки и отклонения от нормы, выявленные при клинических и лабораторных исследованиях, неклассифицированные в других рубриках', 
'Травмы, отравления и некоторые другие последствия воздействия внешних причин'])[s.a], 
(ARRAY['A00-T98.9', 'A00-B99.9', 'C00-D48.9', 
'D50-D89', 'E00-E90', 'F00-F99', 'G00-G99', 'H00-H59', 'H60-H95', 'I00-I99', 'J00-J99', 
'K00-K93', 'L00-L99', 'M00-M99', 'N00-N99', 'O00-O99', 'Q00-Q99', 'R00-R99','S00-T98'])[s.a] as param_1_1_, 
(ARRAY['A00', 'A00', 'C00',  'D50', 'E00', 'F00', 
'G00', 'H00', 'H60', 'I00', 'J00', 'K00', 
'L00', 'M00', 'N00', 'O00', 'Q00', 'R00', 'S00'])[s.a] as param_1_2_, 
(ARRAY['T98.9', 'B99.9', 'D48.9',  'D89.9', 'E90.9', 'F99.9', 
'G99.9', 'H59.9', 'H95.9', 'I99.9', 'J99.9', 'K93.9', 
'L99.9', 'M99.9', 'N99.9', 'O99.9', 'Q99.9', 'R99.9', 'T98.9'])[s.a] as param_1_3_ from generate_series(1,19) as s(a)) as foo;</Sql>
            </Query>
            <Query>
              <Sql>zapros2 :param_1_1_:</Sql>
            </Query>
            <Query>
              <Sql>sostoit1(period) select count(d.dan_id), count(d.dan_id) as param_3_1_ 
from dispan_uchet_tab dis 
left join dan_tab d on d.dan_id= dis.dan_id 
where (dis.date&lt;=date ('period')) and 
((dis.date_sn is NULL) or ((dis.date_sn is not NULL) and (dis.date_sn&gt;date ('period')))) 
and dis.diagn_id between ':param_1_2_:' and ':param_1_3_:' :period_2_1_: :period_3_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros3 sostoit1(:period_1_1_:)</Sql>
            </Query>
            <Query>
              <Sql>zapros4 select count(*), count(*) as param_2_2_, case when :param_3_1_:&gt;0 then round((count(*)*100/:param_3_1_:),2) else 0 end as param_2_1_ 
 from  (select dis.dan_id, dis.diagn_id, dis.spec, MAX(v.data_pos) as param_1_4_   from dispan_uchet_tab dis  
 left join diagn_tab dia on dis.dan_id=dia.dan_id and dis.diagn_id=dia.diagn_osn  
 left join visit_tab v on v.talon_id=dia.talon_id 
left JOIN dan_tab d ON d.dan_id = dis.dan_id 
 where diagn_id between ':param_1_2_:' and ':param_1_3_:' and 
 v.data_pos between date(':period_1_1_:') and date(':period_1_2_:') :period_2_1_: :period_3_1_: 
 group by dis.dan_id, dis.diagn_id, dis.spec) as foo</Sql>
            </Query>
            <Query>
              <Sql>zapros5 :param_2_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros6 select count(d.dan_id), count(d.dan_id) as param_6_1_ from dispan_uchet_tab dis 
left join dan_tab d on d.dan_id=dis.dan_id 
where (dis.date between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:')) 
and dis.diagn_id between ':param_1_2_:' and ':param_1_3_:' :period_2_1_: :period_3_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros7 select count(d.dan_id), count(d.dan_id) as param_7_1_ from dispan_uchet_tab dis 
left join dan_tab d on d.dan_id=dis.dan_id 
where (dis.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:')) 
and dis.diagn_id between ':param_1_2_:' and ':param_1_3_:' :period_2_1_: :period_3_1_:</Sql>
            </Query>
            <Query>
              <Sql>snat1(prichina) select count(d.dan_id) from dispan_uchet_tab dis 
left join dan_tab d on d.dan_id=dis.dan_id 
where (dis.date_sn between date(':period_1_1_:')+interval '1 day' and date(':period_1_2_:')) 
and dis.prichin_sn_id in (prichina) 
and dis.diagn_id between ':param_1_2_:' and ':param_1_3_:' :period_2_1_: :period_3_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros8 snat1(1)</Sql>
            </Query>
            <Query>
              <Sql>zapros9 snat1("4,2")</Sql>
            </Query>
            <Query>
              <Sql>zapros10 snat1(3)</Sql>
            </Query>
            <Query>
              <Sql>zapros11 snat1(5)</Sql>
            </Query>
            <Query>
              <Sql>zapros12 select :param_2_2_:+:param_6_1_:-:param_7_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros13 sostoit1(:period_1_2_:)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="period_2" Caption="Участок" Type="select">
              <Sql>(select 'and d.uchactok_id='||uchactok_id, uchactok from uchactok_tab order by uchactok_id) union (select ' and true', 'Все') </Sql>
            </Parameter>
            <Parameter Name="period_3" Caption="Специалист" Type="select">
              <Sql>(select 'and  dis.spec='||dolg_doctor_id, dolg_doctor from dolg_doctor_tab order by dolg_doctor) union (select ' and true', 'Все')</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008030504" Name="Список больных по полу и возрасту" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансерный учет\Список больных по полу и возрасту.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT '$id', d.fam, d.nam, d.mid, d.date_born, d.address, 
i.nam_inval, 
conv_to_null(join_str(l.lgota))||conv_to_null(' '||join_str(f.floga)) as lgota, 
d.pens, 
join_str(trim(disp.diagn_id)) as mkb1, join_str(trim(m.mkb)) as mkb2 
 FROm dispan_uchet_tab disp 
LEFT JOIN dan_tab d ON d.dan_id = disp.dan_id 
LEFT JOIN lgot_client_tab l ON l.dan_id = d.dan_id 
LEFT JOIN fed_lgota_tab f ON f.dan_id = d.dan_id 
LEFT JOIN inval_tab i ON i.inval_id = d.inval_id 
LEFT JOIN mkb_tab m ON m.kod_d = disp.diagn_id 
WHERE (disp.date_sn is null OR disp.date_sn &gt; ':period1_2_:') 
AND get_vozrast(d.date_born) &gt;= :param1_1_: AND get_vozrast(d.date_born) &lt;= :param2_1_:  
AND d.sex = ':param3_1_:' AND :param5_1_: 
GROUP BY d.fam, d.nam, d.mid, d.date_born, d.address,i.nam_inval,d.pens 
ORDER BY 1,2,3,4</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Возраст с" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="period1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="по" Type="text">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Пол" Type="select">
              <Sql>SELECT 'м'::text, 'Мужской'::text, 1 UNION SELECT 'ж'::text, 'Женский'::text, 2 ORDER BY 3</Sql>
            </Parameter>
            <Parameter Name="param6" Caption="Специалист" Type="select">
              <Sql>(select 'and  disp.spec='||dolg_doctor_id, dolg_doctor from dolg_doctor_tab order by dolg_doctor) union (select ' and true', 'Все')</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Участок" Type="select">
              <Sql>SELECT ' true '::text,'Все'::text, 0 UNION SELECT ' d.uchactok_id = '||u.uchactok_id::text::int4, u.uchactok, 1 FROm uchactok_tab u ORDER BY 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008030505" Name="Лица, имеющие льготу, но не состоящие на диспансерном учете" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансерный учет\Лица, имеющие льготу, но не состоящие на диспансерном учете.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT '$id',split_part(l.lgota,',',t.a) as lgota1, * FROM lgot_client_tab l 
LEFT JOIN generate_series(1,20) as t(a) ON trim(split_part(l.lgota,',',t.a)) != ''  
LEFT JOIN dispan_uchet_tab disp ON disp.dan_id = l.dan_id AND disp.lgota_id = split_part(l.lgota,',',t.a)  
AND (disp.date_sn is null OR disp.date_sn &gt; now()) 
LEFT JOIN dan_tab d ON d.dan_id = l.dan_id 
WHERE disp.dispan_uchet_id is null AND (split_part(l.lgota,',',t.a) =  ':param1_1_: ' 
OR ':param1_1_:' = '0') 
ORDER BY fam,nam,mid,date_born, split_part(l.lgota,',',t.a)</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Льгота" Type="select">
              <Sql>SELECT ' 0 '::text,'Все'::text,0  UNION  SELECT lgota_id ,trim(lgota_id)||' '||nam_lgota , 1 FROM lgota_tab  WHERE length(trim(lgota_id)) &lt; 3  ORDEr BY 3,2  </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2008030506" Name="Список диспансерных больных на определенную дату" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансерный учет\Список диспансерных больных на определенную дату.xls">
          <Queries>
            <Query>
              <Sql>ask_district SELECT CASE WHEN (uchactok IS NULL) THEN 'по всем участкам'::text ELSE uchactok END AS uchactok 
FROM uchactok_tab 
WHERE (uchactok_id = :district_1_:) 
GROUP BY uchactok</Sql>
            </Query>
            <Query>
              <Sql>ask_doctor SELECT CASE WHEN (full_fio IS NULL) THEN 'по всем врачам'::text ELSE full_fio END AS full_fio 
FROM full_doctor_tab 
WHERE (full_doctor_id = :doctor_1_:) 
GROUP BY full_fio</Sql>
            </Query>
            <Query>
              <Sql>ask_speciality SELECT CASE WHEN (dolg_doctor IS NULL) THEN 'по всем специальностям'::text ELSE dolg_doctor END AS dolg_doctor 
FROM full_doctor_tab 
WHERE (dolg_doctor_id = :speciality_1_:) 
GROUP BY dolg_doctor</Sql>
            </Query>
            <Query>
              <Sql>dispensary_list SELECT dispan_uchet_tab.diagn_id AS diagnosis, dan_tab.fam || ' ' || dan_tab.nam || ' ' || dan_tab.mid AS fio, dan_tab.date_born, dispan_uchet_tab.date AS date_in, dispan_uchet_tab.date_sn AS date_out, sp_dispan_state_tab.sp_dispan_state_name_short AS dispensary, dispan_uchet_tab.dan_id as disp_dan_id 
FROM dispan_uchet_tab 
LEFT JOIN dan_tab ON dan_tab.dan_id = dispan_uchet_tab.dan_id 
LEFT JOIN sp_dispan_state_tab ON sp_dispan_state_tab.sp_dispan_state_id = dispan_uchet_tab.sp_dispan_state_id 
WHERE (dispan_uchet_tab.date &lt;= ':period_1_:') 
 AND ((dispan_uchet_tab.date_sn IS NULL) OR (dispan_uchet_tab.date_sn &gt; ':period_1_:')) 
 AND ((:district_1_: &lt; 0) OR (dan_tab.uchactok_id = :district_1_:)) 
 AND ((:doctor_1_: &lt; 0) OR (dispan_uchet_tab.doctor_id = :doctor_1_:)) 
 AND ((:speciality_1_: &lt; 0) OR (dispan_uchet_tab.spec = :speciality_1_:)) 
ORDER BY diagnosis, fio</Sql>
            </Query>
            <Query>
              <Sql>kv1 select case when count(distinct v.visit_id)&gt;0 then  count(distinct v.visit_id)::text else '' end 
from visit_tab v 
left join talon_tab t on t.talon_id=v.talon_id 
--left join diagn_tab diag on diag.dan_id=t.dan_id 
where v.target_pos_id=3 
and t.dan_id=:disp_dan_id: 
and ':diagnosis:'=t.diag_osn -- diag.diagn_osn 
and v.data_pos between date_trunc('year',':period_1_:'::date) and date_trunc('year',':period_1_:'::date) + '3 months'::interval - '1 day'::INTERVAL</Sql>
            </Query>
            <Query>
              <Sql>kv2 select case when count(distinct v.visit_id)&gt;0 then  count(distinct v.visit_id)::text else '' end  
from visit_tab v 
left join talon_tab t on t.talon_id=v.talon_id 
left join diagn_tab diag on diag.dan_id=t.dan_id 
where v.target_pos_id=3 
and t.dan_id=:disp_dan_id: 
and ':diagnosis:'=diag.diagn_osn 
and v.data_pos between date_trunc('year',':period_1_:'::date) + '3 months'::interval and  
date_trunc('year',':period_1_:'::date) + '6 months'::interval - '1 day'::INTERVAL</Sql>
            </Query>
            <Query>
              <Sql>kv3 select case when count(distinct v.visit_id)&gt;0 then  count(distinct v.visit_id)::text else '' end  
from visit_tab v 
left join talon_tab t on t.talon_id=v.talon_id 
left join diagn_tab diag on diag.dan_id=t.dan_id 
where v.target_pos_id=3 
and t.dan_id=:disp_dan_id: 
and ':diagnosis:'=diag.diagn_osn 
and v.data_pos between date_trunc('year',':period_1_:'::date) + '6 months'::interval and  
date_trunc('year',':period_1_:'::date) + '9 months'::interval - '1 day'::INTERVAL</Sql>
            </Query>
            <Query>
              <Sql>kv4 select case when count(distinct v.visit_id)&gt;0 then  count(distinct v.visit_id)::text else '' end  
from visit_tab v 
left join talon_tab t on t.talon_id=v.talon_id 
left join diagn_tab diag on diag.dan_id=t.dan_id 
where v.target_pos_id=3 
and t.dan_id=:disp_dan_id: 
and ':diagnosis:'=diag.diagn_osn 
and v.data_pos between date_trunc('year',':period_1_:'::date) + '9 months'::interval and 
date_trunc('year',':period_1_:'::date) + '12 months'::interval - '1 day'::INTERVAL</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="doctor" Caption="Врач" Type="select">
              <Sql>SELECT -1 AS full_doctor_id, 'по всем врачам' AS full_fio UNION SELECT full_doctor_id, full_fio FROM full_doctor_tab WHERE (doctor_id &gt;= 0) ORDER BY full_doctor_id</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Дата" Type="date">
              <Sql />
            </Parameter>
            <Parameter Name="speciality" Caption="Специальность" Type="select">
              <Sql>SELECT -1 AS dolg_doctor_id, 'по всем специальностям' AS dolg_doctor UNION SELECT dolg_doctor_id, dolg_doctor FROM full_doctor_tab WHERE (dolg_doctor_id &gt;= 0) ORDER BY dolg_doctor_id</Sql>
            </Parameter>
            <Parameter Name="district" Caption="Участок" Type="select">
              <Sql>SELECT -1 AS uchactok_id, 'по всем участкам' AS uchactok UNION SELECT uchactok_id, uchactok FROM uchactok_tab WHERE (uchactok_id &gt;= 0) ORDER BY uchactok_id</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2021903000" Name="Кол-во визитов диспансерных больных" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансерный учет\Кол-во визитов диспансерных больных.xls">
          <Queries>
            <Query>
              <Sql>zapros0 select * from (select 
(ARRAY['Всего', 'Некоторые инфекционные и паразитарные болезни', 
'Новообразования', 'Болезни крови, кроветворных органов и отдельные нарушения, вовлекающие имунный механизм', 
'Болезни эндокринной системы, расстройства питания и нарушения обмена веществ', 
'Психические расстройства и расстройства поведения', 'Болезни нервной системы', 
'Болезни глаза и его придаточного аппарата', 'Болезни уха и сосцевидного отростка', 
'Болезни системы кровообращения', 'Болезни органов дыхания', 'Болезни органов пищеварения', 
'Болезни кожи и подкожной клетчатки', 'Болезни костно-мышечной системы и соединительной ткани', 
'Болезни мочеполовой системы', 'Беременность, роды и послеродовый период', 
'Врожденные аномалии (пороки развития), деформации и хромосомные нарушения', 
'Симптомы, признаки и отклонения от нормы, выявленные при клинических и лабораторных исследованиях, неклассифицированные в других рубриках', 
'Травмы, отравления и некоторые другие последствия воздействия внешних причин'])[s.a], 
(ARRAY['A00-T98.9', 'A00-B99.9', 'C00-D48.9', 
'D50-D89', 'E00-E90', 'F00-F99', 'G00-G99', 'H00-H59', 'H60-H95', 'I00-I99', 'J00-J99', 
'K00-K93', 'L00-L99', 'M00-M99', 'N00-N99', 'O00-O99', 'Q00-Q99', 'R00-R99','S00-T98'])[s.a] as param_1_1_, 
(ARRAY['A00', 'A00', 'C00',  'D50', 'E00', 'F00', 
'G00', 'H00', 'H60', 'I00', 'J00', 'K00', 
'L00', 'M00', 'N00', 'O00', 'Q00', 'R00', 'S00'])[s.a] as param_1_2_, 
(ARRAY['T98.9', 'B99.9', 'D48.9',  'D89.9', 'E90.9', 'F99.9', 
'G99.9', 'H59.9', 'H95.9', 'I99.9', 'J99.9', 'K93.9', 
'L99.9', 'M99.9', 'N99.9', 'O99.9', 'Q99.9', 'R99.9', 'T98.9'])[s.a] as param_1_3_ from generate_series(1,19) as s(a)) as foo;</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select count(distinct v.visit_id)   
from visit_tab v 
left join diagn_tab diag on diag.talon_id=v.talon_id 
left join dan_tab d on d.dan_id=diag.dan_id 
where diag.diagn_osn between ':param_1_2_:' and ':param_1_3_:' and 
 v.data_pos between date(':period_1_1_:') and date(':period_1_2_:') 
and v.target_pos_id=3 
and :prik_1_:</Sql>
            </Query>
            <Query>
              <Sql>zapros2 select count(distinct v.visit_id)   
from visit_tab v 
left join diagn_tab diag on diag.talon_id=v.talon_id 
left join dan_tab d on d.dan_id=diag.dan_id 
left join dispan_uchet_tab disp on disp.dan_id=diag.dan_id 
where diag.diagn_osn between ':param_1_2_:' and ':param_1_3_:' and 
 v.data_pos between date(':period_1_1_:') and date(':period_1_2_:') 
and v.target_pos_id=3 
and :prik_1_: 
and (disp.date &lt;= ':period_1_1_:') 
 AND ((disp.date_sn IS NULL) OR (disp.date_sn &gt; ':period_1_1_:'))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period_1" Caption="Дата посещения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="prik" Caption="Прикреплен" Type="select">
              <Sql>select 'true','Все',0 union select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',1 order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Диспансеризация">
      <Reports />
      <Folders>
        <Folder Name="Диспансеризация 2014">
          <Reports>
            <Report Id="2015703001" Name="Количество детей по врачам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Количество детей по врачам.xls">
              <Queries>
                <Query>
                  <Sql>z1 select f.full_fio, 
/*count(distinct dd.id||'_'||case when c.dd_stage=2 then null else 1 end) as p1 */ 
 count(distinct d.fam||'_'||d.nam||'_'||d.mid||'_'||d.date_born) as p1 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
JOIN okaz_uslug_tab ok ON ok.table_link_name = 'dop_disp_main_tab' 
		AND ok.table_link_id = dd.id AND c.dd_stage = ok.bur_dd_magic_number 
 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
where (case when ':select_by_1_:'='enddate' then ok.sluch_date_end 
         when ':select_by_1_:'='infdate' then dd.date_vnes_inf  
         when ':select_by_1_:'='acceptdate' then ok.accept_date end 
         BETWEEN ':param1_1_:' AND ':param1_2_:')  
 
					 AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL 
 
and ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
and d.num_pol is not null and d.policy_type is not null 
and case when coalesce(ok.paid, false)=false then coalesce(dd.errors_common,'')='' else true end 
and coalesce(d.date_smerti, '01.01.3000'::date) &gt; ok.sluch_date_end and coalesce(d.life,0) in (0, 2) 
 
and :prik_1_: and :stage_1_: and :uch_1_: and :otdel_param_1_:  AND dd.maked_proc&gt;=85 
 
group by 1 
order by 1</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="otdel_param" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel='''||otdel||'''',nam_otdel,1 from otdel_tab  order by 3,2</Sql>
                </Parameter>
                <Parameter Name="opl" Caption="По оплате" Type="select2">
                  <Sql>(true, false)=Все||(true)=Оплаченные||(false)=Не оплаченные</Sql>
                </Parameter>
                <Parameter Name="prik" Caption="Прикреплен" Type="select">
                  <Sql>select 'true','Все',1 union select 'd.strcom_region_id = get_our_region_code()','Да',2 union select 'd.strcom_region_id &lt;&gt; get_our_region_code()','Нет',3 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="select_by" Caption="Считать по" Type="select2">
                  <Sql>enddate=Дате окончания||acceptdate=Дате оплаты||infdate=Дате внесения</Sql>
                </Parameter>
                <Parameter Name="stage" Caption="Тип диспансеризации" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="uch" Caption="Участок" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab  order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2027503000" Name="Список нарушений по заполнению дисп. карт" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Список нарушений по заполнению дисп. карт.xls">
              <Queries>
                <Query>
                  <Sql>z1 SELECT dd.id, max(ma.measure_date) as max_date, 
CASE WHEN 
	CASE WHEN me2.id IS NOT NULL THEN me2.measure_date 
	     ELSE me1.measure_date END &lt; max(ma.measure_date) 
THEN 1 
ELSE 0 END AS errstr, 
CASE WHEN me2.id IS NOT NULL THEN me2.measure_date ELSE me1.measure_date END AS last_date , 
d.fio as fio, 
d.date_born 
FROM dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
LEFT JOIN dop_disp_measures_tab ma ON ma.dop_disp_main_id = dd.id 
LEFT JOIN dop_disp_measures_tab me1 ON me1.dop_disp_main_id = dd.id 
		AND me1.dop_disp_measure_id = 1900000 
LEFT JOIN dop_disp_measures_tab me2 ON me2.dop_disp_main_id = dd.id 
		AND me2.dop_disp_measure_id = 2600000 
where :param3_1_: between ':param1_1_:' and ':param1_2_:' 
and :param2_1_: 
group by 1,me2.id,me2.measure_date,me1.measure_date,fio,d.date_born 
having CASE WHEN 
	CASE WHEN me2.id IS NOT NULL THEN me2.measure_date 
	     ELSE me1.measure_date END &lt; max(ma.measure_date) 
THEN TRUE 
ELSE false END 
and :param4_1_:</Sql>
                </Query>
                <Query>
                  <Sql>z2 SELECT sub.id, d.fio, d.date_born, CASE WHEN result_stage_1 IS NOT NULL THEN ''  
ELSE 'Не указан результат первого этапа. ' END || 
CASE WHEN num_measures_2 &lt;&gt; 0 AND result_stage_2 IS NULL THEN 'Не указан результат второго этапа. '  
ELSE '' END || 
CASE WHEN num_measures = filled_measures THEN '' ELSE 'Не указана дата меропр. ' END|| 
CASE WHEN missing_duchet_group = 1 THEN 'Не указана группа д-учёта. ' ELSE '' END|| 
case when missing_health_group=1 then 'Не указана группа здоровья. ' else '' end || 
--case when didnt_sent_to_disp=1 then 'Не поставлен на диспансерный учёт. ' else '' end || 
case when missing_diagn=1 then 'Не указан диагноз. ' else '' end|| 
case when err_measure&gt;=1 then 'Неверно указана дата оказания услуги. ' else '' end|| 
case when refuse_measure&gt;=1 then 'Укажите причину неполноты данных. ' else '' end|| 
case when recomend=1 then 'Неверно указаны рекомендации по результатам. ' else '' end|| 
case when nepoln_dan=1 then 'Неполный осмотр менее 85%. ' else '' end|| 
case when err_polis=1 then 'Ошибка в данных полиса. ' else '' end|| 
case when err_date=1 then 'Неверная дата окончания диспансеризации. ' else '' end|| 
case when addr_err=1 then 'Неверно заполнен адрес по паспорту. ' else '' end|| 
case when err_results=1 then 'Неверно указаны результаты/рекомендации. ' else '' end|| 
CASE WHEN err_age = 1 THEN 'Не подлежит ДД в этом году. ' ELSE '' END|| 
case when (select count(*) from dop_disp_measures2(sub.date_begin, sub.dan_id, sub.dop_disp_type_id) 
left join dop_disp_measures_tab ddm on ddm.dop_disp_measure_id=measure_id and ddm.dop_disp_main_id=sub.id and ddm.measure_date is not null 
where ddm.id is null) &lt;&gt; 0 and sub.dop_disp_type_id &lt;&gt; 5 then 'Проведены не все мероприятия предусмотренные порядком диспансеризации. ' else '' end|| 
CASE WHEN right_category is true or get_our_region_code()='0300000000000' THEN '' ELSE 'Категория пациента не подходит под данную диспансеризацию. ' END|| 
--case when reestr_date_invalid = 1 then 'Дата реестра меньше даты посещения терапевта. ' else '' end|| 
coalesce(E'\r\n'||E'Последние ошибки проверки из страховой компании:\r\n'||sub.error_str, '') as errstr, 
f.full_fio, 
sub.vrach as vrach, u.name AS uch  
FROM 
(SELECT dd.id, dd.date_begin, dd.dan_id, dd.dop_disp_type_id, dd.result_stage_1, dd.result_stage_2, dd.error_str, 
CASE WHEN dd.date_reestr_first_stage &lt; m1.measure_date or dd.date_reestr_second_stage &lt; m2.measure_date then 1 else 0 end as reestr_date_invalid, 
CASE WHEN dd.dop_disp_type_id in (3, 4) then to_number(k.reestr_code, '999') in (1, 2, 4, 8, 25) WHEN dd.dop_disp_type_id in (5) then to_number(k.reestr_code, '999') in (27) ELSE to_number(k.reestr_code, '999') in (22, 23, 24) END as right_category, 
CASE WHEN dd.sent_to_disp AND dd.disp_group_id IS NULL THEN 1 ELSE 0 END AS missing_duchet_group, 
case when coalesce(dd.sp_health_group_id, 0) = 0 /*and dd.dop_disp_type_id in (3, 4)*/ then 1 else 0 end as missing_health_group, 
case when dd.sp_health_group_id is not null and dd.sp_health_group_id &gt; 2 and dd.sent_to_disp = false then 1 else 0 end as didnt_sent_to_disp, 
case when ds.id is null then 1 else 0 end as missing_diagn, 
case when dd.result_id not in (0,1,2,3,4,5,7,8) then 1 else 0 end as recomend , 
case when dd.maked_proc&lt;85 then 1 else 0 end as nepoln_dan, 
case when (length(dn.num_pol)=16 and dn.policy_type not in (3,4,5)) then 1 else 0 end as err_polis , 
case when dd.date_end&lt;dd.date_begin then 1 else 0 end as err_date, 
case when substr(a.kladr_id, 9, 1000)::bigint = 0 then 1 else 0 end as addr_err, 
case when ((dd.result_id = 7 AND dd.result_stage_1 IN (317,318,319)) OR (dd.result_stage_2 IS NOT NULL AND dd.result_stage_1 IN (317,318,319) AND dd.result_stage_1 != dd.result_stage_2)) THEN 1 ELSE 0 END AS err_results, 
case when f1.full_fio is not null then f1.full_fio else f.full_fio end as vrach, 
CASE WHEN dd.gr_obsl_id IS NULL AND dn.kat NOT IN (8,25) THEN 1 ELSE 0 END AS err_age,  
SUM(CASE WHEN cm.dd_stage=2 THEN 1 ELSE 0 END) as num_measures_2, 
count(m.id) AS num_measures, sum( 
CASE WHEN m.measure_date IS NOT NULL THEN 1 ELSE 0 END) AS filled_measures,  
sum(case when (m.refusal_flag=true and cm.dd_stage=1 and dd.incompletion_reason_id is null) then 1 else 0 end) as refuse_measure, 
sum(case when ( 
((get_vozrast(dd.date_begin,m.measure_date)&gt;=1 or get_vozrast(m.measure_date,dd.date_begin)&gt;=1) AND m.dop_disp_measure_id NOT IN (2100000,1500000)) 
OR ((get_vozrast(dd.date_begin,m.measure_date)&gt;=1 or get_vozrast(m.measure_date,dd.date_begin)&gt;=2) AND m.dop_disp_measure_id IN (2100000,1500000)) 
OR m.measure_date&gt;dd.date_end ) 
then 1 else 0 end) as err_measure 
FROM dop_disp_main_tab dd 
left join dan_tab dn on dn.dan_id=dd.dan_id 
left join codifiers.kateg_tab k on k.id=dn.kat 
left join address_tab a on a.dan_id=dn.dan_id and sp_addr_type_id=1 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab cm ON m.dop_disp_measure_id = cm.id 
LEFT JOIN dop_disp_measures_tab m1 ON m1.dop_disp_main_id = dd.id and m1.dop_disp_measure_id=1900000 
LEFT JOIN dop_disp_measures_tab m2 ON m2.dop_disp_main_id = dd.id and m2.dop_disp_measure_id=2600000 
LEFT JOIN visit_tab v on v.visit_id=m1.table_id and m1.table_name='visit_tab' 
LEFT JOIN visit_tab v1 on v1.visit_id=m2.table_id and m2.table_name='visit_tab' 
left join full_doctor_tab f on f.full_doctor_id=v.doctor_id 
left join full_doctor_tab f1 on f1.full_doctor_id=v1.doctor_id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id AND ds.sp_disease_vid_id = 200001 
left JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id AND c.dd_stage = 1 
where  :param3_1_: between ':param1_1_:' and ':param1_2_:' 
and :param2_1_: 
and :param4_1_: 
 GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21 ) AS sub 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN codifiers.uchactok_tab u ON u.id = d.uchactok_id 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = u.doctor_id 
WHERE (sub.result_stage_1 IS NULL OR num_measures &lt;&gt; filled_measures 
OR sub.missing_duchet_group = 1 or missing_health_group=1 
or missing_diagn=1 or err_measure&gt;=1 or refuse_measure&gt;=1 
or recomend=1  or nepoln_dan=1 or err_polis=1 or err_date=1 
or addr_err =1  or err_results = 1 or err_age = 1 /*OR policy_type_err = 1*/) 
ORDER BY 2</Sql>
                </Query>
                <Query>
                  <Sql>z3 SELECT dd.id, 
d.fio as fio, 
d.date_born 
FROM dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
where  :param3_1_: between ':param1_1_:' and ':param1_2_:' 
and :param2_1_: 
and false --d.kat not in (1,2,4,8,25) 
and :param4_1_:</Sql>
                </Query>
                <Query>
                  <Sql>z4 SELECT dd.id, 
d.fio as fio, 
d.date_born 
FROM dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
where  :param3_1_: between ':param1_1_:' and ':param1_2_:' 
and :param2_1_: 
and dd.result_stage_2 is not null 
and dd.result_stage_1!=316 
and :param4_1_:</Sql>
                </Query>
                <Query>
                  <Sql>z5 SELECT dd.id, 
d.fio as fio, 
d.date_born, 
dd.error_str as errstr 
FROM dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
where  :param3_1_: between ':param1_1_:' and ':param1_2_:' 
and dd.error_str is not null 
and :param2_1_: 
and :param4_1_:</Sql>
                </Query>
                <Query>
                  <Sql>z6 SELECT '$id'::text,d.fam, d.nam, d.mid, d.date_born, 
get_vozrast(d.date_born)||' г. '||date_part('month',age(now(),d.date_born))||' мес.' as vozr, 
u.name as uch, 
d.address, dd.date_begin, 
trim(both E'\r\n' from join_str(E'\r\n'||c.short_name))  as spisok 
FROM dop_disp_main_tab dd 
JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id AND m.measure_date IS NULL 
JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
left join dan_tab d on d.dan_id=dd.dan_id 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id 
WHERE  :param3_1_: BETWEEN ':param1_1_:' AND ':param1_2_:' 
and :param4_1_: 
GROUP BY 2,3,4,5,6,7,8,9 
order by 1,2,3</Sql>
                </Query>
                <Query>
                  <Sql>z7 SELECT dd.id, 
d.fio as fio, 
d.date_born, 
get_vozrast(d.date_born)||' г. '||date_part('month',age(now(),d.date_born))||' мес.' as vozr, 
u.name as uch 
FROM dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id 
where  :param3_1_: between ':param1_1_:' and ':param1_2_:' 
and dd.date_end is null 
and :param2_1_: 
and :param4_1_:</Sql>
                </Query>
                <Query>
                  <Sql>z8 SELECT dd.id, 
d.fio as fio, 
d.date_born, 
dd.errors_common as errstr 
FROM dop_disp_main_tab dd 
LEFT JOIN dop_disp_measures_tab m1 ON m1.dop_disp_main_id = dd.id AND m1.dop_disp_measure_id=1900000 
left join dan_tab d on d.dan_id=dd.dan_id 
where :param3_1_: between ':param1_1_:' and ':param1_2_:' 
and dd.errors_common is not null and dd.errors_common &lt;&gt; '' 
and :param2_1_: 
and :param4_1_:</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param4" Caption="Доктор" Type="select">
                  <Sql>select 'true','Все','',0 union select 'dd.doctor_id='||full_doctor_id, full_fio,fio,1 FROM full_doctor_tab order by 4, 3   </Sql>
                </Parameter>
                <Parameter Name="param3" Caption="Считать по " Type="select2">
                  <Sql>dd.date_end=Дате окончания диспансеризации||dd.date_begin=Дате начала диспансеризации||dd.date_reestr_first_stage=Дате реестра первого этапа||dd.date_reestr_second_stage=Дате реестра второго этапа</Sql>
                </Parameter>
                <Parameter Name="param2" Caption="Участок" Type="select">
                  <Sql>select 'true','Все',0 union  select 'uchactok_id='||id,name,1 from codifiers.uchactok_tab  order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2027703000" Name="Реестр счетов (уведомление)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Реестр счетов (уведомление).xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select distinct '$id'::text, 
d.fio as p1, 
d.ser_pol as p2, 
d.num_pol as p3, 
dd.conv_price as p4 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
left join codifiers.uchactok_tab uch on uch.id=d.uchactok_id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
WHERE 
((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL AND  :param2_1_:  AND dd.maked_proc&gt;=85 
ORDER BY 2;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2027903000" Name="Пациенты, подлежащие ДОГВН (по полу и соц.статусу)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Пациенты, подлежащие ДОГВН (по полу и соц.статусу).xls">
              <Queries>
                <Query>
                  <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
                </Query>
                <Query>
                  <Sql>smo_name select ':param2_2_:'</Sql>
                </Query>
                <Query>
                  <Sql>z1 select distinct '$id'::text, 
d.fio as p1, 
d.sex as p2, 
d.date_born as p3, 
d.mest_born as p4, 
coalesce(d.serdoc ,'')||' '||coalesce(d.numdoc,'') as p5, 
d.fakt_adr as p6, 
d.address as p7, 
d.pens as p8, 
coalesce(d.ser_pol,'')||' '||coalesce(d.num_pol,'') as p9, 
1 as p10, 
diag.mkb_code as p11, 
dd.conv_price as p12, 
dd.result_stage_1 as p13, 
'$id'::text as p14, 
m1.measure_date as p15, 
mp1.spec_code as p16, 
m2.measure_date as p17, 
mp2.spec_code as p18, 
m3.measure_date as p19, 
mp3.spec_code as p20, 
m4.measure_date as p21, 
mp4.spec_code as p22, 
m5.measure_date as p23, 
mp5.spec_code as p24, 
m6.measure_date as p25, 
mp6.spec_code as p26, 
m7.measure_date as p27, 
mp7.spec_code as p28, 
m8.measure_date as p29, 
mp8.spec_code as p30, 
m9.measure_date as p31, 
mp9.spec_code as p32, 
m10.measure_date as p33, 
mp10.spec_code as p34, 
m11.measure_date as p35, 
mp11.spec_code as p36, 
m12.measure_date as p37, 
mp12.spec_code as p38, 
m13.measure_date as p39, 
mp13.spec_code as p40, 
m14.measure_date as p41, 
mp14.spec_code as p42, 
m15.measure_date as p43, 
mp15.spec_code as p44, 
m16.measure_date as p45, 
mp16.spec_code as p46, 
m17.measure_date as p47, 
mp17.spec_code as p48, 
m18.measure_date as p49, 
mp18.spec_code as p50, 
m19.measure_date as p51, 
mp19.spec_code as p52, 
m20.measure_date as p53, 
mp20.spec_code as p54, 
m21.measure_date as p55, 
mp21.spec_code as p56 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
left join dop_disp_diagns_tab diag on diag.dop_disp_main_id = dd.id and diag.sp_disease_vid_id=200001 
left join codifiers.uchactok_tab uch on uch.id=d.uchactok_id 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
LEFT JOIN dop_disp_measures_tab m1 ON m1.dop_disp_main_id = dd.id 
and m1.dop_disp_measure_id=100000 
LEFT JOIN dop_disp_measures_tab m2 ON m2.dop_disp_main_id = dd.id 
and m2.dop_disp_measure_id=200000 
LEFT JOIN dop_disp_measures_tab m3 ON m3.dop_disp_main_id = dd.id 
and m3.dop_disp_measure_id=300000 
LEFT JOIN dop_disp_measures_tab m4 ON m4.dop_disp_main_id = dd.id 
and m4.dop_disp_measure_id=400000 
LEFT JOIN dop_disp_measures_tab m5 ON m5.dop_disp_main_id = dd.id 
and m5.dop_disp_measure_id=500000 
LEFT JOIN dop_disp_measures_tab m6 ON m6.dop_disp_main_id = dd.id 
and m6.dop_disp_measure_id=600000 
LEFT JOIN dop_disp_measures_tab m7 ON m7.dop_disp_main_id = dd.id 
and m7.dop_disp_measure_id=700000 
LEFT JOIN dop_disp_measures_tab m8 ON m8.dop_disp_main_id = dd.id 
and m8.dop_disp_measure_id=800000 
LEFT JOIN dop_disp_measures_tab m9 ON m9.dop_disp_main_id = dd.id 
and m9.dop_disp_measure_id=900000 
LEFT JOIN dop_disp_measures_tab m10 ON m10.dop_disp_main_id = dd.id 
and m10.dop_disp_measure_id=1000000 
LEFT JOIN dop_disp_measures_tab m11 ON m11.dop_disp_main_id = dd.id 
and m11.dop_disp_measure_id=1100000 
LEFT JOIN dop_disp_measures_tab m12 ON m12.dop_disp_main_id = dd.id 
and m12.dop_disp_measure_id=1200000 
LEFT JOIN dop_disp_measures_tab m13 ON m13.dop_disp_main_id = dd.id 
and m13.dop_disp_measure_id=1300000 
LEFT JOIN dop_disp_measures_tab m14 ON m14.dop_disp_main_id = dd.id 
and m14.dop_disp_measure_id=1400000 
LEFT JOIN dop_disp_measures_tab m15 ON m15.dop_disp_main_id = dd.id 
and m15.dop_disp_measure_id=1500000 
LEFT JOIN dop_disp_measures_tab m16 ON m16.dop_disp_main_id = dd.id 
and m16.dop_disp_measure_id=1600000 
LEFT JOIN dop_disp_measures_tab m17 ON m17.dop_disp_main_id = dd.id 
and m17.dop_disp_measure_id=1700000 
LEFT JOIN dop_disp_measures_tab m18 ON m18.dop_disp_main_id = dd.id 
and m18.dop_disp_measure_id=1800000 
LEFT JOIN dop_disp_measures_tab m19 ON m19.dop_disp_main_id = dd.id 
and m19.dop_disp_measure_id=1900000 
LEFT JOIN dop_disp_measures_tab m20 ON m20.dop_disp_main_id = dd.id 
and m20.dop_disp_measure_id=2000000 
LEFT JOIN dop_disp_measures_tab m21 ON m21.dop_disp_main_id = dd.id 
and m21.dop_disp_measure_id=2100000 
left join dop_disp_measure_profiles_tab mp1 on mp1.dop_disp_measure_id=100000 and m1.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp2 on mp2.dop_disp_measure_id=200000  and m2.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp3 on mp3.dop_disp_measure_id=300000  and m3.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp4 on mp4.dop_disp_measure_id=400000  and m4.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp5 on mp5.dop_disp_measure_id=500000  and m5.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp6 on mp6.dop_disp_measure_id=600000  and m6.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp7 on mp7.dop_disp_measure_id=700000  and m7.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp8 on mp8.dop_disp_measure_id=800000  and m8.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp9 on mp9.dop_disp_measure_id=900000  and m9.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp10 on mp10.dop_disp_measure_id=0100000  and m10.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp11 on mp11.dop_disp_measure_id=1100000  and m11.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp12 on mp12.dop_disp_measure_id=1200000  and m12.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp13 on mp13.dop_disp_measure_id=1300000  and m13.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp14 on mp14.dop_disp_measure_id=1400000  and m14.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp15 on mp15.dop_disp_measure_id=1500000  and m15.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp16 on mp16.dop_disp_measure_id=1600000  and m16.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp17 on mp17.dop_disp_measure_id=1700000  and m17.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp18 on mp18.dop_disp_measure_id=1800000  and m18.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp19 on mp19.dop_disp_measure_id=1900000  and m19.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp20 on mp20.dop_disp_measure_id=2000000  and m20.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp21 on mp21.dop_disp_measure_id=2100000  and m21.dop_disp_measure_id is not null 
WHERE ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL) OR 
(c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL)) 
AND u.auto_flag = 0 
AND dd.date_end BETWEEN ':param1_1_:' AND ':param1_2_:' 
AND :param2_1_: and :param3_1_: and :param4_1_:  AND dd.maked_proc&gt;=85 
ORDER BY 2;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param4" Caption="Врач" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.doctor_id='||full_doctor_id, full_fio,1 from full_doctor_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Дата окончания диспансеризации" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param2" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2028103000" Name="Список пациентов с оказанными услугами (Диспансеризация)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Список пациентов с оказанными услугами (Диспансеризация).xls">
              <Queries>
                <Query>
                  <Sql>z1 select '$id'::text,d.fio as p1, 
d.date_born as p2, 
dd.date_begin as p3, 
dd.date_end as p4, 
m.measure_date as p5, 
m1.name as p6 
from dop_disp_main_tab dd 
left join dan_tab d on d.dan_id = dd.dan_id 
left join dop_disp_measures_tab m on m.dop_disp_main_id=dd.id 
left join codifiers.dop_disp_measures_tab m1 on m1.id=m.dop_disp_measure_id 
where :param4_1_: between ':param1_1_:' and ':param1_2_:' 
order by 2,m1.name</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param4" Caption="Считать по " Type="select2">
                  <Sql>dd.date_end=Дате окончания диспансеризации||dd.date_begin=Дате начала диспансеризации||dd.date_reestr_first_stage=Дате реестра первого этапа||dd.date_reestr_second_stage=Дате реестра второго этапа</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2028303000" Name="Объем диспансеризации первый этап" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Объем диспансеризации первый этап.xls">
              <Queries>
                <Query>
                  <Sql>z1 select '$id'::text , d.fio as p1,d.date_born as p2, 
  get_vozrast(d.date_born) as p3, 
  d.address as p4, d.sex as p34, 
  f.floga as p5, e_mail as p6, u.name as p8, 
COALESCE(d.telephon,'')||' '||COALESCE(d.phone_mobile,'')||' '||COALESCE(d.work_phone,'') as p7 
  from dan_tab d 
  left join fed_lgota_tab f on f.dan_id=d.dan_id 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id 
left join full_doctor_tab f1 on f1.full_doctor_id=u.doctor_id 
  where d.spolref::int4 in (select * from get_all_lpu_numbers()) 
and :pol_1_: 
and :param3_1_: and :vrach_1_: and :otdel_param_1_: 
  and (((date_part('year',now()::date) - date_part('year',d.date_born::date)) in ( 
  select f.a from generate_series(18,100,3) f(a)) ) 
 
) 
  and :param2_1_: 
and (((date_part('year',now()::date) - date_part('year',d.date_born::date)) between  :param1_1_: and :param1_2_:  ) 
or (get_vozrast(d.date_born) between   :param1_1_: and :param1_2_:   ) 
) 
  order by 2,4</Sql>
                </Query>
                <Query>
                  <Sql>z2 select count(distinct d.dan_id) 
from dan_tab  d 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id 
left join full_doctor_tab f1 on f1.full_doctor_id=u.doctor_id 
where d.spolref::int4 in (select * from get_all_lpu_numbers()) 
and :pol_1_: 
and :param3_1_: and :vrach_1_: and :otdel_param_1_: 
and (((date_part('year',now()::date) - date_part('year',d.date_born::date)) in ( 
  select f.a from generate_series(18,100,3) f(a)) ) 
 
) 
and :param2_1_: 
and (((date_part('year',now()::date) - date_part('year',d.date_born::date)) between  :param1_1_: and :param1_2_:  ) 
or (get_vozrast(d.date_born) between   :param1_1_: and :param1_2_:   ) 
)</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Возраст" Type="int_period">
                  <Sql />
                </Parameter>
                <Parameter Name="vrach" Caption="Врач" Type="select">
                  <Sql>select 'true','Все',0 union select 'u.doctor_id='||full_doctor_id, full_fio,1 from full_doctor_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="otdel_param" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f1.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param3" Caption="Пациент" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.mesto_work_id is not null','Работающий',1 union select 'd.mesto_work_id is null','Неработающий',2 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="pol" Caption="Пол" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.sex='||'''м''','М',1 union select 'd.sex='||'''ж''','Ж',2 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param2" Caption="Участок" Type="select">
                  <Sql>select 'true','Все',0 union  select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab  order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2028703000" Name="Количество карт по врачам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Количество карт по врачам.xls">
              <Queries>
                <Query>
                  <Sql>z1 select f.full_fio, 
count(distinct dd.id||'_'||case when c.dd_stage=2 then null else 1 end) as p1, 
count(distinct dd.id||'_'||case when c.dd_stage=1 then null else 2 end) as p2 
 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
/*LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
JOIN okaz_uslug_tab ok ON ok.table_link_name = 'dop_disp_main_tab' 
		AND ok.table_link_id = dd.id AND case when c.dd_stage = 1 then ok.bur_dd_magic_number = 1 else (ok.bur_dd_magic_number =2 or ok.bur_dd_magic_number=m.id) end */ 
 
JOIN okaz_uslug_tab ok ON ok.table_link_name = 'dop_disp_main_tab' 
		AND ok.table_link_id = dd.id AND c.dd_stage = ok.bur_dd_magic_number 
 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
where /*((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) */ 
	/* bur_sluch_date_end_for_ok(ok.id)*/ 
(case when ':select_by_1_:'='enddate' then ok.sluch_date_end 
         when ':select_by_1_:'='infdate' then dd.date_vnes_inf  
         when ':select_by_1_:'='acceptdate' then ok.accept_date end 
         BETWEEN ':param1_1_:' AND ':param1_2_:')  
 
 
 
					 AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL 
 
and ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
and d.num_pol is not null and d.policy_type is not null 
/*and case when coalesce(ok.paid, false)=false then coalesce(dd.errors_common,'')='' else true end 
and coalesce(d.date_smerti, '01.01.3000'::date) &gt; ok.sluch_date_end and coalesce(d.life,0) in (0, 2) */ 
 
and :prik_1_: and :stage_1_: and :uch_1_: and :otdel_param_1_:  AND dd.maked_proc&gt;=85 
 
group by 1 
order by 1 
 
 
/*select f.full_fio, 
count(distinct dd.id||'_'||case when ok.bur_dd_magic_number&gt;=2 then null else 1 end||'_'||'_d') as p1, 
count(distinct dd.id||'_'||case when ok.bur_dd_magic_number&gt;=2 then 2 else null end||'_'||'_d') as p2 
 
from okaz_uslug_tab ok 
join dan_tab d ON d.dan_id = ok.dan_id 
left join full_doctor_view f on f.full_doctor_id=ok.doctor_id 
join dop_disp_main_tab dd on dd.id=ok.table_link_id and ok.table_link_name='dop_disp_main_tab' 
where (case when ':select_by_1_:'='enddate' then bur_sluch_date_end_for_ok(ok.id) else ok.accept_date end BETWEEN ':param1_1_:' AND ':param1_2_:') 
and ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
and d.num_pol is not null and d.policy_type is not null 
and :prik_1_:  and :stage_1_: and :uch_1_: and :otdel_param_1_: 
and coalesce(ok.paid, false) in :opl_1_: 
and case when coalesce(ok.paid, false)=false then coalesce(dd.errors_common,'')='' else true end 
and coalesce(d.date_smerti, '01.01.3000'::date) &gt; bur_sluch_date_end_for_ok(ok.id) and d.life in (0, 2) 
 
 
group by 1 */ 
 
 
/*select f.full_fio, count(distinct dd.id) as p1 
FROM dop_disp_main_tab dd 
LEFT JOIN okaz_uslug_tab ok ON ok.table_link_name='dop_disp_main_tab' and ok.table_link_id=dd.id 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
where ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL 
and :prik_1_: and :stage_1_: and :uch_1_: and :otdel_param_1_:  AND dd.maked_proc&gt;=85 
and coalesce(ok.paid, false) in :opl_1_: 
group by 1 
order by 1*/</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="otdel_param" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel='''||otdel||'''',nam_otdel,1 from otdel_tab  order by 3,2</Sql>
                </Parameter>
                <Parameter Name="opl" Caption="По оплате" Type="select2">
                  <Sql>(true, false)=Все||(true)=Оплаченные||(false)=Не оплаченные</Sql>
                </Parameter>
                <Parameter Name="prik" Caption="Прикреплен" Type="select">
                  <Sql>select 'true','Все',1 union select 'd.strcom_region_id = get_our_region_code()','Да',2 union select 'd.strcom_region_id &lt;&gt; get_our_region_code()','Нет',3 order by 3,2 </Sql>
                </Parameter>
                <Parameter Name="select_by" Caption="Считать по" Type="select2">
                  <Sql>enddate=Дате окончания||acceptdate=Дате оплаты||infdate=Дате внесения</Sql>
                </Parameter>
                <Parameter Name="stage" Caption="Тип диспансеризации" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="uch" Caption="Участок" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab  order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2028903000" Name="Реестр счетов (бумажный 2-ой этап)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Реестр счетов (бумажный 2-ой этап).xls">
              <Queries>
                <Query>
                  <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
                </Query>
                <Query>
                  <Sql>smo_name select ':param2_2_:'</Sql>
                </Query>
                <Query>
                  <Sql>z1 select distinct '$id'::text, 
d.fio as p1, 
d.sex as p2, 
d.date_born as p3, 
d.mest_born as p4, 
coalesce(d.serdoc ,'')||' '||coalesce(d.numdoc,'') as p5, 
d.fakt_adr as p6, 
d.address as p7, 
d.pens as p8, 
coalesce(d.ser_pol,'')||' '||coalesce(d.num_pol,'') as p9, 
1 as p10, 
diag.mkb_code as p11, 
dd.conv_price as p12, 
dd.result_stage_1 as p13, 
'$id'::text as p14, 
m1.measure_date as p15, 
mp1.spec_code as p16, 
m2.measure_date as p17, 
mp2.spec_code as p18, 
m3.measure_date as p19, 
mp3.spec_code as p20, 
m4.measure_date as p21, 
mp4.spec_code as p22, 
m5.measure_date as p23, 
mp5.spec_code as p24, 
m6.measure_date as p25, 
mp6.spec_code as p26, 
m7.measure_date as p27, 
mp7.spec_code as p28, 
m8.measure_date as p29, 
mp8.spec_code as p30, 
m9.measure_date as p31, 
mp9.spec_code as p32, 
m10.measure_date as p33, 
mp10.spec_code as p34, 
m11.measure_date as p35, 
mp11.spec_code as p36, 
m12.measure_date as p37, 
mp12.spec_code as p38, 
m13.measure_date as p39, 
mp13.spec_code as p40 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
left join dop_disp_diagns_tab diag on diag.dop_disp_main_id = dd.id /*and diag.sp_disease_vid_id=200001 */ 
left join codifiers.uchactok_tab uch on uch.id=d.uchactok_id 
LEFT JOIN dop_disp_measures_tab m1 ON m1.dop_disp_main_id = dd.id 
and m1.dop_disp_measure_id=2200000 
LEFT JOIN dop_disp_measures_tab m2 ON m2.dop_disp_main_id = dd.id 
and m2.dop_disp_measure_id=2300000 
LEFT JOIN dop_disp_measures_tab m3 ON m3.dop_disp_main_id = dd.id 
and m3.dop_disp_measure_id=2400000 
LEFT JOIN dop_disp_measures_tab m4 ON m4.dop_disp_main_id = dd.id 
and m4.dop_disp_measure_id=2500000 
LEFT JOIN dop_disp_measures_tab m5 ON m5.dop_disp_main_id = dd.id 
and m5.dop_disp_measure_id=2600000 
LEFT JOIN dop_disp_measures_tab m6 ON m6.dop_disp_main_id = dd.id 
and m6.dop_disp_measure_id=2700000 
LEFT JOIN dop_disp_measures_tab m7 ON m7.dop_disp_main_id = dd.id 
and m7.dop_disp_measure_id=2800000 
LEFT JOIN dop_disp_measures_tab m8 ON m8.dop_disp_main_id = dd.id 
and m8.dop_disp_measure_id=2900000 
LEFT JOIN dop_disp_measures_tab m9 ON m9.dop_disp_main_id = dd.id 
and m9.dop_disp_measure_id=3000000 
LEFT JOIN dop_disp_measures_tab m10 ON m10.dop_disp_main_id = dd.id 
and m10.dop_disp_measure_id=31000000 
LEFT JOIN dop_disp_measures_tab m11 ON m11.dop_disp_main_id = dd.id 
and m11.dop_disp_measure_id=3200000 
LEFT JOIN dop_disp_measures_tab m12 ON m12.dop_disp_main_id = dd.id 
and m12.dop_disp_measure_id=3300000 
LEFT JOIN dop_disp_measures_tab m13 ON m13.dop_disp_main_id = dd.id 
and m13.dop_disp_measure_id=3400000 
left join dop_disp_measure_profiles_tab mp1 on mp1.dop_disp_measure_id=2200000 and m1.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp2 on mp2.dop_disp_measure_id=2300000  and m2.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp3 on mp3.dop_disp_measure_id=2400000  and m3.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp4 on mp4.dop_disp_measure_id=2500000  and m4.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp5 on mp5.dop_disp_measure_id=2600000  and m5.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp6 on mp6.dop_disp_measure_id=2700000  and m6.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp7 on mp7.dop_disp_measure_id=2800000  and m7.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp8 on mp8.dop_disp_measure_id=2900000  and m8.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp9 on mp9.dop_disp_measure_id=3000000  and m9.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp10 on mp10.dop_disp_measure_id=3100000  and m10.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp11 on mp11.dop_disp_measure_id=3200000  and m11.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp12 on mp12.dop_disp_measure_id=3300000  and m12.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp13 on mp13.dop_disp_measure_id=3400000  and m13.dop_disp_measure_id is not null 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
WHERE 
(/*(c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN':param1_1_:' AND ':param1_2_:') 
					OR*/ (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL AND  :param2_1_:  AND dd.maked_proc&gt;=85 
ORDER BY 2;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2029103000" Name="Приложение №4 к метод.рекомендациям" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Приложение №4 к метод.рекомендациям.xls">
              <Queries>
                <Query>
                  <Sql>z1 select '$id'::text, d.fio as p1, 
d.date_born as p2, 
d.address as p3, 
coalesce(d.telephon,'')||' '||coalesce(d.phone_mobile,'')||' '||coalesce(d.work_phone,'') as p4, 
u.name as p5 
 from dan_tab d 
  left join fed_lgota_tab f on f.dan_id=d.dan_id 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id 
  where d.spolref::int4 in (select * from get_all_lpu_numbers()) 
and :param3_1_: 
  and (((date_part('year',':param1_1_:'::date) - date_part('year',d.date_born::date)) in ( 
  select f.a from generate_series(18,100,3) f(a)) )) 
order by 3,2</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="Участок" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2029303000" Name="Сведения о ДОГВН (форма 131/о)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Сведения о ДОГВН (форма 131_о).xls">
              <Queries>
                <Query>
                  <Sql>gr_zd(param1,v_1,v_2,pol) select count(distinct dan_id) 
from report_dd_tab 
where age between v_1 and v_2 
and sex='pol' 
and sp_health_group_id=param1</Sql>
                </Query>
                <Query>
                  <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
                </Query>
                <Query>
                  <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
                </Query>
                <Query>
                  <Sql>report_clear SELECT ''; SELECT drop_if_exists('report_disp_tab'); 
SELECT drop_if_exists('report_dd_tab'); 
SELECT drop_if_exists('report_dd1_tab'); 
SELECT drop_if_exists('report_dd2_tab');</Sql>
                </Query>
                <Query>
                  <Sql>report_init SELECT ''; SELECT drop_if_exists('report_disp_tab'); 
 
CREATE TEMP TABLE report_disp_tab 
( 
dan_id BIGINT, 
sex VARCHAR(1), 
age INTEGER 
); 
 
INSERT INTO report_disp_tab (dan_id, sex, age) 
(SELECT   d.dan_id, 
d.sex, 
(date_part('year',now()::date) - date_part('year',d.date_born::date)) 
from dan_tab d 
where :prik_1_: 
and (((date_part('year',now()::date) - date_part('year',d.date_born::date)) in ( 
  select f.a from generate_series(18,100,3) f(a)) )) 
AND (:strcom_1_: ) 
); 
 
CREATE INDEX "report_disp_tab_sex_idx" ON "report_disp_tab" 
  USING btree ("sex"); 
CREATE INDEX "report_disp_tab_age_idx" ON "report_disp_tab" 
  USING btree ("age"); 
 
SELECT drop_if_exists('report_dd_tab'); 
 
CREATE TEMP TABLE report_dd_tab 
( 
dan_id BIGINT, 
sex VARCHAR(1), 
age INTEGER, 
dop_disp_measure_id BIGINT, 
recommended_consultation_out VARCHAR, 
recommended_consultation_in VARCHAR, 
recommended_depth_counseling VARCHAR, 
recommended_duplex_scan BOOLEAN, 
recommended_ezofag BOOLEAN, 
high_a_p BOOLEAN, 
smoker BOOLEAN, 
alcohol BOOLEAN, 
narcotics BOOLEAN, 
irrational_nutrition BOOLEAN, 
insuff_phys_activity BOOLEAN, 
weight_excess BOOLEAN, 
inh_blood VARCHAR, 
inh_cancer VARCHAR, 
sssr_text VARCHAR, 
mkb_code VARCHAR, 
sp_disease_vid_id BIGINT, 
sp_health_group_id BIGINT, 
sent_to_disp BOOLEAN, 
result_id BIGINT, 
kat INTEGER, 
cityzen INTEGER, 
refusal_flag BOOLEAN, 
m_id BIGINT, 
m_doctor_id BIGINT, 
dm_doctor_id BIGINT, 
ds_id BIGINT, 
hypolipidemic_therapy BOOLEAN, 
glucose NUMERIC, 
dyslipidemia BOOLEAN, 
hereditary_tainted BOOLEAN, 
obesity BOOLEAN, 
stress BOOLEAN , 
diagn_stage_id BIGINT , 
result_stage_1 BIGINT, 
result_stage_2 BIGINT 
); 
 
INSERT INTO report_dd_tab (dan_id, sex, age,dop_disp_measure_id,recommended_consultation_out, 
recommended_consultation_in,recommended_depth_counseling,recommended_duplex_scan,recommended_ezofag, 
high_a_p,smoker,alcohol,narcotics,irrational_nutrition,insuff_phys_activity,weight_excess,inh_blood,inh_cancer,sssr_text, 
mkb_code,sp_disease_vid_id,sp_health_group_id,sent_to_disp,result_id,kat,cityzen,refusal_flag,m_id,m_doctor_id,dm_doctor_id, 
ds_id,hypolipidemic_therapy,glucose,dyslipidemia,hereditary_tainted,obesity,stress,diagn_stage_id,result_stage_1,result_stage_2) 
(select dd.dan_id, 
d.sex, 
gr.year, 
dm.dop_disp_measure_id, 
dr.recommended_consultation_out, 
dr.recommended_consultation_in, 
dr.recommended_depth_counseling, 
dr.recommended_duplex_scan, 
dr.recommended_ezofag , 
dr.high_a_p, 
dr.smoker, 
dr.alcohol, 
dr.narcotics, 
dr.irrational_nutrition, 
dr.insuff_phys_activity, 
dr.weight_excess, 
dr.inh_blood, 
dr.inh_cancer, 
dr.sssr_text, 
ds.mkb_code, 
ds.sp_disease_vid_id, 
dd.sp_health_group_id, 
dd.sent_to_disp, 
dd.result_id, 
d.kat , 
d.cityzen, 
m.refusal_flag, 
m.id, 
m.doctor_id, 
dm.doctor_id, 
ds.id , 
dr.hypolipidemic_therapy, 
dr.glucose, 
dr.dyslipidemia, 
dr.hereditary_tainted, 
dr.obesity, 
dr.stress, 
ds.diagn_stage_id , 
dd.result_stage_1, 
dd.result_stage_2 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join dop_disp_results_tab dr on dr.dop_disp_main_id=dd.id 
left JOIN dop_disp_measures_tab dm ON dm.dop_disp_main_id=dd.id 
LEFT JOIN visit_tab v on v.visit_id=m.table_id and m.table_name='visit_tab' 
left join codifiers.gr_obsl_tab gr on gr.id=dd.gr_obsl_id 
LEFT JOIN dop_disp_measures_tab m1 ON m1.dop_disp_main_id = dd.id AND m1.dop_disp_measure_id=1900000 
LEFT JOIN dop_disp_measures_tab m2 ON m2.dop_disp_main_id = dd.id AND m2.dop_disp_measure_id=2600000 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
WHERE 
((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND dd.date_end BETWEEN':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND dd.date_end BETWEEN ':param1_1_:' AND ':param1_2_:')) 
 and :param2_1_: 
/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL AND dd.gr_obsl_id IS NOT NULL 
AND (:strcom_1_: )  AND dd.maked_proc&gt;=85 
and :tip_1_: and :prik_1_: 
); 
 
CREATE INDEX "report_dd_tab_sex_idx" ON "report_dd_tab" 
  USING btree ("sex"); 
CREATE INDEX "report_dd_tab_age_idx" ON "report_dd_tab" 
  USING btree ("age"); 
CREATE INDEX "report_dd_tab_measure_idx" ON "report_dd_tab" 
  USING btree ("dop_disp_measure_id"); 
CREATE INDEX "report_dd_tab_mkb_code_idx" ON "report_dd_tab" 
  USING btree ("mkb_code"); 
 
SELECT drop_if_exists('report_dd1_tab'); 
 
CREATE TEMP TABLE report_dd1_tab 
( 
dan_id BIGINT, 
sex VARCHAR(1), 
age INTEGER, 
dop_disp_measure_id BIGINT, 
result_stage_1 BIGINT, 
result_stage_2 BIGINT 
); 
 
INSERT INTO report_dd1_tab (dan_id, sex, age,dop_disp_measure_id,result_stage_1,result_stage_2) 
(select dd.dan_id, 
d.sex, 
gr.year, 
dm.dop_disp_measure_id , 
dd.result_stage_1, 
dd.result_stage_2 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id AND ds.sp_disease_vid_id = 200001 
LEFT JOIN dop_disp_measures_tab dm ON dm.dop_disp_main_id=dd.id 
left join codifiers.gr_obsl_tab gr on gr.id=dd.gr_obsl_id 
LEFT JOIN dop_disp_measures_tab m1 ON m1.dop_disp_main_id = dd.id AND m1.dop_disp_measure_id=1900000 
LEFT JOIN dop_disp_measures_tab m2 ON m2.dop_disp_main_id = dd.id AND m2.dop_disp_measure_id=2600000 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
WHERE 
((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND dd.date_end BETWEEN':param1_1_:' AND ':param1_2_:') 
					) 
 and :param2_1_: 
/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL AND dd.gr_obsl_id IS NOT NULL 
AND (:strcom_1_: )  AND dd.maked_proc&gt;=85 
and :prik_1_: and :tip_1_: 
); 
 
CREATE INDEX "report_dd1_tab_dop_disp_measure_id_idx" ON "report_dd1_tab" 
  USING btree ("dop_disp_measure_id"); 
 
SELECT drop_if_exists('report_dd2_tab'); 
 
CREATE TEMP TABLE report_dd2_tab 
( 
dan_id BIGINT, 
sex VARCHAR(1), 
age INTEGER, 
dop_disp_measure_id BIGINT, 
cityzen INTEGER,  
result_stage_1 BIGINT, 
result_stage_2 BIGINT 
); 
 
INSERT INTO report_dd2_tab (dan_id, sex, age,dop_disp_measure_id,cityzen,result_stage_1 ,result_stage_2 ) 
(select dd.dan_id, 
d.sex, 
gr.year, 
dm.dop_disp_measure_id, 
 d.cityzen, 
dd.result_stage_1, 
dd.result_stage_2 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id AND ds.sp_disease_vid_id = 200001 
LEFT JOIN dop_disp_measures_tab dm ON dm.dop_disp_main_id=dd.id 
left join codifiers.gr_obsl_tab gr on gr.id=dd.gr_obsl_id 
LEFT JOIN dop_disp_measures_tab m1 ON m1.dop_disp_main_id = dd.id AND m1.dop_disp_measure_id=1900000 
LEFT JOIN dop_disp_measures_tab m2 ON m2.dop_disp_main_id = dd.id AND m2.dop_disp_measure_id=2600000 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
WHERE 
((dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND dd.date_end BETWEEN ':param1_1_:' AND ':param1_2_:')) 
 and :param2_1_: 
/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL AND dd.gr_obsl_id IS NOT NULL 
AND (:strcom_1_: )  AND dd.maked_proc&gt;=85 
and :prik_1_: and :tip_1_: 
); 
 
CREATE INDEX "report_dd2_tab_dop_disp_measure_id_idx" ON "report_dd2_tab" 
  USING btree ("dop_disp_measure_id");</Sql>
                </Query>
                <Query>
                  <Sql>z1(pol,v_1) select count(distinct dan_id) 
from report_disp_tab 
where sex=pol 
and age = v_1</Sql>
                </Query>
                <Query>
                  <Sql>z10(param1) select count(distinct dan_id) 
from report_dd_tab 
where ((mkb_code between 'G45' and 'G46.9') 
OR (mkb_code between 'I60' and 'I69.9')) 
and sp_disease_vid_id=500000 
param1</Sql>
                </Query>
                <Query>
                  <Sql>z11 select count(distinct m_id) 
from report_dd_tab 
where refusal_flag = true</Sql>
                </Query>
                <Query>
                  <Sql>z12(meropr) select count(distinct ds_id) 
from report_dd_tab 
where dop_disp_measure_id in ( meropr ) 
and m_doctor_id=dm_doctor_id 
and mkb_code is not null</Sql>
                </Query>
                <Query>
                  <Sql>z13(param1) select count(distinct ds_id) 
from report_dd_tab 
where m_doctor_id=dm_doctor_id 
and mkb_code is not null 
and param1</Sql>
                </Query>
                <Query>
                  <Sql>z14 </Sql>
                </Query>
                <Query>
                  <Sql>z2(pol,v_1) select count(distinct dan_id) 
from report_dd_tab 
where sex=pol 
and age = v_1</Sql>
                </Query>
                <Query>
                  <Sql>z3(meropr) select count(distinct dan_id) 
from report_dd_tab 
where dop_disp_measure_id in ( meropr )</Sql>
                </Query>
                <Query>
                  <Sql>z4(param1) select count(distinct dan_id) 
from report_dd1_tab 
where param1</Sql>
                </Query>
                <Query>
                  <Sql>z5(param1) select count(distinct dan_id) 
from report_dd2_tab 
where param1</Sql>
                </Query>
                <Query>
                  <Sql>z6(param1) select count(distinct dan_id) 
from report_dd_tab 
where param1</Sql>
                </Query>
                <Query>
                  <Sql>z7(param1,v_1,v_2,pol) select count(distinct dan_id) 
from report_dd_tab 
where param1 
and age between v_1 and v_2 
and sex='pol'</Sql>
                </Query>
                <Query>
                  <Sql>z8(diag_1,diag_2,v_1,v_2,pol,tip) select count(distinct dan_id) 
from report_dd_tab 
where mkb_code between 'diag_1' and 'diag_2' 
and age between v_1 and v_2 
and sex='pol'  tip</Sql>
                </Query>
                <Query>
                  <Sql>z9(v_1,v_2,pol,tip) select count(distinct dan_id) 
from report_dd_tab 
where ((mkb_code between 'F00' and 'F99.9') 
OR (mkb_code between 'H60' and 'H99.9') 
OR (mkb_code between 'L00' and 'M99.9') 
OR (mkb_code between 'O00' and 'Z99.9')) 
and age between v_1 and v_2 
and sex='pol' tip</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="prik" Caption="Прикреплен" Type="select">
                  <Sql>select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="strcom" Caption="Страховая компания" Type="select">
                  <Sql>select 'true','Все',0 union select ' d.strcom_region_id !=''7000000000000''','Иногородние',1 union select 'd.strcom_id ='||strcom_id, strcom,2 from strcom_tab where strcom_id&lt;97 or strcom_id=99  order by 3,2</Sql>
                </Parameter>
                <Parameter Name="tip" Caption="Тип диспасеризации" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2029503000" Name="Реестр по диспансеризации" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Реестр по диспансеризации.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select distinct '$id'::text, 
d.fio as p1, 
d.date_born as p2, 
dd.date_begin  as p3, 
dd.date_end as p4, 
join_str(distinct ds.mkb_code) as p5 , 
uch.name as p6, 
mh.name as p8, 
mh1.name as p7, 
coalesce(d.ser_pol||' ','')||coalesce(d.num_pol,'') as p9, 
case when dd.sent_to_disp=true then 'Да' else 'Нет' end as p10, 
h.sp_health_group as p11  
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
left join codifiers.uchactok_tab uch on uch.id=d.uchactok_id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join codifiers.med_help_result_tab mh on mh.id=dd.result_stage_1 
left join codifiers.med_help_result_tab mh1 on mh1.id=dd.result_stage_2 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
left join sp_health_group_tab h on h.sp_health_group_id=dd.sp_health_group_id 
WHERE 
 case when ':etap_2_:'='1' then  (c.dd_stage=1 AND dd.result_stage_1 IS NOT NULL and  
date_reestr_first_stage between ':param1_1_:' and ':param1_2_:') 
when ':etap_2_:'='2' then (dd.result_stage_1 IS NOT NULL AND c.dd_stage =2 
AND dd.result_stage_2 IS NOT NULL 
and date_reestr_second_stage between ':param1_1_:' and ':param1_2_:' ) 
else ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:'))  end   
/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL AND :param2_1_: 
and :param3_1_: and :tip_1_: and :prik_1_:  AND dd.maked_proc&gt;=85 
and :param4_1_: and :param5_1_: 
group by 2,3,4,5,7,8,9,10,11,12 
ORDER BY 2;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param5" Caption="Категория" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.kat='||kateg_id,kateg,1 from kateg_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param3" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="prik" Caption="Прикреплен" Type="select">
                  <Sql>select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param4" Caption="Соц.статус" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.sozstatus_id='||sozstatus_id,sozstatus,1 from sozstatus_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param2" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
                <Parameter Name="tip" Caption="Тип диспансеризации" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="etap" Caption="Этап" Type="select2">
                  <Sql>3=Все||1=1||2=2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2029703000" Name="Реестр счетов (бумажный 1-ый этап)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Реестр счетов (бумажный 1-ый этап).xls">
              <Queries>
                <Query>
                  <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
                </Query>
                <Query>
                  <Sql>smo_name select ':param2_2_:'</Sql>
                </Query>
                <Query>
                  <Sql>z1 select distinct '$id'::text, 
d.fio as p1, 
d.sex as p2, 
d.date_born as p3, 
d.mest_born as p4, 
coalesce(d.serdoc ,'')||' '||coalesce(d.numdoc,'') as p5, 
d.fakt_adr as p6, 
d.address as p7, 
d.pens as p8, 
coalesce(d.ser_pol,'')||' '||coalesce(d.num_pol,'') as p9, 
1 as p10, 
diag.mkb_code as p11, 
dd.conv_price as p12, 
dd.result_stage_1 as p13, 
'$id'::text as p14, 
m1.measure_date as p15, 
mp1.spec_code as p16, 
m2.measure_date as p17, 
mp2.spec_code as p18, 
m3.measure_date as p19, 
mp3.spec_code as p20, 
m4.measure_date as p21, 
mp4.spec_code as p22, 
m5.measure_date as p23, 
mp5.spec_code as p24, 
m6.measure_date as p25, 
mp6.spec_code as p26, 
m7.measure_date as p27, 
mp7.spec_code as p28, 
m8.measure_date as p29, 
mp8.spec_code as p30, 
m9.measure_date as p31, 
mp9.spec_code as p32, 
m10.measure_date as p33, 
mp10.spec_code as p34, 
m11.measure_date as p35, 
mp11.spec_code as p36, 
m12.measure_date as p37, 
mp12.spec_code as p38, 
m13.measure_date as p39, 
mp13.spec_code as p40, 
m14.measure_date as p41, 
mp14.spec_code as p42, 
m15.measure_date as p43, 
mp15.spec_code as p44, 
m16.measure_date as p45, 
mp16.spec_code as p46, 
m17.measure_date as p47, 
mp17.spec_code as p48, 
m18.measure_date as p49, 
mp18.spec_code as p50, 
m19.measure_date as p51, 
mp19.spec_code as p52, 
m20.measure_date as p53, 
mp20.spec_code as p54, 
m21.measure_date as p55, 
mp21.spec_code as p56 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
left join dop_disp_diagns_tab diag on diag.dop_disp_main_id = dd.id /*and diag.sp_disease_vid_id=200001 */ 
left join codifiers.uchactok_tab uch on uch.id=d.uchactok_id 
LEFT JOIN dop_disp_measures_tab m1 ON m1.dop_disp_main_id = dd.id 
and m1.dop_disp_measure_id=100000 
LEFT JOIN dop_disp_measures_tab m2 ON m2.dop_disp_main_id = dd.id 
and m2.dop_disp_measure_id=200000 
LEFT JOIN dop_disp_measures_tab m3 ON m3.dop_disp_main_id = dd.id 
and m3.dop_disp_measure_id=300000 
LEFT JOIN dop_disp_measures_tab m4 ON m4.dop_disp_main_id = dd.id 
and m4.dop_disp_measure_id=400000 
LEFT JOIN dop_disp_measures_tab m5 ON m5.dop_disp_main_id = dd.id 
and m5.dop_disp_measure_id=500000 
LEFT JOIN dop_disp_measures_tab m6 ON m6.dop_disp_main_id = dd.id 
and m6.dop_disp_measure_id=600000 
LEFT JOIN dop_disp_measures_tab m7 ON m7.dop_disp_main_id = dd.id 
and m7.dop_disp_measure_id=700000 
LEFT JOIN dop_disp_measures_tab m8 ON m8.dop_disp_main_id = dd.id 
and m8.dop_disp_measure_id=800000 
LEFT JOIN dop_disp_measures_tab m9 ON m9.dop_disp_main_id = dd.id 
and m9.dop_disp_measure_id=900000 
LEFT JOIN dop_disp_measures_tab m10 ON m10.dop_disp_main_id = dd.id 
and m10.dop_disp_measure_id=1000000 
LEFT JOIN dop_disp_measures_tab m11 ON m11.dop_disp_main_id = dd.id 
and m11.dop_disp_measure_id=1100000 
LEFT JOIN dop_disp_measures_tab m12 ON m12.dop_disp_main_id = dd.id 
and m12.dop_disp_measure_id=1200000 
LEFT JOIN dop_disp_measures_tab m13 ON m13.dop_disp_main_id = dd.id 
and m13.dop_disp_measure_id=1300000 
LEFT JOIN dop_disp_measures_tab m14 ON m14.dop_disp_main_id = dd.id 
and m14.dop_disp_measure_id=1400000 
LEFT JOIN dop_disp_measures_tab m15 ON m15.dop_disp_main_id = dd.id 
and m15.dop_disp_measure_id=1500000 
LEFT JOIN dop_disp_measures_tab m16 ON m16.dop_disp_main_id = dd.id 
and m16.dop_disp_measure_id=1600000 
LEFT JOIN dop_disp_measures_tab m17 ON m17.dop_disp_main_id = dd.id 
and m17.dop_disp_measure_id=1700000 
LEFT JOIN dop_disp_measures_tab m18 ON m18.dop_disp_main_id = dd.id 
and m18.dop_disp_measure_id=1800000 
LEFT JOIN dop_disp_measures_tab m19 ON m19.dop_disp_main_id = dd.id 
and m19.dop_disp_measure_id=1900000 
LEFT JOIN dop_disp_measures_tab m20 ON m20.dop_disp_main_id = dd.id 
and m20.dop_disp_measure_id=2000000 
LEFT JOIN dop_disp_measures_tab m21 ON m21.dop_disp_main_id = dd.id 
and m21.dop_disp_measure_id=2100000 
left join dop_disp_measure_profiles_tab mp1 on mp1.dop_disp_measure_id=100000 and m1.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp2 on mp2.dop_disp_measure_id=200000  and m2.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp3 on mp3.dop_disp_measure_id=300000  and m3.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp4 on mp4.dop_disp_measure_id=400000  and m4.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp5 on mp5.dop_disp_measure_id=500000  and m5.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp6 on mp6.dop_disp_measure_id=600000  and m6.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp7 on mp7.dop_disp_measure_id=700000  and m7.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp8 on mp8.dop_disp_measure_id=800000  and m8.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp9 on mp9.dop_disp_measure_id=900000  and m9.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp10 on mp10.dop_disp_measure_id=1000000  and m10.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp11 on mp11.dop_disp_measure_id=1100000  and m11.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp12 on mp12.dop_disp_measure_id=1200000  and m12.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp13 on mp13.dop_disp_measure_id=1300000  and m13.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp14 on mp14.dop_disp_measure_id=1400000  and m14.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp15 on mp15.dop_disp_measure_id=1500000  and m15.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp16 on mp16.dop_disp_measure_id=1600000  and m16.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp17 on mp17.dop_disp_measure_id=1700000  and m17.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp18 on mp18.dop_disp_measure_id=1800000  and m18.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp19 on mp19.dop_disp_measure_id=1900000  and m19.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp20 on mp20.dop_disp_measure_id=2000000  and m20.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp21 on mp21.dop_disp_measure_id=2100000  and m21.dop_disp_measure_id is not null 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
WHERE 
((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN':param1_1_:' AND ':param1_2_:') 
					/*OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')*/) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL AND  :param2_1_:  AND dd.maked_proc&gt;=85 
ORDER BY 2;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2029903000" Name="Индикаторы мониторинга диспансеризации взр.нас." Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Индикаторы мониторинга диспансеризации взр.нас..xls">
              <Queries>
                <Query>
                  <Sql>z1 select count(distinct d.dan_id) 
from dan_tab  d 
where d.spolref::int4 in (select * from get_all_lpu_numbers()) 
  and ( 
((date_part('year',now()::date) - date_part('year',d.date_born::date)) in ( 
  select f.a from generate_series(18,100,3) f(a))  
or (get_vozrast(d.date_born) in ( 
  select f.a from generate_series(18,100,3) f(a))  ) ))</Sql>
                </Query>
                <Query>
                  <Sql>z10 select  count(distinct dd.dan_id) 
from dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join dop_disp_results_tab dr on dr.dop_disp_main_id=dd.id 
where ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL  
and :prik_1_: and :tip_1_: AND dd.maked_proc&gt;=85 
and (case when dr.smoker then 1 else 0 end + 
case when dr.high_a_p then 1 else 0 end + 
case when dr.weight_excess then 1 else 0 end + 
case when dr.obesity  then 1 else 0 end + 
case when dr.hypercholesterinemia then 1 else 0 end + 
case when dr.hyperglycemia then 1 else 0 end + 
case when dr.insuff_phys_activity then 1 else 0 end + 
case when dr.irrational_nutrition then 1 else 0 end + 
case when dr.alcohol then 1 else 0 end + 
case when dr.narcotics  then 1 else 0 end + 
case when dr.sent_to_narkolog then 1 else 0 end) &gt;=2</Sql>
                </Query>
                <Query>
                  <Sql>z11 select  count(distinct dd.dan_id) 
from dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join dop_disp_results_tab dr on dr.dop_disp_main_id=dd.id  
where ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL  
and :prik_1_: and :tip_1_: AND dd.maked_proc&gt;=85 
and (case when dr.smoker then 1 else 0 end + 
case when dr.high_a_p then 1 else 0 end + 
case when dr.weight_excess then 1 else 0 end + 
case when dr.obesity  then 1 else 0 end + 
case when dr.hypercholesterinemia then 1 else 0 end + 
case when dr.hyperglycemia then 1 else 0 end + 
case when dr.insuff_phys_activity then 1 else 0 end + 
case when dr.irrational_nutrition then 1 else 0 end + 
case when dr.alcohol then 1 else 0 end + 
case when dr.narcotics  then 1 else 0 end + 
case when dr.sent_to_narkolog then 1 else 0 end) &gt;=1</Sql>
                </Query>
                <Query>
                  <Sql>z2 select count(distinct dd.dan_id) 
from dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
where (c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
AND ds.mkb_code IS NOT NULL 
AND dd.gr_obsl_id IS NOT NULL 
and :prik_1_: and :tip_1_: AND dd.maked_proc&gt;=85</Sql>
                </Query>
                <Query>
                  <Sql>z3 select count(distinct dd.dan_id) 
from dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
where (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
AND ds.mkb_code IS NOT NULL 
AND dd.gr_obsl_id IS NOT NULL 
and :prik_1_: and :tip_1_: AND dd.maked_proc&gt;=85</Sql>
                </Query>
                <Query>
                  <Sql>z4(gr_param) select count(distinct dd.dan_id) 
from dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */  
where case when (dd.result_stage_1 is not null  and dd.result_stage_1!=316) then dd.sp_health_group_id=gr_param 
		when (dd.result_stage_1=316 and dd.result_stage_2 is not null) then dd.sp_health_group_id=gr_param 
		else false end 
and ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL 
and :prik_1_: and :tip_1_: AND dd.maked_proc&gt;=85</Sql>
                </Query>
                <Query>
                  <Sql>z5(mkb1,mkb2,param2) select count(distinct dd.dan_id) 
from dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
where ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL  
and case when (dd.result_stage_1 is not null  and dd.result_stage_1!=316) 
then (ds.mkb_code between 'mkb1' and 'mkb2') 
		when (dd.result_stage_1=316 and dd.result_stage_2 is not null) 
then (ds.mkb_code between 'mkb1' and 'mkb2') 
		else false end 
 and :prik_1_: and :tip_1_:  AND dd.maked_proc&gt;=85 
and ds.diagn_stage_id in (2)    /*выявлено во время дд*/ 
param2</Sql>
                </Query>
                <Query>
                  <Sql>z9(gr_risk) select count(distinct dd.dan_id) 
from dop_disp_main_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join dop_disp_results_tab dr on dr.dop_disp_main_id=dd.id 
where case when (dd.result_stage_1 is not null  and dd.result_stage_1!=316 and dd.sp_health_group_id=1) then gr_risk 
		when (dd.result_stage_1=316 and dd.result_stage_2 is not null) then gr_risk 
		else false end 
and ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL 
and :prik_1_: and :tip_1_: AND dd.maked_proc&gt;=85</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="prik" Caption="Прикреплен" Type="select">
                  <Sql>select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="tip" Caption="Тип диспансеризации" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2030903000" Name="Приложение 12 Сведения о ДД" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Приложение 12 Сведения о ДД.xls">
              <Queries>
                <Query>
                  <Sql>report_clear SELECT ''; 
SELECT drop_if_exists('report_dd_tab'); 
SELECT drop_if_exists('report_dan_tab');</Sql>
                </Query>
                <Query>
                  <Sql>report_init SELECT ''; 
SELECT drop_if_exists('report_dd_tab'); 
SELECT drop_if_exists('report_dan_tab'); 
 
CREATE TEMP TABLE report_dan_tab 
( 
id BIGINT, 
sex VARCHAR(1), 
vozrast INTEGER 
); 
 
INSERT INTO report_dan_tab (id,sex,vozrast) 
( 
select d.dan_id, 
d.sex, 
get_vozrast(d.date_born) as vozrast 
from dan_tab d 
where  (((date_part('year',':param1_1_:'::date) - date_part('year',d.date_born::date)) in ( 
  select f.a from generate_series(21,100,3) f(a)) ) ) 
and d.spolref::int4 in (select * from get_all_lpu_numbers()) 
and :prikreplen_1_: 
); 
 
 
CREATE TEMP TABLE report_dd_tab 
( 
dan_id BIGINT, 
result_id_1 BIGINT, 
result_id_2 BIGINT, 
health_group BIGINT, 
hypercholesterinemia BOOLEAN, 
hypergikemia BOOLEAN, 
weight_excess BOOLEAN, 
obesity BOOLEAN, 
hypodynamia BOOLEAN, 
high_pressure BOOLEAN, 
smoking BOOLEAN, 
alcohol BOOLEAN, 
high_risk_grade BOOLEAN, 
diag_osn VARCHAR, 
stage_of_disease INTEGER,  
vozrast INTEGER, 
sex VARCHAR(1), 
date_reestr_first_stage DATE, 
date_reestr_second_stage DATE, 
irrational_diet BOOLEAN , 
narcotics BOOLEAN, 
data_pos DATE 
); 
 
INSERT INTO report_dd_tab (dan_id, 
result_id_1, 
result_id_2, 
health_group, 
hypercholesterinemia, 
hypergikemia, 
weight_excess, 
obesity, 
hypodynamia, 
high_pressure, 
smoking, 
alcohol, 
high_risk_grade, 
diag_osn, 
stage_of_disease, 
vozrast, 
sex, 
date_reestr_first_stage, 
date_reestr_second_stage, 
irrational_diet, 
narcotics, 
data_pos ) 
( 
select dd.dan_id, 
dd.result_stage_1, 
dd.result_stage_2, 
dd.sp_health_group_id as health_group, 
dr.hypercholesterinemia as hypercholesterinemia, 
dr.hyperglycemia as hypergikemia, 
dr.weight_excess as weight_excess, 
dr.obesity as obesity, 
dr.insuff_phys_activity as hypodynamia, 
dr.high_a_p as high_pressure, 
dr.smoker as smoking, 
dr.alcohol as alcohol, 
false as high_risk_grade, 
ds.mkb_code as diag_osn, 
ds.sp_disease_vid_id as stage_of_disease,  
get_vozrast(d.date_born,':param1_2_:'), 
d.sex, 
dd.date_reestr_first_stage, 
dd.date_reestr_second_stage, 
dr.irrational_nutrition as irrational_diet, 
dr.narcotics as narcotics, 
v.data_pos  
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join dop_disp_results_tab dr on dr.dop_disp_main_id=dd.id 
left JOIN dop_disp_measures_tab dm ON dm.dop_disp_main_id=dd.id 
LEFT JOIN visit_tab v on v.visit_id=m.table_id and m.table_name='visit_tab' 
left join codifiers.gr_obsl_tab gr on gr.id=dd.gr_obsl_id  
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
WHERE 
((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL 
and :param3_1_: 
and :param2_1_: 
and :param4_1_: 
AND :stage_1_: 
and :prikreplen_1_:  AND dd.maked_proc&gt;=85 
); 
 
CREATE INDEX "report_dd_tab_vozrast_idx" ON "report_dd_tab" 
  USING btree ("vozrast"); 
 
CREATE INDEX "report_dd_tab_pol_idx" ON "report_dd_tab" 
  USING btree ("sex");</Sql>
                </Query>
                <Query>
                  <Sql>z1(age1,age2,param_pol) select count(distinct id) 
from report_dan_tab 
where vozrast between age1 and age2 
param_pol</Sql>
                </Query>
                <Query>
                  <Sql>z2(age1,age2,param2) select count(distinct dan_id) 
from report_dd_tab 
where vozrast between age1 and age2 
and (result_id_1 is not null or result_id_2 is not null) 
 param2</Sql>
                </Query>
                <Query>
                  <Sql>z3(mkb1,mkb2,pol,param2) select count(distinct dan_id) 
from report_dd_tab 
where diag_osn between 'mkb1' and 'mkb2' 
and sex='pol'  
and (result_id_1 is not null or result_id_2 is not null) 
param2</Sql>
                </Query>
                <Query>
                  <Sql>z4(mkb1,mkb2,pol,param2) select count(distinct dan_id) 
from report_dd_tab 
where diag_osn between 'mkb1' and 'mkb2' 
and sex='pol' 
and data_pos between date_reestr_first_stage::date + '1 day'::interval and date_reestr_first_stage::date + '6 month'::interval 
and (result_id_1 is not null or result_id_2 is not null) 
param2</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param3" Caption="Врач" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.doctor_id='||full_doctor_id,full_fio,1 from full_doctor_tab  order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Дата реестра" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel='''||otdel||'''',nam_otdel,1 from otdel_tab  order by 3,2</Sql>
                </Parameter>
                <Parameter Name="prikreplen" Caption="Прикреплен" Type="select">
                  <Sql>select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="stage" Caption="Тип диспансеризации" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param4" Caption="Участок" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab  order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2031103000" Name="Список направленных на 2ой этап" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Список направленных на 2ой этап.xls">
              <Queries>
                <Query>
                  <Sql>z1 select '$id'::text, 
d.fio as p1, 
d.date_born as p2, 
d.fakt_adr as p3, 
d.address as p4, 
join_str(distinct ds.mkb_code) as p5, 
uch.name as p6, 
f.fio as p7 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
left join codifiers.uchactok_tab uch on uch.id=d.uchactok_id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
WHERE 
 ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:')) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL 
and dd.result_stage_1 BETWEEN 420 AND 423 
 AND dd.maked_proc&gt;=85 
and :param2_1_: 
and :param3_1_: 
group by 1,2,3,4,5,7,8 
ORDER BY 2;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param3" Caption="Врач" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.doctor_id='||full_doctor_id, full_fio,1 from full_doctor_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2031503000" Name="Список пациентов с впервые выявленными заболеваниями" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Список пациентов с впервые выявленными заболеваниями.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select distinct '$id'::text, 
d.fio as p1, 
d.date_born as p2, 
dd.date_begin  as p3, 
dd.date_end as p4, 
join_str(distinct ds.mkb_code) as p5 , 
uch.name as p6, 
mh.name as p8, 
mh1.name as p7, 
coalesce(d.ser_pol||' ','')||coalesce(d.num_pol,'') as p9, 
case when dd.sent_to_disp=true then 'Да' else 'Нет' end as p10  
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
left join codifiers.uchactok_tab uch on uch.id=d.uchactok_id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join codifiers.med_help_result_tab mh on mh.id=dd.result_stage_1 
left join codifiers.med_help_result_tab mh1 on mh1.id=dd.result_stage_2 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
WHERE 
((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:'))    
/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL AND :param2_1_: 
and :param4_1_: and :prik_1_: and :disp_type_1_: and :uch_1_: 
and :param3_1_: 
and ds.diagn_stage_id=2 
 AND dd.maked_proc&gt;=85 
group by 2,3,4,5,7,8,9,10,11 
ORDER BY 2;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param4" Caption="Врач" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.doctor_id='||full_doctor_id, full_fio,1 from full_doctor_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="prik" Caption="Прикреплен" Type="select">
                  <Sql>select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',0 union select 'true','Все',1 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param2" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
                <Parameter Name="disp_type" Caption="Тип диспансеризации" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="uch" Caption="Участок" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab  order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2033303000" Name="Оказанные услуги" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Оказанные услуги.xls">
              <Queries>
                <Query>
                  <Sql>z1 SELECT distinct '$id'::text, d.fam||' '||d.nam||' '||d.mid as pac_fio, to_char(d.date_born, 'DD.MM.YYYY') as date_born, full_doc.full_fio as fio, 
  case when v.visit_id is not null then 'visit' 
      when h.id is not null then 'hosp' 
      when r.id is not null then 'research' 
      --when dd.id is not null then 'disp'||dd.dop_disp_type_id||'_'||case when ok.bur_dd_magic_number &gt;= 2 then 2 else 1 end 
      when dd.id is not null then 'disp'||dd.dop_disp_type_id||'_'||case when ok.bur_dd_magic_number &lt;= 2 then 'dd_card' else 'dd_measure' end 
      else 'unknown' 
  end as uslug_type, 
 
  uc.code as uslug_code, 
 
  ok.reestr_date, 
 
  o.name as otdel, 
 
  --case when ok.paid=true then '+' else '' end as is_opl, 
 
  ok.accept_date, 
 
  trim(both from kat.kateg)||', '||trim(both from soz.sozstatus) as katstat, 
 
  to_char(case when v.visit_id is not null then v.data_pos 
      when h.id is not null then h.date_begin 
      when dd.id is not null then dd.date_begin 
      else ok.date_okaz end, 'DD.MM.YYYY') as date_1, 
 
  to_char(case when v.visit_id is not null then v.data_pos 
      when h.id is not null then h.date_end 
      when dd.id is not null then dd.date_end 
      else ok.date_okaz end, 'DD.MM.YYYY') as date_2, 
 
  case when (r.id is not null and d.spolref = get_main_lpu_code()) then 0 else coalesce((h.id/h.id) * ok.cost / CASE WHEN d.strcom_region_id = GET_OUR_REGION_CODE() THEN 1 ELSE h.duration end, ok.cost * kol_vo) end as cost 
 
 FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN sozstatus_tab soz ON soz.sozstatus_id = d.sozstatus_id 
LEFT JOIN kateg_tab kat ON kat.kateg_id = d.kat 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
LEFT JOIN full_doctor_view full_doc ON full_doc.full_doctor_id = doc.id 
LEFT JOIN codifiers.otdel_tab o ON o.id  = doc.sp_otdel_id 
LEFT JOIN sp_uslug_tab uc ON uc.id = ok.sp_uslug_id 
LEFT JOIN visit_tab v ON v.visit_id=table_link_id and table_link_name='visit_tab' 
LEFT JOIN talon_tab t ON t.id  = v.talon_id and table_link_name='visit_tab' 
LEFT JOIN hosp_tab h ON h.id=table_link_id and table_link_name='hosp_tab' 
LEFT JOIN researches.main_research_tab r ON r.id=table_link_id and table_link_name ILIKE 'researches.%' and r.researches_types_id=ok.research_id 
LEFT JOIN dop_disp_main_tab dd ON dd.id=table_link_id and table_link_name ILIKE 'dop_disp_main_tab' 
WHERE (case when ':select_by_1_:'='enddate' then /*bur_sluch_date_end_for_ok(ok.id)*/ ok.sluch_date_end else ok.accept_date end BETWEEN ':param1_1_:' AND ':param1_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
						AND d.num_pol is not null AND d.policy_type is not null 
						AND CASE WHEN ':usl_1_:'='all' THEN 
							 (table_link_name = 'visit_tab' OR table_link_name = 'hosp_tab' OR 	table_link_name ILIKE 'researches.%' OR table_link_name='dop_disp_main_tab' OR table_link_name ILIKE 'dop_disp_measures_tab') 
							WHEN ':usl_1_:'='visit' THEN table_link_name = 'visit_tab' 
							WHEN ':usl_1_:'='hosp' THEN table_link_name = 'hosp_tab' 
							WHEN ':usl_1_:'='research' THEN table_link_name ILIKE 'researches.%' 
							WHEN ':usl_1_:'='disp' THEN (table_link_name ILIKE 'dop_disp_main_tab' OR table_link_name ILIKE 'dop_disp_measures_tab')  END 
						AND (v.visit_id is not null OR h.id is not null OR r.id is not null OR dd.id is not null) 
						AND coalesce(ok.paid, false) in :opl_1_: 
						AND case when dd.id is not null and coalesce(ok.paid, false)=false then coalesce(dd.errors_common,'')='' else true end 
						AND case when dd.id is not null  then :ddtype_1_: and :res1_1_: and :res2_1_: else true end 
						AND coalesce(d.date_smerti, '01.01.3000'::date) &gt; ok.sluch_date_end AND coalesce(d.life,0) in (0, 2) 
						AND d.sex in :pol_1_: 
						AND true 
						 
ORDER BY 6 ASC</Sql>
                </Query>
                <Query>
                  <Sql>z2 SELECT full_doc.full_doctor_id||' '||full_doc.full_fio , o.name as otdel, 
  sum(case when (r.id is not null and d.spolref = get_main_lpu_code()) then 0 else coalesce((h.id/h.id) * ok.cost / CASE WHEN d.strcom_region_id = GET_OUR_REGION_CODE() THEN 1 ELSE h.duration end, ok.cost * kol_vo) end) as cost, 
count(distinct case when v.visit_id is not null then v.talon_id||'_t' 
					when r.id is not null then r.id||'_'||r.researches_types_id||'_r' 
/*					when dd.id is not null then dd.id||'_'||case when ok.bur_dd_magic_number&gt;=2 then 2 else 1 end||'_'||'_d' 
					else ok.id::character varying end) as kolvo, 
count(distinct dd.id||'_'||case when ok.bur_dd_magic_number&gt;=2 then 2 else null end||'_'||'_d') as kolvo2 */ 
 
					when dd.id is not null then dd.id||'_d' 
					else ok.id::character varying end) as kolvo, 
count(distinct case when ok.bur_dd_magic_number &gt;= 2 then dd.id||'_d' else null end) as kolvo2 
 
 
  
 FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
 
LEFT JOIN visit_tab v ON v.visit_id=table_link_id and table_link_name='visit_tab' 
LEFT JOIN talon_tab t ON t.id  = v.talon_id and table_link_name='visit_tab' 
LEFT JOIN hosp_tab h ON h.id=table_link_id and table_link_name='hosp_tab' 
LEFT JOIN researches.main_research_tab r ON r.id=table_link_id and table_link_name ILIKE 'researches.%' and r.researches_types_id=ok.research_id 
LEFT JOIN dop_disp_main_tab dd ON dd.id=table_link_id and table_link_name ILIKE 'dop_disp_main_tab' --and ok.bur_dd_magic_number &lt; 2 
LEFT JOIN dop_disp_measures_tab m2 ON m2.dop_disp_main_id = dd.id AND (m2.dop_disp_measure_id=2600000)  
 
LEFT JOIN doctor_tab doc ON doc.id = case when dd.id is null then ok.doctor_id else dd.doctor_id end 
LEFT JOIN full_doctor_view full_doc ON full_doc.full_doctor_id = doc.id 
LEFT JOIN codifiers.otdel_tab o ON o.id  = doc.sp_otdel_id  
 
WHERE (case when ':select_by_1_:'='enddate' then /*bur_sluch_date_end_for_ok(ok.id)*/ ok.sluch_date_end else ok.accept_date end BETWEEN ':param1_1_:' AND ':param1_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
						AND d.num_pol is not null AND d.policy_type is not null 
						AND CASE WHEN ':usl_1_:'='all' THEN 
							 (table_link_name = 'visit_tab' OR table_link_name = 'hosp_tab' OR 	table_link_name ILIKE 'researches.%' OR table_link_name='dop_disp_main_tab' OR table_link_name ILIKE 'dop_disp_measures_tab') 
							WHEN ':usl_1_:'='visit' THEN table_link_name = 'visit_tab' 
							WHEN ':usl_1_:'='hosp' THEN table_link_name = 'hosp_tab' 
							WHEN ':usl_1_:'='research' THEN table_link_name ILIKE 'researches.%' 
							WHEN ':usl_1_:'='disp' THEN (table_link_name ILIKE 'dop_disp_main_tab' /*and ok.bur_dd_magic_number &lt;= 2*/)  END 
						AND (v.visit_id is not null OR h.id is not null OR r.id is not null OR dd.id is not null /*or dd2.id is not null*/) 
						AND coalesce(ok.paid, false) in :opl_1_: 
						AND case when dd.id is not null and coalesce(ok.paid, false)=false then coalesce(dd.errors_common,'')='' else true end 
						AND case when dd.id is not null  then :ddtype_1_: and :res1_1_: and :res2_1_: else true end 
						AND coalesce(d.date_smerti, '01.01.3000'::date) &gt; ok.sluch_date_end AND coalesce(d.life,0) in (0, 2) 
						AND true 
GROUP BY 1, 2</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="opl" Caption="По оплате" Type="select2">
                  <Sql>(true, false)=Все||(true)=Оплаченные||(false)=Не оплаченные</Sql>
                </Parameter>
                <Parameter Name="pol" Caption="Пол" Type="select2">
                  <Sql>('м', 'ж')=Все||('м')=Мужчины||('ж')=Женщины</Sql>
                </Parameter>
                <Parameter Name="res2" Caption="Результат второго этапа ДД" Type="select">
                  <Sql>select 'true','Все',0 union select 'coalesce(dd.result_stage_2)='||id, substr(name, 1, 80), id from codifiers.med_help_result_tab where id in (352,353,354,355,356,321,322,323,324,325,317,318,319,332,333,334,335,336,347,348,349,350,351)  order by 3, 2;</Sql>
                </Parameter>
                <Parameter Name="res1" Caption="Результат первого этапа ДД" Type="select">
                  <Sql>select 'true','Все',0 union select 'coalesce(dd.result_stage_1)='||id, substr(name,1,80), id from codifiers.med_help_result_tab where id in (357,352,353,354,355,356,320,321,322,323,324,325,316,317,318,319,343,344,345,358,332,333,334,335,336,359,347,348,349,350,351,342) order by 3, 2; </Sql>
                </Parameter>
                <Parameter Name="select_by" Caption="Считать по" Type="select2">
                  <Sql>enddate=Дате окончания||acceptdate=Дате оплаты</Sql>
                </Parameter>
                <Parameter Name="ddtype" Caption="Тип ДД" Type="select">
                  <Sql>select 'true','Все',0 union select 'coalesce(dd.dop_disp_type_id)='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="usl" Caption="Услуга" Type="select2">
                  <Sql>all=Все||disp=ДД||visit=Посещения||hosp=Госпитализация||research=Исследования</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2033503000" Name="Прошедшие ДД" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\Прошедшие ДД.xls">
              <Queries>
                <Query>
                  <Sql>z1 select distinct '$id'::text, 
d.fam as p1, 
d.nam as p2, 
d.mid  as p3, 
d.date_born as p4, 
dd.date_begin as p11, 
dd.date_end as p12, 
d.sex as p5, 
d.address as p6, 
f.full_fio as p7, 
s.sozstatus as p8, 
uchas.uchactok as p9, 
u.accept_date as p10, 
dd.errors_common as p13, 
dd.maked_proc as p14 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_main_tab' 
		AND u.table_link_id = dd.id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id 
left join uchactok_tab uchas  ON uchas.uchactok_id = d.uchactok_id  
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
left join sozstatus_tab s on s.sozstatus_id=d.sozstatus_id 
WHERE 
 case when ':etap_2_:'='1' then  (c.dd_stage=1 
--AND dd.result_stage_1 IS NOT NULL 
 and  u.bur_dd_magic_number=1 
and date_reestr_first_stage between ':param1_1_:' and ':param1_2_:') 
when ':etap_2_:'='2' then (dd.result_stage_1 IS NOT NULL AND c.dd_stage =2 
AND dd.result_stage_2 IS NOT NULL and  u.bur_dd_magic_number&lt;&gt;1 
and date_reestr_second_stage between ':param1_1_:' and ':param1_2_:' ) 
else ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN ':param1_1_:' AND ':param1_2_:') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN ':param1_1_:' AND ':param1_2_:'))  end   
AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL AND :param2_1_: 
and :param3_1_: and :param2_1_: and :param4_1_:  AND dd.maked_proc&gt;=85 
ORDER BY 2,3,4;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param3" Caption="Врач" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.doctor_id='||full_doctor_id,full_fio,1 from full_doctor_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param4" Caption="Тип ДД" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="etap" Caption="Этап" Type="select2">
                  <Sql>3=Все||1=1||2=2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2034503000" Name=" Сведения о результатах проведения диспансеризации" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2014\ Сведения о результатах проведения диспансеризации.xls">
              <Queries>
                <Query>
                  <Sql>z1(group_dd,sex,magik,sozstatus,result) select sum(ou.cost) from dop_disp_main_tab dd 
left join okaz_uslug_tab ou on ou.table_link_name = 'dop_disp_main_tab' and ou.table_link_id = dd.id 
left join dan_tab d on d.dan_id = dd.dan_id 
where ou.accept_date  between ':param1_1_:' and ':param1_2_:' and ou.paid = true and group_dd 
and sex 
and magik and sozstatus and result</Sql>
                </Query>
                <Query>
                  <Sql>z2(group_dd,sex,magik,sozstatus,result) select count(*) from dop_disp_main_tab dd 
left join okaz_uslug_tab ou on ou.table_link_name = 'dop_disp_main_tab' and ou.table_link_id = dd.id 
left join dan_tab d on d.dan_id = dd.dan_id 
where ou.accept_date  between ':param1_1_:' and ':param1_2_:' and ou.paid = true and group_dd 
and sex 
and magik and sozstatus 
and result</Sql>
                </Query>
                <Query>
                  <Sql>z3(sex,magik,sozstatus) select sum(ou.cost) from dop_disp_main_tab dd 
left join okaz_uslug_tab ou on ou.table_link_name = 'dop_disp_main_tab' and ou.table_link_id = dd.id 
left join dan_tab d on d.dan_id = dd.dan_id 
where ou.accept_date  between ':param1_1_:' and ':param1_2_:' and ou.paid = true and dd.disp_group_id = '3' 
and sex 
and magik and sozstatus</Sql>
                </Query>
                <Query>
                  <Sql>z4(group_dd,result,sex,magik,sozstatus) select count(dd.dan_id) from dop_disp_main_tab dd 
left join okaz_uslug_tab ou on ou.table_link_name = 'dop_disp_main_tab' and ou.table_link_id = dd.id 
left join dan_tab d on d.dan_id = dd.dan_id 
where ou.accept_date  between ':param1_1_:' and ':param1_2_:' and ou.paid = true and group_dd 
and result 
and sex 
and magik and sozstatus</Sql>
                </Query>
                <Query>
                  <Sql>z5(group_dd,result,sex,magik,sozstatus) select count(dd.dan_id) from dop_disp_main_tab dd 
left join okaz_uslug_tab ou on ou.table_link_name = 'dop_disp_main_tab' and ou.table_link_id = dd.id 
left join dan_tab d on d.dan_id = dd.dan_id 
where ou.accept_date  between (date_part('year',date ':param1_2_:')||'-01-01')::date and ':param1_2_:' and ou.paid = true and group_dd 
and result 
and sex 
and magik and sozstatus</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Период оплаты" Type="date_period">
                  <Sql />
                </Parameter>
              </Parameters>
            </Report>
          </Reports>
          <Folders />
        </Folder>
        <Folder Name="Диспансеризация 2013">
          <Reports>
            <Report Id="2026303000" Name="Приложение 12 Сведения о ДД" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2013\Приложение 12 Сведения о ДД.xls">
              <Queries>
                <Query>
                  <Sql>report_clear SELECT ''; 
SELECT drop_if_exists('report_dd_tab'); 
SELECT drop_if_exists('report_dan_tab');</Sql>
                </Query>
                <Query>
                  <Sql>report_init SELECT ''; 
SELECT drop_if_exists('report_dd_tab'); 
SELECT drop_if_exists('report_dan_tab'); 
 
CREATE TEMP TABLE report_dan_tab 
( 
id BIGINT, 
sex VARCHAR(1), 
vozrast INTEGER 
); 
 
INSERT INTO report_dan_tab (id,sex,vozrast) 
( 
select d.dan_id, 
d.sex, 
get_vozrast(d.date_born) as vozrast 
from dan_tab d 
where  (((date_part('year',':param1_1_:'::date) - date_part('year',d.date_born::date)) in ( 
  select f.a from generate_series(21,100,3) f(a)) ) ) 
and d.spolref::int4 in (select * from get_all_lpu_numbers()) 
and :prikreplen_1_: 
); 
 
 
CREATE TEMP TABLE report_dd_tab 
( 
dan_id BIGINT, 
result_id BIGINT, 
health_group BIGINT, 
hypercholesterinemia BOOLEAN, 
hypergikemia BOOLEAN, 
weight_excess BOOLEAN, 
obesity BOOLEAN, 
hypodynamia BOOLEAN, 
high_pressure BOOLEAN, 
smoking BOOLEAN, 
alcohol BOOLEAN, 
high_risk_grade BOOLEAN, 
diag_osn VARCHAR, 
stage_of_disease INTEGER, 
data_pos DATE, 
target_pos_id BIGINT, 
vozrast INTEGER, 
sex VARCHAR(1), 
date_creation DATE, 
irrational_diet BOOLEAN , 
narcotics BOOLEAN 
); 
 
INSERT INTO report_dd_tab (dan_id, 
result_id,health_group,hypercholesterinemia, 
hypergikemia,weight_excess,obesity,hypodynamia, 
high_pressure,smoking,alcohol,high_risk_grade, 
diag_osn,stage_of_disease,data_pos,target_pos_id, 
vozrast,sex,date_creation,irrational_diet, 
narcotics ) 
( 
select dd.dan_id, 
dd.result_id, 
dd.health_group, 
dd.hypercholesterinemia, 
dd.hypergikemia, 
dd.weight_excess, 
dd.obesity, 
dd.hypodynamia, 
dd.high_pressure, 
dd.smoking, 
dd.alcohol, 
dd.high_risk_grade, 
t.diag_osn, 
diag.stage_of_disease, 
v.data_pos, 
v.target_pos_id , 
get_vozrast(d.date_born,':param1_2_:'), 
d.sex, 
dd.date_creation, 
dd.irrational_diet, 
dd.narcotics  
from dop_disp_bur_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id  
left join talon_tab t on t.dan_id=dd.dan_id 
left join visit_tab v on v.talon_id=t.talon_id and v.target_pos_id IN (10,11,12,13,14,15,16) 
left join full_doctor_tab f on f.full_doctor_id=dd.operator_id 
left join diagn_tab diag on diag.dan_id=dd.dan_id and diag.talon_id in (SELECT DISTINCT talon_id FROM visit_tab v WHERE v.data_pos BETWEEN dd.date_creation::date-'1 month'::interval AND dd.date_creation::date+'1 month'::interval AND v.target_pos_id IN (10,11,12,13,14,15,16)) 
where  ((date_part('year',':param1_2_:'::date) - date_part('year',d.date_born::date)) in ( 
  select f.a from generate_series(21,100,3) f(a)) ) 
and dd.date_creation between ':param1_1_:' and ':param1_2_:' 
and :param3_1_: 
and :param2_1_: 
and :param4_1_: 
AND dd.dd_stage = :stage_1_: 
and :prikreplen_1_: 
); 
 
CREATE INDEX "report_dd_tab_vozrast_idx" ON "report_dd_tab" 
  USING btree ("vozrast"); 
 
CREATE INDEX "report_dd_tab_pol_idx" ON "report_dd_tab" 
  USING btree ("sex");</Sql>
                </Query>
                <Query>
                  <Sql>z1(age1,age2,param_pol) select count(distinct id) 
from report_dan_tab 
where vozrast between age1 and age2 
param_pol</Sql>
                </Query>
                <Query>
                  <Sql>z2(age1,age2,param2) select count(distinct dan_id) 
from report_dd_tab 
where vozrast between age1 and age2 
and result_id is not null param2</Sql>
                </Query>
                <Query>
                  <Sql>z3(mkb1,mkb2,pol,param2) select count(distinct dan_id) 
from report_dd_tab 
where diag_osn between 'mkb1' and 'mkb2' 
and sex='pol' 
and target_pos_id in (12) 
and data_pos between ':param1_1_:' and ':param1_2_:' 
and result_id is not null 
param2</Sql>
                </Query>
                <Query>
                  <Sql>z4(mkb1,mkb2,pol,param2) select count(distinct dan_id) 
from report_dd_tab 
where diag_osn between 'mkb1' and 'mkb2' 
and sex='pol' 
and data_pos between date_creation::date + '1 day'::interval and date_creation::date + '6 month'::interval 
and result_id is not null 
param2</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param3" Caption="Врач" Type="select">
                  <Sql>select 'true','Все',0 union select 'diag.doctor_id='||full_doctor_id,full_fio,1 from full_doctor_tab  order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Дата запонения" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel='''||otdel||'''',nam_otdel,1 from otdel_tab  order by 3,2</Sql>
                </Parameter>
                <Parameter Name="prikreplen" Caption="Прикреплен" Type="select">
                  <Sql>select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param4" Caption="Участок" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab  order by 3,2</Sql>
                </Parameter>
                <Parameter Name="stage" Caption="Этап ДД" Type="select">
                  <Sql>SELECT 1,1 UNION SELECT 2,2;</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2026903000" Name="Сведения о результатах проведения диспансеризации" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2013\Сведения о результатах проведения диспансеризации.xls">
              <Queries>
                <Query>
                  <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
                </Query>
                <Query>
                  <Sql>report_clear SELECT ''; 
SELECT drop_if_exists('report_dd_tab'); 
SELECT drop_if_exists('report_dan_tab'); 
SELECT drop_if_exists('report_prik_tab');</Sql>
                </Query>
                <Query>
                  <Sql>report_init SELECT ''; 
SELECT drop_if_exists('report_dd_tab'); 
SELECT drop_if_exists('report_dan_tab'); 
SELECT drop_if_exists('report_prik_tab'); 
SELECT drop_if_exists('report_visit_tab'); 
 
CREATE TEMP TABLE report_dan_tab 
( 
cost NUMERIC, 
sex VARCHAR(1), 
mesto_work_id BIGINT, 
kod_vuz INTEGER , 
id BIGINT, 
code VARCHAR 
); 
 
INSERT INTO report_dan_tab (cost,sex,mesto_work_id,kod_vuz,id,code) 
( 
SELECT ok.cost, d.sex, d.mesto_work_id, d.kod_vuz, ok.id, cu.code 
FROM okaz_uslug_tab ok 
LEFT JOIN codifiers.sp_uslug_tab cu ON cu.id = ok.sp_uslug_id 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
WHERE (ok.date_okaz BETWEEN ':param1_1_:' AND ':param1_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
and (((date_part('year',':param1_1_:'::date) - date_part('year',d.date_born::date)) in ( 
  select f.a from generate_series(21,100,3) f(a)) ) ) 
and :param4_1_: 
); 
 
CREATE TEMP TABLE report_prik_tab 
( 
id BIGINT, 
sex VARCHAR(1), 
mesto_work_id BIGINT, 
kod_vuz INTEGER , 
date_born DATE 
); 
 
INSERT INTO report_prik_tab (id,sex,mesto_work_id,kod_vuz,date_born) 
( 
select d.dan_id, 
d.sex, 
d.mesto_work_id, 
d.kod_vuz, 
d.date_born 
from dan_tab d 
where  d.spolref::int4 in (select * from get_all_lpu_numbers()) 
and :param4_1_: 
); 
 
 
CREATE TEMP TABLE report_dd_tab 
( 
dan_id BIGINT, 
result_id BIGINT, 
health_group BIGINT, 
vozrast INTEGER, 
sex VARCHAR(1), 
date_creation DATE, 
mesto_work_id BIGINT, 
kod_vuz INTEGER 
); 
 
INSERT INTO report_dd_tab (dan_id, 
result_id,health_group, 
vozrast,sex,date_creation,mesto_work_id,kod_vuz ) 
( 
select dd.dan_id, 
dd.result_id, 
dd.health_group, 
get_vozrast(d.date_born,':param1_1_:'), 
d.sex, 
dd.date_creation, 
d.mesto_work_id, 
d.kod_vuz   
from dop_disp_bur_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id  
where  (((date_part('year',':param1_1_:'::date) - date_part('year',d.date_born::date)) in ( 
  select f.a from generate_series(21,100,3) f(a)) ) ) 
and dd.date_creation between ':param1_1_:' and ':param1_2_:' 
and :param4_1_: and d.dan_id is not null 
); 
 
CREATE TEMP TABLE report_visit_tab 
( 
id BIGINT, 
sex VARCHAR(1), 
mesto_work_id BIGINT, 
kod_vuz INTEGER , 
date_born DATE, 
data_pos DATE  
); 
 
INSERT INTO report_visit_tab (id,sex,mesto_work_id,kod_vuz,date_born,data_pos) 
( 
select d.dan_id, 
d.sex, 
d.mesto_work_id, 
d.kod_vuz, 
d.date_born, 
v.data_pos  
from talon_tab t 
left join visit_tab v on v.talon_id=v.talon_id 
left join dan_tab d on d.dan_id=t.dan_id 
where  d.spolref::int4 in (select * from get_all_lpu_numbers()) 
and v.target_pos_id=4 
and v.data_pos between date_trunc('year',':param1_1_:'::date)::date and ':param1_2_:' 
and :param4_1_: 
); 
 
 
CREATE INDEX "report_dan_tab_pol_idx" ON "report_dan_tab" 
  USING btree ("sex"); 
CREATE INDEX "report_prik_tab_pol_idx" ON "report_prik_tab" 
  USING btree ("sex"); 
CREATE INDEX "report_dd_tab_pol_idx" ON "report_dd_tab" 
  USING btree ("sex");</Sql>
                </Query>
                <Query>
                  <Sql>zapros1(pol,param) SELECT count(distinct id), sum(cost) as p1 
FROM report_dan_tab 
where sex='pol' 
and code::int4 in (063121, 063124,063127,063130, 063133, 063136, 063139, 063142, 063145, 063148, 063151, 063154, 063157, 063160, 063163, 063166, 063169, 063172, 063175, 063178, 063181, 063184, 063187, 063190, 063193, 063196, 063199,063221, 063224,063227,063230, 063233, 063236, 063239, 063242, 063245, 063248, 063251, 063254, 063257, 063260, 063263, 063266, 063269, 063272, 063275, 063278, 063281, 063284, 063287, 063290, 063293, 063296, 063299) 
param</Sql>
                </Query>
                <Query>
                  <Sql>zapros2(pol,param) SELECT count(distinct id), sum(cost) as p1 
FROM report_dan_tab 
where sex='pol' 
and code::int4 in (063301,063302,063303,063304,063305,063306,063307,063308,063309,063310,063311) 
param</Sql>
                </Query>
                <Query>
                  <Sql>zapros3(pol,param) select count(distinct id) 
from report_prik_tab 
where sex='pol' 
param</Sql>
                </Query>
                <Query>
                  <Sql>zapros4(pol,param) select count(distinct id) 
from report_prik_tab 
where sex='pol' 
and (((date_part('year',now()::date) - date_part('year',date_born::date)) in ( 
  select f.a from generate_series(21,100,3) f(a)) ) 
or (get_vozrast(date_born) in ( 
  select f.a from generate_series(21,100,3) f(a))  )) 
param</Sql>
                </Query>
                <Query>
                  <Sql>zapros5(pol,param) select count(distinct dan_id) 
from report_dd_tab 
where result_id = 500000 
param</Sql>
                </Query>
                <Query>
                  <Sql>zapros6(pol,grup,param) select count(distinct dan_id) 
from report_dd_tab 
where result_id is not null 
and health_group = grup 
param</Sql>
                </Query>
                <Query>
                  <Sql>zapros7(pol,param) select count(distinct id) 
from report_prik_tab 
where sex='pol' 
and  (get_vozrast(date_born) in ( 
  select f.a from generate_series(21,100,3) f(a))  ) 
param</Sql>
                </Query>
                <Query>
                  <Sql>zapros8(pol,param) select count(distinct id) 
from report_visit_tab 
where sex='pol' 
param</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата запонения" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param4" Caption="Участок" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab  order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2030103000" Name="Список направленных на 2ой этап" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2013\Список направленных на 2ой этап.xls">
              <Queries>
                <Query>
                  <Sql>z1 select '$id'::text, 
d.fio as p1, 
d.date_born as p2, 
d.fakt_adr as p3, 
d.address as p4, 
join_str(diag.diagn_osn) as p5, 
u.name as p6 
from dop_disp_bur_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id  
left join talon_tab t on t.dan_id=dd.dan_id 
left join visit_tab v on v.talon_id=t.talon_id and v.target_pos_id IN (10,11,12,13,14,15,16) 
left join diagn_tab diag on diag.talon_id=v.talon_id 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id  
where  dd.date_creation between ':param1_1_:' and ':param1_2_:' 
and :param2_1_: 
and dd.result_id=500000 
and d.dan_id is not null 
group by 2,3,4,5,7 
order by 2;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата создания карты" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param2" Caption="Прикреплен" Type="select">
                  <Sql>select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2030303000" Name="ДД Пациенты" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2013\ДД Пациенты.xls">
              <Queries>
                <Query>
                  <Sql>z1 SELECT d.dan_id AS dan_id, 
conv_to_null(str.socr||' ')||str.name  as ulname, 
a.sp_street_code AS strcode, '' as nullstr, 
CASE WHEN length(d.num_pol) = 16 THEN d.num_pol ELSE 
COALESCE(d.ser_pol||' ','')||COALESCE(ltrim(d.num_pol,'0'),'') end as ser_num_pol, 
case when length(d.pens)&lt;14 then '' else d.pens end as pens, 
d.fam, d.nam, d.mid, 
d.date_born, 
CASE WHEN d.sex = 'м' THEN 1 ELSE 2 END as sex, 
s.code as strcom,  
substr(d.street_id,14,4) as str_code, 
a.sp_street_code as street_id, 
a.house_number, 
a.building, 
a.flat_number as flat, 
a.text_address, 
d.kateg_lgot_id, 
d.sozstatus_id, 
m.name as mest_work, 
m.inn, 
m.kpp, 
d.dogovor_number, 
d.okvd, 
d.policy_type, 
substr(d.strcom_region_id,1,2) AS regs, 
CASE WHEN (sub.sp_otdel_id=9004 OR sub.sp_otdel_id=401) THEN '2308011' 
ELSE (SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1) END AS spolref, 
COALESCE(d.telephon,d.phone_mobile,d.work_phone,'')  as tel, 
sub.h_gr, 
sub.dd_res  
FROM 
 
(SELECT d.dan_id, date_creation, ok.operator_id, doc.sp_spec_doctor_id, 
doc.dan_id AS doc_dan_id, 
doc.sp_otdel_id , s.sp_health_group as h_gr, 
re.name as dd_res  
FROM dop_disp_bur_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.operator_id 
left join sp_health_group_tab s on s.sp_health_group_id=ok.health_group 
left join codifiers.dop_disp_result_tab re on re.id=ok.result_id 
WHERE (ok.date_creation BETWEEN ':period_1_:' AND ':period_2_:') 
AND ok.dan_id is not null 
AND d.strcom_region_id = get_our_region_code() --- Иногородний 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
and d.dan_id is not null 
) AS sub 
 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN address_tab a ON a.dan_id = sub.dan_id AND sp_addr_type_id = 1 
LEFT JOIN codifiers.strcom_tab s ON s.id = d.strcom_id 
LEFT JOIN codifiers.mest_work_tab m ON m.id = d.mesto_work_id 
LEFT JOIN codifiers.sp_street_tab str ON str.code = a.sp_street_code 
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,30,31</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="otdel_param" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'doc.sp_otdel_id='||'9004','Амбулатория Сокол',1 union select 'doc.sp_otdel_id!='||'9004','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="period" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2031303000" Name="Реестр по диспансеризации" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2013\Реестр по диспансеризации.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select distinct '$id'::text, 
d.fio as p1, 
d.date_born as p2, 
dd.date_creation  as p3, 
join_str(diag.diagn_osn) as p5 , 
u.name as p6, 
dr.name as p8, 
coalesce(d.ser_pol||' ','')||coalesce(d.num_pol,'') as p9, 
h.sp_health_group as p10  
from dop_disp_bur_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id  
left join talon_tab t on t.dan_id=dd.dan_id 
left join visit_tab v on v.talon_id=t.talon_id and v.target_pos_id IN (10,11,12,13,14,15,16) 
left join diagn_tab diag on diag.talon_id=v.talon_id 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id 
left join codifiers.dop_disp_result_tab dr on dr.id=dd.result_id 
left join full_doctor_tab f on f.full_doctor_id=dd.operator_id 
left join sp_health_group_tab h on h.sp_health_group_id=dd.health_group 
WHERE 
 dd.date_creation between ':param1_1_:' and ':param1_2_:' 
AND :param2_1_: 
and :param3_1_: 
and d.dan_id is not null 
group by 2,3,4,6,7,8,9 
ORDER BY 2;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param2" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2032103000" Name="Список пациентов с впервые выявленными заболеваниями" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Диспансеризация\Диспансеризация 2013\Список пациентов с впервые выявленными заболеваниями.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 select '$id'::text, 
d.fio as p1, 
d.date_born as p2, 
coalesce(d.ser_pol||' ','')||coalesce(d.num_pol,'') as p9, 
dd.date_creation as p3, 
join_str(diag.diagn_osn) as p5, 
u.name as p6, 
dr.name as p8  
from dop_disp_bur_tab dd 
left join dan_tab d on d.dan_id=dd.dan_id  
left join talon_tab t on t.dan_id=dd.dan_id 
left join visit_tab v on v.talon_id=t.talon_id and v.target_pos_id IN (10,11,12,13,14,15,16) 
left join diagn_tab diag on diag.talon_id=v.talon_id 
left join codifiers.uchactok_tab u on u.id=d.uchactok_id  
left join codifiers.dop_disp_result_tab dr on dr.id=dd.result_id 
left join full_doctor_tab f on f.full_doctor_id=dd.operator_id 
where  dd.date_creation between ':param1_1_:' and ':param1_2_:' 
and :param2_1_: and :uch_1_: and :prik_1_: and :param3_1_: and :param4_1_: 
and diag.stage_of_disease=2 
and d.dan_id is not null 
group by 2,3,4,5,7,8 
order by 2;</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="param4" Caption="Врач" Type="select">
                  <Sql>select 'true','Все',0 union select 'dd.operator_id='||full_doctor_id, full_fio,1 from full_doctor_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param1" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="param3" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2</Sql>
                </Parameter>
                <Parameter Name="prik" Caption="Прикреплен" Type="select">
                  <Sql>select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',0 union select 'true','Все',1 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="param2" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
                <Parameter Name="uch" Caption="Участок" Type="select">
                  <Sql>select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab  order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
          </Reports>
          <Folders />
        </Folder>
      </Folders>
    </Folder>
    <Folder Name="Отчёты для регистратуры">
      <Reports>
        <Report Id="2010303000" Name="Отчёт по записи пациентов" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчёты для регистратуры\Отчёт по записи пациентов.xls">
          <Queries>
            <Query>
              <Sql>zapros select dolg_doctor, /*sum (case when date_nazn is null then 0 else 1 end) as cnt_z, 
sum(case when data_pos is null then 0 else 1 end) as cnt_pat, */ 
SUM(f.mp) as mp, sum(f.tp) as tp, case when sum(f.mp)=0 then 0 else sum(f.tp)::float4*100/sum(f.mp) end as perc 
from ( 
select distinct td.programm_name, doc.dolg_doctor, td.date_nazn, /*v.data_pos,*/ td.dan_id as d1, /*t.dan_id as d2 , */ 
CASE WHEN td.mark_date_vnes_inf /*td.date_vnes_inf*/ is null THEN 0 ELSE 1 ENd as mp, 
CASE WHEN td.talon_date_vnes_inf /*td.talon_id*/ IS NULL THEN 0 ELSE 1 END as tp 
from talon_doctor_tab td 
LEFT JOIN full_doctor_tab doc ON doc.full_doctor_id = td.doctor_id 
LEFT JOIN talon_tab t ON t.dan_id = td.dan_id 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id AND 
	v.data_pos = td.date_nazn AND td.doctor_id = v.doctor_id 
	 
where :param3_1_: between ':param1_1_:' and ':param1_2_:' 
and (td.programm_name=':param2_1_:' or ( ':param2_1_:'='неизвестно' and td.programm_name is null) or ':param2_1_:'= 'Все') 
AND td.mark_operator_id IS NULL 
AND td.mark_date_vnes_inf IS NOT NULL 
order by 1,2,3,4) f 
group by 1 
1</Sql>
            </Query>
            <Query>
              <Sql>zapros1 select 'Всего:' , 
SUM(f.mp) as mp, sum(f.tp) as tp, case when sum(f.mp)=0 then 0 else sum(f.tp)::float4*100/sum(f.mp) end as perc 
from ( 
select distinct td.programm_name, td.doctor_id, td.date_nazn, td.dan_id as d1, 
CASE WHEN  td.date_vnes_inf is null THEN 0 ELSE 1 ENd as mp, 
CASE WHEN  td.talon_id IS NULL THEN 0 ELSE 1 END as tp 
from talon_doctor_tab td 
LEFT JOIN talon_tab t ON t.dan_id = td.dan_id 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id AND 
	v.data_pos = td.date_nazn AND td.doctor_id = v.doctor_id 
	 
where :param3_1_: between ':param1_1_:' and ':param1_2_:' 
and (td.programm_name=':param2_1_:' or ( ':param2_1_:'='неизвестно' and td.programm_name is null) or ':param2_1_:'= 'Все') 
order by 1,2,3,4) f</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="по" Type="select2">
              <Sql>td.date_nazn=Дате приема|td.date_vnes_inf::date=Дате внесения информации</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Программа, из которой производилась запись" Type="select">
              <Sql>select 'Все', 'Все' , 0 union select distinct case when programm_name is null then 'неизвестно' else  programm_name end, case when programm_name is null then 'неизвестно' else  programm_name end, 1  from talon_doctor_tab order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2010503000" Name="Список пациентов, обратившихся по предварительной записи" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчёты для регистратуры\Список пациентов, обратившихся по предварительной записи.xls">
          <Queries>
            <Query>
              <Sql>zapros select distinct 
'$id'::text, conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid) as fio, d.date_born, d.ser_pol, d.num_pol, 
d.address, d.telephon, doc.full_fio, td.date_nazn, td.time_nazn, 
to_char(td.date_vnes_inf::date,'DD.MM.YYYY') as  date_vnes_inf, 
/*date_part('hour',td.date_vnes_inf)||':'||date_part('minute',td.date_vnes_inf)*/ substr(td.date_vnes_inf::text,12,5) as time_zapis, case when programm_name is null then 'неизвестно' else  programm_name end as programm_name 
from talon_doctor_tab td 
LEFT JOIN dan_tab d ON td.dan_id = d.dan_id 
LEFT JOIN full_doctor_tab doc ON doc.full_doctor_id = td.doctor_id 
where /*td.talon_id is null*/ 
:param6_1_: and :param1_1_: between ':param4_1_:' and ':param4_2_:' 
and (doc.dolg_doctor_id = :param3_1_: or :param3_1_:=-1) and (doc.full_doctor_id = :param2_1_: or :param2_1_:=-1) 
and (td.programm_name=':param5_1_:' or ( ':param5_1_:'='неизвестно' and td.programm_name is null) or ':param5_1_:'= 'Все') 
AND td.mark_operator_id IS NULL 
AND td.mark_date_vnes_inf IS NOT NULL 
 
order by td.date_nazn, td.time_nazn</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Врач" Type="select">
              <Sql>select -1, 'Все врачи' union  SELECT f1.full_doctor_id, f1.full_fio FROM full_doctor_view f1 join full_doctor_tab f2 ON f1.full_doctor_id = f2.doctor_id where expiration_date&gt;=now() and dolg_doctor_id!=900 ORDER BY 1</Sql>
            </Parameter>
            <Parameter Name="param6" Caption="Выдан ли стат. талон" Type="select2">
              <Sql>td.talon_id is null=Нет|td.talon_id is not null=Да|true=Не учитывать</Sql>
            </Parameter>
            <Parameter Name="param4" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="по" Type="select2">
              <Sql>td.date_nazn=Дате приема|td.date_vnes_inf::date=Дате внесения информации</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Программа, из которой производилась запись" Type="select">
              <Sql>select 'Все', 'Все' , 0 union select distinct case when programm_name is null then 'неизвестно' else  programm_name end, case when programm_name is null then 'неизвестно' else  programm_name end, 1  from talon_doctor_tab order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Специальность" Type="select">
              <Sql>select -1, 'Все специалисты' union  select distinct dolg_doctor_id, dolg_doctor  FROM full_doctor_tab  ORDER BY 1</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2010703000" Name="Вызовы на дом" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчёты для регистратуры\Вызовы на дом.xls">
          <Queries>
            <Query>
              <Sql>zapros(par1,par2) select 
case when uchactok_id=0 then nam_otdel else uchactok end, otdel, uchactok_id as uch_id 
from ( 
select 0 as uchactok_id,'' as uchactok,0,otdel_tab.otdel,nam_otdel from otdel_tab 
join doctor_tab doc ON otdel_tab.otdel=doc.sp_otdel_id 
join uchactok_tab ON doc.doctor_id = uchactok_tab.doctor_id 
where otdel_tab.otdel between par1 and par2 
union 
select uchactok_id, uchactok, doc.doctor_id, o.otdel, nam_otdel 
from 
uchactok_tab 
join doctor_tab doc ON doc.doctor_id = uchactok_tab.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
where o.otdel between par1 and par2) q 
order by 2,3</Sql>
            </Query>
            <Query>
              <Sql>zapros_call select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and d.uchactok_id= :uch_id:</Sql>
            </Query>
            <Query>
              <Sql>zapros_call_after_15 select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and d.uchactok_id= :uch_id: 
and time_call&gt;='15:00:00'</Sql>
            </Query>
            <Query>
              <Sql>zapros_call_orvi select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
LEFT JOIN talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and d.uchactok_id= :uch_id: 
and v.mesto_obs ='Д' 
and v.data_pos&gt;=c.date_call 
and t.diag_osn='J06.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros_call_orvi2(age1,age2) select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
LEFT JOIN talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and d.uchactok_id= :uch_id: 
AND DATE_PART('year',AGE(date_call, date_born)) BETWEEN age1 AND age2 
and v.mesto_obs ='Д' 
and v.data_pos&gt;=c.date_call 
and t.diag_osn='J06.9'</Sql>
            </Query>
            <Query>
              <Sql>zapros_call_orvi3(par) select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
LEFT JOIN talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and v.mesto_obs ='Д' 
and v.data_pos&gt;=c.date_call 
and t.diag_osn='J06.9' 
and u.uchactok ilike '%par%'</Sql>
            </Query>
            <Query>
              <Sql>zapros_call_orvi4(age1,age2,par) select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
LEFT JOIN talon_tab t ON t.dan_id = d.dan_id 
LEFT JOIN visit_tab v ON v.talon_id = t.talon_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
AND DATE_PART('year',AGE(date_call, date_born)) BETWEEN age1 AND age2 
and v.mesto_obs ='Д' 
and v.data_pos&gt;=c.date_call 
and t.diag_osn='J06.9' 
and u.uchactok ilike '%par%'</Sql>
            </Query>
            <Query>
              <Sql>zapros_call2(age1,age2) select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and d.uchactok_id= :uch_id: 
and DATE_PART('year',AGE(date_call, date_born)) BETWEEN age1 AND age2</Sql>
            </Query>
            <Query>
              <Sql>zapros_call2_after_15(age1,age2) select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and d.uchactok_id= :uch_id: 
and time_call&gt;='15:00:00' 
AND DATE_PART('year',AGE(date_call, date_born)) BETWEEN age1 AND age2</Sql>
            </Query>
            <Query>
              <Sql>zapros_call3(age1,age2) select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and DATE_PART('year',AGE(date_call, date_born)) BETWEEN age1 AND age2</Sql>
            </Query>
            <Query>
              <Sql>zapros_call3_after_15(age1,age2) select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and time_call&gt;='15:00:00' 
AND DATE_PART('year',AGE(date_call, date_born)) BETWEEN age1 AND age2</Sql>
            </Query>
            <Query>
              <Sql>zapros_call4(par) select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and u.uchactok ilike '%par%'</Sql>
            </Query>
            <Query>
              <Sql>zapros_call4_after_15(par) select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and time_call&gt;='15:00:00' 
and u.uchactok ilike '%par%'</Sql>
            </Query>
            <Query>
              <Sql>zapros_call5(age1,age2,par) select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and u.uchactok ilike '%par%' 
AND DATE_PART('year',AGE(date_call, date_born)) BETWEEN age1 AND age2</Sql>
            </Query>
            <Query>
              <Sql>zapros_call5_after_15(age1,age2,par) select case when count(*)=0 then '' else count(*)::text end 
from calls_tab c 
LEFT JOIN dan_tab d ON d.dan_id = c.dan_id 
LEFT JOIN uchactok_tab u ON d.uchactok_id=u.uchactok_id 
where date_call between ':param1_1_:' and ':param1_2_:' 
and call_type_id=2 
and time_call&gt;='15:00:00' 
and u.uchactok ilike '%par%' 
AND DATE_PART('year',AGE(date_call, date_born)) BETWEEN age1 AND age2</Sql>
            </Query>
            <Query>
              <Sql>zapros_not_otdel(par1,par2,par3) select uchactok, uchactok_id as uch_id from uchactok_tab 
where uchactok_id not in ( 
select 
uchactok_id 
from ( 
select 0 as uchactok_id,'' as uchactok,0,otdel_tab.otdel,nam_otdel from otdel_tab 
join doctor_tab doc ON otdel_tab.otdel=doc.sp_otdel_id 
join uchactok_tab ON doc.doctor_id = uchactok_tab.doctor_id 
where otdel_tab.otdel between par1 and par2 
union 
select uchactok_id, uchactok, doc.doctor_id, o.otdel, nam_otdel 
from 
uchactok_tab 
join doctor_tab doc ON doc.doctor_id = uchactok_tab.doctor_id 
left join otdel_tab o ON o.otdel=doc.sp_otdel_id 
where o.otdel between par1 and par2) q ) 
and uchactok ilike '%par3%' 
order by 1,2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2010903000" Name="Социальная, половозрастная структура населения" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчёты для регистратуры\Социальная, половозрастная структура населения.xls">
          <Queries>
            <Query>
              <Sql>cur_date select to_char(now(),'dd.mm.yyyy')</Sql>
            </Query>
            <Query>
              <Sql>lpuname select value from settings_tab where name = 'LPU'</Sql>
            </Query>
            <Query>
              <Sql>z_otd select distinct case when ':param2_1_:' = 'true' then 'Все отделения'::text else (select nam_otdel 
from otdel_tab f 
where f.otdel::text=':param2_1_:') end</Sql>
            </Query>
            <Query>
              <Sql>zapros1(sx,soz_st,_inv,mw,trd,_strcom,_str_id) select count(distinct d.dan_id) from dan_tab d 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
LEFT JOIN doctor_tab doc ON doc.doctor_id = u.doctor_id 
LEFT JOIN otdel_tab o ON o.otdel = doc.sp_otdel_id 
LEFT JOIN strcom_tab s ON d.strcom_id=s.strcom_id 
where (':param2_1_:'='true' or o.otdel::text=':param2_1_:') 
and (d.sex='sx' or ('sx'='xxx' and d.sex is not null)) 
and life&lt;&gt;1 
and (d.sozstatus_id=soz_st or 'soz_st'='-1') 
and (d.inval_id = _inv or '_inv'='-1' or ('_inv'='-2' and d.inval_id is not null)) 
and (('mw'='+' and (d.mest_work is not null or d.metka_work='+')) or ('mw'='-' and (d.mest_work is null or d.metka_work='-')) or 'mw'='x') 
and ('trd'='0' or ('trd'='1' and d.sex='м' and  DATE_PART('year',AGE(now(), date_born)) BETWEEN 18 and 59) 
   or ('trd'='1' and d.sex='ж' and  DATE_PART('year',AGE(now(), date_born)) BETWEEN 18 and 54)) 
and ('_strcom'='x' or ('_strcom'='y' and d.data_end&gt;=now())) 
--and ('_str_id'='-1' or d.strcom_id =_str_id) 
and ('_str_id'='-1' or s.strcom ilike '_str_id%')</Sql>
            </Query>
            <Query>
              <Sql>zapros2(sx,age1,age2) select count(distinct d.dan_id) from dan_tab d 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
LEFT JOIN doctor_tab doc ON doc.doctor_id = u.doctor_id 
LEFT JOIN otdel_tab o ON o.otdel = doc.sp_otdel_id 
where (':param2_1_:'='true' or o.otdel::text=':param2_1_:') 
and (d.sex='sx' or ('sx'='xxx' and d.sex is not null)) 
and life&lt;&gt;1 
and DATE_PART('year',AGE(now(), date_born)) BETWEEN age1 and age2</Sql>
            </Query>
            <Query>
              <Sql>zapros3(sx) select count(distinct d.dan_id) from dan_tab d 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
LEFT JOIN doctor_tab doc ON doc.doctor_id = u.doctor_id 
LEFT JOIN otdel_tab o ON o.otdel = doc.sp_otdel_id 
where (':param2_1_:'='true' or o.otdel::text=':param2_1_:') 
and (d.sex='sx' or ('sx'='xxx' and d.sex is not null)) 
and life&lt;&gt;1 and d.sozstatus_id in (4,5)</Sql>
            </Query>
            <Query>
              <Sql>zapros4(sx) select count(distinct d.dan_id) from dan_tab d 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
LEFT JOIN doctor_tab doc ON doc.doctor_id = u.doctor_id 
LEFT JOIN otdel_tab o ON o.otdel = doc.sp_otdel_id 
where (':param2_1_:'='true' or o.otdel::text=':param2_1_:') 
and (d.sex='sx' or ('sx'='xxx' and d.sex is not null)) 
and life&lt;&gt;1 
and d.kat=13</Sql>
            </Query>
            <Query>
              <Sql>zapros5(klg) select count(distinct d.dan_id) from dan_tab d 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
LEFT JOIN doctor_tab doc ON doc.doctor_id = u.doctor_id 
LEFT JOIN otdel_tab o ON o.otdel = doc.sp_otdel_id 
where (':param2_1_:'='true' or o.otdel::text=':param2_1_:') 
and life&lt;&gt;1 
and d.kateg_lgot_id =klg</Sql>
            </Query>
            <Query>
              <Sql>zapros6(lgg) select count(distinct d.dan_id) from dan_tab d 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
LEFT JOIN doctor_tab doc ON doc.doctor_id = u.doctor_id 
LEFT JOIN otdel_tab o ON o.otdel = doc.sp_otdel_id 
LEFT JOIN (select * from 
(SELECT distinct f.dan_id, split_part(trim(f.floga), ',', t.a) as lgota FROm fed_lgota_tab f, generate_series(1,20) t(a) 
WHERE f.dan_id is not null  ) as q where lgota!='' ) f ON f.dan_id = d.dan_id 
where (':param2_1_:'='true' or o.otdel::text=':param2_1_:') 
and life&lt;&gt;1 
and f.lgota in ('lgg')</Sql>
            </Query>
            <Query>
              <Sql>zapros7 select count(distinct d.dan_id) from dan_tab d 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
LEFT JOIN doctor_tab doc ON doc.doctor_id = u.doctor_id 
LEFT JOIN otdel_tab o ON o.otdel = doc.sp_otdel_id 
where (':param2_1_:'='true' or o.otdel::text=':param2_1_:') 
and life&lt;&gt;1 
and d.kat=16</Sql>
            </Query>
            <Query>
              <Sql>zapros8(par) select count(distinct d.dan_id) from dan_tab d 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
LEFT JOIN doctor_tab doc ON doc.doctor_id = u.doctor_id 
LEFT JOIN otdel_tab o ON o.otdel = doc.sp_otdel_id 
where (':param2_1_:'='true' or o.otdel::text=':param2_1_:') 
and life&lt;&gt;1 
and ((:par:=0 and d.sex='м' and DATE_PART('year',AGE(now(), date_born)) BETWEEN 18 and 60) or (:par:=1 and d.sex='ж' and DATE_PART('year',AGE(now(), date_born)) BETWEEN 18 and 55))</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Отделение" Type="select">
              <Sql>SELECT 'true'::text, 'Все отделения'::text, 0  UNION  SELECT o.otdel::text,o.nam_otdel, 1 FROm otdel_tab o  ORDER BY 3,1,2 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2011103000" Name="Дети по полу и возрасту" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчёты для регистратуры\Дети по полу и возрасту.xls">
          <Queries>
            <Query>
              <Sql>cur_date select to_char(now(),'dd.mm.yyyy')</Sql>
            </Query>
            <Query>
              <Sql>lpuname select value from settings_tab where name = 'LPU'</Sql>
            </Query>
            <Query>
              <Sql>z_otd select distinct case when ':param2_1_:' = 'true' then 'Все отделения'::text else (select nam_otdel 
from otdel_tab f 
where f.otdel::text=':param2_1_:') end</Sql>
            </Query>
            <Query>
              <Sql>zapros1(sx,age1,age2) select count(distinct d.dan_id) from dan_tab d 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
LEFT JOIN doctor_tab doc ON doc.doctor_id = u.doctor_id 
LEFT JOIN otdel_tab o ON o.otdel = doc.sp_otdel_id 
where (':param2_1_:'='true' or o.otdel::text=':param2_1_:') 
and (d.sex='sx' or ('sx'='xxx' and d.sex is not null)) 
and life&lt;&gt;1 
and  DATE_PART('year',AGE(now(), date_born))=0 
and  DATE_PART('month',AGE(now(), date_born)) BETWEEN age1 and age2</Sql>
            </Query>
            <Query>
              <Sql>zapros2(sx,age1,age2,_inv) select count(distinct d.dan_id) from dan_tab d 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
LEFT JOIN doctor_tab doc ON doc.doctor_id = u.doctor_id 
LEFT JOIN otdel_tab o ON o.otdel = doc.sp_otdel_id 
where (':param2_1_:'='true' or o.otdel::text=':param2_1_:') 
and (d.sex='sx' or ('sx'='xxx' and d.sex is not null)) 
and life&lt;&gt;1 
and (d.inval_id = _inv or '_inv'='-1' or ('_inv'='-2' and d.inval_id is not null)) 
and  DATE_PART('year',AGE(now(), date_born)) BETWEEN age1 and age2</Sql>
            </Query>
            <Query>
              <Sql>zapros3(_strcom) select count(distinct d.dan_id) from dan_tab d 
LEFT JOIN uchactok_tab u ON u.uchactok_id = d.uchactok_id 
LEFT JOIN doctor_tab doc ON doc.doctor_id = u.doctor_id 
LEFT JOIN otdel_tab o ON o.otdel = doc.sp_otdel_id 
LEFT JOIN strcom_tab s ON d.strcom_id=s.strcom_id 
where (':param2_1_:'='true' or o.otdel::text=':param2_1_:') 
and life&lt;&gt;1 
and ('_strcom'='-1' or s.strcom ilike '_strcom%') 
and  DATE_PART('year',AGE(now(), date_born)) BETWEEN 0 and 17 
and  d.data_end&gt;=now()</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param2" Caption="Отделение" Type="select">
              <Sql>SELECT 'true'::text, 'Все отделения'::text, 0  UNION  SELECT o.otdel::text,o.nam_otdel, 1 FROm otdel_tab o  ORDER BY 3,1,2 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2015903000" Name="Отчёт по предварительной записи" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчёты для регистратуры\Отчёт по предварительной записи.xls">
          <Queries>
            <Query>
              <Sql>zapros select distinct 
'$id'::text, d.fio, d.date_born, d.ser_pol, d.num_pol, 
d.address, d.telephon, doc.full_fio, td.date_nazn, td.time_nazn, 
/*to_char(td.date_vnes_inf::date,'DD.MM.YYYY') */ 
td.mark_date_vnes_inf::date as  date_vnes_inf, du.fio||' ('||u.id||')' as operator, 
substr(td.date_vnes_inf::text,12,5) as time_zapis, case when mark_programm_name is null then 'неизвестно' else  mark_programm_name end as programm_name 
from talon_doctor_tab td 
LEFT JOIN dan_tab d ON td.dan_id = d.dan_id 
LEFT JOIN full_doctor_tab doc ON doc.full_doctor_id = td.doctor_id 
LEFT JOIN users_tab u ON u.id = td.mark_operator_id 
LEFT JOIN dan_tab du ON du.dan_id = u.dan_id 
where td.mark_date_vnes_inf::date between ':param1_1_:' and ':param1_2_:' 
and (td.mark_programm_name=':param5_1_:' or ( ':param5_1_:'='неизвестно' and td.programm_name is null) or ':param5_1_:'= 'Все') 
AND :param_oper_1_: 
 
order by td.date_nazn, td.time_nazn</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата внесения информации" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param_oper" Caption="Оператор" Type="select">
              <Sql>select ' true', 'Все операторы', 0 union select ' td.mark_operator_id is null', 'Неизвестно', 1 union  select ' td.mark_operator_id='||u.id, d.fio||' ('||u.id||')', 3 from users_tab u join dan_tab d ON d.dan_id = u.dan_id where u.id in (select distinct mark_operator_id from talon_doctor_tab) order by 3,2</Sql>
            </Parameter>
            <Parameter Name="param5" Caption="Программа, из которой производилась запись" Type="select">
              <Sql>select q1, trim(q2) from ( select 'Все' as q1, 'Все' as q2, 0 as q3 union select distinct case when mark_programm_name is null then 'неизвестно' else  mark_programm_name end,  case when mark_programm_name is null then ' неизвестно' else  mark_programm_name end, 1   from talon_doctor_tab order by 3,2) q</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2016103000" Name="Очередь к врачу" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчёты для регистратуры\Очередь к врачу.xls">
          <Queries>
            <Query>
              <Sql>zapros1 SELECT t.time_nazn, d.fio FROM talon_doctor_tab t 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
WHERE t.date_nazn = ':data_1_:' AND :doctor_1_: 
and :param1_1_: 
ORDER BY t.time_nazn;</Sql>
            </Query>
            <Query>
              <Sql>zapros2 SELECT case when ':doctor_1_:'='true' then 'Все' else (select distinct f.full_fio FROM talon_doctor_tab t 
LEFT JOIN full_doctor_tab f ON f.full_doctor_id = t.doctor_id  WHERE :doctor_1_:) end ;</Sql>
            </Query>
            <Query>
              <Sql>zapros3 select case when  ':param1_1_:'='true' then 'Все' else (select distinct name FROM talon_doctor_tab t 
LEFT JOIN codifiers.cabinet_tab f ON f.id = t.cabinet_id where :param1_1_:) end ;</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="data" Caption="дата" Type="date">
              <Sql />
            </Parameter>
            <Parameter Name="doctor" Caption="Доктор" Type="select">
              <Sql>select 'true','Все',0 union  SELECT 't.doctor_id ='||full_doctor_id, full_fio,1 FROM full_doctor_view ORDER BY 3,2;</Sql>
            </Parameter>
            <Parameter Name="param1" Caption="Кабинет" Type="select">
              <Sql>select 'true','Все',0 union  select 't.cabinet_id='||id, name,1 from codifiers.cabinet_tab order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2016503001" Name="направления в семашко" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчёты для регистратуры\направления в семашко.xls">
          <Queries>
            <Query>
              <Sql>fio_pac SELECT conv_to_null(d.fam)||' '||conv_to_null(d.nam)||' '||conv_to_null(d.mid), d.date_born 
from public.naprav_tab n 
left join public.dan_tab d on d.dan_id=n.dan_id 
where (n.sp_naprav_lpu_id=32001) and n.naprav_number= ':param5_1_:'</Sql>
            </Query>
            <Query>
              <Sql>mesto_zh SELECT d.address 
from public.naprav_tab n 
left join public.dan_tab d on d.dan_id=n.dan_id 
where (n.sp_naprav_lpu_id=32001) and n.naprav_number= ':param5_1_:'</Sql>
            </Query>
            <Query>
              <Sql>diagnoz SELECT sp_mkb_code 
from public.naprav_tab 
where (sp_naprav_lpu_id=32001) and naprav_number= ':param5_1_:'</Sql>
            </Query>
            <Query>
              <Sql>polis SELECT d.ser_pol,d.num_pol 
from public.naprav_tab n 
left join public.dan_tab d on d.dan_id=n.dan_id 
where (n.sp_naprav_lpu_id=32001) and n.naprav_number= ':param5_1_:'</Sql>
            </Query>
            <Query>
              <Sql>specialnost SELECT spec.name 
from public.naprav_tab n 
LEFT JOIN sp_spec_doctor_tab spec ON n.spec_doctor_id =spec.id 
where (n.sp_naprav_lpu_id=32001) and n.naprav_number= ':param5_1_:'</Sql>
            </Query>
            <Query>
              <Sql>zapros SELECT n.naprav_number 
from public.naprav_tab n 
where (n.sp_naprav_lpu_id=32001) and n.naprav_number= ':param5_1_:'</Sql>
            </Query>
            <Query>
              <Sql>vrach SELECT doc.fio 
from public.naprav_tab n 
left join public.full_doctor_view doc on doc.full_doctor_id=n.doctor_id 
where (n.sp_naprav_lpu_id=32001) and n.naprav_number= ':param5_1_:'</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param5" Caption="номер направления" Type="text">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2020503000" Name="Кол-во зарегистрированных пациентов по регистраторам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчёты для регистратуры\Кол-во зарегистрированных пациентов по регистраторам.xls">
          <Queries>
            <Query>
              <Sql>z1 select '$id'::text,u.full_fio, case when d.prikreplen=1 then 'Прикреплен' else 'Не прикреплен' end as prik, 
count(distinct d.dan_id)  as count 
from dan_tab d 
left join users_view u on u.user_id=d.operator_id 
where u.user_id&gt;0 and d.date_vnes_inf between date(':param1_1_:') and date (':param1_2_:') 
and :param2_1_: and :param3_1_: 
group by 1,2,u.fam,d.prikreplen 
order by u.fam</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="Прикреплен" Type="select">
              <Sql>select 'true','ВСЕ',0 union select 'd.prikreplen=1','ДА',1 union select 'd.prikreplen!=1','НЕТ',2 group by 3,2</Sql>
            </Parameter>
            <Parameter Name="param3" Caption="Регистратор" Type="select">
              <Sql>select 'true','ВСЕ',0 union (select 'u.user_id='||user_id, full_fio,1 from users_view u  left join users_tab ut on ut.id=u.user_id  where ut.expiration_date&gt;now()) order by 3,2 </Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2020703000" Name="Список зарегестрированных пациентов по регистраторам" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчёты для регистратуры\Список зарегестрированных пациентов по регистраторам.xls">
          <Queries>
            <Query>
              <Sql>z1 select '$id'::text,u.full_fio, d.fio, d.date_born, 
conv_to_null(d.telephon)||' '||conv_to_null(d.phone_mobile) as tel, d.address, d.fakt_adr, 
ut.uchactok, conv_to_null(d.num_pol)||' '||conv_to_null(d.ser_pol) as polis, 
s.strcom, 
conv_to_null(d.serdoc)||' '||conv_to_null(d.numdoc)||' '||conv_to_null(d.kem_output)||' '||conv_to_null(d.mest_born) as doc 
from dan_tab d 
left join users_view u on u.user_id=d.operator_id 
left join uchactok_tab ut on ut.uchactok_id=d.uchactok_id 
left join strcom_tab s on s.strcom_id=d.strcom_id 
where u.user_id&gt;0 and d.date_vnes_inf between date(':param1_1_:') and date (':param1_2_:')  
and :param2_1_: and :param3_1_: 
group by 2,3,4,d.telephon,d.phone_mobile,6,7,8, d.num_pol,d.ser_pol,10, 
d.serdoc,d.numdoc,d.kem_output,d.mest_born 
order by 3</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата внесения" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param3" Caption="Регистратор" Type="select">
              <Sql>select 'true','ВСЕ',0 union (select 'u.user_id='||user_id, full_fio,1 from users_view u  left join users_tab ut on ut.id=u.user_id  where ut.expiration_date&gt;now()) order by 3,2 </Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Прикреплен" Type="select">
              <Sql>select 'true','ВСЕ',0 union select 'd.prikreplen=1','ДА',1 union select 'd.prikreplen!=1','НЕТ',2 group by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Служебные">
      <Reports>
        <Report Id="2013503000" Name="Отчет по отсутствующим в СРЗ (не запускать, используется в специальном модуле)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Служебные\Отчет по отсутствующим в СРЗ (не запускать, используется в специальном модуле).xls">
          <Queries>
            <Query>
              <Sql>zapros1 :main_zapros:</Sql>
            </Query>
          </Queries>
          <Parameters />
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="ФОМС">
      <Reports>
        <Report Id="2020903000" Name="Иногородние Пациенты" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\ФОМС\Иногородние Пациенты.xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'I'||get_lpu_number()::text</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT substr(d.strcom_region_id,1,2) AS regs, 
d.dan_id, 
conv_to_null(str.socr||' ')||str.name  as ulname, 
a.sp_street_code AS strcode, 
'' as nullstr, 
CASE WHEN length(d.num_pol) = 16 THEN d.num_pol ELSE COALESCE(d.ser_pol||' ','')||COALESCE(d.num_pol,'') end as ser_num_pol, 
case when length(d.pens)&lt;14 then '' else d.pens end as pens, 
d.fam, 
d.nam, 
d.mid, 
d.date_born, 
CASE WHEN d.sex = 'м' THEN 1 ELSE 2 END as sex, 
s.code as strcom,  
substr(d.street_id,14,4) as str_code, 
a.sp_street_code as street_id, 
a.house_number, 
a.building, 
a.flat_number as flat, 
a.text_address, 
d.kateg_lgot_id, 
d.sozstatus_id, 
m.name as mest_work, 
m.inn, 
m.kpp, 
d.dogovor_number, 
d.okvd, 
d.policy_type,  
CASE WHEN (sub.sp_otdel_id=9004 OR sub.sp_otdel_id=401) THEN '2308011' 
ELSE (SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1) END AS spolref, 
date_part('month',':period_1_:'::date) as nums, 
(date_trunc('month',':period_1_:'::date) + '2 months'::interval  - '1 day'::interval)::date as data_s, 
CASE WHEN (date_part('month',age(':period_2_:'::timestamp, d.date_born::timestamp))&lt;1 
		and get_vozrast(d.date_born,':period_2_:')&lt;1) 
		THEN 1 ELSE 0 END AS novor, 
CASE WHEN d.vid_doc_id=1 THEN 14  
	WHEN d.vid_doc_id=5 THEN 2 ELSE 3 END AS c_doc, 
(SELECT value FROM settings_tab WHERE name='OGRN' LIMIT 1) AS q_ogrn, 
d.strcom_id AS q_vcode, 
a.raions_id AS rn, 
a.sp_street_code as np,  
s.name AS q_name, 
k.name AS nnp, 
conv_to_null(d.serdoc)||' '||conv_to_null(d.numdoc) as sn_pasp, 
d.sozstatus_id AS sp, '' AS nullstr, 
sum(sub.cost) AS cena 
 
FROM 
 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, 
doc.dan_id AS doc_dan_id, 
case when length(inference_diagnosis)=4 then substr(inference_diagnosis,1,3) else inference_diagnosis end AS diagn_id, doc.sp_otdel_id, ok.result_code, kol_vo 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
WHERE (ok.reestr_date BETWEEN ':period_1_:' AND ':period_2_:' ) 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
and ok.sp_kind_paid_id=0 
AND d.strcom_region_id != get_our_region_code() --- Иногородний 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub 
 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN address_tab a ON a.dan_id = sub.dan_id AND sp_addr_type_id = 1 
LEFT JOIN codifiers.strcom_tab s ON s.id = d.strcom_id 
LEFT JOIN codifiers.mest_work_tab m ON m.id = d.mesto_work_id 
LEFT JOIN codifiers.sp_street_tab str ON str.code = a.sp_street_code 
LEFT JOIN codifiers.sp_kladr_tab k ON rpad(substring(a.sp_street_code for 8),13,'0') = k.code 
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select 'doc.sp_otdel_id='||'9004','Амбулатория Сокол',1 union select 'doc.sp_otdel_id!='||'9004','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2021303000" Name="Иногородние Услуги" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\ФОМС\Иногородние Услуги.xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'C'||get_lpu_number()::text</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT DISTINCT 
'$id'::text, 
d.dan_id,  
CASE WHEN length(d.num_pol) = 16 THEN d.num_pol ELSE COALESCE(d.ser_pol||' ','')||COALESCE(d.num_pol,'') end as ser_num_pol, 
case when length(d.pens)&lt;14 then '' else d.pens end as pens, 
CASE WHEN (sub.sp_otdel_id='9004' or sub.sp_otdel_id='401') THEN '2308011' ELSE 
(SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1) END AS spolref, 
0 as god, 
0 as mm, 
NULL AS srz_mcod, 
sub.diagn_id AS ds, 
sub.date_okaz AS d_u, 
cu.code AS cod, 
sub.sp_uslug_id, 
sub.kol_vo AS kol_vo_usl, 
o.code AS otdel, 
NULL AS tds,  --TODO: сейчас пустое, нужно ли вообще? 
'' AS ds2, -- TODO: Пока будет пустое 
sub.result_code AS be, 
sub.doctor_id AS tn1, 
case when d.pens='--' then '' else d.pens end AS vrss, 
sub.sp_spec_doctor_id AS post, 
sub.cost AS cena, 
sub.prvs as prvs, 
  sub.profil as profil, 
case when sub.sp_otdel_id=303001 /*дневной стационар*/ then 1::text else '' end as ig  
FROM 
 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, doc.dan_id AS doc_dan_id, 
case when length(inference_diagnosis)=4 then substr(inference_diagnosis,1,3) else inference_diagnosis end AS diagn_id, doc.sp_otdel_id, ok.result_code, kol_vo, 
ds.xprvs AS prvs, 
 ds.xprofil as profil 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
LEFT JOIN codifiers.doctor_spec_tab ds ON doc.sp_spec_doctor_id=ds.id 
WHERE (ok.reestr_date BETWEEN ':period_1_:' AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
and ok.sp_kind_paid_id=0 
AND d.strcom_region_id != get_our_region_code() 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN dan_tab dd ON dd.dan_id = sub.doc_dan_id 
LEFT JOIN codifiers.otdel_tab o ON o.id  = sub.sp_otdel_id 
LEFT JOIN codifiers.sp_uslug_tab cu ON cu.id = sub.sp_uslug_id</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select '(doc.sp_otdel_id='||'9004)','Амбулатория Сокол',1 union select '(doc.sp_otdel_id!='||'9004)','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2022503000" Name="ОМС Пациенты" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\ФОМС\ОМС Пациенты.xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'P'||get_lpu_number()::text</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT d.dan_id AS dan_id, 
conv_to_null(str.socr||' ')||str.name  as ulname, 
a.sp_street_code AS strcode, '' as nullstr, 
CASE WHEN length(d.num_pol) = 16 THEN d.num_pol 
ELSE COALESCE(d.ser_pol||' ','')||COALESCE(d.num_pol,'') end as ser_num_pol, 
case when length(d.pens)&lt;14 then '' else d.pens end as pens, 
d.fam, d.nam, d.mid, 
d.date_born, 
CASE WHEN d.sex = 'м' THEN 1 ELSE 2 END as sex, 
CASE   WHEN s.code = '03101'  THEN 'G1' 
	WHEN s.code = '03102'  THEN 'R2' 
	WHEN s.code = '03103'  THEN 'R1' 
ELSE s.code END as strcom,  
substr(d.street_id,14,4) as str_code, 
a.sp_street_code as street_id, 
a.house_number, 
a.building, 
a.flat_number as flat, 
a.text_address, 
d.kateg_lgot_id, 
d.sozstatus_id, 
m.name as mest_work, 
m.inn, 
m.kpp, 
d.dogovor_number, 
d.okvd, 
d.policy_type, 
substr(d.strcom_region_id,1,2) AS regs, 
CASE WHEN (sub.sp_otdel_id=9004 OR sub.sp_otdel_id=401) THEN '2308011' 
ELSE (SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1) END AS spolref, 
sum(sub.cost) AS cena, 
COALESCE(d.telephon,d.phone_mobile,d.work_phone,'')  as tel 
FROM 
 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, doc.dan_id AS doc_dan_id, 
case when length(inference_diagnosis)=4 then substr(inference_diagnosis,1,3) else inference_diagnosis end AS diagn_id, doc.sp_otdel_id, ok.result_code, kol_vo 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
WHERE (ok.reestr_date BETWEEN ':period_1_:' AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id = get_our_region_code() --- Иногородний 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub 
 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN address_tab a ON a.dan_id = sub.dan_id AND sp_addr_type_id = 1 
LEFT JOIN codifiers.strcom_tab s ON s.id = d.strcom_id 
LEFT JOIN codifiers.mest_work_tab m ON m.id = d.mesto_work_id 
LEFT JOIN codifiers.sp_street_tab str ON str.code = a.sp_street_code 
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,30</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select 'doc.sp_otdel_id='||'9004','Амбулатория Сокол',1 union select 'doc.sp_otdel_id!='||'9004','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2023103000" Name="ОМС Услуги" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\ФОМС\ОМС Услуги.xls">
          <Queries>
            <Query>
              <Sql>filename SELECT 'S'||get_lpu_number()::text</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT DISTINCT 
'$id'::text, 
d.dan_id,  
CASE WHEN length(d.num_pol) = 16 THEN d.num_pol ELSE COALESCE(d.ser_pol||' ','')||COALESCE(d.num_pol,'') end as ser_num_pol, 
case when length(d.pens)&lt;14 then '' else d.pens end as pens, 
CASE WHEN (sub.sp_otdel_id='9004' or sub.sp_otdel_id='401') THEN '2308011' ELSE 
(SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1) END AS spolref, 
0 as god, 
0 as mm, 
NULL AS srz_mcod, 
sub.diagn_id AS ds, 
sub.date_okaz AS d_u, 
cu.code AS cod, 
sub.sp_uslug_id, 
sub.kol_vo AS kol_vo_usl, 
o.code AS otdel, 
NULL AS tds,  --TODO: сейчас пустое, нужно ли вообще? 
'' AS ds2, -- TODO: Пока будет пустое 
sub.result_code AS be, 
sub.doctor_id::VARCHAR AS tn1, 
dd.pens AS vrss, 
sub.sp_spec_doctor_id AS post, 
sub.cost AS cena , 
sub.prvs as prvs, 
sub.profil as profil , 
sub.ok_result_code as ishod  
FROM 
 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, doc.dan_id AS doc_dan_id, 
case when length(inference_diagnosis)=4 then substr(inference_diagnosis,1,3) else inference_diagnosis end AS diagn_id, doc.sp_otdel_id, ok.result_code, kol_vo, 
ds.xprvs AS prvs, 
 ds.xprofil as profil , ok.result_code as ok_result_code  
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
LEFT JOIN codifiers.doctor_spec_tab ds ON doc.sp_spec_doctor_id=ds.id 
WHERE (ok.reestr_date BETWEEN ':period_1_:' AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id = get_our_region_code() 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN dan_tab dd ON dd.dan_id = sub.doc_dan_id 
LEFT JOIN codifiers.otdel_tab o ON o.id  = sub.sp_otdel_id 
LEFT JOIN codifiers.sp_uslug_tab cu ON cu.id = sub.sp_uslug_id</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union  select '(doc.sp_otdel_id='||'9004)','Амбулатория Сокол',1 union select '(doc.sp_otdel_id!='||'9004)','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name || ' ' || code,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2026503000" Name="Иногородние печатная форма" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\ФОМС\Иногородние печатная форма.xls">
          <Queries>
            <Query>
              <Sql>lpu_address select value from settings_tab where name='ADDRESS'</Sql>
            </Query>
            <Query>
              <Sql>lpu_name select value from settings_tab where name='LPU'</Sql>
            </Query>
            <Query>
              <Sql>zapros1 SELECT sub1.fio, sub1.strcom, sub1.sn_pol, sub1.date_born, sub1.strcom, sub1.address, 
''''||array_to_string(array_agg(sub1.code),E'&amp;#10;','*') AS usl_codes, 
array_to_string(array_agg(sub1.str_date),E'&amp;#10;','*') AS usl_dates, 
array_to_string(array_agg(sub1.str_cost),E'&amp;#10;','0.00') AS prices, 
sum(sub1.cost) AS total_price, 
array_to_string(array_agg(sub1.str_kol),'&amp;#10;','*') AS total_q, 
array_to_string(array_agg(sub1.diagn_id),'&amp;#10;','*') AS diagnoses, 
count(sub1.*) AS total_count FROM 
(SELECT  d.fio, d.dan_id, 
s.name AS strcom, 
CASE WHEN length(num_pol)=16 THEN d.num_pol ELSE COALESCE(d.ser_pol||' ','')||COALESCE(d.num_pol,'') END AS sn_pol, 
to_char(d.date_born,'dd/MM/yyyy') as date_born,  
d.address, 
u.code, to_char(sub.date_okaz,'dd/MM/yyyy') AS str_date, LTRIM(TO_CHAR(sub.cost,'99999999.99')) AS str_cost, 
sub.kol_vo::varchar AS str_kol, sub.cost, 
sub.diagn_id 
FROM 
 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, 
doc.dan_id AS doc_dan_id, 
case when length(inference_diagnosis)=4 then substr(inference_diagnosis,1,3) else inference_diagnosis end AS diagn_id, 
doc.sp_otdel_id, ok.result_code, kol_vo 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
WHERE (ok.reestr_date BETWEEN ':period_1_:' AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
and ok.sp_kind_paid_id=0 
AND d.strcom_region_id != get_our_region_code() 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub 
 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN sp_uslug_tab u ON u.id = sub.sp_uslug_id 
LEFT JOIN codifiers.strcom_tab s ON s.id = d.strcom_id 
ORDER BY fio,sub.date_okaz ) AS sub1 
GROUP BY 1,2,3,4,5,6 
ORDER BY 1,2</Sql>
            </Query>
            <Query>
              <Sql>zapros3 SELECT sum(sub.kol_vo), sum(sub.cost)  AS total_cost 
FROM 
(SELECT d.dan_id, sp_uslug_id, cost, date_okaz, ok.doctor_id, doc.sp_spec_doctor_id, doc.dan_id AS doc_dan_id, 
inference_diagnosis AS diagn_id, doc.sp_otdel_id, ok.result_code, kol_vo 
FROM okaz_uslug_tab ok 
LEFT JOIN dan_tab d ON d.dan_id = ok.dan_id 
LEFT JOIN doctor_tab doc ON doc.id = ok.doctor_id 
WHERE (ok.reestr_date BETWEEN ':period_1_:' AND ':period_2_:') 
AND ok.sp_uslug_id IS NOT NULL AND ok.kol_vo &gt; 0 
AND d.strcom_region_id != get_our_region_code() 
AND  :otdel_param_1_: 
AND :strcom_param_1_: 
) AS sub</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="otdel_param" Caption="Отделение" Type="select">
              <Sql>select 'true','Все',0 union select 'doc.sp_otdel_id='||'9004','Амбулатория Сокол',1 union select 'doc.sp_otdel_id!='||'9004','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
            </Parameter>
            <Parameter Name="period" Caption="Период" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
              <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders>
        <Folder Name="Лаборатория">
          <Reports>
            <Report Id="2023703000" Name="Реестр ОМС Эндоскопич.центр (пациенты)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\ФОМС\Лаборатория\Реестр ОМС Эндоскопич.центр (пациенты).xls">
              <Queries>
                <Query>
                  <Sql>filename SELECT 'P'||get_lpu_number()::text</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 SELECT d.dan_id,sub.spolref AS spolref, conv_to_null(str.socr||' ')||str.name  as ulname, 
d.ser_pol, d.num_pol, 
d.pens, 
d.fam, d.nam, d.mid, 
d.date_born, 
CASE WHEN d.sex = 'м' THEN 1 ELSE 2 END as sex, 
s.code as strcom,  
substr(d.street_id,14,4) as str_code, 
a.sp_street_code as street_id, 
a.house_number, 
a.building, 
a.flat_number as flat, 
a.text_address, 
d.kateg_lgot_id, 
d.sozstatus_id, 
m.name as mest_work, 
m.inn, 
m.kpp, 
d.dogovor_number, 
d.okvd, 
d.policy_type, 
substring(a.sp_street_code,1,2) as regs, 
'' as nullstr , 
sum(sub.cena) 
FROM 
(SELECT DISTINCT d.id as dan_id, 
case when (f.otdel='9004' or f.otdel='401') then '2308011' 
else (select value from settings_tab where name='LPU_NUMBER' limit 1) end as spolref, 
COALESCE(usl.cost,0.0) as cena 
 
FROM okaz_uslug_tab okaz  
LEFT JOIN researches.rectoromanoscopia_tab r on r.researches_types_id=okaz.research_id 
left join codifiers.sp_uslug_tab usl on usl.id=okaz.sp_uslug_id 
LEFT JOIN dan_tab d  ON okaz.dan_id = d.dan_id   
left join full_doctor_tab f on f.full_doctor_id=okaz.doctor_id 
 
 
WHERE okaz.reestr_date BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id ='0300000000000'   
and :otdel_param_1_: and okaz.sp_uslug_id is not null 
 and f.otdel='2001' 
union 
 
--фиброгастроскопия 
SELECT DISTINCT d.id as dan_id, 
case when (f.otdel='9004' or f.otdel='401') then '2308011' 
else (select value from settings_tab where name='LPU_NUMBER' limit 1) end as spolref, 
COALESCE(usl.cost,0.0) as cena 
 
FROM okaz_uslug_tab okaz  
LEFT JOIN researches.fibrogastroscopia_tab r on r.researches_types_id=okaz.research_id 
left join codifiers.sp_uslug_tab usl on usl.id=okaz.sp_uslug_id  
LEFT JOIN dan_tab d  ON okaz.dan_id = d.dan_id 
left join full_doctor_tab f on f.full_doctor_id=okaz.doctor_id 
 
WHERE okaz.reestr_date BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id ='0300000000000'   
and :otdel_param_1_: and okaz.sp_uslug_id is not null 
 and f.otdel='2001' 
union 
 
--фиброколоноскопия 
SELECT DISTINCT d.id as dan_id, 
case when (f.otdel='9004' or f.otdel='401') then '2308011' 
else (select value from settings_tab where name='LPU_NUMBER' limit 1) end as spolref, 
COALESCE(usl.cost,0.0) as cena 
FROM okaz_uslug_tab okaz  
LEFT JOIN researches.fibrocoloniscopia_tab r on r.researches_types_id=okaz.research_id 
left join codifiers.sp_uslug_tab usl on usl.id=okaz.sp_uslug_id  
left join full_doctor_tab f on f.full_doctor_id=okaz.doctor_id 
LEFT JOIN dan_tab d  ON okaz.dan_id = d.dan_id 
 
WHERE okaz.reestr_date BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id ='0300000000000'   
and :otdel_param_1_: and okaz.sp_uslug_id is not null 
 and f.otdel='2001') AS sub 
 
LEFT JOIN dan_tab d ON d.dan_id = sub.dan_id 
LEFT JOIN codifiers.strcom_tab s ON s.id = d.strcom_id 
LEFT JOIN address_tab a ON a.dan_id = d.dan_id AND a.sp_addr_type_id = 1 
LEFT JOIN codifiers.mest_work_tab m ON m.id = d.mesto_work_id 
LEFT JOIN codifiers.sp_kladr_tab sp ON sp.code = substr(a.sp_street_code,1,11)||'00' 
LEFT JOIN codifiers.sp_street_tab str On str.code = a.sp_street_code 
 
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="otdel_param" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select 'f.otdel='||'''9004''','Амбулатория Сокол',1 union select 'f.otdel!='||'''9004''','Все, кроме Амбулатории Сокол',1 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="period" Caption="Период" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2023903000" Name="Реестр ОМС Эндоскопич.центр (услуги)" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\ФОМС\Лаборатория\Реестр ОМС Эндоскопич.центр (услуги).xls">
              <Queries>
                <Query>
                  <Sql>filename SELECT 'S'||get_lpu_number()::text</Sql>
                </Query>
                <Query>
                  <Sql>zapros1 SELECT DISTINCT '$id'::text, d.id as dan_id,  d.ser_pol, d.num_pol, d.pens, 
case when (f.otdel='9004' or f.otdel='401') then '2308011' 
else (select value from settings_tab where name='LPU_NUMBER' limit 1) end as spolref, 
0 as god, 
0 as mm, 
'' as srz_mcod, 
r.directional_diagnosis as ds, 		 
okaz.date_okaz d_u, 
usl.code as cod, 
1 as kol_vo_usl, 
o.reestr_code as otdel, 		 
0 as tds, 		 
'' as ds2, 	 
3 as be, 		 
okaz.doctor_id as tn1, 
d2.pens as vrss, 
 doc.sp_spec_doctor_id as post, 
usl.cost as cena 
 
FROM okaz_uslug_tab okaz 
left join researches.rectoromanoscopia_tab r on r.researches_types_id=okaz.research_id 
LEFT JOIN dan_tab d 			ON d.dan_id = okaz.dan_id 
LEFT JOIN spec_doctor_tab doc_sp 	ON doc_sp.kod_doctor = okaz.doctor_id 
LEFT JOIN otdel_tab o			ON o.otdel::text = doc_sp.otdel 
LEFT JOIN doctor_tab doc 		ON doc.id=okaz.doctor_id 
LEFT JOIN dan_tab d2 		ON d2.dan_id=doc.dan_id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.id=okaz.sp_uslug_id  
left join full_doctor_tab f on f.full_doctor_id=okaz.doctor_id   
WHERE okaz.reestr_date BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id ='0300000000000'   
and :otdel_param_1_: and okaz.sp_uslug_id is not null 
 and f.otdel='2001' 
union 
--фиброгастроскопия 
SELECT DISTINCT '$id'::text, d.id as dan_id,  d.ser_pol, d.num_pol, d.pens, 
case when (f.otdel='9004' or f.otdel='401') then '2308011' 
else (select value from settings_tab where name='LPU_NUMBER' limit 1) end as spolref, 
0 as god, 
0 as mm, 
'' as srz_mcod, 
r.directional_diagnosis as ds, 		 
okaz.date_okaz d_u, 
usl.code as cod, 
1 as kol_vo_usl, 
o.reestr_code as otdel, 		 
0 as tds, 		 
'' as ds2, 	 
3 as be, 		 
okaz.doctor_id as tn1, 
d2.pens as vrss, 
 doc.sp_spec_doctor_id as post, 
usl.cost as cena 
 
FROM okaz_uslug_tab okaz 
left join researches.fibrogastroscopia_tab r on r.researches_types_id=okaz.research_id 
LEFT JOIN dan_tab d 			ON d.dan_id = okaz.dan_id 
LEFT JOIN spec_doctor_tab doc_sp 	ON doc_sp.kod_doctor = okaz.doctor_id 
LEFT JOIN otdel_tab o			ON o.otdel::text = doc_sp.otdel 
LEFT JOIN doctor_tab doc 		ON doc.id=okaz.doctor_id 
LEFT JOIN dan_tab d2 		ON d2.dan_id=doc.dan_id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.id=okaz.sp_uslug_id  
left join full_doctor_tab f on f.full_doctor_id=okaz.doctor_id  
WHERE okaz.reestr_date BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id ='0300000000000'   
and :otdel_param_1_: and okaz.sp_uslug_id is not null 
 and f.otdel='2001' 
union 
--фиброколоноскопия 
SELECT DISTINCT '$id'::text, d.id as dan_id,  d.ser_pol, d.num_pol, d.pens, 
case when (f.otdel='9004' or f.otdel='401') then '2308011' 
else (select value from settings_tab where name='LPU_NUMBER' limit 1) end as spolref, 
0 as god, 
0 as mm, 
'' as srz_mcod, 
r.directional_diagnosis as ds, 		 
okaz.date_okaz d_u, 
usl.code as cod, 
1 as kol_vo_usl, 
o.reestr_code as otdel, 		 
0 as tds, 		 
'' as ds2, 	 
3 as be, 		 
okaz.doctor_id as tn1, 
d2.pens as vrss, 
 doc.sp_spec_doctor_id as post, 
usl.cost as cena 
 
FROM okaz_uslug_tab okaz 
left join researches.fibrocoloniscopia_tab r on r.researches_types_id=okaz.research_id 
LEFT JOIN dan_tab d 			ON d.dan_id = okaz.dan_id 
LEFT JOIN spec_doctor_tab doc_sp 	ON doc_sp.kod_doctor = okaz.doctor_id 
LEFT JOIN otdel_tab o			ON o.otdel::text = doc_sp.otdel 
LEFT JOIN doctor_tab doc 		ON doc.id=okaz.doctor_id 
LEFT JOIN dan_tab d2 		ON d2.dan_id=doc.dan_id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.id=okaz.sp_uslug_id  
left join full_doctor_tab f on f.full_doctor_id=okaz.doctor_id  
WHERE okaz.reestr_date BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id ='0300000000000'   
and :otdel_param_1_: and okaz.sp_uslug_id is not null 
 and f.otdel='2001'</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="otdel_param" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select '(f.otdel='||'''9004'' or f.otdel='||'''401'')','Амбулатория Сокол, ВСП',1 union select '(f.otdel!='||'''9004'' and f.otdel!='||'''401'')','Все, кроме Амбулатории Сокол, ВСП',1 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
            <Report Id="2024103000" Name="Реестр ОМС Эндоскопич.центр (услуги) с расшифровкой" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\ФОМС\Лаборатория\Реестр ОМС Эндоскопич.центр (услуги) с расшифровкой.xls">
              <Queries>
                <Query>
                  <Sql>zapros1 SELECT DISTINCT '$id'::text, d.id as dan_id,  d.ser_pol, d.num_pol, d.pens, 
case when (f.otdel='9004' or f.otdel='401') then '2308011' 
else (select value from settings_tab where name='LPU_NUMBER' limit 1) end as spolref, 
0 as god, 
0 as mm, 
'' as srz_mcod, 
r.directional_diagnosis as ds, 		 
okaz.date_okaz d_u, 
usl.name as cod, 
1 as kol_vo_usl, 
o.nam_otdel as otdel, 		 
0 as tds, 		 
'' as ds2, 	 
3 as be, 		 
f.full_fio as tn1, 
d2.pens as vrss, 
 doc.sp_spec_doctor_id as post, 
usl.cost as cena 
 
FROM okaz_uslug_tab okaz 
LEFT JOIN researches.rectoromanoscopia_tab r ON okaz.table_link_name = 'researches.rectoromanoscopia_tab' AND okaz.table_link_id = r.id    ---r.researches_types_id=okaz.research_id 
LEFT JOIN dan_tab d 			ON d.dan_id = okaz.dan_id 
LEFT JOIN spec_doctor_tab doc_sp 	ON doc_sp.kod_doctor = okaz.doctor_id 
LEFT JOIN otdel_tab o			ON o.otdel::text = doc_sp.otdel 
LEFT JOIN doctor_tab doc 		ON doc.id=okaz.doctor_id 
LEFT JOIN dan_tab d2 		ON d2.dan_id=doc.dan_id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.id=okaz.sp_uslug_id  
left join full_doctor_tab f on f.full_doctor_id=okaz.doctor_id 
left join codifiers.endoscopic_diagnosis_tab diag on diag.id=r.naprav_diagnosis::bigint   
WHERE okaz.reestr_date BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id ='0300000000000'   
and :otdel_param_1_: and okaz.sp_uslug_id is not null 
 and f.otdel='2001' 
union 
--фиброгастроскопия 
SELECT DISTINCT '$id'::text, d.id as dan_id,  d.ser_pol, d.num_pol, d.pens, 
case when (f.otdel='9004' or f.otdel='401') then '2308011' 
else (select value from settings_tab where name='LPU_NUMBER' limit 1) end as spolref, 
0 as god, 
0 as mm, 
'' as srz_mcod, 
r.directional_diagnosis as ds, 		 
okaz.date_okaz d_u, 
usl.name as cod, 
1 as kol_vo_usl, 
o.nam_otdel as otdel, 		 
0 as tds, 		 
'' as ds2, 	 
3 as be, 		 
f.full_fio as tn1, 
d2.pens as vrss, 
 doc.sp_spec_doctor_id as post, 
usl.cost as cena 
 
FROM okaz_uslug_tab okaz 
LEFT JOIN researches.fibrogastroscopia_tab r ON okaz.table_link_name = 'researches.fibrogastroscopia_tab' AND okaz.table_link_id = r.id    ---r.researches_types_id=okaz.research_id 
LEFT JOIN dan_tab d 			ON d.dan_id = okaz.dan_id 
LEFT JOIN spec_doctor_tab doc_sp 	ON doc_sp.kod_doctor = okaz.doctor_id 
LEFT JOIN otdel_tab o			ON o.otdel::text = doc_sp.otdel 
LEFT JOIN doctor_tab doc 		ON doc.id=okaz.doctor_id 
LEFT JOIN dan_tab d2 		ON d2.dan_id=doc.dan_id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.id=okaz.sp_uslug_id  
left join full_doctor_tab f on f.full_doctor_id=okaz.doctor_id 
left join codifiers.endoscopic_diagnosis_tab diag on diag.id=r.naprav_diagnosis::bigint   
WHERE okaz.reestr_date BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id ='0300000000000'   
and :otdel_param_1_: and okaz.sp_uslug_id is not null 
  and f.otdel='2001' 
union 
--фиброколоноскопия 
SELECT DISTINCT '$id'::text, d.id as dan_id,  d.ser_pol, d.num_pol, d.pens, 
case when (f.otdel='9004' or f.otdel='401') then '2308011' 
else (select value from settings_tab where name='LPU_NUMBER' limit 1) end as spolref, 
0 as god, 
0 as mm, 
'' as srz_mcod, 
r.directional_diagnosis as ds, 		 
okaz.date_okaz d_u, 
usl.name as cod, 
1 as kol_vo_usl, 
o.nam_otdel as otdel, 		 
0 as tds, 		 
'' as ds2, 	 
3 as be, 		 
f.full_fio as tn1, 
d2.pens as vrss, 
 doc.sp_spec_doctor_id as post, 
usl.cost as cena 
 
FROM okaz_uslug_tab okaz 
LEFT JOIN researches.fibrocoloniscopia_tab r ON  okaz.table_link_name = 'researches.fibrocoloniscopia_ta' AND okaz.table_link_id = r.id    ---r.researches_types_id=okaz.research_id 
LEFT JOIN dan_tab d 			ON d.dan_id = okaz.dan_id 
LEFT JOIN spec_doctor_tab doc_sp 	ON doc_sp.kod_doctor = okaz.doctor_id 
LEFT JOIN otdel_tab o			ON o.otdel::text = doc_sp.otdel 
LEFT JOIN doctor_tab doc 		ON doc.id=okaz.doctor_id 
LEFT JOIN dan_tab d2 		ON d2.dan_id=doc.dan_id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.id=okaz.sp_uslug_id  
left join full_doctor_tab f on f.full_doctor_id=okaz.doctor_id 
left join codifiers.endoscopic_diagnosis_tab diag on diag.id=r.naprav_diagnosis::bigint   
WHERE okaz.reestr_date BETWEEN ':period_1_:'  AND ':period_2_:' 
AND :strcom_param_1_: and d.strcom_region_id ='0300000000000'   
and :otdel_param_1_: and okaz.sp_uslug_id is not null 
 and f.otdel='2001'</Sql>
                </Query>
              </Queries>
              <Parameters>
                <Parameter Name="period" Caption="Дата" Type="date_period">
                  <Sql />
                </Parameter>
                <Parameter Name="otdel_param" Caption="Отделение" Type="select">
                  <Sql>select 'true','Все',0 union select '(f.otdel='||'''9004'' or f.otdel='||'''401'')','Амбулатория Сокол, ВСП',1 union select '(f.otdel!='||'''9004'' and f.otdel!='||'''401'')','Все, кроме Амбулатории Сокол, ВСП',1 order by 3,2</Sql>
                </Parameter>
                <Parameter Name="strcom_param" Caption="Страховая компания" Type="select">
                  <Sql>SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2</Sql>
                </Parameter>
              </Parameters>
            </Report>
          </Reports>
          <Folders />
        </Folder>
      </Folders>
    </Folder>
    <Folder Name="Отчеты по прикреплению населения">
      <Reports>
        <Report Id="2025503000" Name="Журнал прикрепления населения" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по прикреплению населения\Журнал прикрепления населения.xls">
          <Queries>
            <Query>
              <Sql>zapros1 select * from ( 
select distinct on (d.dan_id) '$id', 
coalesce(p.fam,'')||' '||coalesce(p.nam,'')||' '||coalesce(p.mid,'') as p1, 
d.date_born as s9, 
d.date_born as p2,  
d.address as p3, 
d1.fio as p4, 
p.date_prik as p5, 
d.fakt_adr as p6, 
u1.name p7, 
case when d.vid_prik_id = 0 then 'Нет' else 'Да' end as p8, 
reg.name||' '||s.name as p9, 
coalesce(d.ser_pol,'')||' '||d.num_pol as p10 
from prik_zayav_tab p 
left join dan_tab d on p.dan_id=d.dan_id 
left join codifiers.strcom_tab s on s.id=d.strcom_id 
left join kladr_tab reg on  reg.code=s.region_id 
left join users_tab u on u.id=p.operator_id 
left join dan_tab d1 on d1.dan_id=u.dan_id 
left join codifiers.uchactok_tab u1 on u1.id=d.uchactok_id 
where date_prik between date(':param1_1_:') and date(':param1_2_:')) as sub 
 
 order by 2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата прикрепления" Type="date_period">
              <Sql />
            </Parameter>
          </Parameters>
        </Report>
        <Report Id="2034103000" Name="Реестр прикрепленных" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по прикреплению населения\Реестр прикрепленных.xls">
          <Queries>
            <Query>
              <Sql>filename select 'MO2'|| 
case when (SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1)='2301001' 
then '032021' 
when (SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1)='2301002' 
then '032022' end||to_char(':param1_2_:'::date,'yyyymmdd')</Sql>
            </Query>
            <Query>
              <Sql>z1 select * from ( 
select distinct on (d.dan_id) d.fam, 
d.data_proverki_polis as k2, 
d.proverka_error as k1, 
d.nam as p1, 
d.mid as p2, 
d.date_born as p3, 
case when d.sex='м' then 1 else 2 end as p4, 
d.vid_doc_id as p29, 
d.serdoc as p30, 
d.numdoc as p31, 
d.date_output as p32, 
d.kem_output as p33, 
d.policy_type as p34, 
d.ser_pol as p5, 
d.num_pol as p6, 
s.code as p7, 
case when (SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1)='2301001' then '032021' 
when (SELECT value FROM settings_tab WHERE name='LPU_NUMBER' LIMIT 1)='2301002' then '032022' end as p8, 
p.date_prik as p9, 
'' as p10, 
'' as p11, 
'2' as p12, 
coalesce(str.ocatd,k4.ocatd,k2.ocatd) as p13, 
k2.name as p14, 
k4.name as p15, 
str.name as p16, 
a.house_number as p17, 
a.building as p18, 
a.flat_number as p19, 
'' as p20, 
'' as p21, 
'' as p22, 
k5.snils as p24, 
k5.fam as p25, 
k5.nam as p26, 
k5.mid as p27, 
k6.code as p28 
from prik_zayav_tab p 
left join dan_tab d on p.dan_id=d.dan_id 
left join codifiers.strcom_tab s on s.id=d.strcom_id 
left join address_tab a on a.dan_id=d.dan_id and a.sp_addr_type_id=1 
LEFT JOIN codifiers.sp_street_tab str ON str.code = a.sp_street_code 
LEFT JOIN codifiers.sp_kladr_tab k2 ON rpad(substring(a.street_id for 5),13,'0') = k2.code 
LEFT JOIN codifiers.sp_kladr_tab k4 ON rpad(substring(a.street_id for 12),13,'0') = k4.code 
LEFT JOIN public.uchastok_m2 k5 ON k5.uchactok_id=d.uchactok_id 
LEFT JOIN codifiers.uchactok_tab k6 ON k6.id=k5.uchactok_id 
where p.date_prik between date(':param1_1_:') and date(':param1_2_:') 
and :param2_1_:) as sub 
 
 order by 1,2,3</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="param1" Caption="Дата" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param2" Caption="СМО" Type="select">
              <Sql>select 'true','Все',0 union select ' d.strcom_id='||id,name,1 from codifiers.strcom_tab  where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) union select ' d.strcom_region_id != get_our_region_code() ','Иногородние',2 order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
    <Folder Name="Отчеты по услугам">
      <Reports>
        <Report Id="2025903000" Name="Список пациентов по коду услуги" Path="D:\aldar\work\ambulance_1\plugins_reports\plugins_reports\externals\Reports\Отчеты по услугам\Список пациентов по коду услуги.xls">
          <Queries>
            <Query>
              <Sql>z1 SELECT '$id'::text, d.fio as p1, d.date_born as p2, d.address as p3, 
usl.code||' '||usl.name as p4,  :param1_1_: as p5 
FROM visit_tab v 
LEFT JOIN talon_tab t 			ON t.talon_id = v.talon_id 
LEFT JOIN dan_tab d 			ON d.dan_id = t.dan_id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.code=v.conv_usl_code 
left join full_doctor_tab f on f.full_doctor_id=v.doctor_id 
LEFT JOIN codifiers.reestr_mkb_tab r on r.mkb=t.diag_osn 
WHERE :param1_1_: BETWEEN ':period_1_:'  AND ':period_2_:' 
AND t.strcom_region_id ='0300000000000'  
and (t.vid_oplat_id in (0,3,6,7)) 
and f.dolg_doctor_id not in (167,13,152,159,900,403,603001) 
and (f.otdel!='2001' or f.otdel != '203001' or f.otdel is null) 
and t.diag_osn is not null AND v.conv_usl_code IS NOT NULL and r.oms!=1 
and :param2_1_: 
 UNION 
--госпитализация 
 SELECT '$id'::text, d.fio as p1, d.date_born as p2, d.address as p3, 
usl.code||' '||usl.name as p4,  h.date_end as p5 
FROM hosp_tab h 
LEFT JOIN dan_tab d 			ON d.dan_id =h.dan_id 
left join full_doctor_tab f on f.full_doctor_id=h.operator_id 
LEFT JOIN codifiers.sp_uslug_tab usl ON usl.code=(case when (DATE_PART('year',AGE(h.date_begin, d.date_born)) between 0 and 17) then 
	case when h.stacionar_type=4 then  '198304' 
	WHEN h.stacionar_type = 5 THEN '161131' 
		else '198305' end 
	else case when h.stacionar_type=4 then  '098304' 
	WHEN h.stacionar_type = 5 THEN '061131' 
		else '098305' end end) 
LEFT JOIN codifiers.reestr_mkb_tab r on r.mkb=h.diagn  
WHERE h.date_end BETWEEN ':period_1_:'  AND ':period_2_:' 
 and d.strcom_region_id ='0300000000000'  
and f.dolg_doctor_id not in (167,403,603001)  
and (f.otdel!='2001' or f.otdel != '203001' or f.otdel is null) 
and h.diagn is not null and r.oms!=1 
and :param2_1_: 
order by 2</Sql>
            </Query>
          </Queries>
          <Parameters>
            <Parameter Name="period" Caption="Дата оказания" Type="date_period">
              <Sql />
            </Parameter>
            <Parameter Name="param1" Caption="Считать по" Type="select2">
              <Sql>v.data_pos=дате посещения|v.data_vnes_inf=дате внесения визита</Sql>
            </Parameter>
            <Parameter Name="param2" Caption="Услуга" Type="select">
              <Sql>select 'true','Все',0 union select 'usl.code::int4='||code,code||' '||name,1 from codifiers.sp_uslug_tab order by 3,2</Sql>
            </Parameter>
          </Parameters>
        </Report>
      </Reports>
      <Folders />
    </Folder>
  </Folders>
</ReportSchema>