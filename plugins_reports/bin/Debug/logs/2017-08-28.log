2017-08-28 11:30:26.2995 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 11:30:29.1906 DEBUG Получено записей: 447
2017-08-28 11:34:21.2493 DEBUG Запрос: select 'true','Все',0 union select 'f.otdel='''||otdel||'''',nam_otdel,1 from otdel_tab  order by 3,2
2017-08-28 11:34:21.2653 DEBUG Получено записей: 31
2017-08-28 11:34:21.3163 DEBUG Запрос: select 'true','Все',1 union select 'd.strcom_region_id = get_our_region_code()','Да',2 union select 'd.strcom_region_id <> get_our_region_code()','Нет',3 order by 3,2
2017-08-28 11:34:21.3223 DEBUG Получено записей: 3
2017-08-28 11:34:21.3503 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 11:34:21.3503 DEBUG Получено записей: 8
2017-08-28 11:34:21.3853 DEBUG Запрос: select 'true','Все',0 union select 'd.uchactok_id='||id,name,1 from codifiers.uchactok_tab  order by 3,2
2017-08-28 11:34:21.3853 DEBUG Получено записей: 78
2017-08-28 11:34:29.7698 DEBUG Запрос: select f.full_fio, 
/*count(distinct dd.id||'_'||case when c.dd_stage=2 then null else 1 end) as p1 */ 
 count(distinct d.fam||'_'||d.nam||'_'||d.mid||'_'||d.date_born) as p1 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
JOIN okaz_uslug_tab ok ON ok.table_link_name = 'dop_disp_main_tab' 
		AND ok.table_link_id = dd.id AND c.dd_stage = ok.bur_dd_magic_number 
 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
where (case when 'enddate'='enddate' then ok.sluch_date_end 
         when 'enddate'='infdate' then dd.date_vnes_inf  
         when 'enddate'='acceptdate' then ok.accept_date end 
         BETWEEN '2017-08-01' AND '2017-08-28')  
 
					 AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL 
 
and ok.sp_uslug_id IS NOT NULL AND ok.kol_vo > 0 
and d.num_pol is not null and d.policy_type is not null 
and case when coalesce(ok.paid, false)=false then coalesce(dd.errors_common,'')='' else true end 
and coalesce(d.date_smerti, '01.01.3000'::date) > ok.sluch_date_end and coalesce(d.life,0) in (0, 2) 
 
and true and true and d.uchactok_id=20603001 and true  AND dd.maked_proc>=85 
 
group by 1 
order by 1
2017-08-28 11:34:29.9918 DEBUG Получено записей: 2
2017-08-28 11:34:58.4565 DEBUG Запрос: select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2
2017-08-28 11:34:58.4635 DEBUG Получено записей: 3
2017-08-28 11:34:58.5005 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 11:34:58.5005 DEBUG Получено записей: 8
2017-08-28 11:35:30.9703 DEBUG SQL Error: ERROR: 42601: syntax error at or near "when"
2017-08-28 11:39:45.6414 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 11:39:48.4444 DEBUG Получено записей: 447
2017-08-28 11:41:04.0895 DEBUG Запрос: select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2
2017-08-28 11:41:04.0995 DEBUG Получено записей: 3
2017-08-28 11:41:04.1295 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 11:41:04.1295 DEBUG Получено записей: 8
2017-08-28 11:42:24.6297 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 11:42:27.6997 DEBUG Получено записей: 447
2017-08-28 11:42:33.3297 DEBUG Запрос: select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2
2017-08-28 11:42:33.3397 DEBUG Получено записей: 3
2017-08-28 11:42:33.3697 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 11:42:33.3697 DEBUG Получено записей: 8
2017-08-28 11:43:18.6851 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 11:43:21.1533 DEBUG Получено записей: 447
2017-08-28 11:43:27.3354 DEBUG Запрос: select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2
2017-08-28 11:43:27.3454 DEBUG Получено записей: 3
2017-08-28 11:43:27.3754 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 11:43:27.3954 DEBUG Получено записей: 8
2017-08-28 11:51:00.0254 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 11:51:02.5916 DEBUG Получено записей: 447
2017-08-28 11:51:24.0518 DEBUG Запрос: select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2
2017-08-28 11:51:24.0518 DEBUG Получено записей: 3
2017-08-28 11:51:24.0808 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 11:51:24.0808 DEBUG Получено записей: 8
2017-08-28 11:52:56.3854 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 11:52:59.5744 DEBUG Получено записей: 447
2017-08-28 11:53:08.4785 DEBUG Запрос: select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2
2017-08-28 11:53:08.4785 DEBUG Получено записей: 3
2017-08-28 11:53:08.5085 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 11:53:08.5085 DEBUG Получено записей: 8
2017-08-28 11:53:29.6255 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 11:53:32.6055 DEBUG Получено записей: 447
2017-08-28 11:53:37.4795 DEBUG Запрос: select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2
2017-08-28 11:53:37.4895 DEBUG Получено записей: 3
2017-08-28 11:53:37.5095 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 11:53:37.5095 DEBUG Получено записей: 8
2017-08-28 11:54:02.1126 DEBUG SQL Error: ERROR: 42601: syntax error at or near "when"
2017-08-28 11:54:42.8647 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 11:54:45.6397 DEBUG Получено записей: 447
2017-08-28 11:54:50.2897 DEBUG Запрос: select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2
2017-08-28 11:54:50.2997 DEBUG Получено записей: 3
2017-08-28 11:54:50.3197 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 11:54:50.3327 DEBUG Получено записей: 8
2017-08-28 11:55:15.7808 DEBUG SQL Error: ERROR: 42601: syntax error at or near "when"
2017-08-28 11:56:48.0640 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 11:56:50.9160 DEBUG Получено записей: 447
2017-08-28 11:56:56.0021 DEBUG Запрос: select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2
2017-08-28 11:56:56.0221 DEBUG Получено записей: 3
2017-08-28 11:56:56.0621 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 11:56:56.0721 DEBUG Получено записей: 8
2017-08-28 11:57:17.5001 DEBUG SQL Error: ERROR: 42601: syntax error at or near "when"
2017-08-28 12:02:35.3800 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 12:02:38.1432 DEBUG Получено записей: 447
2017-08-28 12:02:44.2855 DEBUG Запрос: select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2
2017-08-28 12:02:44.2935 DEBUG Получено записей: 3
2017-08-28 12:02:44.3155 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 12:02:44.3235 DEBUG Получено записей: 8
2017-08-28 12:03:06.3288 DEBUG SQL Error: ERROR: 42601: syntax error at or near "when"
2017-08-28 12:04:21.9401 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 12:04:24.7313 DEBUG Получено записей: 447
2017-08-28 12:04:31.7167 DEBUG Запрос: SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2
2017-08-28 12:04:31.7167 DEBUG Получено записей: 5
2017-08-28 12:06:28.0248 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 12:06:31.1718 DEBUG Получено записей: 447
2017-08-28 12:07:10.1844 DEBUG Запрос: SELECT ' true ', 'Все',0 UNION SELECT  '(d.strcom_id = '||id::text||' OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id ='||id::text||' ))',  name,1 from codifiers.strcom_tab where region_id=get_our_region_code() AND (parent_id IS NULL OR parent_id = id) order by 3,2
2017-08-28 12:07:10.1944 DEBUG Получено записей: 5
2017-08-28 12:08:40.6428 DEBUG Запрос: select distinct '$id'::text, 
d.fio as p1, 
d.sex as p2, 
d.date_born as p3, 
d.mest_born as p4, 
coalesce(d.serdoc ,'')||' '||coalesce(d.numdoc,'') as p5, 
d.fakt_adr as p6, 
d.address as p7, 
d.pens as p8, 
coalesce(d.ser_pol,'')||' '||coalesce(d.num_pol,'') as p9, 
1 as p10, 
diag.mkb_code as p11, 
dd.conv_price as p12, 
dd.result_stage_1 as p13, 
'$id'::text as p14, 
m1.measure_date as p15, 
mp1.spec_code as p16, 
m2.measure_date as p17, 
mp2.spec_code as p18, 
m3.measure_date as p19, 
mp3.spec_code as p20, 
m4.measure_date as p21, 
mp4.spec_code as p22, 
m5.measure_date as p23, 
mp5.spec_code as p24, 
m6.measure_date as p25, 
mp6.spec_code as p26, 
m7.measure_date as p27, 
mp7.spec_code as p28, 
m8.measure_date as p29, 
mp8.spec_code as p30, 
m9.measure_date as p31, 
mp9.spec_code as p32, 
m10.measure_date as p33, 
mp10.spec_code as p34, 
m11.measure_date as p35, 
mp11.spec_code as p36, 
m12.measure_date as p37, 
mp12.spec_code as p38, 
m13.measure_date as p39, 
mp13.spec_code as p40, 
m14.measure_date as p41, 
mp14.spec_code as p42, 
m15.measure_date as p43, 
mp15.spec_code as p44, 
m16.measure_date as p45, 
mp16.spec_code as p46, 
m17.measure_date as p47, 
mp17.spec_code as p48, 
m18.measure_date as p49, 
mp18.spec_code as p50, 
m19.measure_date as p51, 
mp19.spec_code as p52, 
m20.measure_date as p53, 
mp20.spec_code as p54, 
m21.measure_date as p55, 
mp21.spec_code as p56 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
left join dop_disp_diagns_tab diag on diag.dop_disp_main_id = dd.id /*and diag.sp_disease_vid_id=200001 */ 
left join codifiers.uchactok_tab uch on uch.id=d.uchactok_id 
LEFT JOIN dop_disp_measures_tab m1 ON m1.dop_disp_main_id = dd.id 
and m1.dop_disp_measure_id=100000 
LEFT JOIN dop_disp_measures_tab m2 ON m2.dop_disp_main_id = dd.id 
and m2.dop_disp_measure_id=200000 
LEFT JOIN dop_disp_measures_tab m3 ON m3.dop_disp_main_id = dd.id 
and m3.dop_disp_measure_id=300000 
LEFT JOIN dop_disp_measures_tab m4 ON m4.dop_disp_main_id = dd.id 
and m4.dop_disp_measure_id=400000 
LEFT JOIN dop_disp_measures_tab m5 ON m5.dop_disp_main_id = dd.id 
and m5.dop_disp_measure_id=500000 
LEFT JOIN dop_disp_measures_tab m6 ON m6.dop_disp_main_id = dd.id 
and m6.dop_disp_measure_id=600000 
LEFT JOIN dop_disp_measures_tab m7 ON m7.dop_disp_main_id = dd.id 
and m7.dop_disp_measure_id=700000 
LEFT JOIN dop_disp_measures_tab m8 ON m8.dop_disp_main_id = dd.id 
and m8.dop_disp_measure_id=800000 
LEFT JOIN dop_disp_measures_tab m9 ON m9.dop_disp_main_id = dd.id 
and m9.dop_disp_measure_id=900000 
LEFT JOIN dop_disp_measures_tab m10 ON m10.dop_disp_main_id = dd.id 
and m10.dop_disp_measure_id=1000000 
LEFT JOIN dop_disp_measures_tab m11 ON m11.dop_disp_main_id = dd.id 
and m11.dop_disp_measure_id=1100000 
LEFT JOIN dop_disp_measures_tab m12 ON m12.dop_disp_main_id = dd.id 
and m12.dop_disp_measure_id=1200000 
LEFT JOIN dop_disp_measures_tab m13 ON m13.dop_disp_main_id = dd.id 
and m13.dop_disp_measure_id=1300000 
LEFT JOIN dop_disp_measures_tab m14 ON m14.dop_disp_main_id = dd.id 
and m14.dop_disp_measure_id=1400000 
LEFT JOIN dop_disp_measures_tab m15 ON m15.dop_disp_main_id = dd.id 
and m15.dop_disp_measure_id=1500000 
LEFT JOIN dop_disp_measures_tab m16 ON m16.dop_disp_main_id = dd.id 
and m16.dop_disp_measure_id=1600000 
LEFT JOIN dop_disp_measures_tab m17 ON m17.dop_disp_main_id = dd.id 
and m17.dop_disp_measure_id=1700000 
LEFT JOIN dop_disp_measures_tab m18 ON m18.dop_disp_main_id = dd.id 
and m18.dop_disp_measure_id=1800000 
LEFT JOIN dop_disp_measures_tab m19 ON m19.dop_disp_main_id = dd.id 
and m19.dop_disp_measure_id=1900000 
LEFT JOIN dop_disp_measures_tab m20 ON m20.dop_disp_main_id = dd.id 
and m20.dop_disp_measure_id=2000000 
LEFT JOIN dop_disp_measures_tab m21 ON m21.dop_disp_main_id = dd.id 
and m21.dop_disp_measure_id=2100000 
left join dop_disp_measure_profiles_tab mp1 on mp1.dop_disp_measure_id=100000 and m1.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp2 on mp2.dop_disp_measure_id=200000  and m2.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp3 on mp3.dop_disp_measure_id=300000  and m3.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp4 on mp4.dop_disp_measure_id=400000  and m4.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp5 on mp5.dop_disp_measure_id=500000  and m5.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp6 on mp6.dop_disp_measure_id=600000  and m6.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp7 on mp7.dop_disp_measure_id=700000  and m7.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp8 on mp8.dop_disp_measure_id=800000  and m8.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp9 on mp9.dop_disp_measure_id=900000  and m9.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp10 on mp10.dop_disp_measure_id=1000000  and m10.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp11 on mp11.dop_disp_measure_id=1100000  and m11.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp12 on mp12.dop_disp_measure_id=1200000  and m12.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp13 on mp13.dop_disp_measure_id=1300000  and m13.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp14 on mp14.dop_disp_measure_id=1400000  and m14.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp15 on mp15.dop_disp_measure_id=1500000  and m15.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp16 on mp16.dop_disp_measure_id=1600000  and m16.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp17 on mp17.dop_disp_measure_id=1700000  and m17.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp18 on mp18.dop_disp_measure_id=1800000  and m18.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp19 on mp19.dop_disp_measure_id=1900000  and m19.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp20 on mp20.dop_disp_measure_id=2000000  and m20.dop_disp_measure_id is not null 
left join dop_disp_measure_profiles_tab mp21 on mp21.dop_disp_measure_id=2100000  and m21.dop_disp_measure_id is not null 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
WHERE 
((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN'2017-08-20' AND '2017-08-28') 
					/*OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN '2017-08-20' AND '2017-08-28')*/) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL AND  (d.strcom_id = 103003001 OR d.strcom_id IN (SELECT id FROM codifiers.strcom_tab WHERE parent_id =103003001 ))  AND dd.maked_proc>=85 
ORDER BY 2
2017-08-28 12:09:39.8379 DEBUG Получено записей: 2025
2017-08-28 12:20:22.2840 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 12:20:25.4840 DEBUG Получено записей: 447
2017-08-28 12:20:45.0481 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:45.1081 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:45.1881 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:45.2481 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:45.3181 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:45.3981 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:45.4581 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:45.5081 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:45.5781 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:45.6781 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:45.7281 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:46.6531 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:47.2531 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:47.3131 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:47.3731 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:47.4631 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:47.5231 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:47.7231 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:48.0431 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:48.1431 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:48.2131 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:48.3331 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:48.3831 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:48.5931 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:48.9331 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:49.0131 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:49.0831 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:49.1831 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:49.5531 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:50.9271 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:51.2571 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:52.2771 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:52.3641 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:52.5851 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:52.9051 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:52.9651 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:53.0151 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:53.1231 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:53.3811 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:54.0311 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:54.3511 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:55.0181 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:55.0781 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:55.2681 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:55.5741 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:55.6441 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:55.7141 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:55.8041 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:56.1341 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:56.7841 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:57.3841 DEBUG SQL Error: ERROR: 42703: column "result" does not exist
2017-08-28 12:20:58.0281 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:58.0781 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:58.1381 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:58.1881 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:58.2631 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:58.3431 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:58.4331 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:58.5031 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:58.5531 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:58.6131 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:58.6631 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:58.7131 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:58.7731 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:58.8331 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:58.8831 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:58.9431 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:59.0331 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:59.0831 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:59.1331 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:59.1831 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:59.2331 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:59.2831 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:59.3331 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:59.3941 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:59.4741 DEBUG SQL Error: ERROR: 42804: argument of AND must be type boolean, not type character
2017-08-28 12:20:59.5241 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:59.6641 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:20:59.8141 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:59.9041 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:20:59.9541 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:21:00.0141 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:21:00.1141 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:21:00.1541 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:21:00.2041 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:21:00.2741 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:21:00.3341 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:21:00.4241 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:21:00.4741 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:21:00.5241 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:21:00.6041 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:21:00.6741 DEBUG SQL Error: ERROR: 42703: column "sozstatus" does not exist
2017-08-28 12:21:00.7341 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:21:00.8041 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:21:00.8941 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:21:00.9641 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:21:01.0341 DEBUG SQL Error: ERROR: 42703: column "magik" does not exist
2017-08-28 12:21:18.9461 DEBUG Запрос: select 'true','Все',0 union select 'dd.doctor_id='||full_doctor_id, full_fio,1 from full_doctor_tab order by 3,2
2017-08-28 12:21:19.4161 DEBUG Получено записей: 935
2017-08-28 12:21:19.5361 DEBUG Запрос: select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2
2017-08-28 12:21:19.5461 DEBUG Получено записей: 31
2017-08-28 12:21:31.4791 DEBUG Запрос: select '$id'::text, 
d.fio as p1, 
d.date_born as p2, 
d.fakt_adr as p3, 
d.address as p4, 
join_str(distinct ds.mkb_code) as p5, 
uch.name as p6, 
f.fio as p7 
FROM dop_disp_main_tab dd 
LEFT JOIN dan_tab d ON d.dan_id = dd.dan_id 
LEFT JOIN dop_disp_measures_tab m ON m.dop_disp_main_id = dd.id 
LEFT JOIN codifiers.dop_disp_measures_tab c ON c.id = m.dop_disp_measure_id 
LEFT JOIN okaz_uslug_tab u ON u.table_link_name = 'dop_disp_measures_tab' 
		AND u.table_link_id = m.id 
left join codifiers.uchactok_tab uch on uch.id=d.uchactok_id 
LEFT JOIN dop_disp_diagns_tab ds ON ds.dop_disp_main_id = dd.id /*AND ds.sp_disease_vid_id = 200001 */ 
left join full_doctor_tab f on f.full_doctor_id=dd.doctor_id 
WHERE 
 ((c.dd_stage = 1 AND dd.result_stage_1 IS NOT NULL 
                    AND date_reestr_first_stage BETWEEN '2017-08-20' AND '2017-08-28') 
					OR (dd.result_stage_1 IS NOT NULL 
                    AND c.dd_stage = 2 AND dd.result_stage_2 IS NOT NULL 
					AND date_reestr_second_stage BETWEEN '2017-08-20' AND '2017-08-28')) 
					/*AND u.auto_flag = 0*/ AND ds.mkb_code IS NOT NULL 
                    AND dd.gr_obsl_id IS NOT NULL 
and dd.result_stage_1 BETWEEN 420 AND 423 
 AND dd.maked_proc>=85 
and true 
and true 
group by 1,2,3,4,5,7,8 
ORDER BY 2
2017-08-28 12:21:31.9791 DEBUG Получено записей: 76
2017-08-28 13:08:28.8658 DEBUG Запрос: with recursive t as (
               select array[stat_id] as hierarchy
                     , stat_id
                     , parent_id
                     , desk
                     , period_xml
                     , 1 as level
               from  public.stat_tab
               where parent_id = -1
               union all
               select t.hierarchy || a.stat_id
                     , a.stat_id
                     , a.parent_id
                     , a.desk
                     , a.period_xml
                     , t.level + 1 as level
               from public.stat_tab a
               join t on a.parent_id = t.stat_id
               )
            select stat_id
                  , parent_id
                  , level
                  , desk
                  , period_xml
            from t
            order by hierarchy
2017-08-28 13:08:31.1410 DEBUG Получено записей: 447
2017-08-28 13:09:28.6433 DEBUG Запрос: select 'true','Все',0 union  SELECT 't.doctor_id ='||full_doctor_id, full_fio,1 FROM full_doctor_view ORDER BY 3,2;
2017-08-28 13:09:28.9133 DEBUG Получено записей: 935
2017-08-28 13:09:28.9983 DEBUG Запрос: select 'true','Все',0 union  select 't.cabinet_id='||id, name,1 from codifiers.cabinet_tab order by 3,2
2017-08-28 13:09:29.0113 DEBUG Получено записей: 193
2017-08-28 13:09:56.6829 DEBUG Запрос: SELECT t.time_nazn, d.fio FROM talon_doctor_tab t 
LEFT JOIN dan_tab d ON t.dan_id = d.dan_id 
WHERE t.date_nazn = '2017-08-28' AND true 
and true 
ORDER BY t.time_nazn
2017-08-28 13:09:56.8309 DEBUG Получено записей: 2620
2017-08-28 13:11:38.6847 DEBUG Запрос: SELECT full_doctor_id, full_doctor_id::text||' '||fio||' - '||dolg_doctor FROM full_doctor_tab  where dolg_doctor_id!=900 --where dolg_doctor ilike '%педиат%'  ORDER BY full_doctor_id
2017-08-28 13:11:38.9137 DEBUG Получено записей: 740
2017-08-28 13:11:38.9897 DEBUG Запрос: select -1, 'По всему ЛПУ' union SELECT uchactok_id, uchactok FROM uchactok_tab ORDER BY 1;
2017-08-28 13:11:38.9897 DEBUG Получено записей: 78
2017-08-28 13:11:55.4566 DEBUG Запрос: SELECT to_char('2017-08-20'::date + f.a,'dd.mm.yy'), ('2017-08-20'::date + f.a)::date AS p1 FROM generate_series(0,1000) as f(a) 
WHERE '2017-08-20'::date + f.a <='2017-08-28'::date ORDER BY ('2017-08-20'::date + f.a)::date
2017-08-28 13:11:55.7657 DEBUG Получено записей: 9
2017-08-28 13:21:06.3102 DEBUG Запрос: select 'true','Все',0 union select 'f.otdel::int='||otdel,nam_otdel,1 from otdel_tab order by 3,2
2017-08-28 13:21:06.3192 DEBUG Получено записей: 31
2017-08-28 13:21:06.3572 DEBUG Запрос: select 'd.spolref::int4 in (select * from get_all_lpu_numbers())','Да',1 union select 'd.spolref::int4 not in (select * from get_all_lpu_numbers())','Нет',2 union select 'true','Все',3 order by 3,2
2017-08-28 13:21:06.3622 DEBUG Получено записей: 3
2017-08-28 13:21:06.3872 DEBUG Запрос: select 'true','Все',0 union select ' d.strcom_region_id !=''7000000000000''','Иногородние',1 union select 'd.strcom_id ='||strcom_id, strcom,2 from strcom_tab where strcom_id<97 or strcom_id=99  order by 3,2
2017-08-28 13:21:06.3972 DEBUG Получено записей: 18
2017-08-28 13:21:06.4292 DEBUG Запрос: select 'true','Все',0 union select 'dd.dop_disp_type_id='||id,name,1 from codifiers.dop_disp_type_tab order by 3,2
2017-08-28 13:21:06.4292 DEBUG Получено записей: 8
